{"version":3,"file":"6059.32f6db30c885b9930c3b.js","mappings":"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","sources":["webpack://wai/./src/api/gramjs/localDb.ts","webpack://wai/./src/api/gramjs/apiBuilders/helpers.ts","webpack://wai/./src/lib/gramjs/client/uploadFile.ts","webpack://wai/./src/worker/msg/MsgCommandChatLab.ts","webpack://wai/./src/global/actions/api/chats.ts","webpack://wai/./src/global/actions/ui/calls.ts","webpack://wai/./src/global/reducers/calls.ts","webpack://wai/./src/lib/gramjs/Helpers.js","webpack://wai/./src/lib/gramjs/errors/index.js","webpack://wai/./src/lib/gramjs/tl/api.js","webpack://wai/./src/util/Deferred.ts"],"sourcesContent":["import BigInt from 'big-integer';\nimport type { Api as GramJs } from '../../lib/gramjs';\nimport type { ApiMessage } from '../types';\nimport { omitVirtualClassFields } from './apiBuilders/helpers';\nimport { DATA_BROADCAST_CHANNEL_NAME } from '../../config';\nimport { constructors } from '../../lib/gramjs/tl';\nimport { throttle } from '../../util/schedulers';\n\n// eslint-disable-next-line no-restricted-globals\nconst IS_MULTITAB_SUPPORTED = 'BroadcastChannel' in self;\n\nexport interface LocalDb {\n  localMessages: Record<string, ApiMessage>;\n  // Used for loading avatars and media through in-memory Gram JS instances.\n  chats: Record<string, GramJs.Chat | GramJs.Channel>;\n  users: Record<string, GramJs.User>;\n  messages: Record<string, GramJs.Message | GramJs.MessageService>;\n  documents: Record<string, GramJs.Document>;\n  stickerSets: Record<string, GramJs.StickerSet>;\n  photos: Record<string, GramJs.Photo>;\n  webDocuments: Record<string, GramJs.TypeWebDocument>;\n  cache: Record<string,any>;\n  botWaitReply: Record<string, undefined | {\n    command:string,\n    payload?:Record<string,any>\n  }>;\n}\n\nconst channel = IS_MULTITAB_SUPPORTED ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) : undefined;\n\nlet batchedUpdates: {\n  name: string;\n  prop: string;\n  value: any;\n}[] = [];\nconst throttledLocalDbUpdate = throttle(() => {\n  channel!.postMessage({\n    type: 'localDbUpdate',\n    batchedUpdates,\n  });\n  batchedUpdates = [];\n}, 100);\n\nfunction createProxy(name: string, object: any) {\n  return new Proxy(object, {\n    get(target, prop: string, value: any) {\n      return Reflect.get(target, prop, value);\n    },\n    set(target, prop: string, value: any) {\n      batchedUpdates.push({ name, prop, value });\n      throttledLocalDbUpdate();\n      return Reflect.set(target, prop, value);\n    },\n  });\n}\n\nfunction convertToVirtualClass(value: any): any {\n  if (value instanceof Uint8Array) return Buffer.from(value);\n  if (typeof value === 'object' && Object.keys(value).length === 1 && Object.keys(value)[0] === 'value') {\n    return BigInt(value.value);\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(convertToVirtualClass);\n  }\n\n  if (typeof value !== 'object' || !('CONSTRUCTOR_ID' in value)) {\n    return value;\n  }\n  const path = value.className.split('.');\n  const VirtualClass = path.reduce((acc: any, field: string) => {\n    return acc[field];\n  }, constructors);\n\n  const valueOmited = omitVirtualClassFields(value);\n  const valueConverted = Object.keys(valueOmited).reduce((acc, key) => {\n    acc[key] = convertToVirtualClass(valueOmited[key]);\n    return acc;\n  }, {} as Record<string, any>);\n\n  return new VirtualClass(valueConverted);\n}\n\nfunction createLocalDbInitial(initial?: LocalDb): LocalDb {\n  return [\n    'localMessages', 'chats', 'users', 'messages', 'documents', 'stickerSets', 'photos', 'webDocuments','cache','botWaitReply',\n  ]\n    .reduce((acc: Record<string, any>, key) => {\n      const value = initial?.[key as keyof LocalDb] ?? {};\n      const valueVirtualClass = Object.keys(value).reduce((acc2, key2) => {\n        acc2[key2] = convertToVirtualClass(value[key2]);\n        return acc2;\n      }, {} as Record<string, any>);\n\n      acc[key] = IS_MULTITAB_SUPPORTED\n        ? createProxy(key, valueVirtualClass)\n        : valueVirtualClass;\n      return acc;\n    }, {} as LocalDb) as LocalDb;\n}\n\nconst localDb: LocalDb = createLocalDbInitial();\n\nexport default localDb;\n\nexport function broadcastLocalDbUpdateFull() {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'localDbUpdateFull',\n    localDb: Object.keys(localDb).reduce((acc: Record<string, any>, key) => {\n      acc[key] = { ...localDb[key as keyof LocalDb] };\n      return acc;\n    }, {} as Record<string, any>),\n  });\n}\n\nexport function updateFullLocalDb(initial: LocalDb) {\n  Object.assign(localDb, createLocalDbInitial(initial));\n}\n\nexport function clearLocalDb() {\n  Object.assign(localDb, createLocalDbInitial());\n}\n","import type { Api as GramJs } from '../../../lib/gramjs';\n\ntype VirtualFields =\n  'flags'\n  | 'CONSTRUCTOR_ID'\n  | 'SUBCLASS_OF_ID'\n  | 'className'\n  | 'classType'\n  | 'getBytes';\n\nexport function bytesToDataUri(bytes: Buffer, shouldOmitPrefix = false, mimeType: string = 'image/jpeg') {\n  const prefix = shouldOmitPrefix ? '' : `data:${mimeType};base64,`;\n\n  return `${prefix}${btoa(String.fromCharCode(...bytes))}`;\n}\n\nexport function omitVirtualClassFields<T extends GramJs.VirtualClass<T> & { flags?: any }>(\n  instance: T,\n): Omit<T, VirtualFields> {\n  const {\n    flags,\n    CONSTRUCTOR_ID,\n    SUBCLASS_OF_ID,\n    className,\n    classType,\n    getBytes,\n    ...rest\n  } = instance;\n\n  return rest;\n}\n","// eslint-disable-next-line import/no-named-default\nimport {default as Api} from '../tl/api';\n\nimport type TelegramClient from './TelegramClient';\nimport {generateRandomBytes, readBigIntFromBuffer, sleep} from '../Helpers';\nimport {getUploadPartSize} from '../Utils';\nimport errors from '../errors';\nimport {Foreman} from '../../../util/foreman';\nimport {DownloadRes, UploadReq} from \"../../ptp/protobuf/PTPFile\";\nimport {CLOUD_MESSAGE_API, DEBUG, MEDIA_CACHE_NAME_WAI} from \"../../../config\";\nimport localDb from \"../../../api/gramjs/localDb\";\nimport Account from \"../../../worker/share/Account\";\nimport * as cacheApi from '../../../util/cacheApi';\nimport {fileToBuffer} from \"../../../worker/share/utils/utils\";\nimport {ERR, FileInfo_Type} from \"../../ptp/protobuf/PTPCommon/types\";\n\ninterface OnProgress {\n    isCanceled?: boolean;\n\n    // Float between 0 and 1.\n    (progress: number): void;\n}\n\nexport interface UploadFileParams {\n    file: File;\n    workers?: number;\n    onProgress?: OnProgress;\n}\n\nconst KB_TO_BYTES = 1024;\nconst LARGE_FILE_THRESHOLD = 10 * 1024 * 1024;\nconst DISCONNECT_SLEEP = 1000;\nconst MAX_CONCURRENT_CONNECTIONS = 3;\nconst MAX_CONCURRENT_CONNECTIONS_PREMIUM = 6;\nconst MAX_WORKERS_PER_CONNECTION = 10;\n\nconst foremans = Array(MAX_CONCURRENT_CONNECTIONS_PREMIUM).fill(undefined)\n    .map(() => new Foreman(MAX_WORKERS_PER_CONNECTION));\n\nexport const getFileId = ()=>{\n    let fileId1 = readBigIntFromBuffer(generateRandomBytes(8), true, true);\n    return fileId1.toString()\n        .replace(\"-\", \"\")\n        .replace(\"n\", \"\")\n}\n\nexport async function uploadFileV1(\n    fileParams: UploadFileParams,\n): Promise<Api.InputFile | Api.InputFileBig> {\n    const { file, onProgress } = fileParams;\n    const { name, size } = file;\n    let fileIdStr = getFileId();\n    const fileId = Number(fileIdStr)\n    fileIdStr = String(fileId)\n    localDb.cache[fileIdStr] = file;\n    const isLarge = size > LARGE_FILE_THRESHOLD;\n\n    const partSize = getUploadPartSize(size) * KB_TO_BYTES;\n    const partCount = Math.floor((size + partSize - 1) / partSize);\n\n    let progress = 0;\n    if (onProgress) {\n        onProgress(progress);\n    }\n    const buf = await fileToBuffer(file)\n    const cipher = Account.localEncrypt(Buffer.from(buf));\n    const body = new DownloadRes({\n        file:{\n            id:fileIdStr,\n            part:0,\n            part_total:1,\n            buf:cipher,\n            size,\n            type:file.type\n        },\n        err:ERR.NO_ERROR\n    }).pack().getPbData()\n\n    const blob = new Blob([Buffer.from(body)]);\n    await cacheApi.save(MEDIA_CACHE_NAME_WAI, fileIdStr, blob);\n\n    return isLarge\n        ? new Api.InputFileBig({\n            id: fileId,\n            parts: partCount,\n            name,\n        })\n        : new Api.InputFile({\n            id: fileId,\n            parts: partCount,\n            name,\n            md5Checksum: '', // This is not a \"flag\", so not sure if we can make it optional.\n        });\n}\n\n\nexport async function uploadFileCache(\n    file: FileInfo_Type,\n) {\n    const { buf, id } = file;\n    const size = buf.length\n    const fileIdStr = id;\n\n    const partSize = getUploadPartSize(size) * KB_TO_BYTES;\n    const partCount = Math.floor((size + partSize - 1) / partSize);\n    const activeCounts = foremans.map(({ activeWorkers }) => activeWorkers);\n    let currentForemanIndex = activeCounts.indexOf(Math.min(...activeCounts));\n\n    const promises: Promise<any>[] = [];\n\n    for (let i = 0; i < partCount; i++) {\n        const senderIndex = currentForemanIndex % MAX_CONCURRENT_CONNECTIONS_PREMIUM;\n        await foremans[senderIndex].requestWorker();\n        const blobSlice = buf.subarray(i * partSize, (i + 1) * partSize);\n        promises.push((async (jMemo: number, blobSliceMemo: Buffer) => {\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                try {\n                    if(CLOUD_MESSAGE_API && Account.getCurrentAccount()?.getSession()){\n                        if(DEBUG){\n                            console.log(\"uploadProfilePhoto\",fileIdStr,jMemo,partCount)\n                        }\n                        const fileInfo = {\n                            id:fileIdStr,\n                            size:file.size,\n                            type:file.type,\n                            part:jMemo+1,\n                            part_total:partCount,\n                            buf:blobSliceMemo\n                        }\n                        const uploadReq = new UploadReq({file:fileInfo})\n                        const body = Buffer.from(uploadReq.pack().getPbData());\n                        await fetch(`${CLOUD_MESSAGE_API}/proto`,{\n                            method: 'POST',\n                            body,\n                            headers:{\n                                Authorization: `Bearer ${Account.getCurrentAccount()?.getSession()}`,\n                            }\n                        })\n                    }\n                } catch (err) {\n                    foremans[senderIndex].releaseWorker();\n                    throw err;\n                }\n\n                foremans[senderIndex].releaseWorker();\n                break;\n            }\n        })(i, blobSlice));\n\n        currentForemanIndex++;\n    }\n    await Promise.all(promises);\n}\n\n\nexport async function uploadFile(\n    client: TelegramClient,\n    fileParams: UploadFileParams,\n): Promise<Api.InputFile | Api.InputFileBig> {\n    const { file, onProgress } = fileParams;\n\n    const isPremium = Boolean(client.isPremium);\n\n    const { name, size } = file;\n    const fileId = readBigIntFromBuffer(generateRandomBytes(8), true, true);\n    const isLarge = size > LARGE_FILE_THRESHOLD;\n\n    const partSize = getUploadPartSize(size) * KB_TO_BYTES;\n    const partCount = Math.floor((size + partSize - 1) / partSize);\n\n    // Pick the least busy foreman\n    // For some reason, fresh connections give out a higher speed for the first couple of seconds\n    // I have no idea why, but this may speed up the download of small files\n    const activeCounts = foremans.map(({ activeWorkers }) => activeWorkers);\n    let currentForemanIndex = activeCounts.indexOf(Math.min(...activeCounts));\n\n    let progress = 0;\n    if (onProgress) {\n        onProgress(progress);\n    }\n\n    const promises: Promise<any>[] = [];\n\n    for (let i = 0; i < partCount; i++) {\n        const senderIndex = currentForemanIndex % (\n            isPremium ? MAX_CONCURRENT_CONNECTIONS_PREMIUM : MAX_CONCURRENT_CONNECTIONS\n        );\n\n        await foremans[senderIndex].requestWorker();\n\n        if (onProgress?.isCanceled) {\n            foremans[senderIndex].releaseWorker();\n            break;\n        }\n\n        const blobSlice = file.slice(i * partSize, (i + 1) * partSize);\n        // eslint-disable-next-line no-loop-func, @typescript-eslint/no-loop-func\n        promises.push((async (jMemo: number, blobSliceMemo: Blob) => {\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                let sender;\n                try {\n                    // We always upload from the DC we are in\n                    sender = await client.getSender(client.session.dcId, senderIndex, isPremium);\n                    const partBytes = await blobSliceMemo.arrayBuffer();\n                    await sender.send(\n                        isLarge\n                            ? new Api.upload.SaveBigFilePart({\n                                fileId,\n                                filePart: jMemo,\n                                fileTotalParts: partCount,\n                                bytes: Buffer.from(partBytes),\n                            })\n                            : new Api.upload.SaveFilePart({\n                                fileId,\n                                filePart: jMemo,\n                                bytes: Buffer.from(partBytes),\n                            }),\n                    );\n                } catch (err) {\n                    if (sender && !sender.isConnected()) {\n                        await sleep(DISCONNECT_SLEEP);\n                        continue;\n                    } else if (err instanceof errors.FloodWaitError) {\n                        await sleep(err.seconds * 1000);\n                        continue;\n                    }\n                    foremans[senderIndex].releaseWorker();\n\n                    throw err;\n                }\n\n                foremans[senderIndex].releaseWorker();\n\n                if (onProgress) {\n                    if (onProgress.isCanceled) {\n                        throw new Error('USER_CANCELED');\n                    }\n\n                    progress += (1 / partCount);\n                    onProgress(progress);\n                }\n                break;\n            }\n        })(i, blobSlice));\n\n        currentForemanIndex++;\n    }\n\n    await Promise.all(promises);\n\n    return isLarge\n        ? new Api.InputFileBig({\n            id: fileId,\n            parts: partCount,\n            name,\n        })\n        : new Api.InputFile({\n            id: fileId,\n            parts: partCount,\n            name,\n            md5Checksum: '', // This is not a \"flag\", so not sure if we can make it optional.\n        });\n}\n","import MsgDispatcher from \"./MsgDispatcher\";\nimport {ApiBotInfo, ApiKeyboardButtons, ApiMessage} from \"../../api/types\";\nimport {UserIdChatGpt, UserIdCnPrompt, UserIdEnPrompt, UserIdFirstBot} from \"../setting\";\nimport {GlobalState} from \"../../global/types\";\nimport {showModalFromEvent} from \"../share/utils/modal\";\nimport {getActions, getGlobal, setGlobal} from \"../../global\";\nimport {currentTs} from \"../share/utils/utils\";\nimport {DEBUG} from \"../../config\";\nimport {selectChatMessage} from \"../../global/selectors\";\n\nexport default class MsgCommandChatLab{\n  private chatId: string;\n  private botInfo: ApiBotInfo;\n  constructor(chatId:string,botInfo:ApiBotInfo) {\n    this.chatId = chatId\n    this.botInfo = botInfo;\n  }\n  static getInlineButtonsDemo():ApiKeyboardButtons{\n    return [\n\n      [\n        {\n          text:\"command button\",\n          type:'command'\n        },\n        {\n          text:\"unsupported button\",\n          type:'unsupported'\n        },\n        {\n          text:\"buy button\",\n          type:'buy'\n        }\n      ],\n      [\n        {\n          text:\"game button\",\n          type:'game'\n        },\n        {\n          text:\"requestPhone button\",\n          type:'requestPhone'\n        }\n      ],\n      [\n        {\n          text:\"receipt button\",\n          type:'receipt',\n          receiptMessageId:1\n        },\n      ],\n      [\n        {\n          text:\"url button\",\n          type:'url',\n          url:\"http://www.ai.com\"\n        },\n      ],\n      [\n        {\n          text:\"simpleWebView button\",\n          type:'simpleWebView',\n          url:\"http://www.ai.com\"\n        },\n        {\n          text:\"webView button\",\n          type:'webView',\n          url:\"http://www.ai.com\"\n        },\n      ],\n      [\n        {\n          text:\"requestPoll button\",\n          type:'requestPoll',\n          isQuiz:true\n        },\n        {\n          text:\"switchBotInline button\",\n          type:'switchBotInline',\n          query: \"\",\n          isSamePeer: false\n        },\n        {\n          text:\"userProfile button\",\n          type:'userProfile',\n          userId: UserIdFirstBot,\n        },\n      ],\n      [\n        {\n          text:\"requestUploadImage button\",\n          type:'requestUploadImage',\n        },\n      ]\n    ]\n  }\n  static async createChat(botId:string,data:string,msgId:number){\n    const t = data.split(\"/\")\n    const chatId = t[0]\n    const title = t[3]\n    const message = selectChatMessage(getGlobal(),chatId,msgId)\n    if(message){\n      const prompt = message.content.text!.text\n      getActions().createChat({title,promptInit:prompt})\n    }\n  }\n  static async createChatGpt(id:string,name:string = \"ChatGpt\"){\n    let needCreate = true;\n    let global = getGlobal();\n    if(global.chats.byId[id]){\n      const chat = global.chats.byId[id];\n      if(chat.isNotJoined){\n        delete global.chats.byId[id]\n        delete global.users.byId[id]\n        setGlobal(global)\n      }else{\n        needCreate = false\n      }\n    }\n    if(!needCreate){\n      getActions().openChat({id,shouldReplaceHistory:true})\n      return\n    }\n    getActions().createChat({id,title:name})\n  }\n  static async createPromptChat(chatId:string,id:string){\n    let name: string;\n    const prompts = require('./prompts.json')\n    let tag: string;\n    if(id === UserIdEnPrompt){\n      name = \"Prompt\"\n      tag = 'en'\n    }else{\n      name = \"Prompt\"\n      tag = 'cn'\n    }\n    let needCreate = true;\n    let global = getGlobal();\n    if(global.chats.byId[id]){\n      const chat = global.chats.byId[id];\n      if(chat.isNotJoined){\n        delete global.chats.byId[id]\n        delete global.users.byId[id]\n        setGlobal(global)\n      }else{\n        needCreate = false\n      }\n    }\n    if(!needCreate){\n      getActions().openChat({id,shouldReplaceHistory:true})\n      return MsgDispatcher.showNotification(`${name} `)\n    }\n    const promptRows = prompts[tag]\n    getActions().createChat({id,title:name})\n    const msg0 = await MsgDispatcher.newTextMessage(chatId,undefined,\" \"+name+\"...\")\n    setTimeout(async ()=>{\n      promptRows.reverse();\n      for (let i = 0; i < promptRows.length; i++) {\n        const desc = promptRows[i][1]\n        const title = promptRows[i][0]\n        if(desc){\n          await MsgDispatcher.newTextMessage(id,undefined,desc,[\n            [\n              {\n                text:\"Gpt\",\n                type:\"callback\",\n                data:`${id}/createChat/${tag}/${title}`\n              }\n            ]\n          ])\n          await MsgDispatcher.updateMessage(chatId,msg0.id,{\n            ...msg0,\n            content:{\n              text:{\n                text:` ${name}... ${i+1}/${promptRows.length}`\n              }\n            }\n          })\n        }\n\n      }\n    },500)\n  }\n  static async answerCallbackButton(global:GlobalState,chatId:string,messageId:number,data:string){\n\n    if(data.startsWith(`${chatId}/createChat/cn`)){\n      await MsgCommandChatLab.createChat(UserIdCnPrompt,data,messageId)\n      return\n    }\n    if(data.startsWith(`${chatId}/createChat/en`)){\n      await MsgCommandChatLab.createChat(UserIdEnPrompt,data,messageId)\n      return\n    }\n    switch (data){\n      case `${chatId}/lab/createChatGpt`:\n        await MsgCommandChatLab.createChatGpt(UserIdChatGpt)\n        break\n      case `${chatId}/lab/createEnPrompt`:\n        await MsgCommandChatLab.createPromptChat(chatId,UserIdEnPrompt)\n        break\n      case `${chatId}/lab/createCnPrompt`:\n        await MsgCommandChatLab.createPromptChat(chatId,UserIdCnPrompt)\n        break\n      case `${chatId}/lab/InlineButs`:\n        await MsgDispatcher.newTextMessage(chatId,undefined,\"\",MsgCommandChatLab.getInlineButtonsDemo())\n        break\n\n      case `${chatId}/lab/dumpUsers`:\n        if(DEBUG){\n          await MsgDispatcher.newCodeMessage(chatId,undefined,JSON.stringify(global.messages.byChatId[chatId],null,2))\n        }\n        break\n      case `${chatId}/lab/testMsg`:\n        const {value} = await showModalFromEvent({\n          title: \"JSON  msg\", type: \"singleInput\"\n        })\n        try {\n          if(value){\n            const testMsg = async (value:string)=>{\n              const message:ApiMessage = JSON.parse(value);\n              message.chatId = chatId;\n              message.id = await MsgDispatcher.genMsgId();\n              message.isOutgoing = false\n              message.senderId = chatId\n              message.date = currentTs()\n              await MsgDispatcher.newMessage(chatId,message.id,message)\n            }\n            await testMsg(value);\n          }\n        }catch (e){\n          getActions().showNotification({\n            message:\"\"\n          })\n        }\n        break\n    }\n  }\n  async lab(){\n    const messageId = await MsgDispatcher.genMsgId();\n    return await MsgDispatcher.newTextMessage(this.chatId,messageId,\"\",[\n      [\n        {\n          data:`${this.chatId}/lab/createChatGpt`,\n          text:\"ChatGpt\",\n          type:\"callback\"\n        },\n      ],\n      [\n        {\n          data:`${this.chatId}/lab/createCnPrompt`,\n          text:\"Prompt\",\n          type:\"callback\"\n        },\n      ],\n      [\n        {\n          data:`${this.chatId}/lab/createEnPrompt`,\n          text:\"Prompt\",\n          type:\"callback\"\n        },\n      ],\n      // [\n      //   {\n      //     data:`${this.chatId}/lab/dumpUsers`,\n      //     text:\"DumpUsers\",\n      //     type:\"callback\"\n      //   },\n      // ],\n      // [\n      //   {\n      //     data:`${this.chatId}/lab/InlineButs`,\n      //     text:\"InlineButs Demo\",\n      //     type:\"callback\"\n      //   },\n      // ],\n        // [\n        //   {\n        //     data:`${this.chatId}/temp/PromptDemo`,\n        //     text:\"PromptDemo\",\n        //     type:\"callback\"\n        //   },\n        // ],\n    ])\n  }\n\n}\n","import type {RequiredGlobalActions} from '../../index';\nimport {addActionHandler, getActions, getGlobal, setGlobal,} from '../../index';\n\nimport type {ApiChat, ApiChatFolder, ApiChatMember, ApiError, ApiUser, ApiUserStatus,} from '../../../api/types';\nimport {MAIN_THREAD_ID} from '../../../api/types';\nimport {ChatCreationProgress, ManagementProgress, NewChatMembersProgress} from '../../../types';\nimport type {ActionReturnType, GlobalState, TabArgs,} from '../../types';\n\nimport {\n  ALL_FOLDER_ID,\n  ARCHIVED_FOLDER_ID,\n  DEBUG,\n  MEDIA_CACHE_NAME_WAI,\n  RE_TG_LINK,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  TME_WEB_DOMAINS,\n  TMP_CHAT_ID,\n  TOP_CHAT_MESSAGES_PRELOAD_LIMIT,\n  TOPICS_SLICE,\n  TOPICS_SLICE_SECOND_LOAD,\n} from '../../../config';\nimport {callApi} from '../../../api/gramjs';\nimport {\n  addChatMembers,\n  addChats,\n  addMessages,\n  addUsers,\n  addUserStatuses,\n  deleteTopic,\n  leaveChat,\n  replaceChatListIds,\n  replaceChats,\n  replaceThreadParam,\n  replaceUsers,\n  replaceUserStatuses,\n  updateChat,\n  updateChatListIds,\n  updateChatListSecondaryInfo,\n  updateChats,\n  updateListedTopicIds,\n  updateManagementProgress,\n  updateThreadInfo,\n  updateTopic,\n  updateTopics,\n  updateUser,\n} from '../../reducers';\nimport {\n  selectChat,\n  selectChatByUsername,\n  selectChatFolder,\n  selectChatListType,\n  selectCurrentChat,\n  selectCurrentMessageList,\n  selectDraft,\n  selectIsChatPinned,\n  selectLastServiceNotification,\n  selectSupportChat,\n  selectTabState,\n  selectThread,\n  selectThreadInfo,\n  selectThreadOriginChat,\n  selectThreadTopMessageId,\n  selectUser,\n  selectUserByPhoneNumber,\n  selectVisibleUsers,\n} from '../../selectors';\nimport {buildCollectionByKey, omit} from '../../../util/iteratees';\nimport {debounce, pause, throttle} from '../../../util/schedulers';\nimport {\n  isChatArchived,\n  isChatBasicGroup,\n  isChatChannel,\n  isChatSummaryOnly,\n  isChatSuperGroup,\n  isUserBot,\n} from '../../helpers';\nimport {formatShareText, parseChooseParameter, processDeepLink} from '../../../util/deeplink';\nimport {updateGroupCall} from '../../reducers/calls';\nimport {selectGroupCall} from '../../selectors/calls';\nimport {getOrderedIds} from '../../../util/folderManager';\nimport * as langProvider from '../../../util/langProvider';\nimport {selectCurrentLimit} from '../../selectors/limits';\nimport {updateTabState} from '../../reducers/tabs';\nimport {getCurrentTabId} from '../../../util/establishMultitabRole';\nimport {\n  ChatModelConfig,\n  DEFAULT_AVATARS,\n  DEFAULT_BOT_COMMANDS,\n  DEFAULT_CHATGPT_AI_COMMANDS,\n  DEFAULT_CREATE_USER_BIO,\n  DEFAULT_PROMPT,\n  LoadAllChats,\n  UserIdChatGpt,\n  UserIdChatGpt4,\n  UserIdFirstBot\n} from \"../../../worker/setting\";\nimport * as cacheApi from '../../../util/cacheApi';\nimport {blobToDataUri, fetchBlob} from \"../../../util/files\";\nimport {DownloadRes} from \"../../../lib/ptp/protobuf/PTPFile\";\nimport {ERR} from \"../../../lib/ptp/protobuf/PTPCommon/types\";\nimport {getFileId} from \"../../../lib/gramjs/client/uploadFile\";\nimport ChatMsg from \"../../../worker/msg/ChatMsg\";\n\nimport {resizeImage} from '../../../util/imageResize';\nimport MsgCommandChatLab from \"../../../worker/msg/MsgCommandChatLab\";\n\nconst TOP_CHAT_MESSAGES_PRELOAD_INTERVAL = 100;\nconst INFINITE_LOOP_MARKER = 100;\n\nconst SERVICE_NOTIFICATIONS_USER_MOCK: ApiUser = {\n  id: SERVICE_NOTIFICATIONS_USER_ID,\n  accessHash: '0',\n  type: 'userTypeRegular',\n  isMin: true,\n  phoneNumber: '',\n};\n\nconst runThrottledForLoadTopChats = throttle((cb) => cb(), 3000, true);\nconst runDebouncedForLoadFullChat = debounce((cb) => cb(), 500, false, true);\n\naddActionHandler('preloadTopChatMessages', async (global, actions): Promise<void> => {\n  const preloadedChatIds = new Set<string>();\n\n  for (let i = 0; i < TOP_CHAT_MESSAGES_PRELOAD_LIMIT; i++) {\n    await pause(TOP_CHAT_MESSAGES_PRELOAD_INTERVAL);\n\n    global = getGlobal();\n    const currentChatIds = Object.values(global.byTabId)\n      // eslint-disable-next-line @typescript-eslint/no-loop-func\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)?.chatId)\n      .filter(Boolean);\n\n    const folderAllOrderedIds = getOrderedIds(ALL_FOLDER_ID);\n    const nextChatId = folderAllOrderedIds?.find((id) => !currentChatIds.includes(id) && !preloadedChatIds.has(id));\n    if (!nextChatId) {\n      return;\n    }\n\n    preloadedChatIds.add(nextChatId);\n\n    actions.loadViewportMessages({ chatId: nextChatId, threadId: MAIN_THREAD_ID, tabId: getCurrentTabId() });\n  }\n});\n\naddActionHandler('openChat', (global, actions, payload): ActionReturnType => {\n  const {\n    id, threadId = MAIN_THREAD_ID,\n  } = payload;\n  if (!id) {\n    return;\n  }\n\n  const { currentUserId } = global;\n  const chat = selectChat(global, id);\n\n  if (chat?.hasUnreadMark) {\n    actions.toggleChatUnread({ id });\n  }\n\n  if (!chat) {\n    if (id === currentUserId) {\n      void callApi('fetchChat', { type: 'self' });\n    } else {\n      const user = selectUser(global, id);\n      if (user) {\n        void callApi('fetchChat', { type: 'user', user });\n      }\n    }\n  } else if (isChatSummaryOnly(chat) && !chat.isMin) {\n    //todo\n    // actions.requestChatUpdate({ chatId: id });\n  }\n\n  if (threadId !== MAIN_THREAD_ID) {\n    actions.requestThreadInfoUpdate({ chatId: id, threadId });\n  }\n});\n\naddActionHandler('openComments', async (global, actions, payload): Promise<void> => {\n  const {\n    id, threadId, originChannelId, tabId = getCurrentTabId(),\n  } = payload;\n\n  if (threadId !== MAIN_THREAD_ID) {\n    const topMessageId = selectThreadTopMessageId(global, id, threadId);\n    if (!topMessageId) {\n      const chat = selectThreadOriginChat(global, id, threadId);\n      if (!chat) {\n        return;\n      }\n\n      actions.openChat({ id: TMP_CHAT_ID, tabId });\n\n      const result = await callApi('requestThreadInfoUpdate', { chat, threadId, originChannelId });\n      if (!result) {\n        actions.openPreviousChat({ tabId });\n        return;\n      }\n      global = getGlobal();\n      global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n      setGlobal(global);\n\n      actions.openChat({ id, threadId: result.topMessageId, tabId });\n    } else {\n      actions.openChat({ id, threadId: topMessageId, tabId });\n    }\n  }\n});\n\naddActionHandler('openLinkedChat', async (global, actions, payload): Promise<void> => {\n  const { id, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, id);\n  if (!chat) {\n    return;\n  }\n\n  const chatFullInfo = await callApi('fetchFullChat', chat);\n\n  if (chatFullInfo?.fullInfo?.linkedChatId) {\n    actions.openChat({ id: chatFullInfo.fullInfo.linkedChatId, tabId });\n  }\n});\n\naddActionHandler('focusMessageInComments', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, threadId, messageId, tabId = getCurrentTabId(),\n  } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const result = await callApi('requestThreadInfoUpdate', { chat, threadId });\n  if (!result) {\n    return;\n  }\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  setGlobal(global);\n\n  actions.focusMessage({\n    chatId, threadId, messageId, tabId,\n  });\n});\n\naddActionHandler('openSupportChat', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  const chat = selectSupportChat(global);\n  if (chat) {\n    actions.openChat({ id: chat.id, shouldReplaceHistory: true, tabId });\n    return;\n  }\n\n  actions.openChat({ id: TMP_CHAT_ID, shouldReplaceHistory: true, tabId });\n\n  const result = await callApi('fetchChat', { type: 'support' });\n  if (result) {\n    actions.openChat({ id: result.chatId, shouldReplaceHistory: true, tabId });\n  }\n});\n\naddActionHandler('loadAllChats', async (global, actions, payload): Promise<void> => {\n  const listType = payload.listType as 'active' | 'archived';\n  if(listType === \"archived\"){\n    return;\n  }\n  const { onReplace } = payload;\n  let { shouldReplace } = payload;\n  let i = 0;\n\n  const getOrderDate = (chat: ApiChat) => {\n    return chat.lastMessage?.date || chat.joinDate;\n  };\n  while (shouldReplace || !global.chats.isFullyLoaded[listType]) {\n    if (i++ >= INFINITE_LOOP_MARKER) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('`actions/loadAllChats`: Infinite loop detected');\n      }\n      return;\n    }\n\n    global = getGlobal();\n    const listIds = !shouldReplace && global.chats.listIds[listType];\n    const oldestChat = listIds\n      ? listIds\n        /* eslint-disable @typescript-eslint/no-loop-func */\n        .map((id) => global.chats.byId[id])\n        .filter((chat) => (\n          Boolean(chat && getOrderDate(chat))\n          && chat.id !== SERVICE_NOTIFICATIONS_USER_ID\n          && !selectIsChatPinned(global, chat.id)\n        ))\n        /* eslint-enable @typescript-eslint/no-loop-func */\n        .sort((chat1, chat2) => getOrderDate(chat1)! - getOrderDate(chat2)!)[0]\n      : undefined;\n    await loadChats(global,\n      listType,\n      oldestChat?.id,\n      oldestChat ? getOrderDate(oldestChat) : undefined,\n      shouldReplace,\n      true,\n    );\n\n    if (shouldReplace) {\n      onReplace?.();\n      shouldReplace = false;\n    }\n\n    global = getGlobal();\n  }\n});\n\naddActionHandler('loadFullChat', (global, actions, payload): ActionReturnType => {\n  const { chatId, force, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  if (force) {\n    loadFullChat(global, actions, chat, tabId);\n  } else {\n    runDebouncedForLoadFullChat(() => loadFullChat(global, actions, chat, tabId));\n  }\n});\n\naddActionHandler('loadTopChats', (global): ActionReturnType => {\n  runThrottledForLoadTopChats(() => loadChats(global, 'active'));\n});\n\naddActionHandler('requestChatUpdate', (global, actions, payload): ActionReturnType => {\n  const { chatId } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  void callApi('requestChatUpdate', {\n    chat,\n    ...(chatId === SERVICE_NOTIFICATIONS_USER_ID && {\n      lastLocalMessage: selectLastServiceNotification(global)?.message,\n    }),\n  });\n});\n\naddActionHandler('updateChatMutedState', (global, actions, payload): ActionReturnType => {\n  const { chatId, isMuted } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = updateChat(global, chatId, { isMuted });\n  setGlobal(global);\n  void callApi('updateChatMutedState', { chat, isMuted });\n});\n\naddActionHandler('updateTopicMutedState', (global, actions, payload): ActionReturnType => {\n  const { chatId, isMuted, topicId } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = updateTopic(global, chatId, topicId, { isMuted });\n  setGlobal(global);\n  void callApi('updateTopicMutedState', {\n    chat, topicId, isMuted,\n  });\n});\n\naddActionHandler('createChannel', async (global, actions, payload): Promise<void> => {\n  const {\n    title, about, photo, memberIds, tabId = getCurrentTabId(),\n  } = payload;\n\n  const users = (memberIds as string[])\n    .map((id) => selectUser(global, id))\n    .filter(Boolean);\n\n  global = updateTabState(global, {\n    chatCreation: {\n      progress: ChatCreationProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  let createdChannel: ApiChat | undefined;\n\n  try {\n    createdChannel = await callApi('createChannel', { title, about, users });\n  } catch (error) {\n    global = getGlobal();\n\n    global = updateTabState(global, {\n      chatCreation: {\n        progress: ChatCreationProgress.Error,\n      },\n    }, tabId);\n\n    setGlobal(global);\n\n    if ((error as ApiError).message === 'CHANNELS_TOO_MUCH') {\n      actions.openLimitReachedModal({ limit: 'channels', tabId });\n    } else {\n      actions.showDialog({ data: { ...(error as ApiError), hasErrorKey: true }, tabId });\n    }\n  }\n\n  if (!createdChannel) {\n    return;\n  }\n\n  const { id: channelId, accessHash } = createdChannel;\n\n  global = getGlobal();\n  global = updateChat(global, channelId, createdChannel);\n  global = updateTabState(global, {\n    chatCreation: {\n      ...selectTabState(global, tabId).chatCreation,\n      progress: createdChannel ? ChatCreationProgress.Complete : ChatCreationProgress.Error,\n    },\n  }, tabId);\n  setGlobal(global);\n  actions.openChat({ id: channelId, shouldReplaceHistory: true, tabId });\n\n  if (channelId && accessHash && photo) {\n    await callApi('editChatPhoto', { chatId: channelId, accessHash, photo });\n  }\n});\n\naddActionHandler('joinChannel', async (global, actions, payload): Promise<void> => {\n  const { chatId, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const { id: channelId, accessHash } = chat;\n\n  if (!(channelId && accessHash)) {\n    return;\n  }\n\n  try {\n    await callApi('joinChannel', { channelId, accessHash });\n  } catch (error) {\n    if ((error as ApiError).message === 'CHANNELS_TOO_MUCH') {\n      actions.openLimitReachedModal({ limit: 'channels', tabId });\n    } else {\n      actions.showDialog({ data: { ...(error as ApiError), hasErrorKey: true }, tabId });\n    }\n  }\n});\n\naddActionHandler('deleteChatUser', (global, actions, payload): ActionReturnType => {\n  const { chatId, userId, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  const user = selectUser(global, userId);\n  if (!chat || !user) {\n    return;\n  }\n\n  global = leaveChat(global, chatId);\n  setGlobal(global);\n\n  if (selectCurrentMessageList(global, tabId)?.chatId === chatId) {\n    actions.openChat({ id: undefined, tabId });\n  }\n\n  void callApi('deleteChatUser', { chat, user });\n});\n\naddActionHandler('deleteChat', (global, actions, payload): ActionReturnType => {\n  const { chatId, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = leaveChat(global, chatId);\n  setGlobal(global);\n\n  if (selectCurrentMessageList(global, tabId)?.chatId === chatId) {\n    actions.openChat({ id: undefined, tabId });\n  }\n\n  void callApi('deleteChat', { chatId: chat.id });\n});\n\naddActionHandler('leaveChannel', (global, actions, payload): ActionReturnType => {\n  const { chatId, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = leaveChat(global, chatId);\n  setGlobal(global);\n\n  if (selectCurrentMessageList(global, tabId)?.chatId === chatId) {\n    actions.openChat({ id: undefined, tabId });\n  }\n\n  const { id: channelId, accessHash } = chat;\n  if (channelId && accessHash) {\n    void callApi('leaveChannel', { channelId, accessHash });\n  }\n});\n\naddActionHandler('deleteChannel', (global, actions, payload): ActionReturnType => {\n  const { chatId, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = leaveChat(global, chatId);\n  setGlobal(global);\n\n  if (selectCurrentMessageList(global, tabId)?.chatId === chatId) {\n    actions.openChat({ id: undefined, tabId });\n  }\n\n  const { id: channelId, accessHash } = chat;\n  if (channelId && accessHash) {\n    void callApi('deleteChannel', { channelId, accessHash });\n  }\n});\n\n\nconst getAvatarPhoto = async (id:string,url:string)=>{\n  const res = await fetch(url)\n  const ab = await res.arrayBuffer()\n  const type = \"image/\"+url.split(\".\")[url.split(\".\").length - 1]\n  const body = new DownloadRes({\n    file:{\n      id,\n      part:0,\n      part_total:1,\n      buf:Buffer.from(ab),\n      size:Buffer.from(ab).length,\n      type\n    },\n    err:ERR.NO_ERROR\n  }).pack().getPbData()\n  const blob = new Blob([Buffer.from(body)],{type});\n  const blob1= new Blob([Buffer.from(ab)],{type});\n\n  const quality = 0.1;\n  const thumbUrl = await resizeImage(blob1, 40,40, 'image/jpeg',quality);\n  const thumbBlob = await fetchBlob(thumbUrl)\n  const dataUri = await blobToDataUri(thumbBlob);\n  const size = {\n    \"width\": 640,\n    \"height\":  640,\n  }\n  await cacheApi.save(MEDIA_CACHE_NAME_WAI, id, blob);\n\n  return {\n    id:id,\n    thumbnail:{\n      dataUri,\n      ...size\n    },\n    \"sizes\": [\n      {\n        width: 160,\n        height: 160,\n        type: 's',\n      },\n      {\n        width: 320,\n        height: 320,\n        type: 'm',\n      },\n      {\n        width: 640,\n        height: 640,\n        type: 'x',\n      },\n    ],\n  }\n}\naddActionHandler('createChat', async (global, actions, payload)=> {\n  const {\n    title, id,promptInit,about, tabId = getCurrentTabId(),\n  } = payload;\n\n  let userIds = Object.keys(global.users.byId)\n\n  global = updateTabState(global, {\n    chatCreation: {\n      progress: ChatCreationProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  try{\n    let userId: string;\n    let userIdInt = parseInt(UserIdFirstBot)\n    if(!id){\n      if(userIds.length > 0){\n        userIds = [...userIds,...global.chatIdsDeleted]\n        userIds.sort((a,b)=>parseInt(b) - parseInt(a))\n        userIdInt = parseInt(userIds[0]) + 1\n      }\n      if(userIdInt < 100000){\n        userIdInt = 100000\n      }\n      userId = userIdInt.toString()\n    }else{\n      userId = id\n    }\n\n    const chatGptApiKey = localStorage.getItem(\"cg-key\") ? localStorage.getItem(\"cg-key\") : \"\"\n    const init_system_content = promptInit || DEFAULT_PROMPT\n    let avatarHash = \"\";\n    let photos = []\n    if(DEFAULT_AVATARS[userId]){\n      avatarHash = getFileId();\n      const avatarUrl = DEFAULT_AVATARS[userId]\n      const photo = await getAvatarPhoto(avatarHash,avatarUrl);\n      photos.push(photo)\n    }\n    const user = {\n      \"canBeInvitedToGroup\": false,\n      \"hasVideoAvatar\": false,\n      \"type\": \"userTypeBot\",\n      id:userId,\n      \"phoneNumber\": \"\",\n      isMin:false,\n      \"noStatus\": true,\n      isSelf:false,\n      avatarHash,\n      accessHash:\"\",\n      isPremium: false,\n      firstName: title,\n      photos,\n      usernames: [\n        {\n          \"username\": \"Bot_\"+userId,\n          \"isActive\": true,\n          \"isEditable\": true\n        }\n      ],\n      fullInfo: {\n        \"isBlocked\": false,\n        \"noVoiceMessages\": false,\n        bio: about || DEFAULT_CREATE_USER_BIO,\n        botInfo: {\n          aiBot:{\n            enableAi:true,\n            chatGptConfig:{\n              init_system_content,\n              api_key:\"\",\n              max_history_length:10,\n              modelConfig:{\n                ...ChatModelConfig,\n                ...(userId === UserIdChatGpt4 ? {model:\"gpt-4\"} : {})\n              }\n            }\n          },\n          botId: userId,\n          \"description\": about || DEFAULT_CREATE_USER_BIO,\n          \"menuButton\": {\n            \"type\": \"commands\"\n          },\n          commands:[...DEFAULT_BOT_COMMANDS,...DEFAULT_CHATGPT_AI_COMMANDS].map(cmd=>{\n            // @ts-ignore\n            cmd.botId = userId;\n            return cmd\n          })\n        }\n      }\n    }\n    global = getGlobal()\n    const {chatFolders} = global;\n    // @ts-ignore\n    const users:ApiUser[] = [user]\n\n    // @ts-ignore\n    const chats:ApiChat[] = [ChatMsg.buildDefaultChat(user)]\n\n    let activeChatFolder = window.sessionStorage.getItem(\"activeChatFolder\")\n    let activeChatFolderRow;\n    const chatFolderById:Record<string, ApiChatFolder> = {};\n    if(activeChatFolder){\n      Object.values(chatFolders.byId).forEach((row:ApiChatFolder)=>{\n        if(chatFolders.orderedIds![parseInt(activeChatFolder!)]){\n          const activeFolderId = chatFolders.orderedIds![parseInt(activeChatFolder!)]\n          if(row.id === activeFolderId){\n\n            if(!row.includedChatIds){\n              row.includedChatIds = []\n            }\n            row.includedChatIds.push(userId)\n            chatFolderById[row.id] = row;\n            activeChatFolderRow = row;\n          }\n        }\n      })\n    }\n\n    const userStatusesById:Record<string,ApiUserStatus> = {\n      [user.id] : {\n        \"type\": \"userStatusEmpty\"\n      }\n    }\n\n    global = getGlobal();\n    global = addUsers(global, buildCollectionByKey(users, 'id'));\n    global = addChats(global, buildCollectionByKey(chats, 'id'));\n    global = updateChatListIds(global, \"active\", chats.map(chat=>chat.id));\n    global = addUserStatuses(global, userStatusesById);\n    global = updateTabState(global, {\n      chatCreation: {\n        ...selectTabState(global, tabId).chatCreation,\n        progress: ChatCreationProgress.Complete,\n      },\n    }, tabId);\n\n    setGlobal({\n      ...global,\n      chatFolders:{\n        ...global.chatFolders,\n        byId:{\n          ...global.chatFolders.byId,\n          ...chatFolderById\n        }\n\n      }\n    })\n\n    if(activeChatFolderRow){\n      actions.editChatFolder({ id: activeChatFolderRow.id, folderUpdate: activeChatFolderRow });\n    }\n    if(promptInit || (id === UserIdChatGpt)){\n      actions.sendBotCommand({chatId:userId,command:\"/systemPrompt\",tabId})\n    }\n    if(id !== UserIdChatGpt4){\n      // @ts-ignore\n      actions.openChat({id: userId,shouldReplaceHistory: true,});\n    }\n  }catch (e){\n    console.error(e)\n    global = getGlobal();\n    global = updateTabState(global, {\n      chatCreation: {\n        ...selectTabState(global, tabId).chatCreation,\n        progress: ChatCreationProgress.Error,\n        error: '',\n      },\n    }, tabId);\n    setGlobal(global);\n  }\n})\naddActionHandler('createGroupChat', async (global, actions, payload): Promise<void> => {\n  const {\n    title, memberIds, photo, tabId = getCurrentTabId(),\n  } = payload;\n  const users = (memberIds as string[])\n    .map((id) => selectUser(global, id))\n    .filter(Boolean);\n\n  global = updateTabState(global, {\n    chatCreation: {\n      progress: ChatCreationProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  try {\n    const createdChat = await callApi('createGroupChat', {\n      title,\n      users,\n    });\n\n    if (!createdChat) {\n      return;\n    }\n\n    const { id: chatId } = createdChat;\n\n    global = getGlobal();\n    global = updateChat(global, chatId, createdChat);\n    global = updateTabState(global, {\n      chatCreation: {\n        ...selectTabState(global, tabId).chatCreation,\n        progress: createdChat ? ChatCreationProgress.Complete : ChatCreationProgress.Error,\n      },\n    }, tabId);\n    setGlobal(global);\n    actions.openChat({\n      id: chatId,\n      shouldReplaceHistory: true,\n      tabId,\n    });\n\n    if (chatId && photo) {\n      await callApi('editChatPhoto', {\n        chatId,\n        photo,\n      });\n    }\n  } catch (e: any) {\n    if (e.message === 'USERS_TOO_FEW') {\n      global = getGlobal();\n      global = updateTabState(global, {\n        chatCreation: {\n          ...selectTabState(global, tabId).chatCreation,\n          progress: ChatCreationProgress.Error,\n          error: 'CreateGroupError',\n        },\n      }, tabId);\n      setGlobal(global);\n    }\n  }\n});\n\naddActionHandler('toggleChatPinned', (global, actions, payload): ActionReturnType => {\n  const { id, folderId, tabId = getCurrentTabId() } = payload!;\n  const chat = selectChat(global, id);\n  if (!chat) {\n    return;\n  }\n\n  const limit = selectCurrentLimit(global, 'dialogFolderPinned');\n\n  if (folderId) {\n    const folder = selectChatFolder(global, folderId);\n    if (folder) {\n      const shouldBePinned = !selectIsChatPinned(global, id, folderId);\n\n      const { pinnedChatIds, includedChatIds } = folder;\n      const newPinnedIds = shouldBePinned\n        ? [id, ...(pinnedChatIds || [])]\n        : (pinnedChatIds || []).filter((pinnedId) => pinnedId !== id);\n\n      // With both Pin and Unpin we need to re-add a user to the included group\n      const newIncludedChatIds = [id, ...includedChatIds];\n\n      void callApi('editChatFolder', {\n        id: folderId,\n        folderUpdate: {\n          ...folder,\n          pinnedChatIds: newPinnedIds,\n          includedChatIds: newIncludedChatIds,\n        },\n      });\n    }\n  } else {\n    const listType = selectChatListType(global, id);\n    const isPinned = selectIsChatPinned(global, id, listType === 'archived' ? ARCHIVED_FOLDER_ID : undefined);\n\n    const ids = global.chats.orderedPinnedIds[listType === 'archived' ? 'archived' : 'active'];\n    if ((ids?.length || 0) >= limit && !isPinned) {\n      actions.openLimitReachedModal({\n        limit: 'dialogFolderPinned',\n        tabId,\n      });\n      return;\n    }\n    void callApi('toggleChatPinned', { chat, shouldBePinned: !isPinned });\n  }\n});\n\naddActionHandler('toggleChatArchived', (global, actions, payload): ActionReturnType => {\n  const { id } = payload!;\n  const chat = selectChat(global, id);\n  if (chat) {\n    void callApi('toggleChatArchived', {\n      chat,\n      folderId: isChatArchived(chat) ? 0 : ARCHIVED_FOLDER_ID,\n    });\n  }\n});\n\naddActionHandler('loadChatFolders', async (global): Promise<void> => {\n  const chatFolders = await callApi('fetchChatFolders');\n\n  if (chatFolders) {\n    global = getGlobal();\n\n    global = {\n      ...global,\n      chatFolders: {\n        ...global.chatFolders,\n        ...chatFolders,\n      },\n    };\n    setGlobal(global);\n  }\n});\n\naddActionHandler('loadRecommendedChatFolders', async (global): Promise<void> => {\n  const recommendedChatFolders = await callApi('fetchRecommendedChatFolders');\n\n  if (recommendedChatFolders) {\n    global = getGlobal();\n\n    global = {\n      ...global,\n      chatFolders: {\n        ...global.chatFolders,\n        recommended: recommendedChatFolders,\n      },\n    };\n    setGlobal(global);\n  }\n});\n\naddActionHandler('editChatFolders', (global, actions, payload): ActionReturnType => {\n  const {\n    chatId, idsToRemove, idsToAdd, tabId = getCurrentTabId(),\n  } = payload;\n  const limit = selectCurrentLimit(global, 'dialogFiltersChats');\n  const isLimitReached = idsToAdd\n    .some((id) => selectChatFolder(global, id)!.includedChatIds.length >= limit);\n  if (isLimitReached) {\n    actions.openLimitReachedModal({ limit: 'dialogFiltersChats', tabId });\n    return;\n  }\n\n  idsToRemove.forEach(async (id) => {\n    const folder = selectChatFolder(global, id);\n    if (folder) {\n      await callApi('editChatFolder', {\n        id,\n        folderUpdate: {\n          ...folder,\n          pinnedChatIds: folder.pinnedChatIds?.filter((pinnedId) => pinnedId !== chatId),\n          includedChatIds: folder.includedChatIds.filter((includedId) => includedId !== chatId),\n        },\n      });\n    }\n  });\n\n  idsToAdd.forEach(async (id) => {\n    const folder = selectChatFolder(global, id);\n    if (folder) {\n      await callApi('editChatFolder', {\n        id,\n        folderUpdate: {\n          ...folder,\n          includedChatIds: folder.includedChatIds.concat(chatId),\n        },\n      });\n    }\n  });\n});\n\naddActionHandler('editChatFolder', (global, actions, payload): ActionReturnType => {\n  const { id, folderUpdate } = payload!;\n  const folder = selectChatFolder(global, id);\n  if (folder) {\n    void callApi('editChatFolder', {\n      id,\n      folderUpdate: {\n        id,\n        emoticon: folder.emoticon,\n        pinnedChatIds: folder.pinnedChatIds,\n        ...folderUpdate,\n      },\n    });\n  }\n});\n\naddActionHandler('addChatFolder', async (global, actions, payload): Promise<void> => {\n  const { folder, tabId = getCurrentTabId() } = payload!;\n  const { orderedIds, byId } = global.chatFolders;\n\n  const limit = selectCurrentLimit(global, 'dialogFilters');\n  if (Object.keys(byId).length >= limit) {\n    actions.openLimitReachedModal({\n      limit: 'dialogFilters',\n      tabId,\n    });\n    return;\n  }\n\n  const maxId = Math.max(...(orderedIds || []), ARCHIVED_FOLDER_ID);\n\n  // Clear fields from recommended folders\n  const { id: recommendedId, description, ...newFolder } = folder;\n\n  await callApi('editChatFolder', {\n    id: maxId + 1,\n    folderUpdate: {\n      id: maxId + 1,\n      ...newFolder,\n    },\n  });\n\n  if (!description) {\n    return;\n  }\n\n  global = getGlobal();\n  const { recommended } = global.chatFolders;\n\n  if (recommended) {\n    global = {\n      ...global,\n      chatFolders: {\n        ...global.chatFolders,\n        recommended: recommended.filter(({ id }) => id !== recommendedId),\n      },\n    };\n    setGlobal(global);\n  }\n});\n\naddActionHandler('sortChatFolders', async (global, actions, payload): Promise<void> => {\n  const { folderIds } = payload!;\n\n  const result = await callApi('sortChatFolders', folderIds);\n  if (result) {\n    global = getGlobal();\n    global = {\n      ...global,\n      chatFolders: {\n        ...global.chatFolders,\n        orderedIds: folderIds,\n      },\n    };\n    setGlobal(global);\n  }\n});\n\naddActionHandler('deleteChatFolder', async (global, actions, payload): Promise<void> => {\n  const { id } = payload;\n  const folder = selectChatFolder(global, id);\n  // @ts-ignore\n  actions.setActiveChatFolder({activeChatFolder:0},getCurrentTabId())\n  if (folder) {\n    await callApi('deleteChatFolder', id);\n  }\n});\n\naddActionHandler('toggleChatUnread', (global, actions, payload): ActionReturnType => {\n  const { id } = payload;\n  const chat = selectChat(global, id);\n  if (chat) {\n    if (chat.unreadCount) {\n      void callApi('markMessageListRead', { chat, threadId: MAIN_THREAD_ID });\n    } else {\n      void callApi('toggleDialogUnread', {\n        chat,\n        hasUnreadMark: !chat.hasUnreadMark,\n      });\n    }\n  }\n});\n\naddActionHandler('markTopicRead', (global, actions, payload): ActionReturnType => {\n  const { chatId, topicId } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  const lastTopicMessageId = chat.topics?.[topicId]?.lastMessageId;\n  if (!lastTopicMessageId) return;\n\n  void callApi('markMessageListRead', {\n    chat,\n    threadId: topicId,\n    maxId: lastTopicMessageId,\n  });\n\n  global = getGlobal();\n  global = updateTopic(global, chatId, topicId, {\n    unreadCount: 0,\n  });\n  global = updateThreadInfo(global, chatId, topicId, {\n    lastReadInboxMessageId: lastTopicMessageId,\n  });\n  setGlobal(global);\n});\n\naddActionHandler('openChatByInvite', async (global, actions, payload): Promise<void> => {\n  const { hash, tabId = getCurrentTabId() } = payload!;\n\n  const result = await callApi('openChatByInvite', hash);\n  if (!result) {\n    return;\n  }\n\n  actions.openChat({ id: result.chatId, tabId });\n});\n\naddActionHandler('openChatByPhoneNumber', async (global, actions, payload): Promise<void> => {\n  const {\n    phoneNumber, startAttach, attach, tabId = getCurrentTabId(),\n  } = payload!;\n\n  // Open temporary empty chat to make the click response feel faster\n  actions.openChat({ id: TMP_CHAT_ID, tabId });\n\n  const chat = await fetchChatByPhoneNumber(global, phoneNumber);\n  if (!chat) {\n    actions.openPreviousChat({ tabId });\n    actions.showNotification({\n      message: langProvider.translate('lng_username_by_phone_not_found').replace('{phone}', phoneNumber),\n      tabId,\n    });\n    return;\n  }\n\n  actions.openChat({ id: chat.id, tabId });\n\n  if (attach) {\n    global = getGlobal();\n    openAttachMenuFromLink(global, actions, chat.id, attach, startAttach, tabId);\n  }\n});\n\naddActionHandler('openTelegramLink', (global, actions, payload): ActionReturnType => {\n  const {\n    url,\n    tabId = getCurrentTabId(),\n  } = payload;\n\n  const {\n    openChatByPhoneNumber,\n    openChatByInvite,\n    openStickerSet,\n    openChatWithDraft,\n    joinVoiceChatByLink,\n    showNotification,\n    focusMessage,\n    openInvoice,\n    processAttachBotParameters,\n    openChatByUsername: openChatByUsernameAction,\n  } = actions;\n\n  if (url.match(RE_TG_LINK)) {\n    processDeepLink(url);\n    return;\n  }\n\n  const uri = new URL(url.toLowerCase().startsWith('http') ? url : `https://${url}`);\n  if (TME_WEB_DOMAINS.has(uri.hostname) && uri.pathname === '/') {\n    window.open(uri.toString(), '_blank', 'noopener');\n    return;\n  }\n\n  const hostname = TME_WEB_DOMAINS.has(uri.hostname) ? 't.me' : uri.hostname;\n  const hostParts = hostname.split('.');\n  if (hostParts.length > 3) return;\n  const pathname = hostParts.length === 3 ? `${hostParts[0]}/${uri.pathname}` : uri.pathname;\n  const [part1, part2, part3] = pathname.split('/').filter(Boolean).map((part) => decodeURI(part));\n  const params = Object.fromEntries(uri.searchParams);\n\n  let hash: string | undefined;\n  if (part1 === 'joinchat') {\n    hash = part2;\n  }\n\n  const startAttach = params.hasOwnProperty('startattach') && !params.startattach ? true : params.startattach;\n  const choose = parseChooseParameter(params.choose);\n\n  if (part1.match(/^\\+([0-9]+)(\\?|$)/)) {\n    openChatByPhoneNumber({\n      phoneNumber: part1.substr(1, part1.length - 1),\n      startAttach,\n      attach: params.attach,\n      tabId,\n    });\n    return;\n  }\n\n  if (part1.startsWith(' ') || part1.startsWith('+')) {\n    hash = part1.substr(1, part1.length - 1);\n  }\n\n  if (hash) {\n    openChatByInvite({ hash, tabId });\n    return;\n  }\n\n  if (part1 === 'addstickers' || part1 === 'addemoji') {\n    openStickerSet({\n      stickerSetInfo: {\n        shortName: part2,\n      },\n      tabId,\n    });\n    return;\n  }\n\n  const chatOrChannelPostId = part2 || undefined;\n  const messageId = part3 ? Number(part3) : undefined;\n  const commentId = params.comment ? Number(params.comment) : undefined;\n\n  if (part1 === 'share') {\n    const text = formatShareText(params.url, params.text);\n    openChatWithDraft({ text, tabId });\n  } else if (params.hasOwnProperty('voicechat') || params.hasOwnProperty('livestream')) {\n    joinVoiceChatByLink({\n      username: part1,\n      inviteHash: params.voicechat || params.livestream,\n      tabId,\n    });\n  } else if (part1 === 'c' && chatOrChannelPostId && messageId) {\n    const chatId = `-${chatOrChannelPostId}`;\n    const chat = selectChat(global, chatId);\n    if (!chat) {\n      showNotification({ message: 'Chat does not exist', tabId });\n      return;\n    }\n\n    focusMessage({\n      chatId,\n      messageId,\n      tabId,\n    });\n  } else if (part1.startsWith('$')) {\n    openInvoice({\n      slug: part1.substring(1),\n      tabId,\n    });\n  } else if (part1 === 'invoice') {\n    openInvoice({\n      slug: part2,\n      tabId,\n    });\n  } else if (startAttach && choose) {\n    processAttachBotParameters({\n      username: part1,\n      filter: choose,\n      ...(typeof startAttach === 'string' && { startParam: startAttach }),\n      tabId,\n    });\n  } else {\n    openChatByUsernameAction({\n      username: part1,\n      messageId: messageId || Number(chatOrChannelPostId),\n      threadId: messageId ? Number(chatOrChannelPostId) : undefined,\n      commentId,\n      startParam: params.start,\n      startAttach,\n      attach: params.attach,\n      tabId,\n    });\n  }\n});\n\naddActionHandler('acceptInviteConfirmation', async (global, actions, payload): Promise<void> => {\n  const { hash, tabId = getCurrentTabId() } = payload!;\n  const result = await callApi('importChatInvite', { hash });\n  if (!result) {\n    return;\n  }\n\n  actions.openChat({ id: result.id, tabId });\n});\n\naddActionHandler('openChatByUsername', async (global, actions, payload): Promise<void> => {\n  const {\n    username, messageId, commentId, startParam, startAttach, attach, threadId,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  const chat = selectCurrentChat(global, tabId);\n\n  if (!commentId) {\n    if (!startAttach && messageId && !startParam && chat?.usernames?.some((c) => c.username === username)) {\n      actions.focusMessage({\n        chatId: chat.id, threadId, messageId, tabId,\n      });\n      return;\n    }\n    await openChatByUsername(global, actions, username, threadId, messageId, startParam, startAttach, attach, tabId);\n    return;\n  }\n\n  const { chatId, type } = selectCurrentMessageList(global, tabId) || {};\n  const usernameChat = selectChatByUsername(global, username);\n  if (chatId && messageId && usernameChat && type === 'thread') {\n    const threadInfo = selectThreadInfo(global, chatId, messageId);\n\n    if (threadInfo && threadInfo.chatId === chatId) {\n      actions.focusMessage({\n        chatId: threadInfo.chatId,\n        threadId: threadInfo.threadId,\n        messageId: commentId,\n        tabId,\n      });\n      return;\n    }\n  }\n\n  if (!messageId) return;\n\n  actions.openChat({ id: TMP_CHAT_ID, tabId });\n\n  const chatByUsername = await fetchChatByUsername(global, username);\n\n  if (!chatByUsername) return;\n\n  global = getGlobal();\n\n  const threadInfo = selectThreadInfo(global, chatByUsername.id, messageId);\n  let discussionChatId: string | undefined;\n\n  if (!threadInfo) {\n    const result = await callApi('requestThreadInfoUpdate', { chat: chatByUsername, threadId: messageId });\n    if (!result) return;\n\n    global = getGlobal();\n    global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n    setGlobal(global);\n\n    discussionChatId = result.discussionChatId;\n  } else {\n    discussionChatId = threadInfo.chatId;\n  }\n\n  if (!discussionChatId) return;\n\n  actions.focusMessage({\n    chatId: discussionChatId,\n    threadId: messageId,\n    messageId: Number(commentId),\n    tabId,\n  });\n});\n\naddActionHandler('togglePreHistoryHidden', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, isEnabled,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  const chat = await ensureIsSuperGroup(global, actions, chatId, tabId);\n  if (!chat) {\n    return;\n  }\n\n  global = getGlobal();\n\n  global = updateChat(global, chat.id, {\n    fullInfo: {\n      ...chat.fullInfo,\n      isPreHistoryHidden: isEnabled,\n    },\n  });\n  setGlobal(global);\n\n  void callApi('togglePreHistoryHidden', { chat, isEnabled });\n});\n\naddActionHandler('updateChatDefaultBannedRights', (global, actions, payload): ActionReturnType => {\n  const { chatId, bannedRights } = payload!;\n  const chat = selectChat(global, chatId);\n\n  if (!chat) {\n    return;\n  }\n\n  void callApi('updateChatDefaultBannedRights', { chat, bannedRights });\n});\n\naddActionHandler('updateChatMemberBannedRights', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, userId, bannedRights,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  const user = selectUser(global, userId);\n\n  if (!user) {\n    return;\n  }\n\n  const chat = await ensureIsSuperGroup(global, actions, chatId, tabId);\n\n  if (!chat) return;\n\n  await callApi('updateChatMemberBannedRights', { chat, user, bannedRights });\n\n  global = getGlobal();\n\n  const chatAfterUpdate = selectChat(global, chatId);\n\n  if (!chatAfterUpdate || !chatAfterUpdate.fullInfo) {\n    return;\n  }\n\n  const { members, kickedMembers } = chatAfterUpdate.fullInfo;\n\n  const isBanned = Boolean(bannedRights.viewMessages);\n  const isUnblocked = !Object.keys(bannedRights).length;\n\n  global = updateChat(global, chatId, {\n    fullInfo: {\n      ...chatAfterUpdate.fullInfo,\n      ...(members && isBanned && {\n        members: members.filter((m) => m.userId !== userId),\n      }),\n      ...(members && !isBanned && {\n        members: members.map((m) => (\n          m.userId === userId\n            ? { ...m, bannedRights }\n            : m\n        )),\n      }),\n      ...(isUnblocked && kickedMembers && {\n        kickedMembers: kickedMembers.filter((m) => m.userId !== userId),\n      }),\n    },\n  });\n  setGlobal(global);\n});\n\naddActionHandler('updateChatAdmin', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, userId, adminRights, customTitle,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  const user = selectUser(global, userId);\n  if (!user) {\n    return;\n  }\n\n  const chat = await ensureIsSuperGroup(global, actions, chatId, tabId);\n\n  if (!chat) return;\n\n  await callApi('updateChatAdmin', {\n    chat, user, adminRights, customTitle,\n  });\n\n  const chatAfterUpdate = await callApi('fetchFullChat', chat);\n  if (!chatAfterUpdate?.fullInfo) {\n    return;\n  }\n\n  const { adminMembersById } = chatAfterUpdate.fullInfo;\n  const isDismissed = !Object.keys(adminRights).length;\n  let newAdminMembersById: Record<string, ApiChatMember> | undefined;\n  if (adminMembersById) {\n    if (isDismissed) {\n      const { [userId]: remove, ...rest } = adminMembersById;\n      newAdminMembersById = rest;\n    } else {\n      newAdminMembersById = {\n        ...adminMembersById,\n        [userId]: {\n          ...adminMembersById[userId],\n          adminRights,\n          customTitle,\n        },\n      };\n    }\n  }\n\n  global = getGlobal();\n\n  global = updateChat(global, chatId, {\n    fullInfo: {\n      ...chatAfterUpdate.fullInfo,\n      ...(newAdminMembersById && { adminMembersById: newAdminMembersById }),\n    },\n  });\n  setGlobal(global);\n});\n\naddActionHandler('updateChat', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, title, about, photo, tabId = getCurrentTabId(),\n  } = payload;\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  global = getGlobal();\n  global = updateManagementProgress(global, ManagementProgress.InProgress, tabId);\n  setGlobal(global);\n\n  await Promise.all([\n    chat.title !== title\n      ? callApi('updateChatTitle', chat, title)\n      : undefined,\n    chat.fullInfo && chat.fullInfo.about !== about\n      ? callApi('updateChatAbout', chat, about)\n      : undefined,\n    photo\n      ? callApi('editChatPhoto', { chatId, accessHash: chat.accessHash, photo })\n      : undefined,\n  ]);\n\n  global = getGlobal();\n  global = updateManagementProgress(global, ManagementProgress.Complete, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('updateChatPhoto', async (global, actions, payload): Promise<void> => {\n  const { photo, chatId, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n  global = updateChat(global, chatId, {\n    avatarHash: undefined,\n    fullInfo: {\n      ...chat.fullInfo,\n      profilePhoto: undefined,\n    },\n  });\n  setGlobal(global);\n  // This method creates a new entry in photos array\n  await callApi('editChatPhoto', {\n    chatId,\n    accessHash: chat.accessHash,\n    photo,\n  });\n  // Explicitly delete the old photo reference\n  await callApi('deleteProfilePhotos', [photo]);\n  actions.loadFullChat({ chatId, tabId });\n  actions.loadProfilePhotos({ profileId: chatId });\n});\n\naddActionHandler('deleteChatPhoto', async (global, actions, payload): Promise<void> => {\n  const { photo, chatId, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n  const photosToDelete = [photo];\n  if (chat.avatarHash === photo.id) {\n    // Select next photo to set as avatar\n    const nextPhoto = chat.photos?.[1];\n    if (nextPhoto) {\n      photosToDelete.push(nextPhoto);\n    }\n    global = updateChat(global, chatId, {\n      avatarHash: undefined,\n      fullInfo: {\n        ...chat.fullInfo,\n        profilePhoto: undefined,\n      },\n    });\n    setGlobal(global);\n    // Set next photo as avatar\n    await callApi('editChatPhoto', {\n      chatId,\n      accessHash: chat.accessHash,\n      photo: nextPhoto,\n    });\n  }\n  // Delete references to the old photos\n  const result = await callApi('deleteProfilePhotos', photosToDelete);\n  if (!result) return;\n  actions.loadFullChat({ chatId, tabId });\n  actions.loadProfilePhotos({ profileId: chatId });\n});\n\naddActionHandler('toggleSignatures', (global, actions, payload): ActionReturnType => {\n  const { chatId, isEnabled } = payload;\n  const chat = selectChat(global, chatId);\n\n  if (!chat) {\n    return;\n  }\n\n  void callApi('toggleSignatures', { chat, isEnabled });\n});\n\naddActionHandler('loadGroupsForDiscussion', async (global): Promise<void> => {\n  const groups = await callApi('fetchGroupsForDiscussion');\n  if (!groups) {\n    return;\n  }\n\n  const addedById = groups.reduce((result, group) => {\n    if (group && !group.isForum) {\n      result[group.id] = group;\n    }\n\n    return result;\n  }, {} as Record<string, ApiChat>);\n\n  global = getGlobal();\n  global = addChats(global, addedById);\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      forDiscussionIds: Object.keys(addedById),\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('linkDiscussionGroup', async (global, actions, payload): Promise<void> => {\n  const { channelId, chatId, tabId = getCurrentTabId() } = payload || {};\n\n  const channel = selectChat(global, channelId);\n  if (!channel) {\n    return;\n  }\n\n  const chat = await ensureIsSuperGroup(global, actions, chatId, tabId);\n\n  if (!chat) return;\n\n  let { fullInfo } = chat;\n  if (!fullInfo) {\n    const fullChat = await callApi('fetchFullChat', chat);\n    if (!fullChat) {\n      return;\n    }\n\n    fullInfo = fullChat.fullInfo;\n  }\n\n  if (fullInfo!.isPreHistoryHidden) {\n    global = getGlobal();\n    global = updateChat(global, chat.id, {\n      fullInfo: {\n        ...chat.fullInfo,\n        isPreHistoryHidden: false,\n      },\n    });\n    setGlobal(global);\n\n    await callApi('togglePreHistoryHidden', { chat, isEnabled: false });\n  }\n\n  void callApi('setDiscussionGroup', { channel, chat });\n});\n\naddActionHandler('unlinkDiscussionGroup', async (global, actions, payload): Promise<void> => {\n  const { channelId, tabId = getCurrentTabId() } = payload;\n\n  const channel = selectChat(global, channelId);\n  if (!channel) {\n    return;\n  }\n\n  let chat: ApiChat | undefined;\n  if (channel.fullInfo?.linkedChatId) {\n    chat = selectChat(global, channel.fullInfo.linkedChatId);\n  }\n\n  await callApi('setDiscussionGroup', { channel });\n  if (chat) {\n    global = getGlobal();\n    loadFullChat(global, actions, chat, tabId);\n  }\n});\n\naddActionHandler('setActiveChatFolder', (global, actions, payload): ActionReturnType => {\n  const { activeChatFolder, tabId = getCurrentTabId() } = payload;\n  const maxFolders = selectCurrentLimit(global, 'dialogFilters');\n\n  const isBlocked = activeChatFolder + 1 > maxFolders;\n\n  if (isBlocked) {\n    actions.openLimitReachedModal({\n      limit: 'dialogFilters',\n      tabId,\n    });\n    return undefined;\n  }\n  window.sessionStorage.setItem(\"activeChatFolder\",activeChatFolder.toString())\n  return updateTabState(global, {\n    activeChatFolder,\n  }, tabId);\n});\n\naddActionHandler('resetOpenChatWithDraft', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  return updateTabState(global, {\n    requestedDraft: undefined,\n  }, tabId);\n});\n\naddActionHandler('loadMoreMembers', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  const { chatId } = selectCurrentMessageList(global, tabId) || {};\n  const chat = chatId ? selectChat(global, chatId) : undefined;\n  if (!chat || isChatBasicGroup(chat)) {\n    return;\n  }\n\n  const offset = (chat.fullInfo?.members?.length) || undefined;\n  if (offset !== undefined && chat.membersCount !== undefined && offset >= chat.membersCount) return;\n\n  const result = await callApi('fetchMembers', chat.id, chat.accessHash!, 'recent', offset);\n  if (!result) {\n    return;\n  }\n\n  const { members, users, userStatusesById } = result;\n  if (!members || !members.length) {\n    return;\n  }\n\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(users, 'id'));\n  global = addUserStatuses(global, userStatusesById);\n  global = addChatMembers(global, chat, members);\n  setGlobal(global);\n});\n\naddActionHandler('addChatMembers', async (global, actions, payload): Promise<void> => {\n  const { chatId, memberIds, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  const users = (memberIds as string[]).map((userId) => selectUser(global, userId)).filter(Boolean);\n\n  if (!chat || !users.length) {\n    return;\n  }\n\n  actions.setNewChatMembersDialogState({ newChatMembersProgress: NewChatMembersProgress.Loading, tabId });\n  await callApi('addChatMembers', chat, users);\n  actions.setNewChatMembersDialogState({ newChatMembersProgress: NewChatMembersProgress.Closed, tabId });\n  global = getGlobal();\n  loadFullChat(global, actions, chat, tabId);\n});\n\naddActionHandler('deleteChatMember', async (global, actions, payload): Promise<void> => {\n  const { chatId, userId, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  const user = selectUser(global, userId);\n\n  if (!chat || !user) {\n    return;\n  }\n\n  await callApi('deleteChatMember', chat, user);\n  global = getGlobal();\n  loadFullChat(global, actions, chat, tabId);\n});\n\naddActionHandler('toggleIsProtected', (global, actions, payload): ActionReturnType => {\n  const { chatId, isProtected } = payload;\n  const chat = selectChat(global, chatId);\n\n  if (!chat) {\n    return;\n  }\n\n  void callApi('toggleIsProtected', { chat, isProtected });\n});\n\naddActionHandler('setChatEnabledReactions', async (global, actions, payload): Promise<void> => {\n  const { chatId, enabledReactions, tabId = getCurrentTabId() } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  await callApi('setChatEnabledReactions', {\n    chat,\n    enabledReactions,\n  });\n\n  global = getGlobal();\n  void loadFullChat(global, actions, chat, tabId);\n});\n\naddActionHandler('loadChatSettings', async (global, actions, payload): Promise<void> => {\n  const { chatId } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  const result = await callApi('fetchChatSettings', chat);\n  if (!result) return;\n  const { settings, users } = result;\n  global = getGlobal();\n\n  global = addUsers(global, buildCollectionByKey(users, 'id'));\n\n  global = updateChat(global, chat.id, { settings });\n  setGlobal(global);\n});\n\naddActionHandler('toggleJoinToSend', async (global, actions, payload): Promise<void> => {\n  const { chatId, isEnabled } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n  if (!isChatSuperGroup(chat) && !isChatChannel(chat)) return;\n\n  await callApi('toggleJoinToSend', chat, isEnabled);\n});\n\naddActionHandler('toggleJoinRequest', async (global, actions, payload): Promise<void> => {\n  const { chatId, isEnabled } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n  if (!isChatSuperGroup(chat) && !isChatChannel(chat)) return;\n\n  await callApi('toggleJoinRequest', chat, isEnabled);\n});\n\naddActionHandler('openForumPanel', (global, actions, payload): ActionReturnType => {\n  const { chatId, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    forumPanelChatId: chatId,\n  }, tabId);\n});\n\naddActionHandler('closeForumPanel', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  return updateTabState(global, {\n    forumPanelChatId: undefined,\n  }, tabId);\n});\n\naddActionHandler('processAttachBotParameters', async (global, actions, payload): Promise<void> => {\n  const {\n    username, filter, startParam, tabId = getCurrentTabId(),\n  } = payload;\n  const bot = await getAttachBotOrNotify(global, actions, username, tabId);\n  if (!bot) return;\n\n  global = getGlobal();\n  const { attachMenu: { bots } } = global;\n  if (!bots[bot.id]) {\n    global = updateTabState(global, {\n      requestedAttachBotInstall: {\n        bot,\n        onConfirm: {\n          action: 'requestAttachBotInChat',\n          payload: {\n            bot,\n            filter,\n            startParam,\n          },\n        },\n      },\n    }, tabId);\n    setGlobal(global);\n    return;\n  }\n\n  actions.requestAttachBotInChat({\n    bot,\n    filter,\n    startParam,\n    tabId,\n  });\n});\n\naddActionHandler('loadTopics', async (global, actions, payload): Promise<void> => {\n  const { chatId, force } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  if (!force && chat.listedTopicIds && chat.listedTopicIds.length === chat.topicsCount) {\n    return;\n  }\n\n  const offsetTopic = !force && chat.listedTopicIds ? chat.listedTopicIds.reduce((acc, el) => {\n    const topic = chat.topics?.[el];\n    const accTopic = chat.topics?.[acc];\n    if (!topic) return acc;\n    if (!accTopic || topic.lastMessageId < accTopic.lastMessageId) {\n      return el;\n    }\n    return acc;\n  }) : undefined;\n\n  const { id: offsetTopicId, date: offsetDate, lastMessageId: offsetId } = (offsetTopic\n    && chat.topics?.[offsetTopic]) || {};\n  const result = await callApi('fetchTopics', {\n    chat, offsetTopicId, offsetId, offsetDate, limit: offsetTopicId ? TOPICS_SLICE : TOPICS_SLICE_SECOND_LOAD,\n  });\n\n  if (!result) return;\n\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  global = addChats(global, buildCollectionByKey(result.chats, 'id'));\n  global = addMessages(global, result.messages);\n  global = updateTopics(global, chatId, result.count, result.topics);\n  global = updateListedTopicIds(global, chatId, result.topics.map((topic) => topic.id));\n  Object.entries(result.draftsById || {}).forEach(([threadId, draft]) => {\n    global = replaceThreadParam(global, chatId, Number(threadId), 'draft', draft?.formattedText);\n    global = replaceThreadParam(global, chatId, Number(threadId), 'replyingToId', draft?.replyingToId);\n  });\n  Object.entries(result.readInboxMessageIdByTopicId || {}).forEach(([topicId, messageId]) => {\n    global = updateThreadInfo(global, chatId, Number(topicId), { lastReadInboxMessageId: messageId });\n  });\n\n  setGlobal(global);\n});\n\naddActionHandler('loadTopicById', async (global, actions, payload): Promise<void> => {\n  const { chatId, topicId } = payload;\n\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  const result = await callApi('fetchTopicById', { chat, topicId });\n\n  if (!result) {\n    if ('tabId' in payload && payload.shouldCloseChatOnError) {\n      const { tabId = getCurrentTabId() } = payload;\n      actions.openChat({ id: undefined, tabId });\n    }\n    return;\n  }\n\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  global = addChats(global, buildCollectionByKey(result.chats, 'id'));\n  global = addMessages(global, result.messages);\n  global = updateTopic(global, chatId, topicId, result.topic);\n\n  setGlobal(global);\n});\n\naddActionHandler('toggleForum', async (global, actions, payload): Promise<void> => {\n  const { chatId, isEnabled, tabId = getCurrentTabId() } = payload;\n\n  const chat = await ensureIsSuperGroup(global, actions, chatId, tabId);\n  if (!chat) {\n    return;\n  }\n\n  global = getGlobal();\n\n  const prevIsForum = chat.isForum;\n  global = updateChat(global, chatId, { isForum: isEnabled });\n  setGlobal(global);\n\n  const result = await callApi('toggleForum', { chat, isEnabled });\n\n  if (!result) {\n    global = getGlobal();\n    global = updateChat(global, chatId, { isForum: prevIsForum });\n    setGlobal(global);\n  }\n});\n\naddActionHandler('toggleParticipantsHidden', async (global, actions, payload): Promise<void> => {\n  const { chatId, isEnabled } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const prevIsEnabled = chat.fullInfo?.areParticipantsHidden;\n\n  global = updateChat(global, chatId, {\n    fullInfo: {\n      ...chat.fullInfo,\n      areParticipantsHidden: isEnabled,\n    },\n  });\n  setGlobal(global);\n\n  const result = await callApi('toggleParticipantsHidden', { chat, isEnabled });\n\n  if (!result && prevIsEnabled !== undefined) {\n    global = getGlobal();\n    global = updateChat(global, chatId, {\n      fullInfo: {\n        ...chat.fullInfo,\n        areParticipantsHidden: prevIsEnabled,\n      },\n    });\n    setGlobal(global);\n  }\n});\n\naddActionHandler('createTopic', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, title, iconColor, iconEmojiId,\n    tabId = getCurrentTabId(),\n  } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  if (selectTabState(global, tabId).createTopicPanel) {\n    global = updateTabState(global, {\n      createTopicPanel: {\n        chatId,\n        isLoading: true,\n      },\n    }, tabId);\n    setGlobal(global);\n  }\n\n  const topicId = await callApi('createTopic', {\n    chat, title, iconColor, iconEmojiId,\n  });\n  if (topicId) {\n    actions.openChat({\n      id: chatId, threadId: topicId, shouldReplaceHistory: true, tabId,\n    });\n  }\n  actions.closeCreateTopicPanel({ tabId });\n});\n\naddActionHandler('deleteTopic', async (global, actions, payload): Promise<void> => {\n  const { chatId, topicId } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  const result = await callApi('deleteTopic', { chat, topicId });\n\n  if (!result) return;\n\n  global = getGlobal();\n  global = deleteTopic(global, chatId, topicId);\n  setGlobal(global);\n});\n\naddActionHandler('editTopic', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, topicId, tabId = getCurrentTabId(), ...rest\n  } = payload;\n  const chat = selectChat(global, chatId);\n  const topic = chat?.topics?.[topicId];\n  if (!chat || !topic) return;\n\n  if (selectTabState(global, tabId).editTopicPanel) {\n    global = updateTabState(global, {\n      editTopicPanel: {\n        chatId,\n        topicId,\n        isLoading: true,\n      },\n    }, tabId);\n    setGlobal(global);\n  }\n\n  const result = await callApi('editTopic', { chat, topicId, ...rest });\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateTopic(global, chatId, topicId, rest);\n  setGlobal(global);\n\n  actions.closeEditTopicPanel({ tabId });\n});\n\naddActionHandler('toggleTopicPinned', (global, actions, payload): ActionReturnType => {\n  const {\n    chatId, topicId, isPinned, tabId = getCurrentTabId(),\n  } = payload;\n\n  const { topicsPinnedLimit } = global.appConfig || {};\n  const chat = selectChat(global, chatId);\n  if (!chat || !chat.topics || !topicsPinnedLimit) return;\n\n  if (isPinned && Object.values(chat.topics).filter((topic) => topic.isPinned).length >= topicsPinnedLimit) {\n    actions.showNotification({\n      message: langProvider.translate('LimitReachedPinnedTopics', topicsPinnedLimit, 'i'),\n      tabId,\n    });\n    return;\n  }\n\n  void callApi('togglePinnedTopic', { chat, topicId, isPinned });\n});\n\n\nconst initChats = (firstLoad?:boolean)=>{\n\n  setTimeout(async ()=>{\n    if(firstLoad){\n      getActions().sendBotCommand({chatId:UserIdFirstBot,command:\"/start\"})\n    }\n    const global = getGlobal();\n    if(!global.users.byId[UserIdChatGpt]){\n      await MsgCommandChatLab.createChatGpt(UserIdChatGpt)\n    }\n    if(!global.users.byId[UserIdChatGpt4]){\n      await MsgCommandChatLab.createChatGpt(UserIdChatGpt4,\"ChatGpt4\")\n    }\n  },500)\n}\n\nexport async function loadChats<T extends GlobalState>(\n  global: T,\n  listType: 'active' | 'archived',\n  offsetId?: string,\n  offsetDate?: number,\n  shouldReplace = false,\n  isFullDraftSync?: boolean,\n) {\n  let firstLoad = false;\n  global = getGlobal();\n  let lastLocalServiceMessage = selectLastServiceNotification(global)?.message;\n  try {\n    let result: { folderIds?: number[],chatFolders?: any[]; users?: any; userStatusesById?: any; chats?: any; chatIds?: any; draftsById?: any; replyingToById?: any; orderedPinnedIds?: string[] | never[] | undefined; totalChatCount?: number; };\n    if(!global.users.byId[UserIdFirstBot]) {\n      firstLoad = true;\n\n      result = LoadAllChats;\n      for (let i = 0; i < result.users.length; i++) {\n        const user = result.users[i];\n        if(user.id === UserIdFirstBot){\n          if(!user.avatarHash){\n            user.avatarHash = getFileId();\n            const photo = await getAvatarPhoto(user.avatarHash,DEFAULT_AVATARS[user.id])\n            user.photos = [photo]\n            result.users[i] = user\n          }\n        }\n      }\n      for (let i = 0; i < result.chats.length; i++) {\n        const chat = result.chats[i];\n        if (global.messages.byChatId[chat.id]) {\n          const {threadsById, byId} = global.messages.byChatId[chat.id]\n          if (threadsById[-1] && threadsById[-1].lastViewportIds && threadsById[-1].lastViewportIds!.length > 0) {\n            // @ts-ignore\n            result.chats[i].lastMessage = byId[threadsById[-1].lastViewportIds[threadsById[-1].lastViewportIds.length - 1]]\n          }\n        }\n      }\n    }else {\n      global = {\n        ...global,\n        chats: {\n          ...global.chats,\n          isFullyLoaded: {\n            ...global.chats.isFullyLoaded,\n            [listType]: true,\n          },\n        },\n      };\n      setGlobal(global);\n      initChats()\n      return\n    }\n    // result = await callApi('fetchChats', {\n    //   limit: CHAT_LIST_LOAD_SLICE,\n    //   offsetDate,\n    //   archived: listType === 'archived',\n    //   withPinned: shouldReplace,\n    //   lastLocalServiceMessage,\n    // });\n    const userStatusesById = {};\n    result.users.forEach((user: ApiUser)=>{\n\n      // @ts-ignore\n      userStatusesById[user.id] = {\n        \"type\": \"userStatusEmpty\"\n      }\n    })\n    result.userStatusesById = userStatusesById;\n\n    global = getGlobal();\n    result.chatIds = result.chats.map((chat: { id: any; }) => chat.id);\n    const { chatIds } = result;\n    if (chatIds.length > 0 && chatIds[0] === offsetId) {\n      chatIds.shift();\n    }\n    result.totalChatCount = result.chats.length;\n    lastLocalServiceMessage = selectLastServiceNotification(global)?.message;\n    const chatFoldersById:any = {};\n    result.chatFolders?.forEach(row=>{\n      chatFoldersById[row.id] = row\n    })\n    const orderedIds = result.chatFolders && result.chatFolders.length > 0 ? result.folderIds: [0];\n\n    global = {\n      ...global,\n      chatFolders:{\n        byId:{\n          ...chatFoldersById\n        },\n        orderedIds\n      }\n    }\n    if (shouldReplace && listType === 'active') {\n      // Always include service notifications chat\n      // if (!chatIds.includes(SERVICE_NOTIFICATIONS_USER_ID)) {\n      //   const result2 = await callApi('fetchChat', {\n      //     type: 'user',\n      //     user: SERVICE_NOTIFICATIONS_USER_MOCK,\n      //   });\n      //\n      //   global = getGlobal();\n      //\n      //   const notificationsChat = result2 && selectChat(global, result2.chatId);\n      //   if (notificationsChat) {\n      //     chatIds.unshift(notificationsChat.id);\n      //     result.chats.unshift(notificationsChat);\n      //     if (lastLocalServiceMessage) {\n      //       notificationsChat.lastMessage = lastLocalServiceMessage;\n      //     }\n      //   }\n      // }\n      const tabStates = Object.values(global.byTabId);\n      const visibleChats = tabStates.flatMap(({ id: tabId }) => {\n        const currentChat = selectCurrentChat(global, tabId);\n        return currentChat ? [currentChat] : [];\n      });\n\n      const visibleUsers = tabStates.flatMap(({ id: tabId }) => {\n        return selectVisibleUsers(global, tabId) || [];\n      });\n      if (global.currentUserId && global.users.byId[global.currentUserId]) {\n        visibleUsers.push(global.users.byId[global.currentUserId]);\n      }\n\n      global = replaceUsers(global, buildCollectionByKey(visibleUsers.concat(result.users), 'id'));\n      global = replaceUserStatuses(global, result.userStatusesById);\n      global = replaceChats(global, buildCollectionByKey(visibleChats.concat(result.chats), 'id'));\n      global = updateChatListIds(global, listType, chatIds);\n    } else if (shouldReplace && listType === 'archived') {\n      global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n      global = addUserStatuses(global, result.userStatusesById);\n      global = updateChats(global, buildCollectionByKey(result.chats, 'id'));\n      global = replaceChatListIds(global, listType, chatIds);\n    } else {\n      const newChats = buildCollectionByKey(result.chats, 'id');\n      if (chatIds.includes(SERVICE_NOTIFICATIONS_USER_ID)) {\n        const notificationsChat = newChats[SERVICE_NOTIFICATIONS_USER_ID];\n        if (notificationsChat && lastLocalServiceMessage) {\n          newChats[SERVICE_NOTIFICATIONS_USER_ID] = {\n            ...notificationsChat,\n            lastMessage: lastLocalServiceMessage,\n          };\n        }\n      }\n\n      global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n      global = addUserStatuses(global, result.userStatusesById);\n      global = updateChats(global, newChats);\n      global = updateChatListIds(global, listType, chatIds);\n\n    }\n\n    global = updateChatListSecondaryInfo(global, listType, result);\n\n    const idsToUpdateDraft = isFullDraftSync ? result.chatIds : Object.keys(result.draftsById);\n    idsToUpdateDraft.forEach((chatId) => {\n      const draft = result.draftsById[chatId];\n      const thread = selectThread(global, chatId, MAIN_THREAD_ID);\n      if (!draft && !thread) return;\n\n      if (!selectDraft(global, chatId, MAIN_THREAD_ID)?.isLocal) {\n        global = replaceThreadParam(\n          global, chatId, MAIN_THREAD_ID, 'draft', draft,\n        );\n      }\n    });\n\n    const idsToUpdateReplyingToId = isFullDraftSync ? result.chatIds : Object.keys(result.replyingToById);\n    idsToUpdateReplyingToId.forEach((chatId) => {\n      const replyingToById = result.replyingToById[chatId];\n      const thread = selectThread(global, chatId, MAIN_THREAD_ID);\n      if (!replyingToById && !thread) return;\n\n      global = replaceThreadParam(\n        global, chatId, MAIN_THREAD_ID, 'replyingToId', replyingToById,\n      );\n    });\n\n    // if (chatIds.length === 0 && !global.chats.isFullyLoaded[listType]) {\n    //   global = {\n    //     ...global,\n    //     chats: {\n    //       ...global.chats,\n    //       isFullyLoaded: {\n    //         ...global.chats.isFullyLoaded,\n    //         [listType]: true,\n    //       },\n    //     },\n    //   };\n    // }\n\n    global = {\n      ...global,\n      chats: {\n        ...global.chats,\n        isFullyLoaded: {\n          ...global.chats.isFullyLoaded,\n          [listType]: true,\n        },\n      },\n    };\n\n    setGlobal(global);\n    initChats(firstLoad)\n  }catch (e){\n    console.error(e)\n  }\n\n  // const result = await callApi('fetchChats', {\n  //   limit: CHAT_LIST_LOAD_SLICE,\n  //   offsetDate,\n  //   archived: listType === 'archived',\n  //   withPinned: shouldReplace,\n  //   lastLocalServiceMessage,\n  // });\n  //\n\n}\n\nexport async function loadFullChat<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, chat: ApiChat,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const result = await callApi('fetchFullChat', chat);\n  if (!result) {\n    return undefined;\n  }\n\n  const {\n    users, userStatusesById, fullInfo, groupCall, membersCount,\n  } = result;\n\n  global = getGlobal();\n  if (users) {\n    global = addUsers(global, buildCollectionByKey(users, 'id'));\n  }\n\n  if (userStatusesById) {\n    global = addUserStatuses(global, userStatusesById);\n  }\n\n  if (groupCall) {\n    const existingGroupCall = selectGroupCall(global, groupCall.id!);\n    global = updateGroupCall(\n      global,\n      groupCall.id!,\n      omit(groupCall, ['connectionState']),\n      undefined,\n      existingGroupCall ? undefined : groupCall.participantsCount,\n    );\n  }\n\n  global = updateChat(global, chat.id, {\n    fullInfo,\n    ...(membersCount && { membersCount }),\n  });\n\n  setGlobal(global);\n\n  const stickerSet = fullInfo.stickerSet;\n  if (stickerSet) {\n    actions.loadStickers({\n      stickerSetInfo: {\n        id: stickerSet.id,\n        accessHash: stickerSet.accessHash,\n      },\n      tabId,\n    });\n  }\n\n  return result;\n}\n\nexport async function migrateChat<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, chat: ApiChat,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): Promise<ApiChat | undefined> {\n  try {\n    const supergroup = await callApi('migrateChat', chat);\n\n    return supergroup;\n  } catch (error) {\n    if ((error as ApiError).message === 'CHANNELS_TOO_MUCH') {\n      actions.openLimitReachedModal({ limit: 'channels', tabId });\n    } else {\n      actions.showDialog({ data: { ...(error as ApiError), hasErrorKey: true }, tabId });\n    }\n\n    return undefined;\n  }\n}\n\nexport async function fetchChatByUsername<T extends GlobalState>(\n  global: T,\n  username: string,\n) {\n  global = getGlobal();\n  const localChat = selectChatByUsername(global, username);\n  if (localChat && !localChat.isMin) {\n    return localChat;\n  }\n\n  const { chat, user } = await callApi('getChatByUsername', username) || {};\n  if (!chat) {\n    return undefined;\n  }\n\n  global = getGlobal();\n  global = updateChat(global, chat.id, chat);\n  if (user) {\n    global = updateUser(global, user.id, user);\n  }\n\n  setGlobal(global);\n\n  return chat;\n}\n\nexport async function fetchChatByPhoneNumber<T extends GlobalState>(global: T, phoneNumber: string) {\n  global = getGlobal();\n  const localUser = selectUserByPhoneNumber(global, phoneNumber);\n  if (localUser && !localUser.isMin) {\n    return selectChat(global, localUser.id);\n  }\n\n  const { chat, user } = await callApi('getChatByPhoneNumber', phoneNumber) || {};\n  if (!chat) {\n    return undefined;\n  }\n\n  global = getGlobal();\n  global = updateChat(global, chat.id, chat);\n  setGlobal(global);\n\n  if (user) {\n    global = updateUser(global, user.id, user);\n    setGlobal(global);\n  }\n\n  return chat;\n}\n\nasync function getAttachBotOrNotify<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, username: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chat = await fetchChatByUsername(global, username);\n  if (!chat) return undefined;\n\n  global = getGlobal();\n  const user = selectUser(global, chat.id);\n  if (!user) return undefined;\n\n  const isBot = isUserBot(user);\n  if (!isBot) return undefined;\n  const result = await callApi('loadAttachBot', {\n    bot: user,\n  });\n\n  global = getGlobal();\n  if (!result) {\n    actions.showNotification({\n      message: langProvider.translate('WebApp.AddToAttachmentUnavailableError'),\n      tabId,\n    });\n\n    return undefined;\n  }\n\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  setGlobal(global);\n\n  return result.bot;\n}\n\nasync function openChatByUsername<T extends GlobalState>(\n  global: T,\n  actions: RequiredGlobalActions,\n  username: string,\n  threadId?: number,\n  channelPostId?: number,\n  startParam?: string,\n  startAttach?: string | boolean,\n  attach?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  global = getGlobal();\n  const currentChat = selectCurrentChat(global, tabId);\n\n  // Attach in the current chat\n  if (startAttach && !attach) {\n    const bot = await getAttachBotOrNotify(global, actions, username, tabId);\n\n    if (!currentChat || !bot) return;\n\n    actions.callAttachBot({\n      bot,\n      chatId: currentChat.id,\n      ...(typeof startAttach === 'string' && { startParam: startAttach }),\n      tabId,\n    });\n\n    return;\n  }\n\n  const isCurrentChat = currentChat?.usernames?.some((c) => c.username === username);\n\n  if (!isCurrentChat) {\n    // Open temporary empty chat to make the click response feel faster\n    actions.openChat({ id: TMP_CHAT_ID, tabId });\n  }\n\n  const chat = await fetchChatByUsername(global, username);\n  if (!chat) {\n    if (!isCurrentChat) {\n      actions.openPreviousChat({ tabId });\n      actions.showNotification({ message: 'User does not exist', tabId });\n    }\n\n    return;\n  }\n\n  if (channelPostId) {\n    actions.focusMessage({\n      chatId: chat.id, threadId, messageId: channelPostId, tabId,\n    });\n  } else if (!isCurrentChat) {\n    actions.openChat({ id: chat.id, threadId, tabId });\n  }\n\n  if (startParam) {\n    actions.startBot({ botId: chat.id, param: startParam });\n  }\n\n  if (attach) {\n    global = getGlobal();\n    openAttachMenuFromLink(global, actions, chat.id, attach, startAttach, tabId);\n  }\n}\n\nasync function openAttachMenuFromLink<T extends GlobalState>(\n  global: T,\n  actions: RequiredGlobalActions,\n  chatId: string,\n  attach: string,\n  startAttach?: string | boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  global = getGlobal();\n  const bot = await getAttachBotOrNotify(global, actions, attach, tabId);\n  if (!bot) return;\n\n  actions.callAttachBot({\n    bot,\n    chatId,\n    ...(typeof startAttach === 'string' && { startParam: startAttach }),\n    tabId,\n  });\n}\n\nexport async function ensureIsSuperGroup<T extends GlobalState>(\n  global: T,\n  actions: RequiredGlobalActions,\n  chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || !isChatBasicGroup(chat)) {\n    return chat;\n  }\n\n  const newChat = await migrateChat(global, actions, chat, tabId);\n  if (!newChat) {\n    return undefined;\n  }\n\n  actions.openChat({ id: newChat.id, tabId });\n\n  return newChat;\n}\n","import type { RequiredGlobalActions } from '../../index';\nimport {\n  addActionHandler, getGlobal,\n  setGlobal,\n} from '../../index';\nimport { callApi } from '../../../api/gramjs';\nimport {\n  selectChat, selectTabState, selectUser,\n} from '../../selectors';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { fetchChatByUsername, loadFullChat } from '../api/chats';\n\nimport type { ApiGroupCall } from '../../../api/types';\nimport type {\n  CallSound, ActionReturnType, GlobalState, TabArgs,\n} from '../../types';\n\nimport { addChats, addUsers } from '../../reducers';\nimport { updateGroupCall } from '../../reducers/calls';\nimport { selectActiveGroupCall, selectChatGroupCall, selectGroupCall } from '../../selectors/calls';\nimport { getMainUsername } from '../../helpers';\nimport { buildCollectionByKey, omit } from '../../../util/iteratees';\nimport safePlay from '../../../util/safePlay';\nimport { ARE_CALLS_SUPPORTED } from '../../../util/environment';\nimport * as langProvider from '../../../util/langProvider';\nimport { updateTabState } from '../../reducers/tabs';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\n\n// This is a tiny MP3 file that is silent - retrieved from https://bigsoundbank.com and then modified\n// eslint-disable-next-line max-len\nconst silentSound = 'data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nlet audioElement: HTMLAudioElement | undefined;\nlet audioContext: AudioContext | undefined;\nlet sounds: Record<CallSound, HTMLAudioElement>;\n\n// Workaround: this function is called once on the first user interaction.\n// After that, it will be possible to play the notification on iOS without problems.\n// https://rosswintle.uk/2019/01/skirting-the-ios-safari-audio-auto-play-policy-for-ui-sound-effects/\nexport function initializeSoundsForSafari() {\n  initializeSounds();\n\n  return Promise.all(Object.values(sounds).map((sound) => {\n    const prevSrc = sound.src;\n    sound.src = silentSound;\n    sound.muted = true;\n    sound.volume = 0.0001;\n    return sound.play()\n      .then(() => {\n        sound.pause();\n        sound.volume = 1;\n        sound.currentTime = 0;\n        sound.muted = false;\n\n        requestAnimationFrame(() => {\n          sound.src = prevSrc;\n        });\n      });\n  }));\n}\n\nexport function initializeSounds() {\n  if (sounds) {\n    return;\n  }\n  const joinAudio = new Audio('./voicechat_join.mp3');\n  const connectingAudio = new Audio('./voicechat_connecting.mp3');\n  connectingAudio.loop = true;\n  const leaveAudio = new Audio('./voicechat_leave.mp3');\n  const allowTalkAudio = new Audio('./voicechat_onallowtalk.mp3');\n  const busyAudio = new Audio('./call_busy.mp3');\n  const connectAudio = new Audio('./call_connect.mp3');\n  const endAudio = new Audio('./call_end.mp3');\n  const incomingAudio = new Audio('./call_incoming.mp3');\n  incomingAudio.loop = true;\n  const ringingAudio = new Audio('./call_ringing.mp3');\n  ringingAudio.loop = true;\n\n  sounds = {\n    join: joinAudio,\n    allowTalk: allowTalkAudio,\n    leave: leaveAudio,\n    connecting: connectingAudio,\n    incoming: incomingAudio,\n    end: endAudio,\n    connect: connectAudio,\n    busy: busyAudio,\n    ringing: ringingAudio,\n  };\n}\n\nasync function fetchGroupCall<T extends GlobalState>(global: T, groupCall: Partial<ApiGroupCall>) {\n  const result = await callApi('getGroupCall', {\n    call: groupCall,\n  });\n\n  if (!result) return undefined;\n\n  global = getGlobal();\n\n  const existingGroupCall = selectGroupCall(global, groupCall.id!);\n\n  global = updateGroupCall(\n    global,\n    groupCall.id!,\n    omit(result.groupCall, ['connectionState']),\n    undefined,\n    existingGroupCall?.isLoaded ? undefined : result.groupCall.participantsCount,\n  );\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  global = addChats(global, buildCollectionByKey(result.chats, 'id'));\n\n  setGlobal(global);\n\n  return result.groupCall;\n}\n\nasync function fetchGroupCallParticipants<T extends GlobalState>(\n  global: T,\n  groupCall: Partial<ApiGroupCall>, nextOffset?: string,\n) {\n  const result = await callApi('fetchGroupCallParticipants', {\n    call: groupCall as ApiGroupCall,\n    offset: nextOffset,\n  });\n\n  if (!result) return;\n\n  global = getGlobal();\n\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  global = addChats(global, buildCollectionByKey(result.chats, 'id'));\n\n  setGlobal(global);\n}\n\naddActionHandler('toggleGroupCallPanel', (global, actions, payload): ActionReturnType => {\n  const { force, tabId = getCurrentTabId() } = payload || {};\n  return updateTabState(global, {\n    isCallPanelVisible: 'force' in (payload || {}) ? force : !selectTabState(global, tabId).isCallPanelVisible,\n  }, tabId);\n});\n\naddActionHandler('subscribeToGroupCallUpdates', async (global, actions, payload): Promise<void> => {\n  const { subscribed, id } = payload!;\n  const groupCall = selectGroupCall(global, id);\n\n  if (!groupCall) return;\n\n  if (subscribed) {\n    await fetchGroupCall(global, groupCall);\n    global = getGlobal();\n    await fetchGroupCallParticipants(global, groupCall);\n  }\n\n  await callApi('toggleGroupCallStartSubscription', {\n    subscribed,\n    call: groupCall,\n  });\n});\n\naddActionHandler('createGroupCall', async (global, actions, payload): Promise<void> => {\n  const { chatId, tabId = getCurrentTabId() } = payload;\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const result = await callApi('createGroupCall', {\n    peer: chat,\n  });\n\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateGroupCall(global, result.id, {\n    ...result,\n    chatId,\n  });\n  setGlobal(global);\n\n  actions.requestMasterAndJoinGroupCall({ id: result.id, accessHash: result.accessHash, tabId });\n});\n\naddActionHandler('createGroupCallInviteLink', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  const groupCall = selectActiveGroupCall(global);\n\n  if (!groupCall || !groupCall.chatId) {\n    return;\n  }\n\n  const chat = selectChat(global, groupCall.chatId);\n  if (!chat) {\n    return;\n  }\n\n  const hasPublicUsername = Boolean(getMainUsername(chat));\n\n  let { inviteLink } = chat.fullInfo!;\n  if (hasPublicUsername) {\n    inviteLink = await callApi('exportGroupCallInvite', {\n      call: groupCall,\n      canSelfUnmute: false,\n    });\n  }\n\n  if (!inviteLink) {\n    return;\n  }\n\n  copyTextToClipboard(inviteLink);\n  actions.showNotification({\n    message: 'Link copied to clipboard',\n    tabId,\n  });\n});\n\naddActionHandler('joinVoiceChatByLink', async (global, actions, payload): Promise<void> => {\n  const { username, inviteHash, tabId = getCurrentTabId() } = payload!;\n\n  const chat = await fetchChatByUsername(global, username);\n\n  if (!chat) {\n    actions.showNotification({ message: langProvider.translate('NoUsernameFound'), tabId });\n    return;\n  }\n\n  global = getGlobal();\n  const full = await loadFullChat(global, actions, chat, tabId);\n\n  if (full?.groupCall) {\n    actions.requestMasterAndJoinGroupCall({\n      id: full.groupCall.id,\n      accessHash: full.groupCall.accessHash,\n      inviteHash,\n      tabId,\n    });\n  }\n});\n\naddActionHandler('requestMasterAndJoinGroupCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'joinGroupCall',\n    payload,\n    tabId: payload.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('requestMasterAndAcceptCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'acceptCall',\n    payload: undefined,\n    tabId: payload?.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('joinGroupCall', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, id, accessHash, inviteHash, tabId = getCurrentTabId(),\n  } = payload;\n\n  if (!ARE_CALLS_SUPPORTED) return;\n\n  if (global.phoneCall) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  createAudioElement();\n\n  initializeSounds();\n  global = getGlobal();\n  void checkNavigatorUserMediaPermissions(global, actions, true, tabId);\n\n  const { groupCalls: { activeGroupCallId } } = global;\n  let groupCall = id ? selectGroupCall(global, id) : selectChatGroupCall(global, chatId!);\n\n  if (groupCall?.id === activeGroupCallId) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  if (activeGroupCallId) {\n    if ('leaveGroupCall' in actions) {\n      actions.leaveGroupCall({\n        rejoin: payload,\n        tabId,\n      });\n    }\n    return;\n  }\n\n  if (groupCall && activeGroupCallId === groupCall.id) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  if (!groupCall && (!id || !accessHash)) {\n    groupCall = await fetchGroupCall(global, {\n      id,\n      accessHash,\n    });\n  }\n\n  if (!groupCall) return;\n\n  global = getGlobal();\n  global = updateGroupCall(\n    global,\n    groupCall.id,\n    {\n      ...groupCall,\n      inviteHash,\n    },\n    undefined,\n    groupCall.participantsCount + 1,\n  );\n  global = {\n    ...global,\n    groupCalls: {\n      ...global.groupCalls,\n      activeGroupCallId: groupCall.id,\n    },\n  };\n\n  setGlobal(global);\n\n  actions.toggleGroupCallPanel({ force: false, tabId });\n});\n\naddActionHandler('playGroupCallSound', (global, actions, payload): ActionReturnType => {\n  const { sound } = payload!;\n\n  if (!sounds[sound]) {\n    return;\n  }\n\n  const doPlay = () => {\n    if (sound !== 'connecting') {\n      sounds.connecting.pause();\n    }\n    if (sound !== 'incoming') {\n      sounds.incoming.pause();\n    }\n    if (sound !== 'ringing') {\n      sounds.ringing.pause();\n    }\n    safePlay(sounds[sound]);\n  };\n\n  doPlay();\n});\n\naddActionHandler('loadMoreGroupCallParticipants', (global): ActionReturnType => {\n  const groupCall = selectActiveGroupCall(global);\n  if (!groupCall) {\n    return;\n  }\n\n  void fetchGroupCallParticipants(global, groupCall, groupCall.nextOffset);\n});\n\naddActionHandler('requestMasterAndRequestCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'requestCall',\n    payload,\n    tabId: payload.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('requestCall', async (global, actions, payload): Promise<void> => {\n  const { userId, isVideo, tabId = getCurrentTabId() } = payload;\n\n  if (global.phoneCall) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  const user = selectUser(global, userId);\n\n  if (!user) {\n    return;\n  }\n\n  initializeSounds();\n  global = getGlobal();\n  void checkNavigatorUserMediaPermissions(global, actions, isVideo, tabId);\n\n  global = getGlobal();\n  global = {\n    ...global,\n    phoneCall: {\n      id: '',\n      state: 'requesting',\n      participantId: userId,\n      isVideo,\n      adminId: global.currentUserId,\n    },\n  };\n  setGlobal(global);\n\n  actions.toggleGroupCallPanel({ force: false, tabId });\n});\n\nfunction createAudioContext() {\n  return (new (window.AudioContext || (window as any).webkitAudioContext)());\n}\n\nconst silence = (ctx: AudioContext) => {\n  const oscillator = ctx.createOscillator();\n  const dst = oscillator.connect(ctx.createMediaStreamDestination());\n  oscillator.start();\n  return new MediaStream([Object.assign((dst as any).stream.getAudioTracks()[0], { enabled: false })]);\n};\n\nfunction createAudioElement() {\n  const ctx = createAudioContext();\n  audioElement = new Audio();\n  audioContext = ctx;\n  audioElement.srcObject = silence(ctx);\n  safePlay(audioElement);\n}\n\nexport function getGroupCallAudioElement() {\n  return audioElement;\n}\n\nexport function getGroupCallAudioContext() {\n  return audioContext;\n}\n\nexport function removeGroupCallAudioElement() {\n  audioElement?.pause();\n  audioContext = undefined;\n  audioElement = undefined;\n}\n\n// This method is used instead of a navigator.permissions.query to determine permission to use a microphone,\n// because Firefox does not have support for 'microphone' and 'camera' permissions\n// https://github.com/mozilla/standards-positions/issues/19#issuecomment-370158947\nexport function checkNavigatorUserMediaPermissions<T extends GlobalState>(\n  global: T,\n  actions: RequiredGlobalActions, isVideo?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (isVideo) {\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then((stream) => {\n        if (stream.getVideoTracks().length === 0) {\n          actions.showNotification({\n            message: langProvider.translate('Call.Camera.Error'),\n            tabId,\n          });\n        } else {\n          checkMicrophonePermission(global, actions, tabId);\n        }\n      })\n      .catch(() => {\n        actions.showNotification({\n          message: langProvider.translate('Call.Camera.Error'),\n          tabId,\n        });\n      });\n  } else {\n    checkMicrophonePermission(global, actions, tabId);\n  }\n}\n\nfunction checkMicrophonePermission<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  navigator.mediaDevices.getUserMedia({ audio: true })\n    .then((stream) => {\n      if (stream.getAudioTracks().length === 0) {\n        actions.showNotification({\n          message: langProvider.translate('RequestAcces.Error.HaveNotAccess.Call'),\n          tabId,\n        });\n      }\n    })\n    .catch(() => {\n      actions.showNotification({\n        message: langProvider.translate('RequestAcces.Error.HaveNotAccess.Call'),\n        tabId,\n      });\n    });\n}\n","import type { GroupCallParticipant } from '../../lib/secret-sauce';\nimport type { GlobalState } from '../types';\nimport type { ApiGroupCall } from '../../api/types';\nimport { selectGroupCall } from '../selectors/calls';\nimport { omit } from '../../util/iteratees';\nimport { updateChat } from './chats';\nimport { selectChat } from '../selectors';\n\nexport function updateGroupCall<T extends GlobalState>(\n  global: T,\n  groupCallId: string,\n  groupCallUpdate: Partial<ApiGroupCall>,\n  addToParticipantCount?: number,\n  resetParticipantCount?: number,\n): T {\n  const unfiltered = Object.values({\n    ...global.groupCalls.byId[groupCallId]?.participants,\n    ...groupCallUpdate.participants,\n  });\n  const filtered = unfiltered.filter(({ isLeft }) => !isLeft);\n  const participants = filtered.reduce((acc: Record<string, GroupCallParticipant>, el) => {\n    acc[el.id] = el;\n    return acc;\n  }, {});\n\n  return {\n    ...global,\n    groupCalls: {\n      ...global.groupCalls,\n      byId: {\n        ...global.groupCalls.byId,\n        [groupCallId]: {\n          ...global.groupCalls.byId[groupCallId],\n          ...omit(groupCallUpdate, ['participantsCount']),\n          ...(addToParticipantCount && {\n            participantsCount: global.groupCalls.byId[groupCallId].participantsCount + addToParticipantCount,\n          }),\n          ...(resetParticipantCount !== undefined && {\n            participantsCount: resetParticipantCount,\n          }),\n          participants,\n        },\n      },\n    },\n  };\n}\n\nexport function removeGroupCall<T extends GlobalState>(\n  global: T,\n  groupCallId: string,\n): T {\n  const groupCall = selectGroupCall(global, groupCallId);\n  if (groupCall && groupCall.chatId) {\n    const chat = selectChat(global, groupCall.chatId);\n    if (chat) {\n      global = updateChat(global, groupCall.chatId, {\n        fullInfo: {\n          ...chat.fullInfo,\n          groupCallId: undefined,\n        },\n      });\n    }\n  }\n\n  return {\n    ...global,\n    groupCalls: {\n      ...global.groupCalls,\n      byId: {\n        ...omit(global.groupCalls.byId, [groupCallId.toString()]),\n      },\n    },\n  };\n}\n\nexport function updateActiveGroupCall<T extends GlobalState>(\n  global: T,\n  groupCallUpdate: Partial<ApiGroupCall>,\n  resetParticipantCount?: number,\n): T {\n  if (!global.groupCalls.activeGroupCallId) {\n    return global;\n  }\n\n  return updateGroupCall(global,\n    global.groupCalls.activeGroupCallId,\n    groupCallUpdate,\n    undefined,\n    resetParticipantCount);\n}\n\nexport function updateGroupCallParticipant<T extends GlobalState>(\n  global: T,\n  groupCallId: string,\n  userId: string,\n  participantUpdate: Partial<GroupCallParticipant>,\n  noUpdateCount = false,\n): T {\n  const groupCall = selectGroupCall(global, groupCallId);\n  if (!groupCall) {\n    return global;\n  }\n\n  return updateGroupCall(global, groupCallId, {\n    participants: {\n      ...groupCall.participants,\n      [userId]: {\n        ...groupCall.participants[userId],\n        ...participantUpdate,\n      },\n    },\n  }, participantUpdate.isLeft\n    ? (noUpdateCount ? 0 : -1)\n    : (groupCall.participants[userId] || noUpdateCount ? 0 : 1));\n}\n","const BigInt = require('big-integer');\nconst crypto = require('./crypto/crypto');\n\n/**\n * converts a buffer to big int\n * @param buffer\n * @param little\n * @param signed\n * @returns {bigInt.BigInteger}\n */\nfunction readBigIntFromBuffer(buffer, little = true, signed = false) {\n    let randBuffer = Buffer.from(buffer);\n    const bytesNumber = randBuffer.length;\n    if (little) {\n        randBuffer = randBuffer.reverse();\n    }\n    let bigInt = BigInt(randBuffer.toString('hex'), 16);\n    if (signed && Math.floor(bigInt.toString('2').length / 8) >= bytesNumber) {\n        bigInt = bigInt.subtract(BigInt(2)\n            .pow(BigInt(bytesNumber * 8)));\n    }\n    return bigInt;\n}\n\n/**\n * Special case signed little ints\n * @param big\n * @param number\n * @returns {Buffer}\n */\nfunction toSignedLittleBuffer(big, number = 8) {\n    const bigNumber = BigInt(big);\n    const byteArray = [];\n    for (let i = 0; i < number; i++) {\n        byteArray[i] = bigNumber.shiftRight(8 * i)\n            .and(255);\n    }\n    return Buffer.from(byteArray);\n}\n\n/**\n * converts a big int to a buffer\n * @param bigInt {bigInt.BigInteger}\n * @param bytesNumber\n * @param little\n * @param signed\n * @returns {Buffer}\n */\nfunction readBufferFromBigInt(bigInt, bytesNumber, little = true, signed = false) {\n    bigInt = BigInt(bigInt);\n    const bitLength = bigInt.bitLength();\n\n    const bytes = Math.ceil(bitLength / 8);\n    if (bytesNumber < bytes) {\n        throw new Error('OverflowError: int too big to convert');\n    }\n    if (!signed && bigInt.lesser(BigInt(0))) {\n        throw new Error('Cannot convert to unsigned');\n    }\n    let below = false;\n    if (bigInt.lesser(BigInt(0))) {\n        below = true;\n        bigInt = bigInt.abs();\n    }\n\n    const hex = bigInt.toString('16')\n        .padStart(bytesNumber * 2, '0');\n    let l = Buffer.from(hex, 'hex');\n    if (little) {\n        l = l.reverse();\n    }\n\n    if (signed && below) {\n        if (little) {\n            let reminder = false;\n            if (l[0] !== 0) {\n                l[0] -= 1;\n            }\n            for (let i = 0; i < l.length; i++) {\n                if (l[i] === 0) {\n                    reminder = true;\n                    continue;\n                }\n                if (reminder) {\n                    l[i] -= 1;\n                    reminder = false;\n                }\n                l[i] = 255 - l[i];\n            }\n        } else {\n            l[l.length - 1] = 256 - l[l.length - 1];\n            for (let i = 0; i < l.length - 1; i++) {\n                l[i] = 255 - l[i];\n            }\n        }\n    }\n    return l;\n}\n\n/**\n * Generates a random long integer (8 bytes), which is optionally signed\n * @returns {BigInteger}\n */\nfunction generateRandomLong(signed = true) {\n    return readBigIntFromBuffer(generateRandomBytes(8), true, signed);\n}\n\n/**\n * .... really javascript\n * @param n {number}\n * @param m {number}\n * @returns {number}\n */\nfunction mod(n, m) {\n    return ((n % m) + m) % m;\n}\n\n/**\n * returns a positive bigInt\n * @param n {BigInt}\n * @param m {BigInt}\n * @returns {BigInt}\n */\nfunction bigIntMod(n, m) {\n    return ((n.remainder(m)).add(m)).remainder(m);\n}\n\n/**\n * Generates a random bytes array\n * @param count\n * @returns {Buffer}\n */\nfunction generateRandomBytes(count) {\n    return Buffer.from(crypto.randomBytes(count));\n}\n\n/**\n * Calculate the key based on Telegram guidelines, specifying whether it's the client or not\n * @param sharedKey\n * @param msgKey\n * @param client\n * @returns {{iv: Buffer, key: Buffer}}\n */\n\n/* CONTEST\nthis is mtproto 1 (mostly used for secret chats)\nasync function calcKey(sharedKey, msgKey, client) {\n    const x = client === true ? 0 : 8\n    const [sha1a, sha1b, sha1c, sha1d] = await Promise.all([\n        sha1(Buffer.concat([msgKey, sharedKey.slice(x, x + 32)])),\n        sha1(Buffer.concat([sharedKey.slice(x + 32, x + 48), msgKey, sharedKey.slice(x + 48, x + 64)])),\n        sha1(Buffer.concat([sharedKey.slice(x + 64, x + 96), msgKey])),\n        sha1(Buffer.concat([msgKey, sharedKey.slice(x + 96, x + 128)]))\n    ])\n    const key = Buffer.concat([sha1a.slice(0, 8), sha1b.slice(8, 20), sha1c.slice(4, 16)])\n    const iv = Buffer.concat([sha1a.slice(8, 20), sha1b.slice(0, 8), sha1c.slice(16, 20), sha1d.slice(0, 8)])\n    return {\n        key,\n        iv\n    }\n}\n\n */\n\n/**\n * Generates the key data corresponding to the given nonces\n * @param serverNonce\n * @param newNonce\n * @returns {{key: Buffer, iv: Buffer}}\n */\nasync function generateKeyDataFromNonce(serverNonce, newNonce) {\n    serverNonce = toSignedLittleBuffer(serverNonce, 16);\n    newNonce = toSignedLittleBuffer(newNonce, 32);\n    const [hash1, hash2, hash3] = await Promise.all([\n        sha1(Buffer.concat([newNonce, serverNonce])),\n        sha1(Buffer.concat([serverNonce, newNonce])),\n        sha1(Buffer.concat([newNonce, newNonce])),\n    ]);\n    const keyBuffer = Buffer.concat([hash1, hash2.slice(0, 12)]);\n    const ivBuffer = Buffer.concat([hash2.slice(12, 20), hash3, newNonce.slice(0, 4)]);\n    return {\n        key: keyBuffer,\n        iv: ivBuffer,\n    };\n}\n\nfunction convertToLittle(buf) {\n    const correct = Buffer.alloc(buf.length * 4);\n\n    for (let i = 0; i < buf.length; i++) {\n        correct.writeUInt32BE(buf[i], i * 4);\n    }\n    return correct;\n}\n\n/**\n * Calculates the SHA1 digest for the given data\n * @param data\n * @returns {Promise}\n */\nfunction sha1(data) {\n    const shaSum = crypto.createHash('sha1');\n    shaSum.update(data);\n    return shaSum.digest();\n}\n\n/**\n * Calculates the SHA256 digest for the given data\n * @param data\n * @returns {Promise}\n */\nfunction sha256(data) {\n    const shaSum = crypto.createHash('sha256');\n    shaSum.update(data);\n    return shaSum.digest();\n}\n\n/**\n * Fast mod pow for RSA calculation. a^b % n\n * @param a\n * @param b\n * @param n\n * @returns {bigInt.BigInteger}\n */\nfunction modExp(a, b, n) {\n    a = a.remainder(n);\n    let result = BigInt.one;\n    let x = a;\n    while (b.greater(BigInt.zero)) {\n        const leastSignificantBit = b.remainder(BigInt(2));\n        b = b.divide(BigInt(2));\n        if (leastSignificantBit.eq(BigInt.one)) {\n            result = result.multiply(x);\n            result = result.remainder(n);\n        }\n        x = x.multiply(x);\n        x = x.remainder(n);\n    }\n    return result;\n}\n\n/**\n * Gets the arbitrary-length byte array corresponding to the given integer\n * @param integer {any}\n * @param signed {boolean}\n * @returns {Buffer}\n */\nfunction getByteArray(integer, signed = false) {\n    const bits = integer.toString(2).length;\n    const byteLength = Math.floor((bits + 8 - 1) / 8);\n    return readBufferFromBigInt(BigInt(integer), byteLength, false, signed);\n}\n\n/**\n * returns a random int from min (inclusive) and max (inclusive)\n * @param min\n * @param max\n * @returns {number}\n */\nfunction getRandomInt(min, max) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n/**\n * Sleeps a specified amount of time\n * @param ms time in milliseconds\n * @returns {Promise}\n */\nconst sleep = (ms) => new Promise((resolve) => {\n    setTimeout(resolve, ms);\n});\n\n/**\n * Helper to export two buffers of same length\n * @returns {Buffer}\n */\n\nfunction bufferXor(a, b) {\n    const res = [];\n    for (let i = 0; i < a.length; i++) {\n        res.push(a[i] ^ b[i]);\n    }\n    return Buffer.from(res);\n}\n\n/**\n * Checks if the obj is an array\n * @param obj\n * @returns {boolean}\n */\n/*\nCONTEST\nwe do'nt support array requests anyway\nfunction isArrayLike(obj) {\n    if (!obj) return false\n    const l = obj.length\n    if (typeof l != 'number' || l < 0) return false\n    if (Math.floor(l) !== l) return false\n    // fast check\n    if (l > 0 && !(l - 1 in obj)) return false\n    // more complete check (optional)\n    for (let i = 0; i < l; ++i) {\n        if (!(i in obj)) return false\n    }\n    return true\n}\n*/\n\n// Taken from https://stackoverflow.com/questions/18638900/javascript-crc32/18639999#18639999\nfunction makeCRCTable() {\n    let c;\n    const crcTable = [];\n    for (let n = 0; n < 256; n++) {\n        c = n;\n        for (let k = 0; k < 8; k++) {\n            c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n        }\n        crcTable[n] = c;\n    }\n    return crcTable;\n}\n\nlet crcTable;\n\nfunction crc32(buf) {\n    if (!crcTable) {\n        crcTable = makeCRCTable();\n    }\n    if (!Buffer.isBuffer(buf)) {\n        buf = Buffer.from(buf);\n    }\n    let crc = -1;\n\n    for (let index = 0; index < buf.length; index++) {\n        const byte = buf[index];\n        crc = crcTable[(crc ^ byte) & 0xff] ^ (crc >>> 8);\n    }\n    return (crc ^ (-1)) >>> 0;\n}\n\nmodule.exports = {\n    readBigIntFromBuffer,\n    readBufferFromBigInt,\n    generateRandomLong,\n    mod,\n    crc32,\n    generateRandomBytes,\n    // calcKey,\n    generateKeyDataFromNonce,\n    sha1,\n    sha256,\n    bigIntMod,\n    modExp,\n    getRandomInt,\n    sleep,\n    getByteArray,\n    // isArrayLike,\n    toSignedLittleBuffer,\n    convertToLittle,\n    bufferXor,\n};\n","/**\n * Converts a Telegram's RPC Error to a Python error.\n * @param rpcError the RPCError instance\n * @param request the request that caused this error\n * @constructor the RPCError as a Python exception that represents this error\n */\nconst { RPCError } = require('./RPCBaseErrors');\nconst { rpcErrorRe } = require('./RPCErrorList');\n\nfunction RPCMessageToError(rpcError, request) {\n    for (const [msgRegex, Cls] of rpcErrorRe) {\n        const m = rpcError.errorMessage.match(msgRegex);\n        if (m) {\n            const capture = m.length === 2 ? parseInt(m[1], 10) : undefined;\n            return new Cls({\n                request,\n                capture,\n            });\n        }\n    }\n\n    return new RPCError(rpcError.errorMessage, request);\n}\n\nconst Common = require('./Common');\nconst RPCBaseErrors = require('./RPCBaseErrors');\nconst RPCErrorList = require('./RPCErrorList');\n\nmodule.exports = {\n    RPCMessageToError,\n    ...Common,\n    ...RPCBaseErrors,\n    ...RPCErrorList,\n};\n","const {\n    parseTl,\n    serializeBytes,\n    serializeDate,\n} = require('./generationHelpers');\nconst {\n    toSignedLittleBuffer,\n} = require('../Helpers');\n\nconst tlContent = require('./apiTl');\nconst schemeContent = require('./schemaTl');\n\n/* CONTEST\nconst NAMED_AUTO_CASTS = new Set([\n    'chatId,int'\n])\nconst NAMED_BLACKLIST = new Set([\n    'discardEncryption'\n])\nconst AUTO_CASTS = new Set([\n    'InputPeer',\n    'InputChannel',\n    'InputUser',\n    'InputDialogPeer',\n    'InputNotifyPeer',\n    'InputMedia',\n    'InputPhoto',\n    'InputMessage',\n    'InputDocument',\n    'InputChatPhoto'\n])\n\n */\n// eslint-disable-next-line no-restricted-globals\nconst CACHING_SUPPORTED = typeof self !== 'undefined' && self.localStorage !== undefined;\n\nconst CACHE_KEY = 'GramJs:apiCache';\n\nfunction buildApiFromTlSchema() {\n    let definitions;\n    const fromCache = CACHING_SUPPORTED && loadFromCache();\n\n    if (fromCache) {\n        definitions = fromCache;\n    } else {\n        definitions = loadFromTlSchemas();\n\n        if (CACHING_SUPPORTED) {\n            localStorage.setItem(CACHE_KEY, JSON.stringify(definitions));\n        }\n    }\n\n    return mergeWithNamespaces(\n        createClasses('constructor', definitions.constructors),\n        createClasses('request', definitions.requests),\n    );\n}\n\nfunction loadFromCache() {\n    const jsonCache = localStorage.getItem(CACHE_KEY);\n    return jsonCache && JSON.parse(jsonCache);\n}\n\nfunction loadFromTlSchemas() {\n    const [constructorParamsApi, functionParamsApi] = extractParams(tlContent);\n    const [constructorParamsSchema, functionParamsSchema] = extractParams(schemeContent);\n    const constructors = [].concat(constructorParamsApi, constructorParamsSchema);\n    const requests = [].concat(functionParamsApi, functionParamsSchema);\n\n    return {\n        constructors,\n        requests,\n    };\n}\n\nfunction mergeWithNamespaces(obj1, obj2) {\n    const result = { ...obj1 };\n\n    Object.keys(obj2)\n        .forEach((key) => {\n            if (typeof obj2[key] === 'function' || !result[key]) {\n                result[key] = obj2[key];\n            } else {\n                Object.assign(result[key], obj2[key]);\n            }\n        });\n\n    return result;\n}\n\nfunction extractParams(fileContent) {\n    const f = parseTl(fileContent);\n    const constructors = [];\n    const functions = [];\n    for (const d of f) {\n        if (d.isFunction) {\n            functions.push(d);\n        } else {\n            constructors.push(d);\n        }\n    }\n    return [constructors, functions];\n}\n\nfunction argToBytes(x, type) {\n    switch (type) {\n        case 'int': {\n            const i = Buffer.alloc(4);\n            i.writeInt32LE(x, 0);\n            return i;\n        }\n        case 'long':\n            return toSignedLittleBuffer(x, 8);\n        case 'int128':\n            return toSignedLittleBuffer(x, 16);\n        case 'int256':\n            return toSignedLittleBuffer(x, 32);\n        case 'double': {\n            const d = Buffer.alloc(8);\n            d.writeDoubleLE(x, 0);\n            return d;\n        }\n        case 'string':\n            return serializeBytes(x);\n        case 'Bool':\n            return x ? Buffer.from('b5757299', 'hex') : Buffer.from('379779bc', 'hex');\n        case 'true':\n            return Buffer.alloc(0);\n        case 'bytes':\n            return serializeBytes(x);\n        case 'date':\n            return serializeDate(x);\n        default:\n            return x.getBytes();\n    }\n}\n\n/*\nCONTEST\nasync function getInputFromResolve(utils, client, peer, peerType) {\n    switch (peerType) {\n        case 'InputPeer':\n            return utils.getInputPeer(await client.getInputEntity(peer))\n        case 'InputChannel':\n            return utils.getInputChannel(await client.getInputEntity(peer))\n        case 'InputUser':\n            return utils.getInputUser(await client.getInputEntity(peer))\n        case 'InputDialogPeer':\n            return await client._getInputDialog(peer)\n        case 'InputNotifyPeer':\n            return await client._getInputNotify(peer)\n        case 'InputMedia':\n            return utils.getInputMedia(peer)\n        case 'InputPhoto':\n            return utils.getInputPhoto(peer)\n        case 'InputMessage':\n            return utils.getInputMessage(peer)\n        case 'InputDocument':\n            return utils.getInputDocument(peer)\n        case 'InputChatPhoto':\n            return utils.getInputChatPhoto(peer)\n        case 'chatId,int' :\n            return await client.getPeerId(peer, false)\n        default:\n            throw new Error('unsupported peer type : ' + peerType)\n    }\n}\n*/\nfunction getArgFromReader(reader, arg) {\n    if (arg.isVector) {\n        if (arg.useVectorId) {\n            reader.readInt();\n        }\n        const temp = [];\n        const len = reader.readInt();\n        arg.isVector = false;\n        for (let i = 0; i < len; i++) {\n            temp.push(getArgFromReader(reader, arg));\n        }\n        arg.isVector = true;\n        return temp;\n    } else if (arg.flagIndicator) {\n        return reader.readInt();\n    } else {\n        switch (arg.type) {\n            case 'int':\n                return reader.readInt();\n            case 'long':\n                return reader.readLong();\n            case 'int128':\n                return reader.readLargeInt(128);\n            case 'int256':\n                return reader.readLargeInt(256);\n            case 'double':\n                return reader.readDouble();\n            case 'string':\n                return reader.tgReadString();\n            case 'Bool':\n                return reader.tgReadBool();\n            case 'true':\n                return true;\n            case 'bytes':\n                return reader.tgReadBytes();\n            case 'date':\n                return reader.tgReadDate();\n            default:\n                if (!arg.skipConstructorId) {\n                    return reader.tgReadObject();\n                } else {\n                    throw new Error(`Unknown type ${arg}`);\n                }\n        }\n    }\n}\n\nfunction createClasses(classesType, params) {\n    const classes = {};\n    for (const classParams of params) {\n        const {\n            name,\n            constructorId,\n            subclassOfId,\n            argsConfig,\n            namespace,\n            result,\n        } = classParams;\n        const fullName = [namespace, name].join('.')\n            .replace(/^\\./, '');\n\n        class VirtualClass {\n            static CONSTRUCTOR_ID = constructorId;\n\n            static SUBCLASS_OF_ID = subclassOfId;\n\n            static className = fullName;\n\n            static classType = classesType;\n\n            CONSTRUCTOR_ID = constructorId;\n\n            SUBCLASS_OF_ID = subclassOfId;\n\n            className = fullName;\n\n            classType = classesType;\n\n            constructor(args) {\n                args = args || {};\n                Object.keys(args)\n                    .forEach((argName) => {\n                        this[argName] = args[argName];\n                    });\n            }\n\n            static fromReader(reader) {\n                const args = {};\n\n                for (const argName in argsConfig) {\n                    if (argsConfig.hasOwnProperty(argName)) {\n                        const arg = argsConfig[argName];\n                        if (arg.isFlag) {\n                            const flagGroupSuffix = arg.flagGroup > 1 ? arg.flagGroup : '';\n                            const flagValue = args[`flags${flagGroupSuffix}`] & (1 << arg.flagIndex);\n                            if (arg.type === 'true') {\n                                args[argName] = Boolean(flagValue);\n                                continue;\n                            }\n\n                            args[argName] = flagValue ? getArgFromReader(reader, arg) : undefined;\n                        } else {\n                            args[argName] = getArgFromReader(reader, arg);\n                        }\n                    }\n                }\n                return new VirtualClass(args);\n            }\n\n            getBytes() {\n                // The next is pseudo-code:\n                const idForBytes = this.CONSTRUCTOR_ID;\n                const c = Buffer.alloc(4);\n                c.writeUInt32LE(idForBytes, 0);\n                const buffers = [c];\n                for (const arg in argsConfig) {\n                    if (argsConfig.hasOwnProperty(arg)) {\n                        if (argsConfig[arg].isFlag) {\n                            if ((this[arg] === false && argsConfig[arg].type === 'true')\n                                || this[arg] === undefined) {\n                                continue;\n                            }\n                        }\n                        if (argsConfig[arg].isVector) {\n                            if (argsConfig[arg].useVectorId) {\n                                buffers.push(Buffer.from('15c4b51c', 'hex'));\n                            }\n                            const l = Buffer.alloc(4);\n                            l.writeInt32LE(this[arg].length, 0);\n                            buffers.push(l, Buffer.concat(this[arg].map((x) => argToBytes(x, argsConfig[arg].type))));\n                        } else if (argsConfig[arg].flagIndicator) {\n                            if (!Object.values(argsConfig)\n                                .some((f) => f.isFlag)) {\n                                buffers.push(Buffer.alloc(4));\n                            } else {\n                                let flagCalculate = 0;\n                                for (const f in argsConfig) {\n                                    if (argsConfig[f].isFlag) {\n                                        if ((this[f] === false && argsConfig[f].type === 'true')\n                                            || this[f] === undefined) {\n                                            flagCalculate |= 0;\n                                        } else {\n                                            flagCalculate |= 1 << argsConfig[f].flagIndex;\n                                        }\n                                    }\n                                }\n                                const f = Buffer.alloc(4);\n                                f.writeUInt32LE(flagCalculate, 0);\n                                buffers.push(f);\n                            }\n                        } else {\n                            buffers.push(argToBytes(this[arg], argsConfig[arg].type));\n\n                            if (this[arg] && typeof this[arg].getBytes === 'function') {\n                                let boxed = (argsConfig[arg].type.charAt(argsConfig[arg].type.indexOf('.') + 1));\n                                boxed = boxed === boxed.toUpperCase();\n                                if (!boxed) {\n                                    buffers.shift();\n                                }\n                            }\n                        }\n                    }\n                }\n                return Buffer.concat(buffers);\n            }\n\n            readResult(reader) {\n                if (classesType !== 'request') {\n                    throw new Error('`readResult()` called for non-request instance');\n                }\n\n                const m = result.match(/Vector<(int|long)>/);\n                if (m) {\n                    reader.readInt();\n                    const temp = [];\n                    const len = reader.readInt();\n                    if (m[1] === 'int') {\n                        for (let i = 0; i < len; i++) {\n                            temp.push(reader.readInt());\n                        }\n                    } else {\n                        for (let i = 0; i < len; i++) {\n                            temp.push(reader.readLong());\n                        }\n                    }\n                    return temp;\n                } else {\n                    return reader.tgReadObject();\n                }\n            }\n\n            /* CONTEST\n            async resolve(client, utils) {\n\n                if (classesType !== 'request') {\n                    throw new Error('`resolve()` called for non-request instance')\n                }\n\n                for (const arg in argsConfig) {\n                    if (argsConfig.hasOwnProperty(arg)) {\n                        if (!AUTO_CASTS.has(argsConfig[arg].type)) {\n                            if (!NAMED_AUTO_CASTS.has(`${argsConfig[arg].name},${argsConfig[arg].type}`)) {\n                                continue\n                            }\n                        }\n                        if (argsConfig[arg].isFlag) {\n                            if (!this[arg]) {\n                                continue\n                            }\n                        }\n                        if (argsConfig[arg].isVector) {\n                            const temp = []\n                            for (const x of this[arg]) {\n                                temp.push(await getInputFromResolve(utils, client, x, argsConfig[arg].type))\n                            }\n                            this[arg] = temp\n                        } else {\n                            this[arg] = await getInputFromResolve(utils, client, this[arg], argsConfig[arg].type)\n                        }\n                    }\n                }\n            } */\n        }\n\n        if (namespace) {\n            if (!classes[namespace]) {\n                classes[namespace] = {};\n            }\n            classes[namespace][name] = VirtualClass;\n        } else {\n            classes[name] = VirtualClass;\n        }\n    }\n\n    return classes;\n}\n\nmodule.exports = buildApiFromTlSchema();\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n}\n"],"names":["IS_MULTITAB_SUPPORTED","self","channel","BroadcastChannel","DATA_BROADCAST_CHANNEL_NAME","undefined","batchedUpdates","throttledLocalDbUpdate","throttle","postMessage","type","convertToVirtualClass","value","Uint8Array","Buffer","from","Object","keys","length","BigInt","Array","isArray","map","VirtualClass","className","split","reduce","acc","field","constructors","valueOmited","instance","flags","CONSTRUCTOR_ID","SUBCLASS_OF_ID","classType","getBytes","rest","omitVirtualClassFields","key","initial","_initial","valueVirtualClass","acc2","key2","name","Proxy","get","target","prop","Reflect","set","push","getFileId","fill","Foreman","readBigIntFromBuffer","generateRandomBytes","toString","replace","MsgCommandChatLab","constructor","chatId","botInfo","_defineProperty","this","static","text","receiptMessageId","url","isQuiz","query","isSamePeer","userId","UserIdFirstBot","botId","data","msgId","t","title","message","selectChatMessage","getGlobal","prompt","content","getActions","createChat","promptInit","id","needCreate","global","chats","byId","isNotJoined","users","setGlobal","openChat","shouldReplaceHistory","prompts","require","tag","UserIdEnPrompt","MsgDispatcher","promptRows","msg0","setTimeout","async","reverse","i","desc","messageId","startsWith","UserIdCnPrompt","createChatGpt","UserIdChatGpt","createPromptChat","getInlineButtonsDemo","DEBUG","JSON","stringify","messages","byChatId","showModalFromEvent","testMsg","parse","isOutgoing","senderId","date","currentTs","e","showNotification","SERVICE_NOTIFICATIONS_USER_ID","runThrottledForLoadTopChats","cb","runDebouncedForLoadFullChat","debounce","addActionHandler","actions","preloadedChatIds","Set","TOP_CHAT_MESSAGES_PRELOAD_LIMIT","pause","currentChatIds","values","byTabId","tabId","selectCurrentMessageList","filter","Boolean","folderAllOrderedIds","getOrderedIds","ALL_FOLDER_ID","nextChatId","find","includes","has","add","loadViewportMessages","threadId","MAIN_THREAD_ID","getCurrentTabId","payload","currentUserId","chat","selectChat","hasUnreadMark","toggleChatUnread","isChatSummaryOnly","isMin","callApi","user","selectUser","requestThreadInfoUpdate","originChannelId","topMessageId","selectThreadTopMessageId","selectThreadOriginChat","TMP_CHAT_ID","result","openPreviousChat","addUsers","buildCollectionByKey","chatFullInfo","fullInfo","linkedChatId","focusMessage","selectSupportChat","listType","onReplace","shouldReplace","getOrderDate","lastMessage","joinDate","isFullyLoaded","console","error","listIds","oldestChat","selectIsChatPinned","sort","chat1","chat2","loadChats","force","loadFullChat","lastLocalMessage","selectLastServiceNotification","isMuted","updateChat","topicId","updateTopic","about","photo","memberIds","createdChannel","updateTabState","chatCreation","progress","ChatCreationProgress","openLimitReachedModal","limit","showDialog","hasErrorKey","channelId","accessHash","selectTabState","leaveChat","getAvatarPhoto","res","fetch","ab","arrayBuffer","body","DownloadRes","file","part","part_total","buf","size","err","ERR","pack","getPbData","blob","Blob","blob1","thumbUrl","resizeImage","thumbBlob","fetchBlob","dataUri","blobToDataUri","cacheApi","MEDIA_CACHE_NAME_WAI","thumbnail","width","height","userIds","userIdInt","parseInt","chatIdsDeleted","a","b","localStorage","getItem","init_system_content","DEFAULT_PROMPT","avatarHash","photos","DEFAULT_AVATARS","avatarUrl","isSelf","isPremium","firstName","usernames","bio","DEFAULT_CREATE_USER_BIO","aiBot","enableAi","chatGptConfig","api_key","max_history_length","modelConfig","ChatModelConfig","UserIdChatGpt4","model","commands","DEFAULT_BOT_COMMANDS","DEFAULT_CHATGPT_AI_COMMANDS","cmd","chatFolders","ChatMsg","activeChatFolderRow","activeChatFolder","window","sessionStorage","chatFolderById","forEach","row","orderedIds","activeFolderId","includedChatIds","userStatusesById","addChats","updateChatListIds","addUserStatuses","editChatFolder","folderUpdate","sendBotCommand","command","createdChat","folderId","selectCurrentLimit","folder","selectChatFolder","shouldBePinned","pinnedChatIds","newPinnedIds","pinnedId","newIncludedChatIds","selectChatListType","isPinned","ARCHIVED_FOLDER_ID","ids","orderedPinnedIds","isChatArchived","recommendedChatFolders","recommended","idsToRemove","idsToAdd","some","includedId","concat","emoticon","maxId","Math","max","recommendedId","description","newFolder","folderIds","setActiveChatFolder","unreadCount","lastTopicMessageId","topics","lastMessageId","updateThreadInfo","lastReadInboxMessageId","hash","phoneNumber","startAttach","attach","localUser","selectUserByPhoneNumber","updateUser","fetchChatByPhoneNumber","langProvider","openAttachMenuFromLink","openChatByPhoneNumber","openChatByInvite","openStickerSet","openChatWithDraft","joinVoiceChatByLink","openInvoice","processAttachBotParameters","openChatByUsername","openChatByUsernameAction","match","RE_TG_LINK","processDeepLink","uri","URL","toLowerCase","TME_WEB_DOMAINS","hostname","pathname","open","hostParts","part1","part2","part3","decodeURI","params","fromEntries","searchParams","hasOwnProperty","startattach","choose","parseChooseParameter","substr","stickerSetInfo","shortName","chatOrChannelPostId","Number","commentId","comment","formatShareText","username","inviteHash","voicechat","livestream","slug","substring","startParam","start","selectCurrentChat","c","channelPostId","currentChat","bot","getAttachBotOrNotify","callAttachBot","isCurrentChat","fetchChatByUsername","startBot","param","usernameChat","selectChatByUsername","threadInfo","selectThreadInfo","chatByUsername","discussionChatId","isEnabled","ensureIsSuperGroup","isPreHistoryHidden","bannedRights","chatAfterUpdate","members","kickedMembers","isBanned","viewMessages","isUnblocked","m","adminRights","customTitle","adminMembersById","isDismissed","newAdminMembersById","remove","updateManagementProgress","ManagementProgress","Promise","all","profilePhoto","loadProfilePhotos","profileId","photosToDelete","nextPhoto","groups","addedById","group","isForum","forDiscussionIds","fullChat","setItem","requestedDraft","isChatBasicGroup","offset","membersCount","addChatMembers","setNewChatMembersDialogState","newChatMembersProgress","NewChatMembersProgress","isProtected","enabledReactions","settings","isChatSuperGroup","isChatChannel","forumPanelChatId","attachMenu","bots","requestedAttachBotInstall","onConfirm","action","requestAttachBotInChat","listedTopicIds","topicsCount","offsetTopic","el","topic","accTopic","offsetTopicId","offsetDate","offsetId","TOPICS_SLICE","TOPICS_SLICE_SECOND_LOAD","addMessages","updateTopics","count","updateListedTopicIds","entries","draftsById","draft","replaceThreadParam","formattedText","replyingToId","readInboxMessageIdByTopicId","shouldCloseChatOnError","prevIsForum","prevIsEnabled","areParticipantsHidden","iconColor","iconEmojiId","createTopicPanel","isLoading","closeCreateTopicPanel","deleteTopic","editTopicPanel","closeEditTopicPanel","topicsPinnedLimit","appConfig","initChats","firstLoad","isFullDraftSync","lastLocalServiceMessage","LoadAllChats","threadsById","lastViewportIds","chatIds","shift","totalChatCount","chatFoldersById","tabStates","visibleChats","flatMap","visibleUsers","selectVisibleUsers","replaceUsers","replaceUserStatuses","replaceChats","updateChats","replaceChatListIds","newChats","notificationsChat","updateChatListSecondaryInfo","thread","selectThread","selectDraft","isLocal","replyingToById","groupCall","existingGroupCall","selectGroupCall","updateGroupCall","omit","participantsCount","stickerSet","loadStickers","localChat","isUserBot","newChat","migrateChat","silentSound","audioElement","audioContext","sounds","initializeSoundsForSafari","initializeSounds","sound","prevSrc","src","muted","volume","play","then","currentTime","requestAnimationFrame","joinAudio","Audio","connectingAudio","loop","leaveAudio","allowTalkAudio","busyAudio","connectAudio","endAudio","incomingAudio","ringingAudio","join","allowTalk","leave","connecting","incoming","end","connect","busy","ringing","fetchGroupCall","call","isLoaded","fetchGroupCallParticipants","nextOffset","isCallPanelVisible","subscribed","peer","requestMasterAndJoinGroupCall","selectActiveGroupCall","hasPublicUsername","getMainUsername","inviteLink","canSelfUnmute","copyTextToClipboard","full","requestMasterAndCallAction","ARE_CALLS_SUPPORTED","phoneCall","toggleGroupCallPanel","ctx","AudioContext","webkitAudioContext","srcObject","silence","safePlay","createAudioElement","checkNavigatorUserMediaPermissions","groupCalls","activeGroupCallId","selectChatGroupCall","leaveGroupCall","rejoin","isVideo","state","participantId","adminId","oscillator","createOscillator","dst","createMediaStreamDestination","MediaStream","assign","stream","getAudioTracks","enabled","getGroupCallAudioElement","getGroupCallAudioContext","removeGroupCallAudioElement","navigator","mediaDevices","getUserMedia","video","getVideoTracks","checkMicrophonePermission","catch","audio","groupCallId","groupCallUpdate","addToParticipantCount","resetParticipantCount","participants","isLeft","removeGroupCall","updateActiveGroupCall","updateGroupCallParticipant","participantUpdate","noUpdateCount","crypto","buffer","little","signed","randBuffer","bytesNumber","bigInt","floor","subtract","pow","toSignedLittleBuffer","big","number","bigNumber","byteArray","shiftRight","and","readBufferFromBigInt","bitLength","ceil","Error","lesser","below","abs","hex","padStart","l","reminder","randomBytes","sha1","shaSum","createHash","update","digest","crcTable","module","exports","generateRandomLong","mod","n","crc32","k","makeCRCTable","isBuffer","crc","index","byte","generateKeyDataFromNonce","serverNonce","newNonce","hash1","hash2","hash3","slice","iv","sha256","bigIntMod","remainder","modExp","one","x","greater","zero","leastSignificantBit","divide","eq","multiply","getRandomInt","min","random","sleep","ms","resolve","getByteArray","integer","bits","byteLength","convertToLittle","correct","alloc","writeUInt32BE","bufferXor","RPCError","rpcErrorRe","Common","RPCBaseErrors","RPCErrorList","RPCMessageToError","rpcError","request","msgRegex","Cls","errorMessage","capture","parseTl","serializeBytes","serializeDate","tlContent","schemeContent","CACHING_SUPPORTED","CACHE_KEY","extractParams","fileContent","f","functions","d","isFunction","argToBytes","writeInt32LE","writeDoubleLE","getArgFromReader","reader","arg","isVector","useVectorId","readInt","temp","len","flagIndicator","readLong","readLargeInt","readDouble","tgReadString","tgReadBool","tgReadBytes","tgReadDate","skipConstructorId","tgReadObject","createClasses","classesType","classes","classParams","constructorId","subclassOfId","argsConfig","namespace","fullName","args","argName","isFlag","flagValue","flagGroup","flagIndex","idForBytes","writeUInt32LE","buffers","flagCalculate","boxed","charAt","indexOf","toUpperCase","readResult","definitions","fromCache","jsonCache","loadFromCache","constructorParamsApi","functionParamsApi","constructorParamsSchema","functionParamsSchema","requests","loadFromTlSchemas","obj1","obj2","mergeWithNamespaces","buildApiFromTlSchema","Deferred","promise","reject"],"sourceRoot":""}