(()=>{"use strict";let e;try{e=localStorage.getItem("adr"),e||(e="0")}catch(t){e="0"}location.href.startsWith("https://");const t=!1,n=!1,s=!1,a="tt-media-progressive",i=524288,o="tt-assets",r=("undefined"!=typeof window&&window.innerHeight,Math.round(425),new Set(["newMessage","newScheduledMessage","deleteMessages","deleteScheduledMessages","deleteHistory"]),new Set(["image/png","image/jpeg","image/gif"])),c=new Set(["video/mp4"]);new Set(["audio/mp3","audio/ogg","audio/wav","audio/mpeg","audio/flac","audio/aac","audio/m4a","audio/mp4","audio/x-m4a"]),new Set([...r,...c]),new Set(["t.me","web.t.me","k.t.me","z.t.me"]),new Set(["AU","BD","CA","CO","EG","HN","IE","IN","JO","MX","MY","NI","NZ","PH","PK","SA","SV","US"]);const l=e=>new Promise((t=>{setTimeout((()=>t()),e)})),u=524288,d=2097151,f=6e4,p=new Map;async function h(e,t){const n=t.url.includes("/download/")?(await self.clients.matchAll()).find((e=>"window"===e.type&&"top-level"===e.frameType)):await self.clients.get(e.clientId);if(!n)return;const s=function(e,t=!1){let n;do{n=String(Math.random()).replace("0.","id")}while(e[n]);return t&&(e[n]=!0),n}(p),a={};let i=!1;const o=Promise.race([l(f).then((()=>i?void 0:Promise.reject(new Error("ERROR_PART_TIMEOUT")))),new Promise(((e,t)=>{Object.assign(a,{resolve:e,reject:t})}))]);return p.set(s,a),o.catch((()=>{})).finally((()=>{p.delete(s),i=!0})),n.postMessage({type:"requestPart",messageId:s,params:t}),o}self.addEventListener("message",(e=>{const{type:t,messageId:n,result:s}=e.data;if("partResponse"===t){const e=p.get(n);e&&e.resolve(s)}}));const m=1048576;class g{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t="queue"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.queue=[]}push(e){this.queue.push(e)}async pop(){return await this.queue.shift()}get size(){return this.queue.length}}const w=3e3;async function y(e){const t=await v((async()=>{const t=await self.caches.open(o),n=await t.match(e.request);return{cache:t,cached:n}}),w),{cache:n,cached:s}=t||{};if(n&&s){if(s.ok)return s;await n.delete(e.request)}const a=await fetch(e.request);return a.ok&&n&&n.put(e.request,a.clone()),a}async function v(e,t){let n=!1;try{return await Promise.race([l(t).then((()=>n?void 0:Promise.reject(new Error("TIMEOUT")))),e()])}catch(e){return void console.error(e)}finally{n=!0}}var S=function(e){return e.True="1",e.False="0",e}(S||{});let b=(new Date).valueOf();const R=new Set,I={};function P(e){return e.custom.from_id?e.custom.from_id:e.custom.chat_id||e.custom.channel_id?`-${e.custom.chat_id||e.custom.channel_id}`:void 0}function E(e){if(e.custom.msg_id)return parseInt(e.custom.msg_id,10)}async function T(){const e=new URL(self.registration.scope).origin;return(await self.clients.matchAll({type:"window"})).filter((t=>new URL(t.url).origin===e))}async function q(e){const t=(await T())[0];t&&t.postMessage({type:"playNotificationSound",payload:{id:e}})}function M({chatId:e,messageId:t,body:n,title:s,icon:a,reaction:i,isSilent:o,shouldReplaceHistory:r}){const c=(new Date).valueOf()-b<1e3,l={body:n,data:{chatId:e,messageId:t,reaction:i,count:1,shouldReplaceHistory:r},icon:a||"icon-192x192.png",badge:"icon-192x192.png",tag:String(c?0:e||0),vibrate:[200,100,200]};return Promise.all([i||o?void 0:q(String(t)||e||""),self.registration.showNotification(s,l)])}async function C(e,n){if(n.chatId&&(e.postMessage({type:"focusMessage",payload:n}),!e.focused))try{await e.focus()}catch(e){t&&console.warn("[SW] ",e)}}function $(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}self.addEventListener("sync",(()=>{b=Date.now()}));class j{constructor(){$(this,"promise",void 0),$(this,"reject",void 0),$(this,"resolve",void 0),this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}const W=new j;W.resolve();const U=new Map;const L=/\.(wasm|html)$/,N=/[\da-f]{20}.*\.(js|css|woff2?|svg|png|jpg|jpeg|tgs|json|wasm)$/;self.addEventListener("install",(e=>{t&&console.log("ServiceWorker installed"),e.waitUntil(self.skipWaiting())})),self.addEventListener("activate",(e=>{t&&console.log("ServiceWorker activated"),e.waitUntil(Promise.race([l(3e3),Promise.all([self.caches.delete(o),self.clients.claim()])]))})),self.addEventListener("fetch",(e=>{const{url:n}=e.request;if(n.includes("/progressive/"))return e.respondWith(async function(e){const{url:n}=e.request,o=e.request.headers.get("range"),r=/^bytes=(\d+)-(\d+)?$/g.exec(o||""),c=Number(r[1]),l=Number(r[2]);let f=l;if((!f||f-c+1>u)&&(f=c+u-1),0===c&&1===f){const t=e.request.url.match(/fileSize=(\d+)&mimeType=([\w/]+)/),n=t&&Number(t[1]),s=t?.[2];if(n&&s)return new Response(new Uint8Array(2).buffer,{status:206,statusText:"Partial Content",headers:[["Content-Range",`bytes 0-1/${n}`],["Accept-Ranges","bytes"],["Content-Length","2"],["Content-Type",s]]})}const p=`${n}?start=${c}&end=${f}`,[m,g]=s?[]:await async function(e){const t=await self.caches.open(a);return Promise.all([t.match(`${e}&type=arrayBuffer`).then((e=>e?e.arrayBuffer():void 0)),t.match(`${e}&type=headers`).then((e=>e?e.json():void 0))])}(p);if(t&&console.log(`FETCH PROGRESSIVE ${p} (request: ${c}-${l}) CACHED: ${Boolean(m)}`),m)return new Response(m,{status:206,statusText:"Partial Content",headers:g});let w;try{w=await h(e,{url:n,start:c,end:f})}catch(e){t&&console.error("FETCH PROGRESSIVE",e)}if(!w)return new Response("",{status:500,statusText:"Failed to fetch progressive part"});const{arrayBuffer:y,fullSize:v,mimeType:S}=w,b=Math.min(f-c+1,y.byteLength);f=c+b-1;const R=y.slice(0,b),I=[["Content-Range",`bytes ${c}-${f}/${v}`],["Accept-Ranges","bytes"],["Content-Length",String(b)],["Content-Type",S]];return!s&&b<=i&&f<d&&async function(e,t,n){const s=await self.caches.open(a);Promise.all([s.put(new Request(`${e}&type=arrayBuffer`),new Response(t)),s.put(new Request(`${e}&type=headers`),new Response(JSON.stringify(n)))])}(p,R,I),new Response(R,{status:206,statusText:"Partial Content",headers:I})}(e)),!0;if(n.includes("/download/"))return e.respondWith(async function(e){const{url:n}=e.request;let s;try{s=await h(e,{url:n,start:0,end:65536})}catch(e){t&&console.error("FETCH DOWNLOAD",e)}if(!s)return new Response("",{status:500,statusText:"Failed to fetch file to download"});const a=e.request.url.match(/filename=(.*)/),i=a?`filename="${decodeURIComponent(a[1])}"`:"",{fullSize:o,mimeType:r}=s,c=[["Content-Length",String(o)],["Content-Type",r],["Content-Disposition",`attachment; ${i}`]],l=new g,u=t=>(l.push(h(e,{url:n,start:t,end:t+m-1}).then((e=>e?.arrayBuffer))),t+m);let d=0;const f=new ReadableStream({start(){for(let e=0;e<8&&!(d>=o);e++)d=u(d)},async pull(e){const t=await l.pop();t?(e.enqueue(new Uint8Array(t)),t.byteLength<m?e.close():d<o&&(d=u(d))):e.close()}});return new Response(f,{status:200,statusText:"OK",headers:c})}(e)),!0;if(n.includes("/share/")&&e.respondWith(async function(e){if("POST"===e.request.method)try{!async function(e,t){const n=await self.clients.get(t);n&&(await function(e){const t=U.get(e);if(t)return t.promise;const n=new j;return U.set(e,n),n.promise}(t),n.postMessage({type:"share",payload:e}))}(function(e){const t=e.getAll("files");return{title:e.get("title"),text:e.get("text"),url:e.get("url"),files:t}}(await e.request.formData()),e.resultingClientId)}catch(e){console.warn("[SHARE] Failed to parse input data",e)}return Response.redirect(".")}(e)),n.startsWith("http")){if("/"===new URL(n).pathname||n.match(L))return e.respondWith(async function(e){const t=await v((()=>fetch(e.request)),w);if(!t?.ok)return y(e);const n=t.clone();return self.caches.open(o).then((t=>t?.put(e.request,n))),t}(e)),!0;if(n.match(N))return e.respondWith(y(e)),!0}return!1})),self.addEventListener("push",(function(e){t&&(console.log("[SW] Push received event",e),e.data&&console.log("[SW] Push received with data",e.data.json()));const n=function(e){try{return e.data.json()}catch(n){return void(t&&console.log("[SW] Unable to parse push notification data",e.data))}}(e);if(!n||n.mute===S.True)return;const s=function(e){let t=e.title||"Wai";const n=e.custom?.silent===S.True;return n&&(t+=" ðŸ”•"),{chatId:P(e),messageId:E(e),body:e.description,isSilent:n,title:t}}(n);R.has(s.messageId)?R.delete(s.messageId):e.waitUntil(M(s))})),self.addEventListener("notificationclick",(function(e){const n=self.registration.scope;e.notification.close();const{data:s}=e.notification;e.waitUntil((async()=>{const e=await T();if(await Promise.all(e.map((e=>(I[e.id]=s,C(e,s))))),self.clients.openWindow&&!(e.length>0)){I[0]=s;try{const e=await self.clients.openWindow(n);e&&(I[e.id]=s)}catch(e){t&&console.warn("[SW] ",e)}}})())})),self.addEventListener("message",(e=>{(function(e){if(n&&console.log("[SW] New message from client",e),!e.data)return;const t=e.source;if("clientReady"===e.data.type){const n=I[t.id]||I[0];n&&(delete I[t.id],delete I[0],e.waitUntil(C(t,n)))}if("showMessageNotification"===e.data.type){const t=e.data.payload;e.waitUntil((async()=>(t.chatId&&(await self.registration.getNotifications({tag:t.chatId})).forEach((e=>e.close())),R.add(t.messageId),M(t)))())}"closeMessageNotifications"===e.data.type&&e.waitUntil(async function({chatId:e,lastReadInboxMessageId:t}){const n=await self.registration.getNotifications(),s=t||Number.MAX_VALUE;n.forEach((t=>{("0"===t.tag||t.data.chatId===e&&t.data.messageId<=s)&&t.close()}))}(e.data.payload))})(e),function(e){const{source:t,data:n}=e;if(t&&"clientReady"===n.type){const{id:e}=t,n=U.get(e);n?n.resolve():U.set(e,W)}}(e)}))})();
//# sourceMappingURL=1367.86ec38c2602c9b4d4097.js.map