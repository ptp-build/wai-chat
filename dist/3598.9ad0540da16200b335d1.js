(()=>{var e,t,n={81900:(e,t,n)=>{"use strict";function s(e,t=!1,n="image/jpeg"){return`${t?"":`data:${n};base64,`}${btoa(String.fromCharCode(...e))}`}function i(e){const{flags:t,CONSTRUCTOR_ID:n,SUBCLASS_OF_ID:s,className:i,classType:o,getBytes:a,...r}=e;return r}n.d(t,{P:()=>s,f:()=>i})},15023:(e,t,n)=>{"use strict";n.d(t,{PP:()=>w,ZP:()=>y,Zf:()=>b,pN:()=>v});var s=n(24736),i=n.n(s),o=n(81900),a=n(83716),r=n(57404),c=n(69118),d=n(48764).Buffer;const u="BroadcastChannel"in self,l=u?new BroadcastChannel(a.tuy):void 0;let f=[];const p=(0,c.P2)((()=>{l.postMessage({type:"localDbUpdate",batchedUpdates:f}),f=[]}),100);function h(e){if(e instanceof Uint8Array)return d.from(e);if("object"==typeof e&&1===Object.keys(e).length&&"value"===Object.keys(e)[0])return i()(e.value);if(Array.isArray(e))return e.map(h);if("object"!=typeof e||!("CONSTRUCTOR_ID"in e))return e;const t=e.className.split(".").reduce(((e,t)=>e[t]),r.constructors),n=(0,o.f)(e);return new t(Object.keys(n).reduce(((e,t)=>(e[t]=h(n[t]),e)),{}))}function g(e){return["localMessages","chats","users","messages","documents","stickerSets","photos","webDocuments","cache","botWaitReply"].reduce(((t,n)=>{var s;const i=null!==(s=e?.[n])&&void 0!==s?s:{},o=Object.keys(i).reduce(((e,t)=>(e[t]=h(i[t]),e)),{});var a;return t[n]=u?(a=n,new Proxy(o,{get:(e,t,n)=>Reflect.get(e,t,n),set:(e,t,n)=>(f.push({name:a,prop:t,value:n}),p(),Reflect.set(e,t,n))})):o,t}),{})}const m=g(),y=m;function w(){l&&l.postMessage({type:"localDbUpdateFull",localDb:Object.keys(m).reduce(((e,t)=>(e[t]={...m[t]},e)),{})})}function b(e){Object.assign(m,g(e))}function v(){Object.assign(m,g())}},10792:(e,t,n)=>{"use strict";var s={};n.r(s),n.d(s,{acceptBotUrlAuth:()=>_r,acceptCall:()=>Zr,acceptLinkUrlAuth:()=>Rr,acceptPhoneCall:()=>xd,addChatMembers:()=>Gi,answerCallbackButton:()=>fr,blockContact:()=>Rc,broadcastLocalDbUpdateFull:()=>a.PP,changeSessionSettings:()=>fc,changeSessionTtl:()=>pc,checkChatUsername:()=>Ga,checkPassword:()=>ar,checkUsername:()=>bc,clearDraft:()=>ci,clearPassword:()=>rr,clearRecentStickers:()=>Ia,closePoll:()=>ko,confirmCall:()=>Jr,confirmPhoneCall:()=>Bd,createChannel:()=>li,createGroupCall:()=>jr,createGroupChat:()=>yi,createPhoneCallState:()=>Td,createTopic:()=>Yi,decodePhoneCallData:()=>Ud,deleteChannel:()=>mi,deleteChat:()=>hi,deleteChatFolder:()=>Ci,deleteChatMember:()=>Li,deleteChatUser:()=>pi,deleteContact:()=>da,deleteExportedChatInvite:()=>Va,deleteHistory:()=>vo,deleteMessages:()=>wo,deleteProfilePhotos:()=>Cc,deleteRevokedExportedChatInvites:()=>Za,deleteScheduledMessages:()=>bo,deleteTopic:()=>to,destroy:()=>$s,destroyPhoneCallState:()=>kd,discardCall:()=>Kr,discardGroupCall:()=>Ur,disconnect:()=>Ks,downloadMedia:()=>Ws,editChatFolder:()=>Si,editChatPhoto:()=>wi,editExportedChatInvite:()=>za,editGroupCallParticipant:()=>Br,editGroupCallTitle:()=>xr,editMessage:()=>po,editTopic:()=>so,encodePhoneCallData:()=>Ed,exportChatInvite:()=>Wa,exportGroupCallInvite:()=>Nr,faveSticker:()=>va,fetchAnimatedEmojiEffects:()=>_a,fetchAnimatedEmojis:()=>Pa,fetchAppConfig:()=>Jc,fetchAuthorizations:()=>Tc,fetchBlockedContacts:()=>Mc,fetchChannelStatistics:()=>hd,fetchChat:()=>oi,fetchChatFolders:()=>Ai,fetchChatInviteImporters:()=>Ja,fetchChatSettings:()=>si,fetchChats:()=>ti,fetchCommonChats:()=>na,fetchConfig:()=>Qc,fetchContactList:()=>oa,fetchContentSettings:()=>Vc,fetchCountryList:()=>Xc,fetchCurrentUser:()=>Js,fetchCustomEmoji:()=>Ca,fetchCustomEmojiSets:()=>ha,fetchDefaultStatusEmojis:()=>Ta,fetchDefaultTopicIcons:()=>Da,fetchEmojiKeywords:()=>qa,fetchExportedChatInvites:()=>Ka,fetchExtendedMedia:()=>Uo,fetchFavoriteStickers:()=>ya,fetchFeaturedEmojiStickers:()=>ba,fetchFeaturedStickers:()=>wa,fetchFullChat:()=>ni,fetchFullUser:()=>ta,fetchGenericEmojiEffects:()=>Ma,fetchGlobalPrivacySettings:()=>ed,fetchGroupCallParticipants:()=>Or,fetchGroupStatistics:()=>gd,fetchGroupsForDiscussion:()=>qi,fetchInlineBot:()=>hr,fetchInlineBotResults:()=>gr,fetchLangPack:()=>Fc,fetchLangStrings:()=>Gc,fetchLanguages:()=>jc,fetchMembers:()=>Oi,fetchMessage:()=>co,fetchMessagePublicForwards:()=>yd,fetchMessageReactions:()=>cd,fetchMessageReactionsList:()=>dd,fetchMessageStatistics:()=>md,fetchMessageViews:()=>Po,fetchMessages:()=>ro,fetchNearestCountry:()=>sa,fetchNotificationExceptions:()=>Nc,fetchNotificationSettings:()=>Oc,fetchPinnedMessages:()=>Ho,fetchPremiumGifts:()=>Ra,fetchPremiumPromo:()=>cc,fetchPrivacySettings:()=>Lc,fetchProfilePhotos:()=>ua,fetchRecentEmojiStatuses:()=>Ha,fetchRecentStickers:()=>ma,fetchRecommendedChatFolders:()=>Ii,fetchSavedGifs:()=>Ea,fetchScheduledHistory:()=>No,fetchSeenBy:()=>jo,fetchSendAs:()=>Fo,fetchSponsoredMessages:()=>Lo,fetchStatisticsAsyncGraph:()=>wd,fetchStickerSets:()=>ga,fetchStickers:()=>Sa,fetchStickersForEmoji:()=>Oa,fetchTemporaryPaymentPassword:()=>dc,fetchTopInlineBots:()=>pr,fetchTopUsers:()=>ia,fetchTopicById:()=>eo,fetchTopics:()=>Xi,fetchUnreadMentions:()=>Wo,fetchUnreadReactions:()=>Vo,fetchUsers:()=>aa,fetchWallpapers:()=>Pc,fetchWebAuthorizations:()=>Uc,fetchWebPagePreview:()=>Do,findFirstMessageIdAfterDate:()=>xo,forwardMessages:()=>Bo,getAvailableReactions:()=>ad,getChatByPhoneNumber:()=>Mi,getChatByUsername:()=>Ri,getDhConfig:()=>$r,getGroupCall:()=>Er,getPasswordInfo:()=>ir,getPaymentForm:()=>ac,getReceipt:()=>rc,hideAllChatJoinRequests:()=>Ya,hideChatJoinRequest:()=>Qa,hideChatReportPanel:()=>Xa,importChatInvite:()=>Wi,importContact:()=>ra,installStickerSet:()=>Ba,joinChannel:()=>fi,joinGroupCall:()=>Hr,joinGroupCallPresentation:()=>Fr,leaveChannel:()=>gi,leaveGroupCall:()=>qr,leaveGroupCallPresentation:()=>Lr,loadAttachBot:()=>Sr,loadAttachBots:()=>Ir,loadPollOptionResults:()=>Eo,markMessageListRead:()=>So,markMessagesRead:()=>Co,migrateChat:()=>ji,openChatByInvite:()=>Fi,pinMessage:()=>mo,prolongWebView:()=>vr,provideAuthCode:()=>yn,provideAuthPassword:()=>wn,provideAuthPhoneNumber:()=>mn,provideAuthRegistration:()=>bn,provideRecoveryEmailCode:()=>ur,readAllMentions:()=>Ko,readAllReactions:()=>zo,receivedCall:()=>Vr,registerDevice:()=>$c,removeRecentSticker:()=>Aa,reorderUsernames:()=>sd,repairFileReference:()=>Qs,reportMessages:()=>Ao,reportPeer:()=>uc,reportProfilePhoto:()=>lc,reportSpam:()=>la,requestBotUrlAuth:()=>Pr,requestCall:()=>zr,requestChatUpdate:()=>ai,requestLinkUrlAuth:()=>Mr,requestPhoneCall:()=>Nd,requestSimpleWebView:()=>br,requestThreadInfoUpdate:()=>_o,requestWebView:()=>wr,rescheduleMessage:()=>ho,restartAuth:()=>vn,restartAuthWithQr:()=>An,saveDefaultSendAs:()=>Go,saveDraft:()=>ri,saveGif:()=>Ua,searchChats:()=>ii,searchGifs:()=>Na,searchMessagesGlobal:()=>Ro,searchMessagesLocal:()=>Mo,searchStickers:()=>ka,sendEmojiInteraction:()=>od,sendInlineBotResult:()=>mr,sendMessage:()=>lo,sendMessageAction:()=>Io,sendPaymentForm:()=>oc,sendPollVote:()=>To,sendReaction:()=>rd,sendScheduledMessages:()=>Oo,sendSignalingData:()=>Qr,sendWatchingEmojiInteraction:()=>id,sendWebViewData:()=>Ar,sendWithCallback:()=>Ys,setCallRating:()=>Wr,setChatEnabledReactions:()=>Vi,setChatUsername:()=>La,setDefaultReaction:()=>ud,setDiscussionGroup:()=>Hi,setPrivacySettings:()=>zc,sortChatFolders:()=>Pi,startBot:()=>yr,terminateAllAuthorizations:()=>Ec,terminateAllWebAuthorizations:()=>xc,terminateAuthorization:()=>kc,terminateWebAuthorization:()=>Bc,toggleAttachBot:()=>Cr,toggleChatArchived:()=>vi,toggleChatPinned:()=>bi,toggleDialogUnread:()=>_i,toggleForum:()=>Qi,toggleGroupCallStartSubscription:()=>Gr,toggleIsProtected:()=>Zi,toggleJoinRequest:()=>Ki,toggleJoinToSend:()=>$i,toggleParticipantsHidden:()=>Ji,togglePinnedTopic:()=>no,togglePreHistoryHidden:()=>Ti,toggleSignatures:()=>Ni,toggleUsername:()=>nd,transcribeAudio:()=>Zo,translateText:()=>Jo,unblockContact:()=>Dc,uninstallStickerSet:()=>xa,unpinAllMessages:()=>yo,unregisterDevice:()=>Kc,updateChatAbout:()=>xi,updateChatAdmin:()=>Ui,updateChatDefaultBannedRights:()=>ki,updateChatMemberBannedRights:()=>Ei,updateChatMutedState:()=>di,updateChatTitle:()=>Bi,updateContact:()=>ca,updateContactSignUpNotification:()=>qc,updateContentSettings:()=>Zc,updateEmojiStatus:()=>fa,updateGlobalPrivacySettings:()=>td,updateIsOnline:()=>Wc,updateNotificationSettings:()=>Hc,updatePassword:()=>cr,updatePrivateLink:()=>$a,updateProfile:()=>wc,updateProfilePhoto:()=>Ac,updateRecoveryEmail:()=>dr,updateTopicMutedState:()=>ui,updateUsername:()=>vc,uploadContactProfilePhoto:()=>Sc,uploadProfilePhoto:()=>Ic,uploadWallpaper:()=>_c,validateRequestedInfo:()=>ic,viewSponsoredMessage:()=>$o});var i=n(83716),o=n(69118),a=n(15023),r=n(13522);function c(e,t){return e.reduce(((e,n)=>(e[n[t]]=n,e)),{})}function d(e,t){return t.reduce(((t,n)=>(t[n]=e[n],t)),{})}function u(e){return e.filter(Boolean)}let l=0;function f(){return l}function p(){return Math.floor(Date.now()/1e3)+l}let h=function(e){return e.Bold="MessageEntityBold",e.Typing="MessageEntityTyping",e.Blockquote="MessageEntityBlockquote",e.BotCommand="MessageEntityBotCommand",e.Cashtag="MessageEntityCashtag",e.Code="MessageEntityCode",e.Email="MessageEntityEmail",e.Hashtag="MessageEntityHashtag",e.Italic="MessageEntityItalic",e.MentionName="MessageEntityMentionName",e.Mention="MessageEntityMention",e.Phone="MessageEntityPhone",e.Pre="MessageEntityPre",e.Strike="MessageEntityStrike",e.TextUrl="MessageEntityTextUrl",e.Url="MessageEntityUrl",e.Underline="MessageEntityUnderline",e.Spoiler="MessageEntitySpoiler",e.CustomEmoji="MessageEntityCustomEmoji",e.Unknown="MessageEntityUnknown",e}({});const g=-1,m="MESSAGE_DELETED";let y=function(e){return e[e.BlobUrl=0]="BlobUrl",e[e.Progressive=1]="Progressive",e[e.Stream=2]="Stream",e[e.DownloadUrl=3]="DownloadUrl",e[e.Text=4]="Text",e}({});var w=n(48960),b=n(81900);const v='<?xml version="1.0" encoding="utf-8"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 {{width}} {{height}}" xml:space="preserve"><path fill-opacity="0.1" d="{{path}}" /></svg>',A="AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,";function I(e,t,n){return v.replace("{{path}}",function(e){let t="M";const n=e.length;for(let s=0;s<n;s++){const n=e[s];n>=192?t+=A[n-128-64]:(n>=128?t+=",":n>=64&&(t+="-"),t+=String(63&n))}return t+="z",t}(e)).replace("{{width}}",String(t)).replace("{{height}}",String(n))}const S={w:100,h:100};function C(e,t){if(!e||!e.length)return;const n=e.find((e=>e instanceof r.Api.PhotoStrippedSize));if(!n)return;const s=e.filter((e=>e instanceof r.Api.PhotoSize)),{w:i,h:o}=s.length?s[s.length-1]:S,{bytes:a}=n;return{dataUri:(0,b.P)(t&&"image/jpeg"!==t?a:(0,w.strippedPhotoToJpg)(a),void 0,t),width:i,height:o}}function P(e,t){const n=e.sizes.filter((e=>e instanceof r.Api.PhotoSize||e instanceof r.Api.PhotoSizeProgressive)).map(M);return{id:String(e.id),thumbnail:C(e.sizes),sizes:n,isSpoiler:t,...e.videoSizes&&{videoSizes:u(e.videoSizes.map(_)),isVideo:!0}}}function _(e){if(!(e instanceof r.Api.VideoSize))return;const{videoStartTs:t,size:n,h:s,w:i,type:o}=e;return{videoStartTs:t,size:n,height:s,width:i,type:o}}function M(e){const{w:t,h:n,type:s}=e;return{width:t,height:n,type:s}}function R(e){if(!(e.usernames||"username"in e&&e.username))return;const t=[];return"username"in e&&e.username&&t.push({username:e.username,isActive:!0,isEditable:!0}),e.usernames&&e.usernames.forEach((({username:e,active:n,editable:s})=>{t.push({username:e,...n&&{isActive:!0},...s&&{isEditable:!0}})})),t}const D="application/x-tgsticker",T="video/webm";function k(e,t){var n;if(e instanceof r.Api.DocumentEmpty)return;const{mimeType:s,videoThumbs:i}=e,o=e.attributes.find((e=>e instanceof r.Api.DocumentAttributeSticker)),a=e.attributes.find((e=>e instanceof r.Api.DocumentAttributeCustomEmoji)),c=(s===D||s===T)&&e.attributes.find((e=>e instanceof r.Api.DocumentAttributeFilename));if(!o&&!a&&!c)return;const d=s===D,l=s===T,f=Boolean(a),p=f&&a.textColor,h=e.attributes.find((e=>e instanceof r.Api.DocumentAttributeImageSize)),g=e.attributes.find((e=>e instanceof r.Api.DocumentAttributeVideo)),m=h||g,y=o||a,w=(C=y?.stickerset,C instanceof r.Api.InputStickerSetID?{id:String(C.id),accessHash:String(C.accessHash)}:C instanceof r.Api.InputStickerSetShortName?{shortName:C.shortName}:{isMissing:!0}),v=y?.alt,A=Boolean(null===(n=a?.free)||void 0===n||n),S=e.thumbs&&e.thumbs.find((e=>e instanceof r.Api.PhotoCachedSize));var C;if(!(s!==T||self.isWebmSupported||S||e.thumbs&&e.thumbs.find((e=>e instanceof r.Api.PhotoSize))))return;const P=e.thumbs&&e.thumbs.find((e=>e instanceof r.Api.PhotoPathSize)),_=S?function(e){const{w:t,h:n,bytes:s}=e;return{dataUri:(0,b.P)(s,void 0,"image/webp"),width:t,height:n}}(S):P&&m?function(e,t){const{w:n,h:s}=t;return{dataUri:`data:image/svg+xml;utf8,${I(e.bytes,n,s)}`,width:n,height:s}}(P,m):void 0,{w:M,h:R}=S||m||{},k=!t&&i&&u(i?.filter((e=>e instanceof r.Api.VideoSize))).some((({type:e})=>"f"===e));return{id:String(e.id),stickerSetInfo:w,emoji:v,isCustomEmoji:f,isLottie:d,isVideo:l,width:M,height:R,thumbnail:_,hasEffect:k,isFree:A,shouldUseTextColor:p}}function E(e){const{archived:t,animated:n,installedDate:s,videos:i,id:o,accessHash:a,title:r,thumbs:c,count:d,shortName:u,emojis:l,thumbDocumentId:f}=e;return{isArchived:t,isLottie:n,isVideos:i,isEmoji:l,installedDate:s,id:String(o),accessHash:String(a),title:r,hasThumbnail:Boolean(c?.length||f),count:d,shortName:u}}function U(e){const t=E(e.set);if(e instanceof r.Api.StickerSetNoCovered)return t;const n=x(e instanceof r.Api.StickerSetCovered?[e.cover]:e instanceof r.Api.StickerSetMultiCovered?e.covers:e.documents);return e instanceof r.Api.StickerSetFullCovered?{...t,stickers:n,packs:B(e.packs)}:{...t,covers:n}}function B(e){return e.reduce(((e,{emoticon:t,documents:n})=>(e[t]=n.map((e=>k(a.ZP.documents[String(e)]))).filter(Boolean),e)),{})}function x(e){return e.map((e=>{if(e instanceof r.Api.Document){const t=k(e);if(t)return a.ZP.documents[String(e.id)]=e,t}})).filter(Boolean)}function N(e,t){let n=0;const s=new Array(t),i=e.length/t,o=e[0],a=e[e.length-1];for(let u=0;u<t;u++){var r,c,d;const t=Math.floor(u*i),l=((null!==(r=e[t-1])&&void 0!==r?r:o)+(null!==(c=e[t])&&void 0!==c?c:o)+(null!==(d=e[t+1])&&void 0!==d?d:a))/3;s[u]=l,n<l&&(n=l)}return{data:s,peak:n}}var O=n(24736),q=n.n(O),H=n(89618),j=n.n(H);function F(e){return e.hasOwnProperty("userId")}function G(e){return e.hasOwnProperty("chatId")}function L(e,t){return"user"===t?String(e):`-${e}`}function $(e){return F(e)?L(e.userId,"user"):G(e)?L(e.chatId,"chat"):L(e.channelId,"channel")}var K=n(48764).Buffer;const z="#111111DD",W="#E4D00A",V={INVOKE:"#49DBF5",RESPONSE:"#6887F7",CONNECTING:"#E4D00A",CONNECTED:"#26D907","CONNECTING ERROR":"#D1191C","INVOKE ERROR":"#D1191C",UPDATE:"#0DD151","UNEXPECTED UPDATE":"#9C9C9C","UNEXPECTED RESPONSE":"#D1191C"};function Z(e){if(e instanceof r.Api.Message||e instanceof r.Api.MessageService)return $(e.peerId)}function J(e){const t=`${Z(e)}-${e.id}`;let n=e;e instanceof r.Api.Message&&e.media instanceof r.Api.MessageMediaInvoice&&e.media.extendedMedia instanceof r.Api.MessageExtendedMedia&&(n=new r.Api.Message({...e,media:e.media.extendedMedia.media})),a.ZP.messages[t]=n,n instanceof r.Api.Message&&(n.media instanceof r.Api.MessageMediaDocument&&n.media.document instanceof r.Api.Document&&(a.ZP.documents[String(n.media.document.id)]=n.media.document),n.media instanceof r.Api.MessageMediaWebPage&&n.media.webpage instanceof r.Api.WebPage&&n.media.webpage.document instanceof r.Api.Document&&(a.ZP.documents[String(n.media.webpage.document.id)]=n.media.webpage.document),n.media instanceof r.Api.MessageMediaGame&&(n.media.game.document instanceof r.Api.Document&&(a.ZP.documents[String(n.media.game.document.id)]=n.media.game.document),Q(n.media.game.photo)),n.media instanceof r.Api.MessageMediaInvoice&&n.media.photo&&(a.ZP.webDocuments[String(n.media.photo.url)]=n.media.photo)),n instanceof r.Api.MessageService&&"photo"in n.action&&Q(n.action.photo)}function Q(e){e instanceof r.Api.Photo&&(a.ZP.photos[String(e.id)]=e)}function Y(e,t=!1){const n=L(e.id,"user");!t&&a.ZP.users[n]||(a.ZP.users[n]=e)}function X(e){e.forEach((e=>{e instanceof r.Api.User&&e.photo?Y(e):(e instanceof r.Api.Chat||e instanceof r.Api.Channel)&&e.photo&&function(e,t=!1){const n=L(e.id,e instanceof r.Api.Chat?"chat":"channel");t&&a.ZP.chats[n]||(a.ZP.chats[n]=e)}(e)}))}function ee(e){return String.fromCharCode(...e)}function te(e){return K.from(e,"binary")}function ne(e,...t){("UNEXPECTED RESPONSE"===e?console.error:"INVOKE ERROR"===e||"UNEXPECTED UPDATE"===e?console.warn:console.log)(`%cGramJS%c${e}`,`color: ${W}; background: ${z}; padding: 0.25rem; border-radius: 0.25rem;`,`color: ${V[e]}; background: ${z}; padding: 0.25rem; border-radius: 0.25rem; margin-left: 0.25rem;`,...t)}const se=11;function ie(e){return"number"==typeof e?function(e){return e>0?"user":e<=-1e9?"channel":"chat"}(e):e.startsWith("-")?e.length>=se?"channel":"chat":"user"}function oe(e){const t=ie(e);return"user"===t?new r.Api.PeerUser({userId:Ce(e,"user")}):"channel"===t?new r.Api.PeerChannel({channelId:Ce(e,"channel")}):new r.Api.PeerChat({chatId:Ce(e,"chat")})}function ae(e,t){const n=ie(e);return"user"===n?new r.Api.InputPeerUser({userId:Ce(e,"user"),accessHash:q()(t)}):"channel"===n?new r.Api.InputPeerChannel({channelId:Ce(e,"channel"),accessHash:q()(t)}):new r.Api.InputPeerChat({chatId:Ce(e,"chat")})}function re(e,t){const n=ie(e);return"user"===n?new r.Api.InputUser({userId:Ce(e,"user"),accessHash:q()(t)}):"channel"===n?new r.Api.InputChannel({channelId:Ce(e,"channel"),accessHash:q()(t)}):Ce(e,"chat")}function ce(e,t){return new r.Api.InputStickerSetID({id:q()(e),accessHash:q()(t)})}function de(e){const t=a.ZP.documents[e.id];if(t)return new r.Api.InputDocument(d(t,["id","accessHash","fileReference"]))}function ue(e){const t=de(e);if(t)return new r.Api.InputMediaDocument({id:t})}function le(e,t=!1){return new r.Api.InputMediaPoll({poll:new r.Api.Poll({id:q()(e.id),publicVoters:e.summary.isPublic,question:e.summary.question,answers:e.summary.answers.map((({text:e,option:t})=>new r.Api.PollAnswer({text:e,option:te(t)}))),quiz:e.summary.quiz,multipleChoice:e.summary.multipleChoice,closeDate:e.summary.closeDate,closePeriod:e.summary.closePeriod,closed:!!t||e.summary.closed}),correctAnswers:e.results.results?.filter((e=>e.isCorrect)).map((e=>te(e.option))),solution:e.results.solution,solutionEntities:e.results.solutionEntities?.map(ge)})}function fe(){return(0,H.readBigIntFromBuffer)((0,H.generateRandomBytes)(8),!0,!0)}function pe(){return(0,H.readBigIntFromBuffer)((0,H.generateRandomBytes)(4),!0,!0).toJSNumber()}function he(e,t,n){return new r.Api.Message({id:e,peerId:oe(t),fromId:oe(t),media:n.media})}function ge(e){const{type:t,offset:n,length:s}=e,i="userId"in e?a.ZP.users[e.userId]:void 0;switch(t){case h.Bold:return new r.Api.MessageEntityBold({offset:n,length:s});case h.Italic:return new r.Api.MessageEntityItalic({offset:n,length:s});case h.Underline:return new r.Api.MessageEntityUnderline({offset:n,length:s});case h.Strike:return new r.Api.MessageEntityStrike({offset:n,length:s});case h.Code:return new r.Api.MessageEntityCode({offset:n,length:s});case h.Pre:return new r.Api.MessageEntityPre({offset:n,length:s,language:e.language||""});case h.Blockquote:return new r.Api.MessageEntityBlockquote({offset:n,length:s});case h.TextUrl:return new r.Api.MessageEntityTextUrl({offset:n,length:s,url:e.url});case h.Url:return new r.Api.MessageEntityUrl({offset:n,length:s});case h.Hashtag:return new r.Api.MessageEntityHashtag({offset:n,length:s});case h.MentionName:return new r.Api.InputMessageEntityMentionName({offset:n,length:s,userId:new r.Api.InputUser({userId:q()(i.id),accessHash:i.accessHash})});case h.Spoiler:return new r.Api.MessageEntitySpoiler({offset:n,length:s});case h.CustomEmoji:return new r.Api.MessageEntityCustomEmoji({offset:n,length:s,documentId:q()(e.documentId)});default:return new r.Api.MessageEntityUnknown({offset:n,length:s})}}function me(e){const{media:t}=e;return!!t&&(t instanceof r.Api.MessageMediaPhoto||t instanceof r.Api.MessageMediaDocument||t instanceof r.Api.MessageMediaWebPage&&t.webpage instanceof r.Api.WebPage&&(t.webpage.photo instanceof r.Api.Photo||t.webpage.document instanceof r.Api.Document&&t.webpage.document.mimeType.startsWith("video"))||t instanceof r.Api.MessageMediaGame&&(t.game.document instanceof r.Api.Document||t.game.photo instanceof r.Api.Photo)||t instanceof r.Api.MessageMediaInvoice&&(t.photo||t.extendedMedia))}function ye(e){const t=a.ZP.photos[e?.id];if(t)return new r.Api.InputPhoto(d(t,["id","accessHash","fileReference"]))}function we({phone:e,firstName:t,lastName:n}){return new r.Api.InputPhoneContact({clientId:q()(1),phone:e,firstName:t,lastName:n})}function be(e,t=0){return new r.Api.ChatBannedRights({...e,untilDate:t})}function ve(e){return new r.Api.ChatAdminRights(e)}function Ae(e){const{shippingAddress:t}=e;return new r.Api.PaymentRequestedInfo({...e,shippingAddress:t?new r.Api.PostAddress(t):void 0})}function Ie(e){switch(e){case"phoneNumber":return new r.Api.InputPrivacyKeyPhoneNumber;case"lastSeen":return new r.Api.InputPrivacyKeyStatusTimestamp;case"profilePhoto":return new r.Api.InputPrivacyKeyProfilePhoto;case"forwards":return new r.Api.InputPrivacyKeyForwards;case"chatInvite":return new r.Api.InputPrivacyKeyChatInvite;case"phoneCall":return new r.Api.InputPrivacyKeyPhoneCall;case"phoneP2P":return new r.Api.InputPrivacyKeyPhoneP2P;case"voiceMessages":return new r.Api.InputPrivacyKeyVoiceMessages}}function Se(e){switch(e){case"spam":return new r.Api.InputReportReasonSpam;case"violence":return new r.Api.InputReportReasonViolence;case"childAbuse":return new r.Api.InputReportReasonChildAbuse;case"pornography":return new r.Api.InputReportReasonPornography;case"copyright":return new r.Api.InputReportReasonCopyright;case"fake":return new r.Api.InputReportReasonFake;case"geoIrrelevant":return new r.Api.InputReportReasonGeoIrrelevant;case"illegalDrugs":return new r.Api.InputReportReasonIllegalDrugs;case"personalDetails":return new r.Api.InputReportReasonPersonalDetails;case"other":return new r.Api.InputReportReasonOther}}function Ce(e,t){return"number"==typeof e?q()(Math.abs(e)):"user"===t?q()(e):q()(e.slice(1))}function Pe(e){return new r.Api.InputGroupCall({id:q()(e.id),accessHash:q()(e.accessHash)})}function _e({id:e,accessHash:t}){return new r.Api.InputPhoneCall({id:q()(e),accessHash:q()(t)})}function Me(e){return"slug"in e?new r.Api.InputInvoiceSlug({slug:e.slug}):new r.Api.InputInvoiceMessage({peer:ae(e.chat.id,e.chat.accessHash),msgId:e.messageId})}function Re(e){return e&&"emoticon"in e?new r.Api.ReactionEmoji({emoticon:e.emoticon}):e&&"documentId"in e?new r.Api.ReactionCustomEmoji({documentId:q()(e.documentId)}):new r.Api.ReactionEmpty}function De(e,t){return e.id===i.MW8?new r.Api.EmojiStatusEmpty:t?new r.Api.EmojiStatusUntil({documentId:q()(e.id),until:t}):new r.Api.EmojiStatus({documentId:q()(e.id)})}function Te(e){const{self:t,min:n,about:s,date:i,versioned:o,canSelfUnmute:a,justJoined:r,left:c,muted:d,mutedByYou:u,source:l,volume:f,volumeByAdmin:p,videoJoined:h,peer:g,video:m,presentation:y,raiseHandRating:w}=e;return{isSelf:t,isMin:n,canSelfUnmute:a,isLeft:c,isMuted:d,isMutedByMe:u,hasJustJoined:r,isVolumeByAdmin:p,isVersioned:o,isVideoJoined:h,about:s,source:l,raiseHandRating:w?.toString(),volume:f,date:new Date(i),isUser:F(g),id:$(g),video:m?ke(m):void 0,presentation:y?ke(y):void 0}}function ke(e){const{audioSource:t,endpoint:n,paused:s,sourceGroups:i}=e;return{audioSource:t,endpoint:n,isPaused:s,sourceGroups:i.map(Ee)}}function Ee(e){return{semantics:e.semantics,sources:e.sources}}function Ue(e){const{id:t,accessHash:n}=e;if(e instanceof r.Api.GroupCallDiscarded)return{connectionState:"discarded",id:t.toString(),accessHash:n.toString(),participantsCount:0,version:0,participants:{}};const{version:s,participantsCount:i,streamDcId:o,scheduleDate:a,canChangeJoinMuted:c,joinMuted:d,canStartVideo:u,scheduleStartSubscribed:l}=e;return{connectionState:"disconnected",isLoaded:!0,id:t.toString(),accessHash:n.toString(),version:s,participantsCount:i,streamDcId:o,scheduleDate:a,canChangeJoinMuted:c,joinMuted:d,canStartVideo:u,scheduleStartSubscribed:l,participants:{}}}function Be(e){const{id:t}=e;let n={id:t.toString()};if(e instanceof r.Api.PhoneCallAccepted||e instanceof r.Api.PhoneCallWaiting||e instanceof r.Api.PhoneCall||e instanceof r.Api.PhoneCallRequested){const{accessHash:t,adminId:s,date:i,video:o,participantId:a,protocol:r}=e;n={...n,accessHash:t.toString(),adminId:s.toString(),participantId:a.toString(),date:i,isVideo:o,protocol:Oe(r)}}if(e instanceof r.Api.PhoneCall){const{p2pAllowed:t,gAOrB:s,keyFingerprint:i,connections:o,startDate:a}=e;n={...n,state:"active",gAOrB:Array.from(s),keyFingerprint:i.toString(),startDate:a,p2pAllowed:t,connections:o.map(Ne).filter(Boolean)}}return e instanceof r.Api.PhoneCallDiscarded&&(n={...n,state:"discarded",duration:e.duration,reason:xe(e.reason),needRating:e.needRating,needDebug:e.needDebug}),e instanceof r.Api.PhoneCallWaiting&&(n={...n,state:"waiting",receiveDate:e.receiveDate}),e instanceof r.Api.PhoneCallAccepted&&(n={...n,state:"accepted",gB:Array.from(e.gB)}),e instanceof r.Api.PhoneCallRequested&&(n={...n,state:"requested",gAHash:Array.from(e.gAHash)}),n}function xe(e){return e instanceof r.Api.PhoneCallDiscardReasonMissed?"missed":e instanceof r.Api.PhoneCallDiscardReasonBusy?"busy":e instanceof r.Api.PhoneCallDiscardReasonHangup?"hangup":"disconnect"}function Ne(e){if(e instanceof r.Api.PhoneConnectionWebrtc){const{username:t,password:n,turn:s,stun:i,ip:o,ipv6:a,port:r}=e;return{username:t,password:n,isTurn:s,isStun:i,ip:o,ipv6:a,port:r}}}function Oe(e){const{libraryVersions:t,minLayer:n,maxLayer:s,udpP2p:i,udpReflector:o}=e;return{libraryVersions:t,minLayer:n,maxLayer:s,isUdpP2p:i,isUdpReflector:o}}function qe(){return new r.Api.PhoneCallProtocol({libraryVersions:["4.0.0"],minLayer:92,maxLayer:92,udpReflector:!0,udpP2p:!0})}String.fromCharCode(8205);const He=/(?:\ud83c[\udd70\udd71\udd7e\udd7f]\ufe0f)|(?:\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffc-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb\udffd-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb-\udffd\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffc-\udfff]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb\udffd-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb-\udffd\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c[\udffc-\udfff]|\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c[\udffb\udffd-\udfff]|\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c[\udffb-\udffd\udfff]|\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c[\udffb-\udffe]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d\udc8f\ud83c[\udffb-\udfff]|\ud83d\udc91\ud83c[\udffb-\udfff]|\ud83e\udd1d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d\udc8f\udc91]|\ud83e\udd1d)|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf7c\udf84\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc70\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd4\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83d\ude36\u200d\ud83c\udf2b\ufe0f|\u2764\ufe0f\u200d\ud83d\udd25|\u2764\ufe0f\u200d\ud83e\ude79|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc3b\u200d\u2744\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83d\ude2e\u200d\ud83d\udca8|\ud83d\ude35\u200d\ud83d\udcab|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f|\ud83d\udc08\u200d\u2b1b)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0c\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\udd77\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd\udec3-\udec5\udef0-\udef6]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udc8e\udc90\udc92-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5-\uded7\udedd-\udedf\udeeb\udeec\udef4-\udefc\udfe0-\udfeb\udff0]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd76\udd78-\uddb4\uddb7\uddba\uddbc-\uddcc\uddd0\uddde-\uddff\ude70-\ude74\ude78-\ude7c\ude80-\ude86\ude90-\udeac\udeb0-\udeba\udec0-\udec2\uded0-\uded9\udee0-\udee7]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,je=new RegExp(`^(?:${He.source})+$`,""),Fe=e=>{const t=e.split("\n"),n=t.join("");if(n.length>800)return!1;if(!Boolean(n.match(je)))return!1;const s=t.map((e=>{let t=0;for(;He.exec(e);)if(t++,t>100)return He.lastIndex=0,-1;return t}));let i=t.length;for(let e=0;e<s.length;e++){if(-1===s[e])return!1;s[e]>i&&(i=s[e])}return i};function Ge(e,t){if(e.text)return!t&&1===Object.keys(e).length&&!e.text.entities?.some((e=>e.type!==h.CustomEmoji))&&Fe(e.text.text)||void 0}const Le=1676e9,$e=100,Ke=1e6,ze="temp",We=63;let Ve,Ze=i.MPN;function Je(){const e=Math.round((Date.now()-Le)/$e);return i.MPN+e+ ++Ze/Ke}function Qe(e){const{fromId:t,message:n,entities:s,startParam:o,channelPost:a,chatInvite:c,chatInviteHash:d,randomId:u,recommended:l}=e,f=t?$(t):void 0,p=c?c instanceof r.Api.ChatInvite?c.title:c.chat instanceof r.Api.ChatEmpty?void 0:c.chat.title:void 0;return{randomId:ee(u),isBot:!!t&&F(t),text:rt(n,s),expiresAt:Math.round(Date.now()/1e3)+i.ZOc,isRecommended:Boolean(l),...f&&{chatId:f},...d&&{chatInviteHash:d},...c&&{chatInviteTitle:p},...o&&{startParam:o},...a&&{channelPostId:a}}}function Ye(e){const t=Z(e);if(t&&(e instanceof r.Api.Message||e instanceof r.Api.MessageService))return Xe(t,e)}function Xe(e,t){const n=t.fromId?$(t.fromId):void 0,s=t.peerId?$(t.peerId):void 0,i=!n&&e===Ve,o=t.out&&!t.post||i&&!t.fwdFrom,a=at(t),c=t.action&&function(e,t,n,s,i){if(e instanceof r.Api.MessageActionEmpty)return;let o,a,c,d,u;const l=[];let f,p,h,g,m,y="other";const w="users"in e?e.users&&e.users.map((e=>L(e,"user"))):"userId"in e&&[L(e.userId,"user")]||[];let b;if(e instanceof r.Api.MessageActionChatCreate)u="Notification.CreatedChatWithTitle",l.push("%action_origin%",e.title),y="chatCreate";else if(e instanceof r.Api.MessageActionChatEditTitle)s?(u="Channel.MessageTitleUpdated",l.push(e.title)):(u="Notification.ChangedGroupName",l.push("%action_origin%",e.title));else if(e instanceof r.Api.MessageActionChatEditPhoto)s?u="Channel.MessagePhotoUpdated":(u="Notification.ChangedGroupPhoto",l.push("%action_origin%"));else if(e instanceof r.Api.MessageActionChatDeletePhoto)u=s?"Channel.MessagePhotoRemoved":"Group.MessagePhotoRemoved";else if(e instanceof r.Api.MessageActionChatAddUser)!t||w.includes(t)?(u="Notification.JoinedChat",l.push("%target_user%")):(u="Notification.Invited",l.push("%action_origin%","%target_user%"));else if(e instanceof r.Api.MessageActionChatDeleteUser)!t||w.includes(t)?(u="Notification.LeftChat",l.push("%target_user%")):(u="Notification.Kicked",l.push("%action_origin%","%target_user%"));else if(e instanceof r.Api.MessageActionChatJoinedByLink)u="Notification.JoinedGroupByLink",l.push("%action_origin%");else if(e instanceof r.Api.MessageActionChannelCreate)u="Notification.CreatedChannel";else if(e instanceof r.Api.MessageActionChatMigrateTo)b=$(e),u="Migrated to %target_chat%",l.push("%target_chat%");else if(e instanceof r.Api.MessageActionChannelMigrateFrom)b=$(e),u="Migrated from %target_chat%",l.push("%target_chat%");else if(e instanceof r.Api.MessageActionPinMessage)u="Chat.Service.Group.UpdatedPinnedMessage1",l.push("%action_origin%","%message%");else if(e instanceof r.Api.MessageActionHistoryClear)u="HistoryCleared",y="historyClear";else if(e instanceof r.Api.MessageActionPhoneCall){const t=Boolean(e.duration);if(u=[t?"ChatList.Service":"Chat",e.video?"VideoCall":"Call",i?t?"outgoing":"Outgoing":t?"incoming":"Incoming"].join("."),t){const t=Math.max(Math.round(e.duration/60),1);l.push(`${t} min${t>1?"s":""}`)}o={isOutgoing:i,isVideo:e.video,duration:e.duration,reason:xe(e.reason)}}else if(e instanceof r.Api.MessageActionInviteToGroupCall)u="Notification.VoiceChatInvitation",a={id:e.call.id.toString(),accessHash:e.call.accessHash.toString()},l.push("%action_origin%","%target_user%");else if(e instanceof r.Api.MessageActionContactSignUp)u="Notification.Joined",l.push("%action_origin%"),y="contactSignUp";else if(e instanceof r.Api.MessageActionPaymentSent)c=Number(e.totalAmount),d=e.currency,u="PaymentSuccessfullyPaid",n&&w.push(n),l.push("%payment_amount%","%target_user%","%product%");else if(e instanceof r.Api.MessageActionGroupCall)if(e.duration){const t=Math.max(Math.round(e.duration/60),1);u="Notification.VoiceChatEnded",l.push(`${t} min${t>1?"s":""}`)}else u="Notification.VoiceChatStartedChannel",a={id:e.call.id.toString(),accessHash:e.call.accessHash.toString()};else if(e instanceof r.Api.MessageActionBotAllowed)u="Chat.Service.BotPermissionAllowed",l.push(e.domain);else if(e instanceof r.Api.MessageActionCustomAction)u=e.message;else if(e instanceof r.Api.MessageActionChatJoinedByRequest)u="ChatService.UserJoinedGroupByRequest",l.push("%action_origin%");else if(e instanceof r.Api.MessageActionGameScore)u=t===Ve?"ActionYouScoredInGame":"ActionUserScoredInGame",l.push("%score%"),p=e.score;else if(e instanceof r.Api.MessageActionWebViewDataSent)u="Notification.WebAppSentData",l.push(e.text);else if(e instanceof r.Api.MessageActionGiftPremium)u=i?"ActionGiftOutbound":"ActionGiftInbound",i?l.push("%gift_payment_amount%"):l.push("%action_origin%","%gift_payment_amount%"),n&&w.push(n),d=e.currency,c=e.amount.toJSNumber(),h=e.months;else if(e instanceof r.Api.MessageActionTopicCreate)u="TopicWasCreatedAction",y="topicCreate",l.push(e.title);else if(e instanceof r.Api.MessageActionTopicEdit)void 0!==e.closed?(u=e.closed?"TopicWasClosedAction":"TopicWasReopenedAction",l.push("%action_origin%","%action_topic%")):void 0!==e.hidden?u=e.hidden?"TopicHidden2":"TopicShown":e.title?(u="TopicRenamedTo",l.push("%action_origin%",e.title)):e.iconEmojiId?(u="TopicWasIconChangedToAction",l.push("%action_origin%","%action_topic_icon%"),g=e.iconEmojiId.toString()):u="ChatList.UnsupportedMessage",m=!0;else if(e instanceof r.Api.MessageActionAttachMenuBotAllowed)u="ActionAttachMenuBotAllowed";else if(e instanceof r.Api.MessageActionSuggestProfilePhoto){const s=e.photo instanceof r.Api.Photo&&e.photo.videoSizes?.length;u=t===Ve?s?"ActionSuggestVideoFromYouDescription":"ActionSuggestPhotoFromYouDescription":s?"ActionSuggestVideoToYouDescription":"ActionSuggestPhotoToYouDescription",y="suggestProfilePhoto",l.push("%target_user%"),n&&w.push(n)}else u="ChatList.UnsupportedMessage";return"photo"in e&&e.photo instanceof r.Api.Photo&&(Q(e.photo),f=P(e.photo)),{text:u,type:y,targetUserIds:w,targetChatId:b,photo:f,amount:c,currency:d,translationValues:l,call:a,phoneCall:o,score:p,months:h,topicEmojiIconId:g,isTopicAction:m}}(t.action,n,s,Boolean(t.post),o);c&&(a.action=c);const d=t.media instanceof r.Api.MessageMediaInvoice&&Boolean(t.media.extendedMedia),{replyToMsgId:u,replyToTopId:l,forumTopic:f,replyToPeerId:p}=t.replyTo||{},h=t.editDate&&!t.editHide,{inlineButtons:g,keyboardButtons:m,keyboardPlaceholder:y,isKeyboardSingleUse:w,isKeyboardSelective:b}=function(e,t){const{replyMarkup:n,media:s}=e;if(!n)return s instanceof r.Api.MessageMediaWebPage&&s.webpage instanceof r.Api.WebPage&&"telegram_message"===s.webpage.type?{inlineButtons:[[{type:"url",text:"Show Message",url:s.webpage.url}]]}:void 0;if(!(n instanceof r.Api.ReplyKeyboardMarkup||n instanceof r.Api.ReplyInlineMarkup))return;const i=n.rows.map((({buttons:e})=>e.map((e=>{const{text:n}=e;if(e instanceof r.Api.KeyboardButton)return{type:"command",text:n};if(e instanceof r.Api.KeyboardButtonUrl)return e.url.includes("?startgroup=")?{type:"unsupported",text:n}:{type:"url",text:n,url:e.url};if(e instanceof r.Api.KeyboardButtonCallback)return e.requiresPassword?{type:"unsupported",text:n}:{type:"callback",text:n,data:ee(e.data)};if(e instanceof r.Api.KeyboardButtonRequestPoll)return{type:"requestPoll",text:n,isQuiz:e.quiz};if(e instanceof r.Api.KeyboardButtonRequestPhone)return{type:"requestPhone",text:n};if(e instanceof r.Api.KeyboardButtonBuy){if(s instanceof r.Api.MessageMediaInvoice&&s.receiptMsgId)return{type:"receipt",text:"PaymentReceipt",receiptMessageId:s.receiptMsgId};if(t)return;return{type:"buy",text:n}}return e instanceof r.Api.KeyboardButtonGame?{type:"game",text:n}:e instanceof r.Api.KeyboardButtonSwitchInline?{type:"switchBotInline",text:n,query:e.query,isSamePeer:e.samePeer}:e instanceof r.Api.KeyboardButtonUserProfile?{type:"userProfile",text:n,userId:e.userId.toString()}:e instanceof r.Api.KeyboardButtonSimpleWebView?{type:"simpleWebView",text:n,url:e.url}:e instanceof r.Api.KeyboardButtonWebView?{type:"webView",text:n,url:e.url}:e instanceof r.Api.KeyboardButtonUrlAuth?{type:"urlAuth",text:n,url:e.url,buttonId:e.buttonId}:{type:"unsupported",text:n}})).filter(Boolean)));return i.every((e=>!e.length))?void 0:{[n instanceof r.Api.ReplyKeyboardMarkup?"keyboardButtons":"inlineButtons"]:i,...n instanceof r.Api.ReplyKeyboardMarkup&&{keyboardPlaceholder:n.placeholder,isKeyboardSingleUse:n.singleUse,isKeyboardSelective:n.selective}}}(t,d)||{},v=t.fwdFrom&&function(e,t=!1){const n=e.savedFromPeer&&$(e.savedFromPeer),s=e.fromId&&$(e.fromId);return{date:e.date,isImported:e.imported,isChannelPost:Boolean(e.channelPost),channelPostId:e.channelPost,isLinkedChannelPost:Boolean(e.channelPost&&n&&!t),fromChatId:n||s,fromMessageId:e.savedFromMsgId||e.channelPost,senderUserId:s,hiddenUserName:e.fromName,postAuthorTitle:e.postAuthor}}(t.fwdFrom,i),{replies:A,mediaUnread:I,postAuthor:S}=t,C=t.groupedId&&String(t.groupedId),_=Boolean(C)&&!(a.document||a.audio||a.sticker),M=t.replyMarkup instanceof r.Api.ReplyKeyboardHide,R=t.replyMarkup instanceof r.Api.ReplyKeyboardHide&&t.replyMarkup.selective,D=t.noforwards||d,T=!t.noforwards,k=Ge(a,C);return{id:t.id,chatId:e,isOutgoing:o,content:a,date:t.date,senderId:n||t.out&&t.post&&Ve||e,views:t.views,forwards:t.forwards,isFromScheduled:t.fromScheduled,isSilent:t.silent,reactions:t.reactions&&et(t.reactions),...k&&{emojiOnlyCount:k},...u&&{replyToMessageId:u},...f&&{isTopicReply:!0},...p&&{replyToChatId:$(p)},...l&&{replyToTopMessageId:l},...v&&{forwardInfo:v},...h&&{isEdited:h},...t.editDate&&{editDate:t.editDate},...I&&{isMediaUnread:I},...t.mentioned&&I&&{hasUnreadMention:!0},...t.mentioned&&{isMentioned:!0},...C&&{groupedId:C,isInAlbum:_},inlineButtons:g,...m&&{keyboardButtons:m,keyboardPlaceholder:y,isKeyboardSingleUse:w,isKeyboardSelective:b},...M&&{shouldHideKeyboardButtons:M,isHideKeyboardSelective:R},...t.viaBotId&&{viaBotId:L(t.viaBotId,"user")},...A&&{repliesThreadInfo:At(A,t.id,e)},...S&&{postAuthorTitle:S},isProtected:D,isForwardingAllowed:T}}function et(e){const{recentReactions:t,results:n,canSeeList:s}=e;return{canSeeList:s,results:n.map(nt).filter(Boolean).sort(tt),recentReactions:t?.map(st).filter(Boolean)}}function tt(e,t){return t.count-e.count||(void 0!==e.chosenOrder&&void 0!==t.chosenOrder?e.chosenOrder-t.chosenOrder:void 0!==e.chosenOrder?1:void 0!==t.chosenOrder?-1:0)}function nt(e){const{chosenOrder:t,count:n,reaction:s}=e,i=it(s);if(i)return{chosenOrder:t,count:n,reaction:i}}function st(e){const{peerId:t,reaction:n,big:s,unread:i}=e,o=it(n);if(o)return{userId:$(t),reaction:o,isUnread:i,isBig:s}}function it(e){return e instanceof r.Api.ReactionEmoji?{emoticon:e.emoticon}:e instanceof r.Api.ReactionCustomEmoji?{documentId:e.documentId.toString()}:void 0}function ot(e){const{selectAnimation:t,staticIcon:n,reaction:s,title:i,inactive:o,aroundAnimation:a,centerIcon:r,effectAnimation:c,activateAnimation:d,premium:u}=e;return{selectAnimation:lt(t),activateAnimation:lt(d),effectAnimation:lt(c),staticIcon:lt(n),aroundAnimation:a?lt(a):void 0,centerIcon:r?lt(r):void 0,reaction:{emoticon:s},title:i,isInactive:o,isPremium:u}}function at(e){let t={};e.media&&(t={...dt(e.media)});const n=e.media instanceof r.Api.MessageMediaUnsupported;return!e.message||n||t.sticker||t.poll||t.contact||t.video?.isRound||(t={...t,text:rt(e.message,e.entities)}),t}function rt(e,t){return{text:e,...t&&{entities:t.map(vt)}}}function ct(e){if(e instanceof r.Api.DraftMessageEmpty)return;const{message:t,entities:n,replyToMsgId:s,date:i}=e;return{formattedText:t?rt(t,n):void 0,replyingToId:s,date:i}}function dt(e){if("ttlSeconds"in e&&e.ttlSeconds)return;if("extendedMedia"in e&&e.extendedMedia instanceof r.Api.MessageExtendedMedia)return dt(e.extendedMedia.media);const t=function(e){if(e instanceof r.Api.MessageMediaDocument&&e.document&&e.document instanceof r.Api.Document)return k(e.document,e.nopremium)}(e);if(t)return{sticker:t};const n=function(e){if(e instanceof r.Api.MessageMediaPhoto&&e.photo&&e.photo instanceof r.Api.Photo)return P(e.photo,e.spoiler)}(e);if(n)return{photo:n};const s=function(e){if(e instanceof r.Api.MessageMediaDocument&&e.document instanceof r.Api.Document&&e.document.mimeType.startsWith("video"))return ut(e.document,e.spoiler)}(e);if(s)return{video:s};const i=function(e){if(!(e instanceof r.Api.MessageMediaDocument&&e.document&&e.document instanceof r.Api.Document))return;const t=e.document.attributes.find((e=>e instanceof r.Api.DocumentAttributeAudio));if(!t||t.voice)return;const n=e.document.thumbs&&e.document.thumbs.filter((e=>e instanceof r.Api.PhotoSize)).map((e=>M(e)));return{id:String(e.document.id),fileName:mt(e.document,"audio"),thumbnailSizes:n,size:e.document.size.toJSNumber(),...d(e.document,["mimeType"]),...d(t,["duration","performer","title"])}}(e);if(i)return{audio:i};const o=function(e){if(!(e instanceof r.Api.MessageMediaDocument&&e.document&&e.document instanceof r.Api.Document))return;const t=e.document.attributes.find((e=>e instanceof r.Api.DocumentAttributeAudio));if(!t||!t.voice)return;const{duration:n,waveform:s}=t;return{id:String(e.document.id),duration:n,waveform:s?Array.from(s):void 0}}(e);if(o)return{voice:o};const a=function(e){if(e instanceof r.Api.MessageMediaDocument&&e.document)return lt(e.document)}(e);if(a)return{document:a};const c=function(e){if(!(e instanceof r.Api.MessageMediaContact))return;const{firstName:t,lastName:n,phoneNumber:s,userId:i}=e;return{firstName:t,lastName:n,phoneNumber:s,userId:L(i,"user")}}(e);if(c)return{contact:c};const u=function(e){if(e instanceof r.Api.MessageMediaPoll)return pt(e.poll,e.results)}(e);if(u)return{poll:u};const l=gt(e);if(l)return{webPage:l};const f=function(e){if(e instanceof r.Api.MessageMediaInvoice)return function(e){const{description:t,title:n,photo:s,test:i,totalAmount:o,currency:a,receiptMsgId:c,extendedMedia:d}=e,u=d instanceof r.Api.MessageExtendedMediaPreview?yt(d):void 0;return{title:n,text:t,photo:wt(s),receiptMsgId:c,amount:Number(o),currency:a,isTest:i,extendedMedia:u}}(e)}(e);if(f)return{invoice:f};const p=function(e){return e instanceof r.Api.MessageMediaGeo?function(e){const t=ft(e.geo);return t&&{type:"geo",geo:t}}(e):e instanceof r.Api.MessageMediaVenue?function(e){const{geo:t,title:n,provider:s,address:i,venueId:o,venueType:a}=e,r=ft(t);return r&&{type:"venue",geo:r,title:n,provider:s,address:i,venueId:o,venueType:a}}(e):e instanceof r.Api.MessageMediaGeoLive?function(e){const{geo:t,period:n,heading:s}=e,i=ft(t);return i&&{type:"geoLive",geo:i,period:n,heading:s}}(e):void 0}(e);if(p)return{location:p};const h=function(e){if(e instanceof r.Api.MessageMediaGame)return function(e){const{id:t,accessHash:n,shortName:s,title:i,description:o,photo:a,document:c}=e.game,d=a instanceof r.Api.Photo?P(a):void 0,u=c instanceof r.Api.Document?lt(c):void 0;return{id:t.toString(),accessHash:n.toString(),shortName:s,title:i,description:o,photo:d,document:u}}(e)}(e);return h?{game:h}:void 0}function ut(e,t){if(e instanceof r.Api.DocumentEmpty)return;const{id:n,mimeType:s,thumbs:o,size:a,attributes:c}=e;if(s===i.KzG&&!self.isWebmSupported)return;if(s===i.Ngd&&!self.isMovSupported)return;const d=c.find((e=>e instanceof r.Api.DocumentAttributeVideo));if(!d)return;const u=c.find((e=>e instanceof r.Api.DocumentAttributeAnimated)),{duration:l,w:f,h:p,supportsStreaming:h=!1,roundMessage:g=!1}=d;return{id:String(n),mimeType:s,duration:l,fileName:mt(e,"video"),width:f,height:p,supportsStreaming:h,isRound:g,isGif:Boolean(u),thumbnail:C(o),size:a.toJSNumber(),isSpoiler:t}}function lt(e){if(!(e instanceof r.Api.Document))return;const{id:t,size:n,mimeType:s,date:o,thumbs:a,attributes:c}=e,d=a&&C(a);let u,l;const f=a&&a.find((e=>e instanceof r.Api.PhotoSize));if(f)if(l={width:f.w,height:f.h},i.oGt.has(s)){u="photo";const e=c.find((e=>e instanceof r.Api.DocumentAttributeImageSize));if(e){const{w:t,h:n}=e;l={width:t,height:n}}}else if(i.wGh.has(s)){u="video";const e=c.find((e=>e instanceof r.Api.DocumentAttributeVideo));if(e){const{w:t,h:n}=e;l={width:t,height:n}}}return{id:String(t),size:n.toJSNumber(),mimeType:s,timestamp:o,fileName:mt(e),thumbnail:d,mediaType:u,mediaSize:l}}function ft(e){if(e instanceof r.Api.GeoPointEmpty)return;const{long:t,lat:n,accuracyRadius:s,accessHash:i}=e;return{long:t,lat:n,accessHash:i.toString(),accuracyRadius:s}}function pt(e,t){const{id:n,answers:s}=e,i=s.map((e=>({text:e.text,option:ee(e.option)})));return{id:String(n),summary:{isPublic:e.publicVoters,...d(e,["closed","multipleChoice","quiz","question","closePeriod","closeDate"]),answers:i},results:ht(t)}}function ht(e){const{results:t,totalVoters:n,recentVoters:s,solution:i,solutionEntities:o,min:a}=e,r=t&&t.map((({option:e,chosen:t,correct:n,voters:s})=>({isChosen:t,isCorrect:n,option:ee(e),votersCount:s})));return{isMin:a,totalVoters:n,recentVoterIds:s?.map((e=>L(e,"user"))),results:r,solution:i,...o&&{solutionEntities:o.map(vt)}}}function gt(e){if(!(e instanceof r.Api.MessageMediaWebPage&&e.webpage instanceof r.Api.WebPage))return;const{id:t,photo:n,document:s}=e.webpage;let i;return s instanceof r.Api.Document&&s.mimeType.startsWith("video/")&&(i=ut(s)),{id:Number(t),...d(e.webpage,["url","displayUrl","type","siteName","title","description","duration"]),photo:n instanceof r.Api.Photo?P(n):void 0,document:!i&&s?lt(s):void 0,video:i}}function mt(e,t="file"){const{mimeType:n,attributes:s}=e,i=s.find((e=>e instanceof r.Api.DocumentAttributeFilename));if(i)return i.fileName;const o=n.split("/")[1];return`${t}${String(e.id)}.${o}`}function yt(e){const{w:t,h:n,thumb:s,videoDuration:i}=e;return{width:t,height:n,duration:i,thumbnail:s?C([s]):void 0}}function wt(e){if(!e)return;const{url:t,size:n,mimeType:s}=e,i=e instanceof r.Api.WebDocument?e.accessHash.toString():void 0,o=e.attributes.find((e=>e instanceof r.Api.DocumentAttributeImageSize));return{url:t,accessHash:i,size:n,mimeType:s,dimensions:o&&{width:o.w,height:o.h}}}function bt(e,t){return{poll:{id:String(t),summary:d(e.summary,["question","answers"]),results:{}}}}function vt(e){const{className:t,offset:n,length:s}=e;return e instanceof r.Api.MessageEntityMentionName?{type:h.MentionName,offset:n,length:s,userId:L(e.userId,"user")}:e instanceof r.Api.MessageEntityTextUrl?{type:h.TextUrl,offset:n,length:s,url:e.url}:e instanceof r.Api.MessageEntityPre?{type:h.Pre,offset:n,length:s,language:e.language}:e instanceof r.Api.MessageEntityCustomEmoji?{type:h.CustomEmoji,offset:n,length:s,documentId:e.documentId.toString()}:{type:t,offset:n,length:s}}function At(e,t,n){const{channelId:s,replies:o,maxId:a,readMaxId:r,recentRepliers:c,comments:d}=e,u=s?L(s,"channel"):void 0;if(u!==i.deL)return{isComments:d,threadId:t,...u&&n!==u?{chatId:u,originChannelId:n}:{chatId:n},messagesCount:o,lastMessageId:a,lastReadInboxMessageId:r,...c&&{recentReplierIds:c.map($)}}}function It(e,t=!1){const n=Boolean("min"in e&&e.min),s="accessHash"in e&&String(e.accessHash),i="photo"in e&&e.photo&&"hasVideo"in e.photo&&e.photo.hasVideo,o="photo"in e&&e.photo&&kt(e.photo),a=Boolean("signatures"in e&&e.signatures),r=Boolean("hasLink"in e&&e.hasLink),c=Boolean("scam"in e&&e.scam),d=Boolean("fake"in e&&e.fake),u=Boolean("joinToSend"in e&&e.joinToSend),l=Boolean("joinRequest"in e&&e.joinRequest),f=R(e),p=Boolean("forum"in e&&e.forum);return{isMin:n,hasPrivateLink:r,isSignaturesShown:a,usernames:f,...s&&{accessHash:s},hasVideoAvatar:i,...o&&{avatarHash:o},..."verified"in e&&{isVerified:e.verified},..."callActive"in e&&{isCallActive:e.callActive},..."callNotEmpty"in e&&{isCallNotEmpty:e.callNotEmpty},..."date"in e&&{joinDate:e.date},..."participantsCount"in e&&void 0!==e.participantsCount&&{membersCount:e.participantsCount},..."noforwards"in e&&{isProtected:Boolean(e.noforwards)},...t&&{isSupport:!0},...Ct(e),..."creator"in e&&{isCreator:e.creator},...Pt(e),..._t(e),fakeType:c?"scam":d?"fake":void 0,isJoinToSend:u,isJoinRequest:l,isForum:p}}function St(e,t){const{peer:n,folderId:s,unreadMark:i,unreadCount:o,unreadMentionsCount:a,unreadReactionsCount:c,notifySettings:{silent:d,muteUntil:u},readOutboxMaxId:l,readInboxMaxId:f,draft:h}=e,g=d||"number"==typeof u&&p()<u;return{id:$(n),...s&&{folderId:s},type:Rt(t),title:Dt(n,t),lastReadOutboxMessageId:l,lastReadInboxMessageId:f,unreadCount:o,unreadMentionsCount:a,unreadReactionsCount:c,isMuted:g,...i&&{hasUnreadMark:!0},...h instanceof r.Api.DraftMessage&&{draftDate:h.date},...It(t)}}function Ct(e){return e instanceof r.Api.Chat||e instanceof r.Api.Channel?{adminRights:e.adminRights?(0,b.f)(e.adminRights):void 0,currentUserBannedRights:"bannedRights"in e&&e.bannedRights?(0,b.f)(e.bannedRights):void 0,defaultBannedRights:e.defaultBannedRights?(0,b.f)(e.defaultBannedRights):void 0}:{}}function Pt(e){if(e instanceof r.Api.ChatForbidden)return{isForbidden:!0};if(e instanceof r.Api.ChannelForbidden)return{isRestricted:!0};const t={};if("restricted"in e){const n=e.restricted?function(e){if(!e)return;const t=e.find((({platform:e})=>"all"===e));return t?d(t,["reason","text"]):void 0}(e.restrictionReason):void 0;n&&Object.assign(t,{isRestricted:!0,restrictionReason:n})}return e instanceof r.Api.Chat&&Object.assign(t,{isNotJoined:e.left}),e instanceof r.Api.Channel&&Object.assign(t,{isNotJoined:e.left}),t}function _t(e){return!("migratedTo"in e)||!e.migratedTo||e.migratedTo instanceof r.Api.InputChannelEmpty?{}:{migratedTo:{chatId:$(e.migratedTo),...e.migratedTo instanceof r.Api.InputChannel&&{accessHash:String(e.migratedTo.accessHash)}}}}function Mt(e,t=!1){if(!(e instanceof r.Api.ChatEmpty||e instanceof r.Api.UserEmpty))return{id:L(e.id,e instanceof r.Api.User?"user":"chat"),type:Rt(e),title:e instanceof r.Api.User?Tt(e):e.title,...It(e,t)}}function Rt(e){return e instanceof r.Api.User||e instanceof r.Api.UserEmpty?"chatTypePrivate":e instanceof r.Api.Chat||e instanceof r.Api.ChatForbidden||e instanceof r.Api.ChatEmpty?"chatTypeBasicGroup":e.megagroup?"chatTypeSuperGroup":"chatTypeChannel"}function Dt(e,t){return F(e)?Tt(t):t.title}function Tt(e){return e.firstName?`${e.firstName}${e.lastName?` ${e.lastName}`:""}`:e.lastName||""}function kt(e){if("photoId"in e)return String(e.photoId)}function Et(e){return{userId:e instanceof r.Api.ChannelParticipantBanned||e instanceof r.Api.ChannelParticipantLeft?$(e.peer):L(e.userId,"user"),inviterId:"inviterId"in e&&e.inviterId?L(e.inviterId,"user"):void 0,joinedDate:"date"in e?e.date:void 0,kickedByUserId:"kickedBy"in e&&e.kickedBy?L(e.kickedBy,"user"):void 0,promotedByUserId:"promotedBy"in e&&e.promotedBy?L(e.promotedBy,"user"):void 0,bannedRights:"bannedRights"in e?(0,b.f)(e.bannedRights):void 0,adminRights:"adminRights"in e?(0,b.f)(e.adminRights):void 0,customTitle:"rank"in e?e.rank:void 0,...(e instanceof r.Api.ChannelParticipantAdmin||e instanceof r.Api.ChatParticipantAdmin)&&{isAdmin:!0},...(e instanceof r.Api.ChannelParticipantCreator||e instanceof r.Api.ChatParticipantCreator)&&{isOwner:!0}}}function Ut(e){return e instanceof r.Api.ChatParticipants||e instanceof r.Api.channels.ChannelParticipants?e.participants.map(Et).filter(Boolean):void 0}function Bt(e){let t,n="";if(!(e.action instanceof r.Api.SendMessageCancelAction)){if(e.action instanceof r.Api.SendMessageTypingAction)n="lng_user_typing";else if(e.action instanceof r.Api.SendMessageRecordVideoAction)n="lng_send_action_record_video";else if(e.action instanceof r.Api.SendMessageUploadVideoAction)n="lng_send_action_upload_video";else if(e.action instanceof r.Api.SendMessageRecordAudioAction)n="lng_send_action_record_audio";else if(e.action instanceof r.Api.SendMessageUploadAudioAction)n="lng_send_action_upload_audio";else if(e.action instanceof r.Api.SendMessageUploadPhotoAction)n="lng_send_action_upload_photo";else if(e.action instanceof r.Api.SendMessageUploadDocumentAction)n="lng_send_action_upload_file";else if(e.action instanceof r.Api.SendMessageGeoLocationAction)n="selecting a location to share";else if(e.action instanceof r.Api.SendMessageChooseContactAction)n="selecting a contact to share";else if(e.action instanceof r.Api.SendMessageGamePlayAction)n="lng_playing_game";else if(e.action instanceof r.Api.SendMessageRecordRoundAction)n="lng_send_action_record_round";else if(e.action instanceof r.Api.SendMessageUploadRoundAction)n="lng_send_action_upload_round";else if(e.action instanceof r.Api.SendMessageChooseStickerAction)n="lng_send_action_choose_sticker";else{if(e.action instanceof r.Api.SpeakingInGroupCallAction)return;if(e.action instanceof r.Api.SendMessageEmojiInteractionSeen)n="lng_user_action_watching_animations",t=e.action.emoticon;else if(e.action instanceof r.Api.SendMessageEmojiInteraction)return}return{action:n,...t&&{emoji:t},...!(e instanceof r.Api.UpdateUserTyping)&&{userId:$(e.fromId)},timestamp:Date.now()+1e3*f()}}}function xt(e){return{...(t=e,n=["id","title","emoticon","contacts","nonContacts","groups","bots","excludeMuted","excludeRead","excludeArchived"],n.reduce(((e,n)=>(t[n]&&(e[n]=t[n]),e)),{})),channels:e.broadcasts,pinnedChatIds:e.pinnedPeers.map($).filter(Boolean),includedChatIds:e.includePeers.map($).filter(Boolean),excludedChatIds:e.excludePeers.map($).filter(Boolean)};var t,n}function Nt({filter:e,description:t}){if(e instanceof r.Api.DialogFilter)return{...xt(e),description:t}}function Ot(e){return e.reduce(((e,t)=>{const n=L(t.userId,"user");return t.commands&&(e=e.concat(t.commands.map((e=>({botId:n,...(0,b.f)(e)}))))),e}),[])}function qt(e){const{revoked:t,date:n,expireDate:s,link:i,permanent:o,startDate:a,usage:r,usageLimit:c,requested:d,requestNeeded:u,title:l,adminId:f}=e;return{isRevoked:t,date:n,expireDate:s,link:i,isPermanent:o,startDate:a,usage:r,usageLimit:c,isRequestNeeded:u,requested:d,title:l,adminId:L(f,"user")}}function Ht({autoarchived:e,reportSpam:t,addContact:n,blockContact:s}){return{isAutoArchived:Boolean(e),canReportSpam:Boolean(t),canAddContact:Boolean(n),canBlockContact:Boolean(s)}}function jt(e){return e instanceof r.Api.ChatReactionsAll?{type:"all",areCustomAllowed:e.allowCustom}:e instanceof r.Api.ChatReactionsSome?{type:"some",allowed:e.reactions.map(it).filter(Boolean)}:void 0}function Ft(e){return{id:$(e.peer),isPremium:e.premiumRequired}}function Gt(e){if(e instanceof r.Api.ForumTopicDeleted)return;const{id:t,my:n,closed:s,pinned:i,hidden:o,short:a,date:c,title:d,iconColor:u,iconEmojiId:l,topMessage:f,unreadCount:p,unreadMentionsCount:h,unreadReactionsCount:g,fromId:m,notifySettings:{silent:y,muteUntil:w}}=e;return{id:t,isClosed:s,isPinned:i,isHidden:o,isOwner:n,isMin:a,date:c,title:d,iconColor:u,iconEmojiId:l?.toString(),lastMessageId:f,unreadCount:p,unreadMentionsCount:h,unreadReactionsCount:g,fromId:$(m),isMuted:y||(void 0!==w?w>0:void 0)}}function Lt(e){return{id:e.botId.toString(),hasSettings:e.hasSettings,shouldRequestWriteAccess:e.requestWriteAccess,shortName:e.shortName,peerTypes:e.peerTypes.map($t),icons:e.icons.map(Kt).filter(Boolean)}}function $t(e){return e instanceof r.Api.AttachMenuPeerTypeBotPM?"bots":e instanceof r.Api.AttachMenuPeerTypePM?"users":e instanceof r.Api.AttachMenuPeerTypeChat?"chats":e instanceof r.Api.AttachMenuPeerTypeBroadcast?"channels":e instanceof r.Api.AttachMenuPeerTypeSameBotPM?"self":void 0}function Kt(e){if(!(e.icon instanceof r.Api.Document))return;const t=lt(e.icon);return t?(a.ZP.documents[String(e.icon.id)]=e.icon,{name:e.name,document:t}):void 0}function zt(e,t){const{description:n,descriptionPhoto:s,descriptionDocument:i,userId:o,commands:a,menuButton:c}=e,d=o&&L(o,"user"),u=s instanceof r.Api.Photo?P(s):void 0,l=i instanceof r.Api.Document?ut(i):void 0,f=a?.map((e=>function(e,t){return{botId:e,...(0,b.f)(t)}}(d||t,e)));return{botId:d||t,description:n,gif:l,photo:u,menuButton:Wt(c),commands:f?.length?f:void 0}}function Wt(e){return e instanceof r.Api.BotMenuButton?{type:"webApp",text:e.text,url:e.url}:{type:"commands"}}function Vt(e){const{fullUser:{about:t,commonChatsCount:n,pinnedMsgId:s,botInfo:i,blocked:o,profilePhoto:a,voiceMessagesForbidden:c,premiumGifts:d,fallbackPhoto:u,personalPhoto:l},users:f}=e,p=Zt(f[0]);return{...p,fullInfo:{...a instanceof r.Api.Photo&&{profilePhoto:P(a)},...u instanceof r.Api.Photo&&{fallbackPhoto:P(u)},...l instanceof r.Api.Photo&&{personalPhoto:P(l)},bio:t,commonChatsCount:n,pinnedMessageId:s,isBlocked:Boolean(o),noVoiceMessages:c,...d&&{premiumGifts:d.map((e=>function(e){const{months:t,currency:n,amount:s,botUrl:i}=e;return{months:t,currency:n,amount:s.toJSNumber(),botUrl:i}}(e)))},...i&&{botInfo:zt(i,p.id)}}}}function Zt(e){if(!(e instanceof r.Api.User))return;const{id:t,firstName:n,lastName:s,fake:i,scam:o}=e,a=e.photo instanceof r.Api.UserProfilePhoto?Boolean(e.photo.hasVideo):void 0,c=e.photo instanceof r.Api.UserProfilePhoto?String(e.photo.photoId):void 0,d=(f=e).bot?"userTypeBot":f.deleted?"userTypeDeleted":"userTypeRegular",u=R(e),l=e.emojiStatus?Qt(e.emojiStatus):void 0;var f;return{id:L(t,"user"),isMin:Boolean(e.min),fakeType:o?"scam":i?"fake":void 0,...e.self&&{isSelf:!0},isPremium:Boolean(e.premium),...e.verified&&{isVerified:!0},...(e.contact||e.mutualContact)&&{isContact:!0},type:d,...n&&{firstName:n},..."userTypeBot"===d&&{canBeInvitedToGroup:!e.botNochats},...s&&{lastName:s},...u&&{usernames:u},phoneNumber:e.phone||"",noStatus:!e.status,...e.accessHash&&{accessHash:String(e.accessHash)},...c&&{avatarHash:c},emojiStatus:l,hasVideoAvatar:a,...e.bot&&e.botInlinePlaceholder&&{botPlaceholder:e.botInlinePlaceholder},...e.bot&&e.botAttachMenu&&{isAttachBot:e.botAttachMenu}}}function Jt(e){return!e||e instanceof r.Api.UserStatusEmpty?{type:"userStatusEmpty"}:e instanceof r.Api.UserStatusOnline?{type:"userStatusOnline",expires:e.expires}:e instanceof r.Api.UserStatusOffline?{type:"userStatusOffline",wasOnline:e.wasOnline}:e instanceof r.Api.UserStatusRecently?{type:"userStatusRecently"}:e instanceof r.Api.UserStatusLastWeek?{type:"userStatusLastWeek"}:{type:"userStatusLastMonth"}}function Qt(e){return e instanceof r.Api.EmojiStatus?{documentId:e.documentId.toString()}:e instanceof r.Api.EmojiStatusUntil?{documentId:e.documentId.toString(),until:e.until}:void 0}function Yt(e){const t={},n=[];return e.forEach((e=>{const s=Zt(e);s&&(n.push(s),"status"in e&&(t[s.id]=Jt(e.status)))})),{users:n,userStatusesById:t}}function Xt(e){if(e instanceof r.Api.WallPaperNoFile)return;const{slug:t}=e,n=lt(e.document);return n?{slug:t,document:n}:void 0}function en(e){return{isCurrent:Boolean(e.current),isOfficialApp:Boolean(e.officialApp),isPasswordPending:Boolean(e.passwordPending),hash:String(e.hash),areCallsEnabled:!e.callRequestsDisabled,areSecretChatsEnabled:!e.encryptedRequestsDisabled,...d(e,["deviceModel","platform","systemVersion","appName","appVersion","dateCreated","dateActive","ip","country","region"])}}function tn(e){return{hash:String(e.hash),botId:L(e.botId,"user"),...d(e,["platform","browser","dateCreated","dateActive","ip","region","domain"])}}function nn(e){let t,n,s,i,o;return e.forEach((e=>{e instanceof r.Api.PrivacyValueAllowAll?t=t||"everybody":e instanceof r.Api.PrivacyValueAllowContacts?t=t||"contacts":e instanceof r.Api.PrivacyValueDisallowContacts?t=t||"nonContacts":e instanceof r.Api.PrivacyValueDisallowAll?t=t||"nobody":e instanceof r.Api.PrivacyValueAllowUsers?n=e.users.map((e=>L(e,"user"))):e instanceof r.Api.PrivacyValueDisallowUsers?i=e.users.map((e=>L(e,"user"))):e instanceof r.Api.PrivacyValueAllowChatParticipants?s=e.chats.map((e=>L(e,"chat"))):e instanceof r.Api.PrivacyValueDisallowChatParticipants&&(o=e.chats.map((e=>L(e,"chat"))))})),t||(t="nobody"),{visibility:t,allowUserIds:n||[],allowChatIds:s||[],blockUserIds:i||[],blockChatIds:o||[]}}function sn(e,t){const{silent:n,muteUntil:s,showPreviews:i,otherSound:o}=e,a=Boolean(o&&!(o instanceof r.Api.NotificationSoundNone));return{chatId:$(t),isMuted:n||"number"==typeof s&&p()<s,...!a&&{isSilent:!0},...void 0!==i&&{shouldShowPreviews:Boolean(i)}}}function on(e,t,n){const{silent:s,muteUntil:i,showPreviews:o,otherSound:a}=e,c=Boolean(a&&!(a instanceof r.Api.NotificationSoundNone));return{chatId:$(t),topicId:n,isMuted:s||"number"==typeof i&&p()<i,...!c&&{isSilent:!0},...void 0!==o&&{shouldShowPreviews:Boolean(o)}}}function an(e,t){const{hidden:n,iso2:s,defaultName:i,name:o}=e,{countryCode:a,prefixes:r,patterns:c}=t||{};return{isHidden:n,iso2:s,defaultName:i,name:o,countryCode:a,prefixes:r,patterns:c}}function rn(e){if(!(e instanceof r.Api.JsonNull))return e instanceof r.Api.JsonString||e instanceof r.Api.JsonBool||e instanceof r.Api.JsonNumber?e.value:e instanceof r.Api.JsonArray?e.value.map(rn):e.value.reduce(((e,t)=>(e[t.key]=rn(t.value),e)),{})}function cn(e){if(e instanceof r.Api.UrlAuthResultRequest){const{bot:t,domain:n,requestWriteAccess:s}=e,i=Zt(t);if(!i)return;return Y(t),{type:"request",domain:n,shouldRequestWriteAccess:s,bot:i}}return e instanceof r.Api.UrlAuthResultAccepted?{type:"accepted",url:e.url}:e instanceof r.Api.UrlAuthResultDefault?{type:"default"}:void 0}const dn=1e3;let un;const ln=new Set;function fn(e){e.filter((e=>e instanceof r.Api.User)).map(Zt).forEach((e=>{e&&un({"@type":"updateUser",id:e.id,user:e})})),e.filter((e=>e instanceof r.Api.Chat||e instanceof r.Api.ChatForbidden||e instanceof r.Api.Channel||e instanceof r.Api.ChannelForbidden)).map((e=>Mt(e))).forEach((e=>{e&&un({"@type":"updateChat",id:e.id,chat:e})}))}function pn(e,t){if(e instanceof r.connection.UpdateServerTimeOffset)c=e.timeOffset,l=c,un({"@type":"updateServerTimeOffset",serverTimeOffset:e.timeOffset});else if(e instanceof r.connection.UpdateConnectionState){let t;switch(e.state){case r.connection.UpdateConnectionState.disconnected:t="connectionStateConnecting";break;case r.connection.UpdateConnectionState.broken:t="connectionStateBroken";break;case r.connection.UpdateConnectionState.connected:default:t="connectionStateReady"}un({"@type":"updateConnectionState",connectionState:t})}else if(e instanceof r.Api.UpdateNewMessage||e instanceof r.Api.UpdateNewScheduledMessage||e instanceof r.Api.UpdateNewChannelMessage||e instanceof r.Api.UpdateShortChatMessage||e instanceof r.Api.UpdateShortMessage){let t,n;const s=e._entities;if(s&&(X(s),fn(s)),e instanceof r.Api.UpdateShortChatMessage)t=Xe(L((o=e).chatId,"chat"),{...o,fromId:oe(L(o.fromId,"user"))});else if(e instanceof r.Api.UpdateShortMessage)t=function(e){return Xe(L(e.userId,"user"),{...e,fromId:oe(e.out?Ve:L(e.userId,"user"))})}(e);else{if(e.message instanceof r.Api.MessageEmpty)return void(i.eMD&&console.error("Unexpected update:",e.className,e));(e.message instanceof r.Api.Message&&me(e.message)||e.message instanceof r.Api.MessageService&&e.message.action instanceof r.Api.MessageActionSuggestProfilePhoto)&&J(e.message),t=Ye(e.message),n="replyMarkup"in e.message&&e.message?.replyMarkup instanceof r.Api.ReplyKeyboardForceReply&&(!e.message.replyMarkup.selective||t.isMentioned)}if(e instanceof r.Api.UpdateNewScheduledMessage?un({"@type":ln.has(t.id)?"updateScheduledMessage":"newScheduledMessage",id:t.id,chatId:t.chatId,message:t}):un({"@type":ln.has(t.id)?"updateMessage":"newMessage",id:t.id,chatId:t.chatId,message:t,shouldForceReply:n}),e.message instanceof r.Api.MessageService){const{action:n}=e.message;if(n instanceof r.Api.MessageActionPaymentSent)un({"@type":"updatePaymentStateCompleted",slug:n.invoiceSlug});else if(n instanceof r.Api.MessageActionChatEditTitle)un({"@type":"updateChat",id:t.chatId,chat:{title:n.title}});else if(n instanceof r.Api.MessageActionChatEditPhoto){const s=function(e){if(e instanceof r.Api.PhotoEmpty)return new r.Api.ChatPhotoEmpty;const{dcId:t,id:n}=e;return new r.Api.ChatPhoto({dcId:t,photoId:n})}(n.photo),i=kt(s),o=Z(e.message);a.ZP.chats[o]&&(a.ZP.chats[o].photo=s),Q(n.photo),i&&un({"@type":"updateChat",id:t.chatId,chat:{avatarHash:i},...n.photo instanceof r.Api.Photo&&{newProfilePhoto:P(n.photo)}})}else if(n instanceof r.Api.MessageActionChatDeletePhoto){const n=Z(e.message);a.ZP.chats[n]&&(a.ZP.chats[n].photo=new r.Api.ChatPhotoEmpty),un({"@type":"updateChat",id:t.chatId,chat:{avatarHash:void 0}})}else if(n instanceof r.Api.MessageActionChatDeleteUser)e._entities&&e._entities.some((e=>e instanceof r.Api.User&&Boolean(e.self)&&e.id===n.userId))&&un({"@type":"updateChat",id:t.chatId,chat:{isForbidden:!0,isNotJoined:!0}});else if(n instanceof r.Api.MessageActionChatAddUser)e._entities&&e._entities.some((e=>e instanceof r.Api.User&&Boolean(e.self)&&n.users.includes(e.id)))&&un({"@type":"updateChatJoin",id:t.chatId});else if(n instanceof r.Api.MessageActionGroupCall)!n.duration&&n.call&&un({"@type":"updateGroupCallChatId",chatId:t.chatId,call:{id:n.call.id.toString(),accessHash:n.call.accessHash.toString()}});else if(n instanceof r.Api.MessageActionTopicEdit){const{replyTo:t}=e.message,{replyToMsgId:n,replyToTopId:s,forumTopic:o}=t||{},a=o&&(s||n)||i.OxA;un({"@type":"updateTopic",chatId:$(e.message.peerId),topicId:a})}else n instanceof r.Api.MessageActionTopicCreate&&un({"@type":"updateTopics",chatId:$(e.message.peerId)})}}else if(e instanceof r.Api.UpdateEditMessage||e instanceof r.Api.UpdateEditChannelMessage){if(e.message instanceof r.Api.MessageEmpty)return void(i.eMD&&console.error("Unexpected update:",e.className,e));e.message instanceof r.Api.Message&&me(e.message)&&J(e.message);const t=function(e,t){const n=new Set(["isOutgoing"].map(String));return d(e,Object.keys(e).filter((e=>!n.has(e))))}(Ye(e.message));un({"@type":"updateMessage",id:t.id,chatId:t.chatId,message:t})}else if(e instanceof r.Api.UpdateMessageReactions)un({"@type":"updateMessageReactions",id:e.msgId,chatId:$(e.peer),reactions:et(e.reactions)});else if(e instanceof r.Api.UpdateMessageExtendedMedia){let t,n;if(e.extendedMedia instanceof r.Api.MessageExtendedMedia&&(t=dt(e.extendedMedia.media)),e.extendedMedia instanceof r.Api.MessageExtendedMediaPreview&&(n=yt(e.extendedMedia)),!t&&!n)return;const s=$(e.peer);!function(e,t,n){const s=a.ZP.messages[`${e}-${t}`];if(s instanceof r.Api.Message&&s.media){if(n instanceof r.Api.MessageExtendedMediaPreview){if(!(s.media instanceof r.Api.MessageMediaInvoice))return;s.media.extendedMedia=n}n instanceof r.Api.MessageExtendedMedia&&(s.media=n.media)}}(s,e.msgId,e.extendedMedia),un({"@type":"updateMessageExtendedMedia",id:e.msgId,chatId:s,media:t,preview:n})}else if(e instanceof r.Api.UpdateDeleteMessages)un({"@type":"deleteMessages",ids:e.messages});else if(e instanceof r.Api.UpdateDeleteScheduledMessages)un({"@type":"deleteScheduledMessages",ids:e.messages,chatId:$(e.peer)});else if(e instanceof r.Api.UpdateDeleteChannelMessages){const t=L(e.channelId,"channel"),n=e.messages,s=n.filter((e=>a.ZP.messages[`${t}-${e}`])),i=n.filter((e=>!a.ZP.messages[`${t}-${e}`])),o=n.map((e=>{const n=a.ZP.messages[`${t}-${e}`];return n&&n instanceof r.Api.MessageService&&"photo"in n.action?String(n.action.photo.id):void 0})).filter(Boolean);s.length&&un({"@type":"deleteMessages",ids:s,chatId:t}),o.length&&un({"@type":"deleteProfilePhotos",ids:o,chatId:t}),i.length&&setTimeout((()=>{un({"@type":"deleteMessages",ids:i,chatId:t})}),dn)}else if(e instanceof r.Api.UpdateServiceNotification)if(e.popup)un({"@type":"error",error:{message:e.message}});else{const t=function(e,t){const n=Je(),s=at(e);return{id:n,chatId:i.awM,date:e.inboxDate||t,content:s,isOutgoing:!1}}(e,Date.now()/1e3+f());me(e)&&J(he(t.id,t.chatId,e)),un({"@type":"updateServiceNotification",message:t})}else if((t instanceof r.Api.messages.SendMessage||t instanceof r.Api.messages.SendMedia||t instanceof r.Api.messages.SendMultiMedia||t instanceof r.Api.messages.ForwardMessages)&&(e instanceof r.Api.UpdateMessageID||e instanceof r.Api.UpdateShortSentMessage)){let n;"randomId"in e?n=e.randomId:"randomId"in t&&(n=t.randomId);const s=n&&a.ZP.localMessages[String(n)];if(!s)throw new Error("Local message not found");let i;if(e instanceof r.Api.UpdateShortSentMessage){s.content.text&&e.entities&&(i={text:rt(s.content.text.text,e.entities)}),e.media&&(i={...i,...dt(e.media)});const t=he(e.id,s.chatId,e);me(t)&&J(t)}ln.add(e.id);const o="date"in e&&1e3*e.date<Date.now()+1e3*f();un({"@type":s.isScheduled&&!o?"updateScheduledMessageSendSucceeded":"updateMessageSendSucceeded",chatId:s.chatId,localId:s.id,message:{...s,...i&&{content:{...s.content,...i}},id:e.id,sendingState:void 0,..."date"in e&&{date:e.date}}})}else if(e instanceof r.Api.UpdateReadMessagesContents)un({"@type":"updateCommonBoxMessages",ids:e.messages,messageUpdate:{hasUnreadMention:!1,isMediaUnread:!1}});else if(e instanceof r.Api.UpdateChannelReadMessagesContents)un({"@type":"updateChannelMessages",channelId:L(e.channelId,"channel"),ids:e.messages,messageUpdate:{hasUnreadMention:!1,isMediaUnread:!1}});else if(e instanceof r.Api.UpdateMessagePoll){const{pollId:t,poll:n,results:s}=e;if(n){const e=pt(n,s);un({"@type":"updateMessagePoll",pollId:String(t),pollUpdate:e})}else{const e=ht(s);un({"@type":"updateMessagePoll",pollId:String(t),pollUpdate:{results:e}})}}else if(e instanceof r.Api.UpdateMessagePollVote)un({"@type":"updateMessagePollVote",pollId:String(e.pollId),userId:L(e.userId,"user"),options:e.options.map(ee)});else if(e instanceof r.Api.UpdateChannelMessageViews)un({"@type":"updateMessage",chatId:L(e.channelId,"channel"),id:e.id,message:{views:e.views}});else if(e instanceof r.Api.UpdateReadHistoryInbox)un({"@type":"updateChatInbox",id:$(e.peer),chat:{lastReadInboxMessageId:e.maxId,unreadCount:e.stillUnreadCount}});else if(e instanceof r.Api.UpdateReadHistoryOutbox)un({"@type":"updateChat",id:$(e.peer),chat:{lastReadOutboxMessageId:e.maxId}});else if(e instanceof r.Api.UpdateReadChannelInbox)un({"@type":"updateChat",id:L(e.channelId,"channel"),chat:{lastReadInboxMessageId:e.maxId,unreadCount:e.stillUnreadCount}});else if(e instanceof r.Api.UpdateReadChannelOutbox)un({"@type":"updateChat",id:L(e.channelId,"channel"),chat:{lastReadOutboxMessageId:e.maxId}});else if(e instanceof r.Api.UpdateReadChannelDiscussionInbox)un({"@type":"updateThreadInfo",chatId:L(e.channelId,"channel"),threadId:e.topMsgId,threadInfo:{lastReadInboxMessageId:e.readMaxId}});else if(e instanceof r.Api.UpdateReadChannelDiscussionOutbox)un({"@type":"updateChat",id:L(e.channelId,"channel"),chat:{lastReadOutboxMessageId:e.readMaxId}});else if(e instanceof r.Api.UpdateDialogPinned&&e.peer instanceof r.Api.DialogPeer)un({"@type":"updateChatPinned",id:$(e.peer.peer),isPinned:e.pinned||!1});else if(e instanceof r.Api.UpdatePinnedDialogs){const t=e.order?e.order.filter((e=>e instanceof r.Api.DialogPeer)).map((e=>$(e.peer))):[];un({"@type":"updatePinnedChatIds",ids:t,folderId:e.folderId||void 0})}else if(e instanceof r.Api.UpdateFolderPeers)e.folderPeers.forEach((e=>{const{folderId:t,peer:n}=e;un({"@type":"updateChatListType",id:$(n),folderId:t})}));else if(e instanceof r.Api.UpdateDialogFilter){const{id:t,filter:n}=e,s=n instanceof r.Api.DialogFilter?xt(n):void 0;un({"@type":"updateChatFolder",id:t,folder:s})}else if(e instanceof r.Api.UpdateDialogFilterOrder)un({"@type":"updateChatFoldersOrder",orderedIds:e.order});else if(e instanceof r.Api.UpdateChatParticipants){const t=Ut(e.participants);un({"@type":"updateChatMembers",id:L(e.participants.chatId,"chat"),replacedMembers:t})}else if(e instanceof r.Api.UpdateChatParticipantAdd){const t=Et(d(e,["userId","inviterId","date"]));un({"@type":"updateChatMembers",id:L(e.chatId,"chat"),addedMember:t})}else if(e instanceof r.Api.UpdateChatParticipantDelete)un({"@type":"updateChatMembers",id:L(e.chatId,"chat"),deletedMemberId:L(e.userId,"user")});else if(e instanceof r.Api.UpdatePinnedMessages||e instanceof r.Api.UpdatePinnedChannelMessages){const t=e instanceof r.Api.UpdatePinnedMessages?$(e.peer):L(e.channelId,"channel");un({"@type":"updatePinnedIds",chatId:t,messageIds:e.messages,isPinned:e.pinned})}else if(e instanceof r.Api.UpdateNotifySettings&&e.peer instanceof r.Api.NotifyPeer)un({"@type":"updateNotifyExceptions",...sn(e.notifySettings,e.peer.peer)});else if(e instanceof r.Api.UpdateNotifySettings&&e.peer instanceof r.Api.NotifyForumTopic)un({"@type":"updateTopicNotifyExceptions",...on(e.notifySettings,e.peer.peer,e.peer.topMsgId)});else if(e instanceof r.Api.UpdateUserTyping||e instanceof r.Api.UpdateChatUserTyping){const t=e instanceof r.Api.UpdateUserTyping?L(e.userId,"user"):L(e.chatId,"chat");e.action instanceof r.Api.SendMessageEmojiInteraction?un({"@type":"updateStartEmojiInteraction",id:t,emoji:e.action.emoticon,messageId:e.action.msgId,interaction:(s=JSON.parse(e.action.interaction.data),{timestamps:s.a.map((({t:e})=>e))})}):un({"@type":"updateChatTypingStatus",id:t,typingStatus:Bt(e)})}else if(e instanceof r.Api.UpdateChannelUserTyping){const t=L(e.channelId,"channel");un({"@type":"updateChatTypingStatus",id:t,threadId:e.topMsgId,typingStatus:Bt(e)})}else if(e instanceof r.Api.UpdateChannel){const{_entities:t}=e;if(!t)return;const n=t.find((e=>e instanceof r.Api.Channel||e instanceof r.Api.ChannelForbidden));if(n instanceof r.Api.Channel){const t=Mt(n);t&&(un({"@type":"updateChat",id:t.id,chat:t}),un({"@type":t.isNotJoined?"updateChatLeave":"updateChatJoin",id:L(e.channelId,"channel")}))}else if(n instanceof r.Api.ChannelForbidden){const t=L(e.channelId,"channel");un({"@type":"updateChat",id:t,chat:{isRestricted:!0}}),un({"@type":"updateChatLeave",id:t})}else 0===t.length&&un({"@type":"resetMessages",id:L(e.channelId,"channel")})}else if(e instanceof r.Api.UpdateDialogUnreadMark&&e.peer instanceof r.Api.DialogPeer)un({"@type":"updateChat",id:$(e.peer.peer),chat:{hasUnreadMark:e.unread}});else if(e instanceof r.Api.UpdateChatDefaultBannedRights)un({"@type":"updateChat",id:$(e.peer),chat:{defaultBannedRights:(0,b.f)(e.defaultBannedRights)}});else if(e instanceof r.Api.UpdateUserStatus)un({"@type":"updateUserStatus",userId:L(e.userId,"user"),status:Jt(e.status)});else if(e instanceof r.Api.UpdateUser)un({"@type":"updateRequestUserUpdate",id:L(e.userId,"user")});else if(e instanceof r.Api.UpdateUserEmojiStatus){const t=Qt(e.emojiStatus);un({"@type":"updateUserEmojiStatus",userId:L(e.userId,"user"),emojiStatus:t})}else if(e instanceof r.Api.UpdateUserName){const t=L(e.userId,"user"),n=a.ZP.users[t],s=n?.mutualContact&&!n.self?d(e,[]):d(e,["firstName","lastName"]),i=R(e);un({"@type":"updateUser",id:t,user:{...s,usernames:i}})}else if(e instanceof r.Api.UpdateUserPhone){const{userId:t,phone:n}=e;un({"@type":"updateUser",id:L(t,"user"),user:{phoneNumber:n}})}else if(e instanceof r.Api.UpdatePeerSettings){const{_entities:t,settings:n}=e;if(!t)return;t?.length&&(t.filter((e=>e instanceof r.Api.User&&!e.contact)).forEach((e=>{un({"@type":"deleteContact",id:L(e.id,"user")})})),t.filter((e=>e instanceof r.Api.User&&e.contact)).map(Zt).forEach((e=>{e&&un({"@type":"updateUser",id:e.id,user:{...e,...n&&{settings:Ht(n)}}})})))}else if(e instanceof r.Api.UpdateNotifySettings){const{notifySettings:{showPreviews:t,silent:n,muteUntil:s},peer:{className:i}}=e,o="NotifyUsers"===i?"contact":"NotifyChats"===i?"group":"NotifyBroadcasts"===i?"broadcast":void 0;if(!o)return;un({"@type":"updateNotifySettings",peerType:o,isSilent:Boolean(n||"number"==typeof s&&Date.now()+1e3*f()<1e3*s),shouldShowPreviews:Boolean(t)})}else if(e instanceof r.Api.UpdatePeerBlocked)un({"@type":"updatePeerBlocked",id:$(e.peerId),isBlocked:e.blocked});else if(e instanceof r.Api.UpdatePrivacy){const t=function(e){switch(e.className){case"PrivacyKeyPhoneNumber":return"phoneNumber";case"PrivacyKeyStatusTimestamp":return"lastSeen";case"PrivacyKeyProfilePhoto":return"profilePhoto";case"PrivacyKeyPhoneCall":return"phoneCall";case"PrivacyKeyPhoneP2P":return"phoneP2P";case"PrivacyKeyForwards":return"forwards";case"PrivacyKeyVoiceMessages":return"voiceMessages";case"PrivacyKeyChatInvite":return"chatInvite"}}(e.key);t&&un({"@type":"updatePrivacy",key:t,rules:nn(e.rules)})}else if(e instanceof r.Api.UpdateDraftMessage)un({"@type":"draftMessage",chatId:$(e.peer),threadId:e.topMsgId,...ct(e.draft)});else if(e instanceof r.Api.UpdateContactsReset)un({"@type":"updateResetContactList"});else if(e instanceof r.Api.UpdateFavedStickers)un({"@type":"updateFavoriteStickers"});else if(e instanceof r.Api.UpdateRecentStickers)un({"@type":"updateRecentStickers"});else if(e instanceof r.Api.UpdateMoveStickerSetToTop)e.masks||un({"@type":"updateMoveStickerSetToTop",isCustomEmoji:e.emojis,id:e.stickerset.toString()});else if(e instanceof r.Api.UpdateStickerSets)un({"@type":"updateStickerSets"});else if(e instanceof r.Api.UpdateStickerSetsOrder)e.masks||un({"@type":"updateStickerSetsOrder",order:e.order.map((e=>e.toString())),isCustomEmoji:e.emojis});else if(e instanceof r.Api.UpdateNewStickerSet){if(e.stickerset instanceof r.Api.messages.StickerSet){const t=E(e.stickerset.set);un({"@type":"updateStickerSet",id:t.id,stickerSet:t})}}else if(e instanceof r.Api.UpdateSavedGifs)un({"@type":"updateSavedGifs"});else if(e instanceof r.Api.UpdateGroupCall){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updateGroupCall",call:Ue(e.call)})}else if(e instanceof r.Api.UpdateGroupCallConnection)un({"@type":"updateGroupCallConnection",data:JSON.parse(e.params.data),presentation:Boolean(e.presentation)});else if(e instanceof r.Api.UpdateGroupCallParticipants){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updateGroupCallParticipants",groupCallId:(n=e.call,n.id.toString()),participants:e.participants.map(Te)})}else if(e instanceof r.Api.UpdatePendingJoinRequests){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updatePendingJoinRequests",chatId:$(e.peer),recentRequesterIds:e.recentRequesters.map((e=>L(e,"user"))),requestsPending:e.requestsPending})}else if(e instanceof r.Api.UpdatePhoneCall){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updatePhoneCall",call:Be(e.phoneCall)})}else if(e instanceof r.Api.UpdatePhoneCallSignalingData)un({"@type":"updatePhoneCallSignalingData",callId:e.phoneCallId.toString(),data:Array.from(e.data)});else if(e instanceof r.Api.UpdateWebViewResultSent){const{queryId:t}=e;un({"@type":"updateWebViewResultSent",queryId:t.toString()})}else if(e instanceof r.Api.UpdateBotMenuButton){const{botId:t,button:n}=e,s=L(t,"user");un({"@type":"updateBotMenuButton",botId:s,button:Wt(n)})}else if(e instanceof r.Api.UpdateTranscribedAudio){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updateTranscribedAudio",transcriptionId:e.transcriptionId.toString(),text:e.text,isPending:e.pending})}else if(e instanceof r.Api.UpdateConfig){const t=e._entities;t&&(X(t),fn(t)),un({"@type":"updateConfig"})}else e instanceof r.Api.UpdateChannelPinnedTopic?un({"@type":"updatePinnedTopic",chatId:L(e.channelId,"channel"),topicId:e.topicId,isPinned:Boolean(e.pinned)}):e instanceof r.Api.UpdateChannelPinnedTopics?un({"@type":"updatePinnedTopicsOrder",chatId:L(e.channelId,"channel"),order:e.order||[]}):e instanceof r.Api.UpdateRecentEmojiStatuses?un({"@type":"updateRecentEmojiStatuses"}):i.eMD&&ne("UNEXPECTED UPDATE","object"==typeof e&&"className"in e?e.className:e);var n,s,o,c}const hn={};let gn;function mn(e){hn.resolve&&hn.resolve(e)}function yn(e){hn.resolve&&hn.resolve(e)}function wn(e){hn.resolve&&hn.resolve(e)}function bn(e){const{firstName:t,lastName:n}=e;hn.resolve&&hn.resolve([t,n])}function vn(){hn.reject&&hn.reject(new Error("RESTART_AUTH"))}function An(){hn.reject&&hn.reject(new Error("RESTART_AUTH_WITH_QR"))}var In=n(89832),Sn=n(49524),Cn=n(3783),Pn=n(63024),_n=n(82752),Mn=n(83579),Rn=n(2133),Dn=n(48764).Buffer;async function Tn({url:e,mediaFormat:t,start:n,end:s,isHtmlAllowed:o},r,c,d){let u,l,f,p,h=!1;const g=e.split("?"),m=g[0].split(":");if(e.indexOf("progressive")>0||m[0].indexOf("-")>1)p=0===m[0].indexOf("avatar-")||0===m[0].indexOf("profile-")?g[1]:m[m.length-1];else if(0===e.indexOf("profile"))p=e.indexOf("?")>-1?e.split("?")[1]:e.replace("profile","");else if(0===e.indexOf("avatar"))p=e.split("?")[1];else{if(0!==e.indexOf("photo"))return void console.error("[error id] ",e);p=e.split("?")[0].replace("photo","")}if(a.ZP.cache[p]){const e=await async function(e){return new Promise(((t,n)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=()=>{n(s.error)},s.readAsArrayBuffer(e)}))}(a.ZP.cache[p]);f=a.ZP.cache[p].type,l=a.ZP.cache[p].size,u=Dn.from(e),h=!0}if(!h){if(!i.qHj)return;let t=new Cn.ju({id:p});try{console.log("[DOWNLOAD media]",{url:e,id:p});let n,s,o=await Sn.fetch(i.F9T,p,Sn.Type.Blob);if(o){const e=await(0,Rn.nM)(o);if(n=Cn.dZ.parseMsg(new _n.es(e)),!n||n.err!==Pn.wb.NO_ERROR)return;try{n.file.buf=Mn.Z.localDecrypt(Dn.from(n.file.buf))}catch(e){}}else{let e=Dn.alloc(0);for(;;){const o=await fetch(`${i.qHj}/proto`,{method:"POST",body:Dn.from(t.pack().getPbData())});if(s=await o.arrayBuffer(),n=Cn.dZ.parseMsg(new _n.es(Dn.from(s))),!n||n.err!==Pn.wb.NO_ERROR||!n.file)return;if(e=Dn.concat([e,Dn.from(n.file.buf)]),!(n.file.part_total&&n.file.part<n.file.part_total)){n.file.buf=e;try{const t=new Cn.dZ(n).pack().getPbData();await Sn.save(i.F9T,p,new Blob([Dn.from(t)])),n.file.buf=Mn.Z.localDecrypt(e)}catch(e){return void console.error(e)}break}t=new Cn.ju({id:p,part:n.file.part+1})}}u=Dn.from(n.file.buf),f=n.file.type,l=n.file.size}catch(t){return void console.error("[DOWNLOAD FAILED]",t,{url:e,id:p})}}const w=await async function(e,t,n){switch(t){case y.BlobUrl:return new Blob([e],{type:n});case y.Text:return e.toString();case y.Progressive:case y.DownloadUrl:return e.buffer}}(u,t,f);if(!w)return;const b=t!==y.Progressive;if(!i.CyD&&Sn&&b){const t=e.startsWith("avatar")?i.SGw:i.lWA;Sn.save(t,e,w)}return{dataBlob:t===y.Progressive?"":w,arrayBuffer:t===y.Progressive?w:void 0,mimeType:f,fullSize:l}}new Set(["msg","sticker","gif","wallpaper","photo","webDocument","document","videoAvatar"]);const kn={model:"gpt-3.5-turbo",temperature:1,max_tokens:1e3,presence_penalty:0},En={id:"1",accessHash:"",firstName:"me",lastName:"",canBeInvitedToGroup:!1,hasVideoAvatar:!1,isMin:!1,isPremium:!1,noStatus:!0,fullInfo:{isBlocked:!1,noVoiceMessages:!1,bio:""},usernames:[{username:"my-self",isActive:!0,isEditable:!0}],type:"userTypeBot",phoneNumber:"",avatarHash:"",isSelf:!0},Un=["translateText","editChatFolder","sortChatFolders","deleteChatFolder","requestWebView","uploadContactProfilePhoto","sendMessage","editMessage","deleteMessages","downloadMedia","destroy","fetchMessages","answerCallbackButton","uploadProfilePhoto","fetchChats","sendWithCallback","msgClientLogin","updateProfile","updateUsername"];var Bn=n(44107);class xn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.AnswerCallbackButtonReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_AnswerCallbackButtonReq),this.msg=e}static parseMsg(e){return(new xn).decode(e.body())}}class Nn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.AnswerCallbackButtonRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_AnswerCallbackButtonRes),this.msg=e}static parseMsg(e){return(new Nn).decode(e.body())}}class On extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.DownloadMsgRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_DownloadMsgRes),this.msg=e}static parseMsg(e){return(new On).decode(e.body())}}class qn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.GenMsgIdReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_GenMsgIdReq),this.msg=e}static parseMsg(e){return(new qn).decode(e.body())}}class Hn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.GenMsgIdRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_GenMsgIdRes),this.msg=e}static parseMsg(e){return(new Hn).decode(e.body())}}class jn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.SendBotMsgReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_SendBotMsgReq),this.msg=e}static parseMsg(e){return(new jn).decode(e.body())}}class Fn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.SendBotMsgRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_SendBotMsgRes),this.msg=e}static parseMsg(e){return(new Fn).decode(e.body())}}class Gn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.UpdateCmdReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateCmdReq),this.msg=e}static parseMsg(e){return(new Gn).decode(e.body())}}class Ln extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.UpdateCmdRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateCmdRes),this.msg=e}static parseMsg(e){return(new Ln).decode(e.body())}}class $n extends _n.ZP{constructor(e){var t,n,s;super("PTP.Msg.UploadMsgReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UploadMsgReq),this.msg=e}static parseMsg(e){return(new $n).decode(e.body())}}class Kn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Common.PbMsg",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.msg=e}static parseMsg(e){return(new Kn).decode(e.body())}}class zn extends _n.ZP{constructor(e){var t,n,s;super("PTP.Common.PbUser",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.msg=e}static parseMsg(e){return(new zn).decode(e.body())}}class Wn extends _n.ZP{constructor(e){var t,n,s;super("PTP.User.DownloadUserRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_DownloadUserRes),this.msg=e}static parseMsg(e){return(new Wn).decode(e.body())}}class Vn extends _n.ZP{constructor(e){var t,n,s;super("PTP.User.UploadUserReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UploadUserReq),this.msg=e}static parseMsg(e){return(new Vn).decode(e.body())}}function Zn(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jn(e){return new Promise(((t,n)=>{const s=new FileReader;s.onload=e=>{const{result:s}=e.target||{};"string"==typeof s&&t(s),n(new Error("Failed to read blob"))},s.onerror=n,s.readAsDataURL(e)}))}async function Qn(e){return(await fetch(e)).blob()}async function Yn(e,t){return function(e,t){return new File([e],t,{lastModified:Date.now(),type:e.type})}(await Qn(e),t)}n(48764).Buffer,"undefined"==typeof File&&(self.File=class extends Blob{constructor(e,t,n){if(n){const{type:t,...s}=n;super(e,{type:t}),Zn(this,"name",void 0),Object.assign(this,s)}else super(e),Zn(this,"name",void 0);this.name=t}});var Xn=n(74766);class es extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.AuthLoginReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_AuthLoginReq),this.msg=e}static parseMsg(e){return(new es).decode(e.body())}}class ts extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.AuthNativeReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_AuthNativeReq),this.msg=e}static parseMsg(e){return(new ts).decode(e.body())}}class ns extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.InitAppRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_InitAppRes),this.msg=e}static parseMsg(e){return(new ns).decode(e.body())}}class ss extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UpdateProfileReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateProfileReq),this.msg=e}static parseMsg(e){return(new ss).decode(e.body())}}class is extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UpdateProfileRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateProfileRes),this.msg=e}static parseMsg(e){return(new is).decode(e.body())}}class os extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UpdateUsernameReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateUsernameReq),this.msg=e}static parseMsg(e){return(new os).decode(e.body())}}class as extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UpdateUsernameRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UpdateUsernameRes),this.msg=e}static parseMsg(e){return(new as).decode(e.body())}}class rs extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UploadProfilePhotoReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UploadProfilePhotoReq),this.msg=e}static parseMsg(e){return(new rs).decode(e.body())}}class cs extends _n.ZP{constructor(e){var t,n,s;super("PTP.Auth.UploadProfilePhotoRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_UploadProfilePhotoRes),this.msg=e}static parseMsg(e){return(new cs).decode(e.body())}}var ds=n(48764).Buffer;function us(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ls=function(e){return e[e.onConnectionStateChanged=0]="onConnectionStateChanged",e[e.onData=1]="onData",e}({}),fs=function(e){return e[e.connect_none=0]="connect_none",e[e.closed=1]="closed",e[e.connect_error=2]="connect_error",e[e.connecting=3]="connecting",e[e.connected=4]="connected",e[e.logged=5]="logged",e}({}),ps=0,hs=0,gs={},ms=null;class ys{constructor(e){us(this,"autoConnect",void 0),us(this,"client",void 0),us(this,"__rev_msg_map",void 0),us(this,"__sending_msg_map",void 0),us(this,"__msgHandler",void 0),us(this,"sendMsgTimer",void 0),us(this,"state",void 0),us(this,"msgConnId",void 0),us(this,"wsUrl",void 0),us(this,"session",void 0),ms=this,this.msgConnId=e,this.autoConnect=!0,this.sendMsgTimer=void 0,this.state=fs.connect_none,this.__rev_msg_map={},this.__sending_msg_map={}}setWsUrl(e){this.wsUrl=e}setSession(e){this.session=e}getState(){return this.state}getMsgConnId(){return this.msgConnId}getAutoConnect(){return this.autoConnect}setAutoConnect(e){this.autoConnect=e}async close(){this.notifyState(fs.closed),this.client&&this.isConnect()&&this.client.close()}connect(){if(this.wsUrl){if(this.state!==fs.logged&&this.state!==fs.connecting&&this.state!==fs.connected)try{console.log("connecting",this.msgConnId,this.wsUrl),this.notifyState(fs.connecting),this.client=new WebSocket(`${this.wsUrl}`),this.client.binaryType="arraybuffer",this.client.onopen=this.onConnected.bind(this),this.client.onmessage=this.onData.bind(this),this.client.onclose=this.onClose.bind(this)}catch(e){console.error("connect error",e),this.reconnect(this.getAutoConnect())}}else console.error("no ws url")}waitForMsgServerState(e,t=1e4,n=0){return new Promise((s=>{setTimeout((()=>{this.getState()===e?s(!0):t>0&&n>=t?s(!1):(n+=500,this.waitForMsgServerState(e,t,n).then(s))}),500)}))}waitTime(e=1e3,t=0){return new Promise((n=>{setTimeout((()=>{t>=e?n():(t+=1e3,this.waitTime(e,t).then(n))}),1e3)}))}setMsgHandler(e){this.__msgHandler=e}onConnected(){ps=0,console.log("[onConnected account]",this.getMsgConnId()),this.notifyState(fs.connected),this.login().catch(console.error)}async login(){await this.sendPduWithCallback(new es({clientInfo:Mn.Z.getCurrentAccount().getClientInfo(),sign:Mn.Z.getCurrentAccount()?.getSession()}).pack()),console.log("[onLogin]"),this.notifyState(fs.logged)}notify(e){this.__msgHandler&&this.__msgHandler(this.msgConnId,e)}onData(e){if(e.data&&e.data.byteLength&&e.data.byteLength>16){let t=new _n.es(ds.from(e.data));const n=t.getSeqNum();i.eMD&&console.log("[onData]",n,t.getCommandId(),(0,Bn.ZS)(t.getCommandId())),this.__sending_msg_map[n]?(this.__rev_msg_map[n]=t,delete this.__sending_msg_map[n]):this.__msgHandler&&this.notify([{action:ls.onData,payload:t}])}}notifyState(e){this.state=e,this.notify([{action:ls.onConnectionStateChanged,payload:{BotWebSocketState:e}}])}onClose(){this.sendMsgTimer&&clearTimeout(this.sendMsgTimer),console.log("onClose",this.autoConnect),this.notifyState(fs.closed),this.reconnect(this.getAutoConnect())}reconnect(e){e&&setTimeout((()=>{this.state!==fs.closed&&this.state!==fs.connect_error||(ps>20&&(ps=0),ps+=ps<5?1:2,console.log("[reconnect_cnt]",ps),this.connect())}),1e3*(ps+1))}static getInstance(e){return gs[e]||(gs[e]=new ys(e)),gs[e]}waitForMsgCallback(e,t=5e3,n=0){return new Promise(((s,i)=>{setTimeout((()=>{if(this.__rev_msg_map[e]){const t=this.__rev_msg_map[e];delete this.__rev_msg_map[e],s(t)}else n>=t?i("TIMEOUT"):(n+=200,this.isConnect()&&this.waitForMsgCallback(e,t,n).then(s).catch(i))}),200)}))}send(e){this.client.send(e)}sendPduWithCallback(e,t=1e4){return hs+=1,hs>1e5&&(hs=1),e.updateSeqNo(hs),new Promise(((n,s)=>{this.isConnect()?(i.eMD&&console.log("[sendPduWithCallback]",e.getSeqNum(),e.getCommandId(),(0,Bn.ZS)(e.getCommandId())),this.__sending_msg_map[e.getSeqNum()]=!0,this.send(e.getPbData()),this.waitForMsgCallback(e.getSeqNum(),t).then(n).catch(s)):(this.reconnect(this.autoConnect),s("BotWebSocketState is not connected"))}))}isLogged(){return[fs.logged].includes(this.state)}isConnect(){return[fs.connected,fs.logged].includes(this.state)}async destroy(){this.client.close(),this.setAutoConnect(!1),await this.waitForMsgServerState(fs.closed)}}function ws(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class bs{constructor(e){ws(this,"chatId",void 0),ws(this,"id",void 0),ws(this,"inlineButtons",void 0),ws(this,"senderId",void 0),ws(this,"isOutgoing",void 0),ws(this,"botInfo",void 0),ws(this,"content",void 0),this.chatId=e}setBotInfo(e){this.botInfo=e}async updateText(e,t){return this.update(e,{content:{text:{text:t}}})}setInlineButtons(e){return this.inlineButtons=e,this}setThinking(){return this.setText("...")}setText(e){let{content:t}=this;return t||(t={text:{text:""}}),t.text||(t={...t,text:{text:""}}),this.content={...t,text:{...t.text,text:e}},this}setSenderId(e){return this.senderId=e,this}async genMsgId(e){return bs.genMessageId(e)}async reply(){let{id:e,chatId:t,senderId:n,isOutgoing:s,content:i,inlineButtons:o}=this;n||(n=t),s||(s=!1),e||(e=await this.genMsgId());let a={chatId:t,id:e,senderId:n,isOutgoing:s,date:(0,Rn.q9)(),inlineButtons:o,content:i};return this.sendNewMessage(a)}async updateMessageSendSucceeded(e,t){return bs.apiUpdate({"@type":"updateMessageSendSucceeded",localId:e,chatId:this.chatId,message:t}),t}async update(e,t){return bs.apiUpdate({"@type":"updateMessage",id:e,chatId:this.chatId,message:t}),t}async sendNewMessage(e){const t=e.id;return t||(e.id=await bs.genMessageId()),bs.apiUpdate({"@type":"newMessage",chatId:this.chatId,id:t,message:e,shouldForceReply:!1}),e}static buildDefaultChat(e){return{id:e.id,title:e.firstName,type:"chatTypePrivate",isMuted:!1,isMin:!1,hasPrivateLink:!1,isSignaturesShown:!1,isVerified:!0,isJoinToSend:!0,isJoinRequest:!0,lastMessage:{id:0,chatId:e.id,isOutgoing:!1,date:Math.ceil(+new Date/1e3),content:{action:{type:"chatCreate",text:""}}},isForum:!1,isListed:!0,settings:{isAutoArchived:!1,canReportSpam:!1,canAddContact:!1,canBlockContact:!1},accessHash:""}}static buildMsgHistoryClear(e){return{id:0,chatId:e,isOutgoing:!1,date:(0,Rn.q9)(),content:{action:{text:"历史记录已清空",type:"historyClear",translationValues:[]}}}}static apiUpdate(e){bs._apiUpdate(e)}static setApiUpdate(e,t){bs._apiUpdate=e,bs.genMessageId=t}}ws(bs,"_apiUpdate",void 0),ws(bs,"genMessageId",void 0),ws(bs,"isWorker",!1);var vs=n(48764).Buffer;function As(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Is=[];class Ss{constructor({chat:e,msgSend:t,attachment:n,media:s,botInfo:i}){As(this,"botInfo",void 0),As(this,"chat",void 0),As(this,"msgSend",void 0),As(this,"media",void 0),As(this,"attachment",void 0),As(this,"chatMsg",void 0),this.botInfo=i,this.chat=e,this.media=s,this.msgSend=t,this.attachment=n,this.chatMsg=new bs(e.id)}static async handleSendBotMsgRes(e){const{reply:t,msgId:n,message:s,chatId:i}=Fn.parseMsg(e);console.log("[SendBotMsgRes]",t,s),t&&(n?await new bs(i).update(n,{content:{text:{text:t}}}):await new bs(i).setText(t).reply()),s&&(n?await new bs(i).update(n,s):await new bs(i).sendNewMessage(s))}static async handleInitAppRes(e){let{chats:t,messages:n,chatFolders:s}=ns.parseMsg(e);t&&(t=JSON.parse(t)),n&&(n=JSON.parse(n)),s&&(s=JSON.parse(s));for(let e=0;e<t?.length;e++)if(null!=t){const n=t[e];bs.apiUpdate({"@type":"updateChat",id:n.id,chat:n})}for(let e=0;e<s?.length;e++)if(null!=s){const t=s[e];bs.apiUpdate({"@type":"updateChatFolder",id:t.id,folder:t})}for(let e=0;e<n?.length;e++)if(null!=n){const t=n[e];await new bs(t.chatId).sendNewMessage(t)}console.log("handleInitAppRes",{chats:t,messages:n})}static async handleRecvMsg(e){switch(e.getCommandId()){case Bn.Qx.CID_SendBotMsgRes:await Ss.handleSendBotMsgRes(e);break;case Bn.Qx.CID_InitAppRes:await Ss.handleInitAppRes(e)}}static async createWsBot(e,t){if(t&&t.startsWith("ws")){const n=ys.getInstance(e);n.isLogged()||(n.setMsgHandler((async(t,n)=>{for(let t=0;t<n.length;t++){const{action:s,payload:i}=n[t];switch(s){case ls.onConnectionStateChanged:switch(i.BotWebSocketState){case fs.connected:case fs.closed:}break;case ls.onData:console.log("[onData]",{accountId:e,payload:i}),await Ss.handleRecvMsg(i)}}})),n.setWsUrl(t||i.d9v),n.setSession(Mn.Z.getCurrentAccount()?.getSession()),n.isConnect()||n.connect(),n.isConnect()&&!n.isLogged()&&await n.login(),await n.waitForMsgServerState(fs.logged))}}static async beforeUploadUserReq(e){const{users:t,...n}=Vn.parseMsg(e);if(t)for(let e=0;e<t?.length;e++)if(t){if(1===t.length&&t[0].user.photos&&t[0].user.photos.length>0){const e=t[0].user.photos[0];let n;if(e&&e.id&&(n=e.id),n){let e=await Sn.fetch(i.F9T,n,Sn.Type.ArrayBuffer);if(e){const t=Cn.dZ.parseMsg(new _n.es(vs.from(e)));if(!t||!t.file)break;await(0,Xn.uploadFileCache)(t.file)}}}const{time:n,user:s}=t[e];let o=vs.from(new zn(s).pack().getPbData());const a="Wai"+n.toString(),r=await Mn.Z.getCurrentAccount().encryptData(o,a),c=(0,_n._b)();(0,_n.K2)(c,r?.length+4+4+4+2),(0,_n.On)(c,1),(0,_n.K2)(c,n),(0,_n.K2)(c,0),(0,_n.mS)(c,r),t[e].buf=vs.from((0,_n._f)(c)),t[e].user=void 0}return new Vn({users:t,...n}).pack()}static async afterDownloadUserReq(e){const{users:t,...n}=Wn.parseMsg(e);if(t)for(let e=0;e<t?.length;e++)if(t){const{buf:n}=t[e],s=(0,_n.rI)(vs.from(n)),i=(0,_n.e2)(s),o=((0,_n.Mt)(s),(0,_n.e2)(s));(0,_n.e2)(s);let a=(0,_n.sB)(s,i-14);const r="Wai"+o.toString(),c=await Mn.Z.getCurrentAccount().decryptData(vs.from(a),r);t[e].user=zn.parseMsg(new _n.es(vs.from(c))),t[e].buf=void 0}return vs.from(new Wn({...n,users:t}).pack().getPbData())}static async afterDownloadMsgReq(e){const{messages:t,...n}=On.parseMsg(e);if(t)for(let e=0;e<t?.length;e++){const{buf:n}=t[e],s=(0,_n.rI)(vs.from(n)),i=(0,_n.e2)(s),o=((0,_n.Mt)(s),(0,_n.e2)(s));(0,_n.e2)(s);let a=(0,_n.sB)(s,i-14);const r="Wai"+o.toString(),c=await Mn.Z.getCurrentAccount().decryptData(vs.from(a),r);t[e].message=Kn.parseMsg(new _n.es(vs.from(c))),t[e].buf=void 0}return vs.from(new On({...n,messages:t}).pack().getPbData())}static async beforeUploadMsgReq(e){const{messages:t,...n}=$n.parseMsg(e);if(t){if(1===t.length){const{photo:e,voice:n,audio:s,document:o}=t[0].message.content;let a;if(e&&e.id?a=e.id:n&&n.id?a=n.id:s&&s.id?a=s.id:o&&o.id&&(a=o.id),a){let e=await Sn.fetch(i.F9T,a,Sn.Type.ArrayBuffer);if(e){const{file:t}=Cn.dZ.parseMsg(new _n.es(vs.from(e)));await(0,Xn.uploadFileCache)(t)}}}for(let e=0;e<t?.length;e++){const{time:n,message:s}=t[e];let i=vs.from(new Kn(s).pack().getPbData());const o="Wai"+n.toString(),a=await Mn.Z.getCurrentAccount().encryptData(i,o),r=(0,_n._b)();(0,_n.K2)(r,a?.length+4+4+4+2),(0,_n.On)(r,1),(0,_n.K2)(r,n),(0,_n.K2)(r,0),(0,_n.mS)(r,a),t[e].buf=vs.from((0,_n._f)(r)),t[e].message=void 0}}return new $n({messages:t,...n}).pack()}static async genMessageId(e){let t=e?Je():parseInt(Je().toString())%i.MPN;return Is.length>10&&(Is=Is.slice(Is.length-10)),Is.includes(t)?(await(0,H.sleep)(100),Ss.genMessageId(e)):(Is.push(t),t)}static async genMsgId(e){const{isLocal:t}=qn.parseMsg(e);return new Hn({messageId:await Ss.genMessageId(t)}).pack().getPbData()}static getMediaFileId(e){let t;return e&&e.file&&e.file.id&&(t=e.file.id.toString()),t}async handleMedia(){const{msgSend:e,attachment:t}=this;if(t){let n=Ss.getMediaFileId(this.media);if(e.content.photo||e.content.document){const s=async e=>({dataUri:await Jn(await Qn(e.thumbBlobUrl)),size:{width:e.quick.width,height:e.quick.height}});if(e.content.document&&(e.content.document.id=n,"image"===e.content.document.mimeType.split("/")[0])){const{size:n,dataUri:i}=await s(t);e.content.document.mediaType="photo",e.content.document.previewBlobUrl=void 0,e.content.document.thumbnail={...n,dataUri:i},e.content.document.mediaSize=n}if(e.content.photo){const{size:i,dataUri:o}=await s(t);e.content.photo={isSpoiler:e.content.photo.isSpoiler,id:n,thumbnail:{...i,dataUri:o},sizes:[{...i,type:"y"}]}}}e.content.voice&&(e.content.voice.id=n),e.content.audio&&(e.content.audio.id=n),this.msgSend=e}}async processOutGoing(){const{msgSend:e}=this,t=await Ss.genMessageId();let n={...e,id:t,isOutGoing:!1,sendingState:void 0};bs.apiUpdate({"@type":"updateMessageSendSucceeded",chatId:e.chatId,localId:e.id,message:n}),this.msgSend=n}async process(){const{msgSend:e,chat:t}=this;try{await this.handleMedia(),await this.processOutGoing()}catch(n){console.error(n),bs.apiUpdate({"@type":"updateMessageSendFailed",chatId:t.id,localId:e.id,error:n.message})}}}class Cs{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t="db"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this.db=e}put(e,t){this.db.cache[e]=t}get(e){return this.db.cache[e]}delete(e){delete this.db.cache[e]}}class Ps extends _n.ZP{constructor(e){var t,n,s;super("PTP.Other.StopChatStreamReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_StopChatStreamReq),this.msg=e}static parseMsg(e){return(new Ps).decode(e.body())}}const _s=3e4,Ms=(e,t)=>{let n=e.map((e=>({role:e.role,content:e.content})));return t?.filterBot&&(n=n.filter((e=>"assistant"!==e.role))),{model:"gpt-3.5-turbo",messages:n,stream:t?.stream}};async function Rs(e,t){Ms(t.body.messages,{stream:t.body.stream,filterBot:!1}),console.log("[Request] ",t.body);const n=new AbortController,s=setTimeout((()=>n.abort()),_s);let i=!1;try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+(Mn.Z.getCurrentAccount()?.getSession()||"")},body:JSON.stringify(t.body),signal:t.body.stream?n.signal:void 0});clearTimeout(s);let a="";const r=()=>{i=!0,t.onMessage&&t.onMessage(a,!0),n.abort()};if(o.ok){if(!t.body.stream)return r(),(await o.json()).choices[0].message.content;{const e=o.body?.getReader(),s=new TextDecoder;for(t.onController?.(n);;){const n=setTimeout((()=>r()),_s),i=await(e?.read());clearTimeout(n);const o=s.decode(i?.value);o.startsWith("ERROR:")&&t.onError&&t.onError(new Error(o.replace("ERROR:",""))),a+=o;const c=!i||i.done;if(t?.onMessage&&t?.onMessage(a,!1),c)break}r()}}else 401===o.status?(console.error("Anauthorized"),a="sign://401/你需要 点击下方生成签名登录, 并告知管理员,加入授权列表",r()):(console.error("Stream Error",o.body),t.onError&&t.onError(new Error("Stream Error")),r())}catch(e){20===e.code?i||(console.error("onAbort",e),t.onAbort&&t.onAbort(e)):(console.error("NetWork Error",e),t.onError&&t.onError(e))}}const Ds={controllers:{},addController(e,t,n){const s=this.key(e,t);return this.controllers[s]=n,s},stop(e,t){const n=this.key(e,t);if(this.controllers[n]){const e=this.controllers[n];console.log(e),e?.abort()}},remove(e,t){const n=this.key(e,t);delete this.controllers[n]},key:(e,t)=>`${e},${t}`},Ts=async(e,t,n,s)=>{const o=new Cs;o.init(a.ZP),Mn.Z.setClientKv(o);const r=Mn.Z.getInstance(e);r.setClientInfo(s),await r.setEntropy(t),Mn.Z.setCurrentAccountId(e),n?(r.saveSession(n),!ys.getInstance(e).isLogged()&&i.obR&&Ss.createWsBot(e,i.obR)):r.delSession()},ks=async e=>{const{accountId:t,entropy:n,session:s}=ts.parseMsg(e);await Ts(t,n,s)},Es=async e=>{const{msgId:t,chatId:n}=Ps.parseMsg(e);Ds.stop(n,t)},Us=async e=>{const t=Mn.Z.getCurrentAccount();let{botApi:n,chatId:s,msgId:o,chatGpt:a,text:r}=jn.parseMsg(e);try{if(!n||!n.startsWith("http")){const e=n?parseInt(s):Mn.Z.getCurrentAccountId();n||(n=i.U$4);const t=ys.getInstance(e);return t.isLogged()||await Ss.createWsBot(e,n),(await t.sendPduWithCallback(new jn({text:r,chatId:s,msgId:o,chatGpt:a}).pack())).getPbData()}if(n||(n=i.U$4),a){let e=n+"/v1/chat/completions";return await async function(e,t,n,s){Rs(e,{body:{...JSON.parse(t),msgId:s,chatId:n,stream:!0},onMessage:(e,t)=>{console.log(e);let i=[];if(e.startsWith("sign://401/"))return i=[[{text:"签名",data:"sign://401",type:"callback"}]],e=e.replace("sign://401/",""),void new bs(n).update(s,{content:{text:{text:e}},inlineButtons:i});new bs(n).update(s,{content:{text:{text:e}}}),t&&Ds.remove(parseInt(n),s)},onAbort:e=>{new bs(n).update(s,{content:{text:{text:"user abort"}}}),bs.apiUpdate({"@type":"updateGlobalUpdate",data:{action:"updateChatGptHistory",payload:{chatId:n,msgIdAssistant:void 0}}}),Ds.remove(parseInt(n),s)},onError:e=>{new bs(n).update(s,{content:{text:{text:e.message}}}),bs.apiUpdate({"@type":"updateGlobalUpdate",data:{action:"updateChatGptHistory",payload:{chatId:n,msgIdAssistant:void 0}}}),Ds.remove(parseInt(n),s)},onController:e=>{Ds.addController(parseInt(n),s,e)}}).catch(console.error)}(e,a,s,o),new Fn({reply:"..."}).pack().getPbData()}{let e=n+"/message";try{const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:`Bearer ${t.getSession()}`},body:JSON.stringify({chatId:s,msgId:o,text:r})});if(!n||200!==n.status)return;return new Fn({reply:await n.text()}).pack().getPbData()}catch(e){return new Fn({reply:"Error invoke api,"+e.message}).pack().getPbData()}}}catch(e){return void console.error(e)}},Bs=async e=>{const t=Mn.Z.getCurrentAccount(),{botApi:n,chatId:s}=Gn.parseMsg(e);if(n)try{if(n.startsWith("http")){const e=await fetch(n+"/commands",{method:"POST",headers:{Authorization:`Bearer ${t.getSession()}`}});if(!e||200!==e.status)return;const{commands:s}=await e.json();return new Ln({commands:s}).pack().getPbData()}{const e=ys.getInstance(parseInt(s));e.isLogged()||await Ss.createWsBot(parseInt(s),n);const t=await e.sendPduWithCallback(new Gn({chatId:s}).pack()),{commands:i}=Ln.parseMsg(t);return new Ln({commands:i}).pack().getPbData()}}catch(e){return void console.error(e)}};var xs=n(48764).Buffer;const Ns="Unknown UserAgent",Os="Unknown platform",qs="Z";let Hs,js;In.Logger.setLevel(i.jr7?"debug":"warn");let Fs,Gs,Ls=!1;async function $s(e=!1,t=!1){t||(0,a.pN)()}async function Ks(){}async function zs(e,t=!1,n=!1,s=!1,o,a=!1){if(Ls)try{i.eMD&&ne("INVOKE",e.className);const n=await js.invoke(e,o);return i.eMD&&ne("RESPONSE",e.className,n),s||function(e,t){let n,s;t instanceof r.Api.UpdatesCombined||t instanceof r.Api.Updates?n=t:"object"==typeof t&&"updates"in t&&(t.updates instanceof r.Api.Updates||t.updates instanceof r.Api.UpdatesCombined)?n=t.updates:(t instanceof r.Api.UpdateShortMessage||t instanceof r.Api.UpdateShortChatMessage||t instanceof r.Api.UpdateShort||t instanceof r.Api.UpdateShortSentMessage)&&(s=t),n?(function(e){const t=[...e.users,...e.chats];e.updates.forEach((e=>{t&&(e._entities=t)}))}(n),n.updates.forEach((t=>{pn(t,e)}))):s&&pn(s,e)}(e,n),t?n&&!0:n}catch(t){if(a)return;if(i.eMD&&(ne("INVOKE ERROR",e.className),console.debug("invokeRequest failed with payload",e),console.error(t)),n)throw t;return void function(e,t){const n=e.message.startsWith("A wait of")&&(t instanceof r.Api.messages.SendMessage||t instanceof r.Api.messages.SendMedia||t instanceof r.Api.messages.SendMultiMedia),{message:s}=e;Hs({"@type":"error",error:{message:s,isSlowMode:n,hasErrorKey:!0}})}(t,e)}else i.eMD&&ne("INVOKE ERROR",e.className,"Client is not connected")}async function Ws(e,t){try{return await Tn(e)}catch(t){if(t.message.startsWith("FILE_REFERENCE")){if(await Qs({url:e.url}))return Tn(e);i.eMD&&console.error("Failed to repair file reference",e.url)}throw t}}function Vs(e,t){return js.uploadFile({file:e,onProgress:t,workers:i.eLN})}function Zs(e){return js.updateTwoFaSettings(e)}async function Js(){const e=await zs(new r.Api.users.GetFullUser({id:new r.Api.InputUserSelf}));if(!(e&&e.users[0]instanceof r.Api.User))return;const t=e.users[0];t.photo instanceof r.Api.Photo&&(a.ZP.photos[t.photo.id.toString()]=t.photo),a.ZP.users[L(t.id,"user")]=t;const n=Vt(e);var s;s=n.id,Ve=s,function(e){gn({"@type":"updateCurrentUser",currentUser:e})}(n),Fs=n.id,Boolean(n.isPremium)}async function Qs({url:e}){const t=function(e){const t=e.startsWith("staticMap")?e.match(/(staticMap):([0-9-]+)(\?.+)/):e.startsWith("webDocument")?e.match(/(webDocument):(.+)/):e.match(/(avatar|profile|photo|msg|stickerSet|sticker|wallpaper|gif|document|videoAvatar)([-\d\w./]+)(?::\d+)?(\?size=\w+)?/);if(!t)return;const n=t[1],s=t[2];let i;const o=t[3],a=o?.replace("?size=","")||void 0;return i="avatar"===t[1]||"profile"===t[1]?ie(s):t[1],{mediaMatchType:n,entityType:i,entityId:s,sizeType:a,params:o}}(e);if(!t)return;const{entityType:n,entityId:s,mediaMatchType:i}=t;if("file"===i)return!1;if("msg"===n){const e=a.ZP.messages[s],t=e.id,n="channelId"in e.peerId?new r.Api.InputChannel({channelId:e.peerId.channelId,accessHash:a.ZP.chats[L(e.peerId.channelId,"channel")].accessHash}):void 0,i=await zs(n?new r.Api.channels.GetMessages({channel:n,id:[new r.Api.InputMessageID({id:t})]}):new r.Api.messages.GetMessages({id:[new r.Api.InputMessageID({id:t})]}));if(!i||i instanceof r.Api.messages.MessagesNotModified)return!1;const o=i.messages[0];return!(o instanceof r.Api.MessageEmpty||(J(o),0))}return!1}async function Ys(e){const t=Mn.Z.getCurrentAccount();let n=new _n.es(xs.from(e));switch(i.eMD&&console.log(n.getCommandId(),(0,Bn.ZS)(n.getCommandId())),n.getCommandId()){case Bn.Qx.CID_SendBotMsgReq:return await Us(n);case Bn.Qx.CID_UpdateCmdReq:return await Bs(n);case Bn.Qx.CID_StopChatStreamReq:return await Es(n);case Bn.Qx.CID_AuthNativeReq:return await ks(n);case Bn.Qx.CID_GenMsgIdReq:return await Ss.genMsgId(n);case Bn.Qx.CID_UploadMsgReq:n=await Ss.beforeUploadMsgReq(n);break;case Bn.Qx.CID_UploadUserReq:n=await Ss.beforeUploadUserReq(n)}if(!t.getSession())return;const s=await fetch(`${i.qHj}/proto`,{method:"POST",body:xs.from(n.getPbData()),headers:{Authorization:`Bearer ${t.getSession()}`}});if(!s||200!==s.status)return;const o=await s.arrayBuffer();let a=xs.from(o);const r=new _n.es(a);switch(r.getCommandId()){case Bn.Qx.CID_DownloadMsgRes:a=await Ss.afterDownloadMsgReq(r);break;case Bn.Qx.CID_DownloadUserRes:a=await Ss.afterDownloadUserReq(r)}return a}class Xs extends _n.ZP{constructor(e){var t,n,s;super("PTP.Chats.LoadChatsReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_LoadChatsReq),this.msg=e}static parseMsg(e){return(new Xs).decode(e.body())}}class ei extends _n.ZP{constructor(e){var t,n,s;super("PTP.Chats.LoadChatsRes",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(Bn.Qx.CID_LoadChatsRes),this.msg=e}static parseMsg(e){return(new ei).decode(e.body())}}async function ti({limit:e,offsetDate:t,archived:n,withPinned:s,lastLocalServiceMessage:i}){const o=await(Mn.Z.getCurrentAccount()?.sendPduWithCallback(new Xs({limit:e,offsetDate:t,archived:n,withPinned:s}).pack()));if(!o)return;const a=ei.parseMsg(o);if(!a||a.err!==Pn.wb.NO_ERROR)return;const r=JSON.parse(a.payload);return console.log("[LoadChatsRes]",r),r}function ni(e){const{id:t,accessHash:n,adminRights:s}=e;return re(t,n)instanceof r.Api.InputChannel?async function(e,t,n){const s=await zs(new r.Api.channels.GetFullChannel({channel:re(e,t)}));if(!(s&&s.fullChat instanceof r.Api.ChannelFull))return;const{about:i,onlineCount:o,exportedInvite:d,slowmodeSeconds:u,slowmodeNextSendDate:l,migratedFromChatId:f,migratedFromMaxId:p,canViewParticipants:h,canViewStats:g,linkedChatId:m,hiddenPrehistory:y,call:w,botInfo:b,availableReactions:v,defaultSendAs:A,requestsPending:I,recentRequesters:S,statsDc:C,participantsCount:_,stickerset:M,chatPhoto:R,participantsHidden:D}=s.fullChat;R instanceof r.Api.Photo&&(a.ZP.photos[R.id.toString()]=R);const T=d instanceof r.Api.ChatInviteExported?d.link:void 0,{members:k,users:U,userStatusesById:B}=h&&await Oi(e,t)||{},{members:x,users:N,userStatusesById:O}=h&&n&&await Oi(e,t,"kicked")||{},{members:q,users:H,userStatusesById:j}=h&&await Oi(e,t,"admin")||{},F=b?Ot(b):void 0;if(s?.chats?.length>1){zi(s);const[,e]=s.chats,t=Mt(e);t&&Gs({"@type":"updateChat",id:t.id,chat:t})}const G={...B,...O,...j};return{fullInfo:{...R instanceof r.Api.Photo&&{profilePhoto:P(R)},about:i,onlineCount:o,inviteLink:T,slowMode:u?{seconds:u,nextSendDate:l}:void 0,migratedFrom:f?{chatId:L(f,"chat"),maxMessageId:p}:void 0,canViewMembers:h,canViewStatistics:g,isPreHistoryHidden:y,members:k,kickedMembers:x,adminMembersById:q?c(q,"userId"):void 0,groupCallId:w?String(w.id):void 0,linkedChatId:m?L(m,"chat"):void 0,botCommands:F,enabledReactions:jt(v),sendAsId:A?$(A):void 0,requestsPending:I,recentRequesterIds:S?.map((e=>L(e,"user"))),statisticsDcId:C,stickerSet:M?E(M):void 0,areParticipantsHidden:D},users:[...U||[],...N||[],...H||[]],userStatusesById:G,groupCall:w?{chatId:e,isLoaded:!1,id:w.id.toString(),accessHash:w?.accessHash.toString(),participants:{},version:0,participantsCount:0,connectionState:"disconnected"}:void 0,membersCount:_}}(t,n,s):async function(e){const t=await zs(new r.Api.messages.GetFullChat({chatId:re(e)}));if(!(t&&t.fullChat instanceof r.Api.ChatFull))return;zi(t);const{about:n,participants:s,exportedInvite:i,botInfo:o,call:d,availableReactions:u,recentRequesters:l,requestsPending:f,chatPhoto:p}=t.fullChat;p instanceof r.Api.Photo&&(a.ZP.photos[p.id.toString()]=p);const h=Ut(s),g=h?h.filter((({isAdmin:e,isOwner:t})=>e||t)):void 0,m=o?Ot(o):void 0,y=i instanceof r.Api.ChatInviteExported?i.link:void 0,{users:w,userStatusesById:b}=Yt(t.users);return{fullInfo:{...p instanceof r.Api.Photo&&{profilePhoto:P(p)},about:n,members:h,adminMembersById:g?c(g,"userId"):void 0,canViewMembers:!0,botCommands:m,inviteLink:y,groupCallId:d?.id.toString(),enabledReactions:jt(u),requestsPending:f,recentRequesterIds:l?.map((e=>L(e,"user")))},users:w,userStatusesById:b,groupCall:d?{chatId:e,isLoaded:!1,id:d.id.toString(),accessHash:d.accessHash.toString(),connectionState:"disconnected",participantsCount:0,version:0,participants:{}}:void 0,membersCount:h?.length}}(t)}async function si(e){const{id:t,accessHash:n}=e,s=await zs(new r.Api.messages.GetPeerSettings({peer:ae(t,n)}));if(s)return X(s.users),{users:s.users.map(Zt).filter(Boolean),settings:Ht(s.settings)}}async function ii({query:e}){const t=await zs(new r.Api.contacts.Search({q:e}));if(!t)return;zi(t);const n=t.myResults.map($),s=t.chats.concat(t.users).map((e=>Mt(e))).filter(Boolean),i=t.users.map(Zt).filter((e=>Boolean(e)&&!e.isSelf));return{localChats:s.filter((e=>n.includes(e.id))),localUsers:i.filter((e=>n.includes(e.id))),globalChats:s.filter((e=>!n.includes(e.id))),globalUsers:i.filter((e=>!n.includes(e.id)))}}async function oi({type:e,user:t}){let n;if("self"===e||"user"===e){const s=await zs(new r.Api.users.GetUsers({id:["user"===e&&t?re(t.id,t.accessHash):new r.Api.InputUserSelf]}));if(!s||!s.length)return;[n]=s}else if("support"===e){const e=await zs(new r.Api.help.GetSupport);if(!e||!e.user)return;n=e.user}const s=Mt(n,"support"===e);if(s)return Gs({"@type":"updateChat",id:s.id,chat:s}),{chatId:s.id}}async function ai({chat:e,lastLocalMessage:t,noLastMessage:n}){const{id:s,accessHash:i}=e,o=await zs(new r.Api.messages.GetPeerDialogs({peers:[new r.Api.InputDialogPeer({peer:ae(s,i)})]}));if(!o)return;const a=o.dialogs[0];if(!(a&&a instanceof r.Api.Dialog))return;const c=function(e,t){const n={};return e.chats?.forEach((e=>{const s=`chat${e.id}`;t?.[s],n[s]=e})),e.users?.forEach((e=>{const s=`user${e.id}`;t?.[s],n[s]=e})),n}(o),d=c[(u=a.peer,F(u)?`user${u.userId}`:G(u)?`chat${u.chatId}`:`chat${u.channelId}`)];var u;if(!d)return;zi(o);const l=Ye(o.messages[0]),f=t&&(!l||t.date>l.date)?t:l;Gs({"@type":"updateChat",id:s,chat:{...St(a,d),...!n&&{lastMessage:f}}})}function ri({chat:e,text:t,entities:n,threadId:s,replyToMsgId:i}){return zs(new r.Api.messages.SaveDraft({peer:ae(e.id,e.accessHash),message:t,...n&&{entities:n.map(ge)},replyToMsgId:i,topMsgId:s}))}function ci(e,t){return zs(new r.Api.messages.SaveDraft({peer:ae(e.id,e.accessHash),message:"",...t&&{topMsgId:t}}))}async function di({chat:e,isMuted:t}){await zs(new r.Api.account.UpdateNotifySettings({peer:new r.Api.InputNotifyPeer({peer:ae(e.id,e.accessHash)}),settings:new r.Api.InputPeerNotifySettings({muteUntil:t?i.PT8:0})})),Gs({"@type":"updateNotifyExceptions",chatId:e.id,isMuted:t}),ai({chat:e,noLastMessage:!0})}async function ui({chat:e,topicId:t,isMuted:n}){await zs(new r.Api.account.UpdateNotifySettings({peer:new r.Api.InputNotifyForumTopic({peer:ae(e.id,e.accessHash),topMsgId:t}),settings:new r.Api.InputPeerNotifySettings({muteUntil:n?i.PT8:0})})),Gs({"@type":"updateTopicNotifyExceptions",chatId:e.id,topicId:t,isMuted:n})}async function li({title:e,about:t="",users:n},s=!1){const o=await zs(new r.Api.channels.CreateChannel({broadcast:!0,title:e,about:t}),void 0,!0);if(!(o instanceof r.Api.Updates))return void(i.eMD&&console.error("Unexpected channel creation update",o));const a=o.chats[0];if(!(a&&a instanceof r.Api.Channel))return void(i.eMD&&console.error("Created channel not found",o));const c=Mt(a);if(n?.length)try{await zs(new r.Api.channels.InviteToChannel({channel:re(c.id,c.accessHash),users:n.map((({id:e,accessHash:t})=>re(e,t)))}),void 0,s)}catch(e){}return c}function fi({channelId:e,accessHash:t}){return zs(new r.Api.channels.JoinChannel({channel:re(e,t)}),!0,!0)}function pi({chat:e,user:t}){if("chatTypeBasicGroup"===e.type)return zs(new r.Api.messages.DeleteChatUser({chatId:re(e.id,e.accessHash),userId:re(t.id,t.accessHash)}),!0)}function hi({chatId:e}){return zs(new r.Api.messages.DeleteChat({chatId:re(e)}),!0)}function gi({channelId:e,accessHash:t}){return zs(new r.Api.channels.LeaveChannel({channel:re(e,t)}),!0)}function mi({channelId:e,accessHash:t}){return zs(new r.Api.channels.DeleteChannel({channel:re(e,t)}),!0)}async function yi({title:e,users:t}){const n=await zs(new r.Api.messages.CreateChat({title:e,users:t.map((({id:e,accessHash:t})=>re(e,t)))}),void 0,!0);if(!(n instanceof r.Api.Updates))return void(i.eMD&&console.error("Unexpected chat creation update",n));const s=n.chats[0];if(s&&s instanceof r.Api.Chat)return Mt(s);i.eMD&&console.error("Created chat not found",n)}async function wi({chatId:e,accessHash:t,photo:n}){const s=re(e,t);let i;if(n instanceof File){const e=await Vs(n);i=new r.Api.InputChatUploadedPhoto({file:e})}else if(n){const e=ye(n);if(!e)return!1;i=new r.Api.InputChatPhoto({id:e})}else i=new r.Api.InputChatPhotoEmpty;return zs(s instanceof r.Api.InputChannel?new r.Api.channels.EditPhoto({channel:s,photo:i}):new r.Api.messages.EditChatPhoto({chatId:s,photo:i}),!0)}async function bi({chat:e,shouldBePinned:t}){const{id:n,accessHash:s}=e;await zs(new r.Api.messages.ToggleDialogPin({peer:new r.Api.InputDialogPeer({peer:ae(n,s)}),pinned:t||void 0}))&&Gs({"@type":"updateChatPinned",id:e.id,isPinned:t})}function vi({chat:e,folderId:t}){const{id:n,accessHash:s}=e;return zs(new r.Api.folders.EditPeerFolders({folderPeers:[new r.Api.InputFolderPeer({peer:ae(n,s),folderId:t})]}),!0)}async function Ai(){const e=await zs(new r.Api.messages.GetDialogFilters);if(!e)return;const t=e.findIndex((e=>e instanceof r.Api.DialogFilterDefault)),n=e.filter((e=>e instanceof r.Api.DialogFilter)),s=n.map((({id:e})=>e));return-1!==t&&s.splice(t,0,i.NfV),{byId:c(n.map(xt),"id"),orderedIds:s}}async function Ii(){const e=await zs(new r.Api.messages.GetSuggestedDialogFilters);if(e)return e.map(Nt).filter(Boolean)}async function Si({id:e,folderUpdate:t}){t.excludedChatIds&&(t.excludedChatIds=t.excludedChatIds.filter((e=>!t.includedChatIds.includes(e)))),Gs({"@type":"updateChatFolder",id:e,folder:t})}async function Ci(e){Gs({"@type":"updateChatFolder",id:e,folder:void 0})}function Pi(e){Gs({"@type":"updateChatFoldersOrder",orderedIds:e})}async function _i({chat:e,hasUnreadMark:t}){const{id:n,accessHash:s}=e;await zs(new r.Api.messages.MarkDialogUnread({peer:new r.Api.InputDialogPeer({peer:ae(n,s)}),unread:t||void 0}))&&Gs({"@type":"updateChat",id:e.id,chat:{hasUnreadMark:t}})}async function Mi(e){return Di(await zs(new r.Api.contacts.ResolvePhone({phone:e})))}async function Ri(e){return Di(await zs(new r.Api.contacts.ResolveUsername({username:e})))}function Di(e){if(!e)return;const{users:t,chats:n}=e,s=n.length?Mt(n[0]):Mt(t[0]);return s?(zi(e),{chat:s,user:Zt(t[0])}):void 0}function Ti({chat:e,isEnabled:t}){const{id:n,accessHash:s}=e,i=re(n,s);return zs(new r.Api.channels.TogglePreHistoryHidden({channel:i,enabled:t}),!0)}function ki({chat:e,bannedRights:t}){const{id:n,accessHash:s}=e,i=ae(n,s);return zs(new r.Api.messages.EditChatDefaultBannedRights({peer:i,bannedRights:be(t)}),!0)}function Ei({chat:e,user:t,bannedRights:n,untilDate:s}){const i=re(e.id,e.accessHash),o=ae(t.id,t.accessHash);return zs(new r.Api.channels.EditBanned({channel:i,participant:o,bannedRights:be(n,s)}),!0)}function Ui({chat:e,user:t,adminRights:n,customTitle:s=""}){const i=re(e.id,e.accessHash),o=re(t.id,t.accessHash);return zs(new r.Api.channels.EditAdmin({channel:i,userId:o,adminRights:ve(n),rank:s}),!0)}async function Bi(e,t){const n=re(e.id,e.accessHash);await zs(n instanceof r.Api.InputChannel?new r.Api.channels.EditTitle({channel:n,title:t}):new r.Api.messages.EditChatTitle({chatId:n,title:t}),!0)}async function xi(e,t){await zs(new r.Api.messages.EditChatAbout({peer:ae(e.id,e.accessHash),about:t}))&&Gs({"@type":"updateChatFullInfo",id:e.id,fullInfo:{about:t}})}function Ni({chat:e,isEnabled:t}){const{id:n,accessHash:s}=e,i=re(n,s);return zs(new r.Api.channels.ToggleSignatures({channel:i,enabled:t}),!0)}async function Oi(e,t,n="recent",s){let o;switch(n){case"kicked":o=new r.Api.ChannelParticipantsKicked({q:""});break;case"admin":o=new r.Api.ChannelParticipantsAdmins;break;default:o=new r.Api.ChannelParticipantsRecent}const a=await zs(new r.Api.channels.GetParticipants({channel:re(e,t),filter:o,offset:s,limit:i.mok}));if(!a||a instanceof r.Api.channels.ChannelParticipantsNotModified)return;zi(a);const{users:c,userStatusesById:d}=Yt(a.users);return{members:Ut(a),users:c,userStatusesById:d}}async function qi(){const e=await zs(new r.Api.channels.GetGroupsForDiscussion);if(e)return zi(e),e.chats.map((e=>Mt(e)))}function Hi({channel:e,chat:t}){return zs(new r.Api.channels.SetDiscussionGroup({broadcast:ae(e.id,e.accessHash),group:t?ae(t.id,t.accessHash):new r.Api.InputChannelEmpty}),!0)}async function ji(e){const t=await zs(new r.Api.messages.MigrateChat({chatId:re(e.id)}),void 0,!0);if(t&&t instanceof r.Api.Updates)return zi(t),Mt(t.chats[1]);i.eMD&&console.error("Unexpected channel creation update",t)}async function Fi(e){const t=await zs(new r.Api.messages.CheckChatInvite({hash:e}));if(!t)return;let n;if(t instanceof r.Api.ChatInvite){const{photo:n,participantsCount:s,title:i,channel:o,requestNeeded:a,about:c,megagroup:d}=t;n instanceof r.Api.Photo&&Q(t.photo),Gs({"@type":"showInvite",data:{title:i,about:c,hash:e,participantsCount:s,isChannel:o&&!d,isRequestNeeded:a,...n instanceof r.Api.Photo&&{photo:P(n)}}})}else n=Mt(t.chat),n&&Gs({"@type":"updateChat",id:n.id,chat:n});return n?{chatId:n.id}:void 0}async function Gi(e,t,n=!1){try{return"chatTypeChannel"===e.type||"chatTypeSuperGroup"===e.type?await zs(new r.Api.channels.InviteToChannel({channel:re(e.id,e.accessHash),users:t.map((e=>re(e.id,e.accessHash)))}),!0,n):await Promise.all(t.map((t=>zs(new r.Api.messages.AddChatUser({chatId:re(e.id),userId:re(t.id,t.accessHash)}),!0,n))))}catch(e){return}}function Li(e,t){return"chatTypeChannel"===e.type||"chatTypeSuperGroup"===e.type?Ei({chat:e,user:t,bannedRights:{viewMessages:!0,sendMessages:!0,sendMedia:!0,sendStickers:!0,sendGifs:!0,sendGames:!0,sendInline:!0,embedLinks:!0,sendPolls:!0,changeInfo:!0,inviteUsers:!0,pinMessages:!0,manageTopics:!0,sendPhotos:!0,sendVideos:!0,sendRoundvideos:!0,sendAudios:!0,sendVoices:!0,sendDocs:!0,sendPlain:!0},untilDate:i.PT8}):zs(new r.Api.messages.DeleteChatUser({chatId:re(e.id),userId:re(t.id,t.accessHash)}),!0)}function $i(e,t){return zs(new r.Api.channels.ToggleJoinToSend({channel:re(e.id,e.accessHash),enabled:t}),!0)}function Ki(e,t){return zs(new r.Api.channels.ToggleJoinRequest({channel:re(e.id,e.accessHash),enabled:t}),!0)}function zi(e){"users"in e&&X(e.users),"chats"in e&&X(e.chats),"messages"in e&&e.messages.forEach((e=>{e instanceof r.Api.Message&&me(e)&&J(e)}))}async function Wi({hash:e}){const t=await zs(new r.Api.messages.ImportChatInvite({hash:e}));if(t instanceof r.Api.Updates&&t.chats.length)return Mt(t.chats[0])}function Vi({chat:e,enabledReactions:t}){return zs(new r.Api.messages.SetChatAvailableReactions({peer:ae(e.id,e.accessHash),availableReactions:(n=t,"all"===n?.type?new r.Api.ChatReactionsAll({allowCustom:n.areCustomAllowed}):"some"===n?.type?new r.Api.ChatReactionsSome({reactions:n.allowed.map(Re)}):new r.Api.ChatReactionsNone)}),!0);var n}function Zi({chat:e,isProtected:t}){const{id:n,accessHash:s}=e;return zs(new r.Api.messages.ToggleNoForwards({peer:ae(n,s),enabled:t}),!0)}function Ji({chat:e,isEnabled:t}){const{id:n,accessHash:s}=e;return zs(new r.Api.channels.ToggleParticipantsHidden({channel:ae(n,s),enabled:t}),!0)}function Qi({chat:e,isEnabled:t}){const{id:n,accessHash:s}=e;return zs(new r.Api.channels.ToggleForum({channel:ae(n,s),enabled:t}),!0)}async function Yi({chat:e,title:t,iconColor:n,iconEmojiId:s,sendAs:i}){const{id:o,accessHash:a}=e,c=await zs(new r.Api.channels.CreateForumTopic({channel:ae(o,a),title:t,iconColor:n,iconEmojiId:s?q()(s):void 0,sendAs:i?ae(i.id,i.accessHash):void 0,randomId:fe()}));if(c instanceof r.Api.Updates&&c.updates.length)return c.updates?.find((e=>e instanceof r.Api.UpdateMessageID))?.id}async function Xi({chat:e,query:t,offsetTopicId:n,offsetId:s,offsetDate:o,limit:a=i.C1M}){const{id:c,accessHash:d}=e,u=await zs(new r.Api.channels.GetForumTopics({channel:ae(c,d),limit:a,q:t,offsetTopic:n,offsetId:s,offsetDate:o}));if(!u)return;zi(u);const{count:l,orderByCreateDate:f}=u;return{topics:u.topics.map(Gt).filter(Boolean),messages:u.messages.map(Ye).filter(Boolean),users:u.users.map(Zt).filter(Boolean),chats:u.chats.map((e=>Mt(e))).filter(Boolean),count:l+1,shouldOrderByCreateDate:f,draftsById:u.topics.reduce(((e,t)=>(t instanceof r.Api.ForumTopic&&t.draft&&(e[t.id]=ct(t.draft)),e)),{}),readInboxMessageIdByTopicId:u.topics.reduce(((e,t)=>(t instanceof r.Api.ForumTopic&&t.readInboxMaxId&&(e[t.id]=t.readInboxMaxId),e)),{})}}async function eo({chat:e,topicId:t}){const{id:n,accessHash:s}=e,i=await zs(new r.Api.channels.GetForumTopicsByID({channel:ae(n,s),topics:[t]}));if(!(i?.topics.length&&i.topics[0]instanceof r.Api.ForumTopic))return;zi(i);const o=i.messages.map(Ye).filter(Boolean),a=i.users.map(Zt).filter(Boolean),c=i.chats.map((e=>Mt(e))).filter(Boolean);return{topic:Gt(i.topics[0]),messages:o,users:a,chats:c}}function to({chat:e,topicId:t}){const{id:n,accessHash:s}=e;return zs(new r.Api.channels.DeleteTopicHistory({channel:ae(n,s),topMsgId:t}),!0)}function no({chat:e,topicId:t,isPinned:n}){const{id:s,accessHash:i}=e;return zs(new r.Api.channels.UpdatePinnedForumTopic({channel:ae(s,i),topicId:t,pinned:n}),!0)}function so({chat:e,topicId:t,title:n,iconEmojiId:s,isClosed:o,isHidden:a}){const{id:c,accessHash:d}=e;return zs(new r.Api.channels.EditForumTopic({channel:ae(c,d),topicId:t,title:n,iconEmojiId:t!==i.OxA&&s?q()(s):void 0,closed:o,hidden:a}),!0)}var io=n(48764).Buffer;const oo=63;let ao;async function ro({chat:e,threadId:t,offsetId:n,lastMessageId:s,isUp:i,...o}){}async function co({chat:e,messageId:t}){const n="channel"===ie(e.id);let s;try{s=await zs(n?new r.Api.channels.GetMessages({channel:re(e.id,e.accessHash),id:[new r.Api.InputMessageID({id:t})]}):new r.Api.messages.GetMessages({id:[new r.Api.InputMessageID({id:t})]}),void 0,!0)}catch(e){const{message:t}=e;"CHANNEL_PRIVATE"!==t&&ao({"@type":"error",error:{message:t,isSlowMode:!1,hasErrorKey:!0}})}if(!s||s instanceof r.Api.messages.MessagesNotModified)return;const i=s.messages[0];if(!i)return;if(i instanceof r.Api.MessageEmpty)return m;const o=i&&Ye(i);return o?(i instanceof r.Api.Message&&J(i),{message:o,users:s.users.map(Zt).filter(Boolean)}):void 0}let uo=Promise.resolve();function lo({chat:e,text:t,entities:n,replyingTo:s,replyingToTopId:o,attachment:c,sticker:d,gif:u,poll:l,contact:p,isSilent:h,scheduledAt:g,groupedId:m,noWebPage:y,sendAs:w,shouldUpdateStickerSetsOrder:b,botInfo:v},A){const I=function(e,t,n,s,o,a,r,c,d,u,l,p,h){const g=Je(),m=a&&function(e){const{filename:t,blobUrl:n,previewBlobUrl:s,mimeType:o,size:a,audio:r,shouldSendAsFile:c,shouldSendAsSpoiler:d}=e;if(!c){if(e.quick){if(i.oGt.has(o)){const{width:t,height:s}=e.quick;return{photo:{id:ze,sizes:[],thumbnail:{width:t,height:s,dataUri:n},blobUrl:n,isSpoiler:d}}}if(i.wGh.has(o)){const{width:i,height:r,duration:c}=e.quick;return{video:{id:ze,mimeType:o,duration:c||0,fileName:t,width:i,height:r,blobUrl:n,...s&&{thumbnail:{width:i,height:r,dataUri:s}},size:a,isSpoiler:d}}}}if(e.voice){const{duration:t,waveform:n}=e.voice,{data:s}=N(n,We);return{voice:{id:ze,duration:t,waveform:s}}}if(i.e74.has(o)){const{duration:e,performer:n,title:s}=r||{};return{audio:{id:ze,mimeType:o,fileName:t,size:a,duration:e||0,title:s,performer:n}}}}return{document:{mimeType:o,fileName:t,size:a,...s&&{previewBlobUrl:s}}}}(a),y="chatTypeChannel"===e.type,w=e.isForum,b={id:g,chatId:e.id,content:{...t&&{text:{text:t,entities:n}},...m,...r&&{sticker:r},...c&&{video:c},...d&&bt(d,g),...u&&{contact:u}},date:p||Math.round(Date.now()/1e3)+f(),isOutgoing:!y,senderId:h?.id||Ve,...s&&{replyToMessageId:s},...o&&{replyToTopMessageId:o},...(s||o)&&w&&{isTopicReply:!0},...l&&{groupedId:l,...m&&(m.photo||m.video)&&{isInAlbum:!0}},...p&&{isScheduled:!0},isForwardingAllowed:!0},v=Ge(b.content,b.groupedId);return{...b,...v&&{emojiOnlyCount:v}}}(e,t,n,s,o,c,d,u,l,p,m,g,w);ao({"@type":I.isScheduled?"newScheduledMessage":"newMessage",id:I.id,chatId:e.id,message:{...I,sendingState:"messageSendingStatePending"}});const S=fe();if(a.ZP.localMessages[String(S)]=I,m)return function({chat:e,text:t,entities:n,replyingTo:s,replyingToTopId:o,attachment:a,groupedId:r,isSilent:c,scheduledAt:d,sendAs:u},l,f,p){let h=-1;fo[r]||(fo[r]={counter:0,singleMediaByIndex:{}}),h=fo[r].counter++;const g=uo;return uo=(async()=>{let e;try{e=await go(f,a,p)}catch(e){return i.eMD&&console.warn(e),fo[r].counter--,void await g}if(await g,delete fo[r],p){let t;if(e&&e.file&&e.file.id&&(t=e.file.id.toString()),f.content.photo||f.content.document){const e=async e=>({dataUri:await Jn(await Qn(e.thumbBlobUrl)),size:{width:e.quick.width,height:e.quick.height}});if(f.content.document&&(f.content.document.id=t,"image"===f.content.document.mimeType.split("/")[0])){const{size:t,dataUri:n}=await e(a);f.content.document.mediaType="photo",f.content.document.previewBlobUrl=void 0,f.content.document.thumbnail={...t,dataUri:n},f.content.document.mediaSize=t}if(f.content.photo){const{size:n,dataUri:s}=await e(a);f.content.photo={isSpoiler:f.content.photo.isSpoiler,id:t,thumbnail:{...n,dataUri:s},sizes:[{...n,type:"y"}]}}}await p(2,f)}})(),uo}({chat:e,text:t,entities:n,replyingTo:s,replyingToTopId:o,attachment:c,groupedId:m,isSilent:h,scheduledAt:g},0,I,A);const C=uo;return uo=(async()=>{let t;if(c)try{t=await go(I,c,A)}catch(e){return i.eMD&&console.warn(e),void await C}else d?t=ue(d):u?t=ue(u):l?t=function(e,t){const{summary:n,quiz:s}=e,i=new r.Api.Poll({id:t,publicVoters:n.isPublic,question:n.question,answers:n.answers.map((({text:e,option:t})=>new r.Api.PollAnswer({text:e,option:te(t)}))),quiz:n.quiz,multipleChoice:n.multipleChoice});if(!s)return new r.Api.InputMediaPoll({poll:i});const o=s.correctAnswers.map(te),{solution:a}=s,c=s.solutionEntities?s.solutionEntities.map(ge):[];return new r.Api.InputMediaPoll({poll:i,correctAnswers:o,...a&&{solution:a,solutionEntities:c}})}(l,S):p&&(t=new r.Api.InputMediaContact({phoneNumber:p.phoneNumber,firstName:p.firstName,lastName:p.lastName,vcard:""}));await C,await new Ss({chat:e,msgSend:I,attachment:c,media:t,botInfo:v}).process()})(),uo}const fo={};async function po({chat:e,message:t,text:n,entities:s,noWebPage:i}){const o=1e3*t.date>Date.now()+1e3*f();let r={content:{...t.content,...n&&{text:{text:n,entities:s}}}};const c=Ge(r.content,r.groupedId);r={...r,emojiOnlyCount:c},ao({"@type":o?"updateScheduledMessage":"updateMessage",id:t.id,chatId:e.id,message:r}),a.ZP.localMessages[t.id]={...t,...r},s&&s.map(ge)}async function ho({chat:e,message:t,scheduledAt:n}){await zs(new r.Api.messages.EditMessage({peer:ae(e.id,e.accessHash),id:t.id,scheduleDate:n}),!0)}async function go(e,t,n){const{filename:s,blobUrl:o,encryptUrl:a,mimeType:c,quick:d,voice:u,audio:l,previewBlobUrl:f,shouldSendAsFile:p,shouldSendAsSpoiler:h}=t,g=t=>{n.isCanceled?g.isCanceled=!0:n(t,e)};let m;m=a?await Yn(a,"EN_"+s):await Yn(o,s);const y=await(0,Xn.uploadFileV1)({file:m,onProgress:g,workers:i.eLN}),w=[new r.Api.DocumentAttributeFilename({fileName:s})];if(!p){if(d){if(i.oGt.has(c)&&c!==i.s11)return new r.Api.InputMediaUploadedPhoto({file:y,spoiler:h});if(i.wGh.has(c)){const{width:e,height:t,duration:n}=d;void 0!==n&&w.push(new r.Api.DocumentAttributeVideo({duration:n,w:e,h:t,supportsStreaming:!0}))}}if(l){const{duration:e,title:t,performer:n}=l;w.push(new r.Api.DocumentAttributeAudio({duration:e,title:t,performer:n}))}if(u){const{duration:e,waveform:t}=u,{data:n}=N(t,oo);w.push(new r.Api.DocumentAttributeAudio({voice:!0,duration:e,waveform:io.from(n)}))}}return new r.Api.InputMediaUploadedDocument({file:y,mimeType:c,attributes:w,thumb:void 0,forceFile:p,spoiler:h})}async function mo({chat:e,messageId:t,isUnpin:n,isOneSide:s,isSilent:i}){await zs(new r.Api.messages.UpdatePinnedMessage({peer:ae(e.id,e.accessHash),id:t,...n&&{unpin:!0},...s&&{pmOneside:!0},...i&&{silent:!0}}),!0)}async function yo({chat:e,threadId:t}){await zs(new r.Api.messages.UnpinAllMessages({peer:ae(e.id,e.accessHash),...t&&{topMsgId:t}}),!0)}async function wo({chat:e,messageIds:t,shouldDeleteForAll:n}){const s="channel"===ie(e.id);ao({"@type":"deleteMessages",ids:t,chatId:e.id,...s&&{chatId:e.id}})}async function bo({chat:e,messageIds:t}){await zs(new r.Api.messages.DeleteScheduledMessages({peer:ae(e.id,e.accessHash),id:t}))&&ao({"@type":"deleteScheduledMessages",ids:t,chatId:e.id})}async function vo({chat:e,shouldDeleteForAll:t}){const n="channel"===ie(e.id),s=await zs(n?new r.Api.channels.DeleteHistory({channel:re(e.id,e.accessHash)}):new r.Api.messages.DeleteHistory({peer:ae(e.id,e.accessHash),...t&&{revoke:!0},...!t&&{just_clear:!0}}));s&&("offset"in s&&s.offset?await vo({chat:e,shouldDeleteForAll:t}):ao({"@type":"deleteHistory",chatId:e.id}))}async function Ao({peer:e,messageIds:t,reason:n,description:s}){return await zs(new r.Api.messages.Report({peer:ae(e.id,e.accessHash),id:t,reason:Se(n),message:s}))}async function Io({peer:e,threadId:t,action:n}){const s=function(e){switch(e.type){case"cancel":return new r.Api.SendMessageCancelAction;case"typing":return new r.Api.SendMessageTypingAction;case"recordAudio":return new r.Api.SendMessageRecordAudioAction;case"chooseSticker":return new r.Api.SendMessageChooseStickerAction;case"playingGame":return new r.Api.SendMessageGamePlayAction}}(n);if(s)try{return await zs(new r.Api.messages.SetTyping({peer:ae(e.id,e.accessHash),topMsgId:t,action:s}),void 0,!0)}catch(e){}else i.eMD&&console.warn("Unsupported message action",n)}async function So({chat:e,threadId:t,maxId:n=-1}){ie(e.id),Math.min(n,i.PT8),t===g?ai({chat:e,noLastMessage:!0}):_o({chat:e,threadId:t})}async function Co({chat:e,messageIds:t}){const n="channel"===ie(e.id);await zs(n?new r.Api.channels.ReadMessageContents({channel:re(e.id,e.accessHash),id:t}):new r.Api.messages.ReadMessageContents({id:t})),ao({...n?{"@type":"updateChannelMessages",channelId:e.id}:{"@type":"updateCommonBoxMessages"},ids:t,messageUpdate:{hasUnreadMention:!1,isMediaUnread:!1}})}async function Po({chat:e,ids:t}){const n=await zs(new r.Api.messages.GetMessagesViews({peer:ae(e.id,e.accessHash),id:t,increment:!1}));if(n)return t.map(((e,t)=>{const{views:s,forwards:i,replies:o}=n.views[t];return{id:e,views:s,forwards:i,messagesCount:o?.replies}}))}async function _o({chat:e,threadId:t,originChannelId:n}){if(t===g)return;const[s,i]=await Promise.all([zs(new r.Api.messages.GetDiscussionMessage({peer:ae(e.id,e.accessHash),msgId:Number(t)})),zs(new r.Api.messages.GetReplies({peer:ae(e.id,e.accessHash),msgId:Number(t),offsetId:1,addOffset:-1,limit:1}))]);if(!s||!s.messages.length)return;const o=Z(s.messages[0]);if(!o)return;const a=s.messages[s.messages.length-1].id;return ao({"@type":"updateThreadInfo",chatId:o,threadId:a,threadInfo:{threadId:a,topMessageId:a,lastReadInboxMessageId:s.readInboxMaxId,messagesCount:i instanceof r.Api.messages.ChannelMessages?i.count:void 0,lastMessageId:s.maxId,...n?{originChannelId:n}:void 0},firstMessageId:i&&"messages"in i&&i.messages.length?i.messages[0].id:void 0}),s.chats.map((e=>Mt(e))).filter(Boolean).forEach((e=>{ao({"@type":"updateChat",id:e.id,chat:e,noTopChatsRequest:!0})})),e.isForum&&ao({"@type":"updateTopic",chatId:e.id,topicId:t}),X(s.users),X(s.chats),{topMessageId:a,discussionChatId:o,users:s.users.map(Zt).filter(Boolean)}}async function Mo({chat:e,type:t,query:n,topMessageId:s,minDate:i,maxDate:o,...a}){let c;switch(t){case"media":c=new r.Api.InputMessagesFilterPhotoVideo;break;case"documents":c=new r.Api.InputMessagesFilterDocument;break;case"links":c=new r.Api.InputMessagesFilterUrl;break;case"audio":c=new r.Api.InputMessagesFilterMusic;break;case"voice":c=new r.Api.InputMessagesFilterRoundVoice;break;case"profilePhoto":c=new r.Api.InputMessagesFilterChatPhotos;break;default:c=new r.Api.InputMessagesFilterEmpty}const d=await zs(new r.Api.messages.Search({peer:ae(e.id,e.accessHash),topMsgId:s,filter:c,q:n||"",minDate:i,maxDate:o,...a}));if(!d||d instanceof r.Api.messages.MessagesNotModified||!d.messages)return;qo(d);const u=d.chats.map((e=>Mt(e))).filter(Boolean),l=d.users.map(Zt).filter(Boolean),f=d.messages.map(Ye).filter(Boolean);let p,h=f.length;return(d instanceof r.Api.messages.MessagesSlice||d instanceof r.Api.messages.ChannelMessages)&&(h=d.count,f.length&&(p=f[f.length-1].id)),{chats:u,users:l,messages:f,totalCount:h,nextOffsetId:p}}async function Ro({query:e,offsetRate:t=0,limit:n,type:s="text",minDate:o,maxDate:a}){let c;switch(s){case"media":c=new r.Api.InputMessagesFilterPhotoVideo;break;case"documents":c=new r.Api.InputMessagesFilterDocument;break;case"links":c=new r.Api.InputMessagesFilterUrl;break;case"audio":c=new r.Api.InputMessagesFilterMusic;break;case"voice":c=new r.Api.InputMessagesFilterRoundVoice;break;default:if(!(e||a&&o))return;c=new r.Api.InputMessagesFilterEmpty}const d=await zs(new r.Api.messages.SearchGlobal({q:e,offsetRate:t,offsetPeer:new r.Api.InputPeerEmpty,limit:n,filter:c,folderId:i.NfV,minDate:o,maxDate:a}));if(!d||d instanceof r.Api.messages.MessagesNotModified||!d.messages)return;qo({chats:d.chats,users:d.users,messages:d.messages});const u=d.chats.map((e=>Mt(e))).filter(Boolean),l=d.users.map(Zt).filter(Boolean),f=d.messages.map(Ye).filter(Boolean);let p,h=f.length;return(d instanceof r.Api.messages.MessagesSlice||d instanceof r.Api.messages.ChannelMessages)&&(h=d.count,f.length&&(p=f[f.length-1].id)),{messages:f,users:l,chats:u,totalCount:h,nextRate:"nextRate"in d&&d.nextRate?d.nextRate:p}}async function Do({message:e}){const t=await zs(new r.Api.messages.GetWebPagePreview({message:e}));return t&&gt(t)}async function To({chat:e,messageId:t,options:n}){const{id:s,accessHash:i}=e;await zs(new r.Api.messages.SendVote({peer:ae(s,i),msgId:t,options:n.map(te)}),!0)}async function ko({chat:e,messageId:t,poll:n}){const{id:s,accessHash:i}=e;await zs(new r.Api.messages.EditMessage({peer:ae(s,i),id:t,media:le(n,!0)}))}async function Eo({chat:e,messageId:t,option:n,offset:s,limit:i,shouldResetVoters:o}){const{id:a,accessHash:c}=e,d=await zs(new r.Api.messages.GetPollVotes({peer:ae(a,c),id:t,...n&&{option:te(n)},...s&&{offset:s},...i&&{limit:i}}));if(!d)return;qo({chats:[],users:d.users,messages:[]});const u=d.users.map(Zt).filter(Boolean),l=d.votes.map((e=>({userId:e.userId,date:e.date})));return{count:d.count,votes:l,users:u,nextOffset:d.nextOffset,shouldResetVoters:o}}async function Uo({chat:e,ids:t}){await zs(new r.Api.messages.GetExtendedMedia({peer:ae(e.id,e.accessHash),id:t}))}async function Bo({fromChat:e,toChat:t,toThreadId:n,messages:s,isSilent:i,scheduledAt:o,sendAs:r,withMyScore:c,noAuthors:d,noCaptions:u,isCurrentUserPremium:l}){s.map((({id:e})=>e));const p=s.map(fe);s.forEach(((e,s)=>{const i=function({toChat:e,toThreadId:t,message:n,scheduledAt:s,noAuthors:i,noCaptions:o,isCurrentUserPremium:a}){const r=Je(),{content:c,chatId:d,id:u,senderId:l,groupedId:p,isInAlbum:g}=n,m=c.audio,y=e.id===Ve&&(d!==e.id||n.forwardInfo)&&!m,w=Object.keys(c).length>1&&c.text&&o,b=!a,v=c.text?.entities&&b?{text:c.text.text,entities:c.text.entities.filter((e=>e.type!==h.CustomEmoji))}:c.text,A=Ge(c,p),I={...c,text:w?void 0:v};return{id:r,chatId:e.id,content:I,date:s||Math.round(Date.now()/1e3)+f(),isOutgoing:!y&&"chatTypeChannel"!==e.type,senderId:Ve,sendingState:"messageSendingStatePending",groupedId:p,isInAlbum:g,isForwardingAllowed:!0,replyToTopMessageId:t,...t&&e?.isForum&&{isTopicReply:!0},...A&&{emojiOnlyCount:A},...n.chatId!==Ve&&!m&&!i&&{forwardInfo:{date:n.date,isChannelPost:!1,fromChatId:d,fromMessageId:u,senderUserId:l}},...n.chatId===Ve&&!i&&{forwardInfo:n.forwardInfo},...s&&{isScheduled:!0}}}({toChat:t,toThreadId:n,message:e,scheduledAt:o,noAuthors:d,noCaptions:u,isCurrentUserPremium:l});a.ZP.localMessages[String(p[s])]=i,ao({"@type":i.isScheduled?"newScheduledMessage":"newMessage",id:i.id,chatId:t.id,message:i})}))}async function xo({chat:e,timestamp:t}){const n=await zs(new r.Api.messages.GetHistory({peer:ae(e.id,e.accessHash),offsetDate:t,addOffset:-1,limit:1}));if(n&&!(n instanceof r.Api.messages.MessagesNotModified)&&n.messages&&n.messages.length)return n.messages[0].id}async function No({chat:e}){const{id:t,accessHash:n}=e,s=await zs(new r.Api.messages.GetScheduledHistory({peer:ae(t,n)}));if(s&&!(s instanceof r.Api.messages.MessagesNotModified)&&s.messages)return qo(s),{messages:s.messages.map(Ye).filter(Boolean)}}async function Oo({chat:e,ids:t}){const{id:n,accessHash:s}=e;await zs(new r.Api.messages.SendScheduledMessages({peer:ae(n,s),id:t}),!0)}function qo(e){X(e.users),X(e.chats),e.messages.forEach((e=>{(e instanceof r.Api.Message&&me(e)||e instanceof r.Api.MessageService&&function(e){return"photo"in e.action&&e.action.photo instanceof r.Api.Photo}(e))&&J(e)}))}async function Ho({chat:e,threadId:t}){const n=await zs(new r.Api.messages.Search({peer:ae(e.id,e.accessHash),filter:new r.Api.InputMessagesFilterPinned,q:"",limit:i.tiD,topMsgId:t}));if(!n||n instanceof r.Api.messages.MessagesNotModified||!n.messages)return;qo(n);const s=n.chats.map((e=>Mt(e))).filter(Boolean),o=n.users.map(Zt).filter(Boolean);return{messages:n.messages.map(Ye).filter(Boolean),users:o,chats:s}}async function jo({chat:e,messageId:t}){const n=await zs(new r.Api.messages.GetMessageReadParticipants({peer:ae(e.id,e.accessHash),msgId:t}));return n?n.map(String):void 0}async function Fo({chat:e}){const t=await zs(new r.Api.channels.GetSendAs({peer:ae(e.id,e.accessHash)}),void 0,void 0,void 0,void 0,!0);if(t)return X(t.users),X(t.chats),{users:t.users.map(Zt).filter(Boolean),chats:t.chats.map((e=>Mt(e))).filter(Boolean),sendAs:t.peers.map(Ft)}}function Go({sendAs:e,chat:t}){return zs(new r.Api.messages.SaveDefaultSendAs({peer:ae(t.id,t.accessHash),sendAs:ae(e.id,e.accessHash)}))}async function Lo({chat:e}){const t=await zs(new r.Api.channels.GetSponsoredMessages({channel:ae(e.id,e.accessHash)}));if(t&&!(t instanceof r.Api.messages.SponsoredMessagesEmpty)&&t.messages.length)return qo(t),{messages:t.messages.map(Qe).filter(Boolean),users:t.users.map(Zt).filter(Boolean),chats:t.chats.map((e=>Mt(e))).filter(Boolean)}}async function $o({chat:e,random:t}){await zs(new r.Api.channels.ViewSponsoredMessage({channel:ae(e.id,e.accessHash),randomId:te(t)}))}function Ko({chat:e}){return zs(new r.Api.messages.ReadMentions({peer:ae(e.id,e.accessHash)}),!0)}function zo({chat:e}){return zs(new r.Api.messages.ReadReactions({peer:ae(e.id,e.accessHash)}),!0)}async function Wo({chat:e,...t}){const n=await zs(new r.Api.messages.GetUnreadMentions({peer:ae(e.id,e.accessHash),limit:i.CJw,...t}));if(n&&!(n instanceof r.Api.messages.MessagesNotModified)&&n.messages)return qo(n),{messages:n.messages.map(Ye).filter(Boolean),users:n.users.map(Zt).filter(Boolean),chats:n.chats.map((e=>Mt(e))).filter(Boolean)}}async function Vo({chat:e,...t}){const n=await zs(new r.Api.messages.GetUnreadReactions({peer:ae(e.id,e.accessHash),limit:i.pCG,...t}));if(n&&!(n instanceof r.Api.messages.MessagesNotModified)&&n.messages)return qo(n),{messages:n.messages.map(Ye).filter(Boolean),users:n.users.map(Zt).filter(Boolean),chats:n.chats.map((e=>Mt(e))).filter(Boolean)}}async function Zo({chat:e,messageId:t}){const n=await zs(new r.Api.messages.TranscribeAudio({msgId:t,peer:ae(e.id,e.accessHash)}));if(n)return ao({"@type":"updateTranscribedAudio",isPending:n.pending,transcriptionId:n.transcriptionId.toString(),text:n.text}),n.transcriptionId.toString()}async function Jo(e){let t;const n="chat"in e;if(n){const{chat:n,messageIds:s,messages:o,toLanguageCode:a}=e,r=n.id,c=await Rs(i.U$4+"/v1/chat/completions",{body:{...kn,apiKey:"",systemPrompt:"你现在是一名专业的翻译官",messages:[{role:"user",content:`我需要将：${o[s[0]].text},翻译成:${a},你的回答格式是：原文:xxx\n译文:xxx,不要做过多解释`}],chatId:r,msgId:0,stream:!1}});c&&(t={result:[{text:c,entities:[]}]})}else{const{text:n,toLanguageCode:s}=e;t=await zs(new r.Api.messages.TranslateText({text:n.map((e=>{return t=e,new r.Api.TextWithEntities({text:t.text,entities:t.entities?.map(ge)||[]});var t})),toLang:s}))}if(!t)return;const s=t.result.map((e=>function(e){const{text:t,entities:n}=e;return{text:t,entities:n.map(vt)}}(e)));return n&&ao({"@type":"updateMessageTranslations",chatId:e.chat.id,messageIds:e.messageIds,translations:s,toLanguageCode:e.toLanguageCode}),s}let Qo,Yo,Xo,ea;async function ta({id:e,accessHash:t}){const n=re(e,t);if(!(n instanceof r.Api.InputUser))return;const s=await zs(new r.Api.users.GetFullUser({id:n}));if(!s)return;pa(s),Y(s.users[0],!0),s.fullUser.profilePhoto instanceof r.Api.Photo&&(a.ZP.photos[s.fullUser.profilePhoto.id.toString()]=s.fullUser.profilePhoto),s.fullUser.personalPhoto instanceof r.Api.Photo&&(a.ZP.photos[s.fullUser.personalPhoto.id.toString()]=s.fullUser.personalPhoto),s.fullUser.fallbackPhoto instanceof r.Api.Photo&&(a.ZP.photos[s.fullUser.fallbackPhoto.id.toString()]=s.fullUser.fallbackPhoto);const i=s.fullUser.botInfo;i?.descriptionPhoto instanceof r.Api.Photo&&(a.ZP.photos[i.descriptionPhoto.id.toString()]=i.descriptionPhoto),i?.descriptionDocument instanceof r.Api.Document&&(a.ZP.documents[i.descriptionDocument.id.toString()]=i.descriptionDocument);const o=Vt(s),c=Zt(s.users[0]);return Qo({"@type":"updateUser",id:e,user:{...c,avatarHash:c?.avatarHash||void 0,fullInfo:o.fullInfo}}),o}async function na(e,t,n){const s=await zs(new r.Api.messages.GetCommonChats({userId:re(e,t),maxId:n?Ce(n,ie(n)):void 0,limit:i.tRq}));if(!s)return;pa(s);const o=[],a=[];return s.chats.forEach((e=>{const t=Mt(e);t&&(a.push(t),o.push(t.id))})),{chats:a,chatIds:o,isFullyLoaded:o.length<i.tRq}}async function sa(){const e=await zs(new r.Api.help.GetNearestDc);return e?.country}async function ia(){const e=await zs(new r.Api.contacts.GetTopPeers({correspondents:!0}));if(!(e instanceof r.Api.contacts.TopPeers))return;const t=e.users.map(Zt).filter((e=>Boolean(e)&&!e.isSelf));return{ids:t.map((({id:e})=>e)),users:t}}async function oa(){const e=await zs(new r.Api.contacts.GetContacts({hash:q()("0")}));if(!e||e instanceof r.Api.contacts.ContactsNotModified)return;e.users.forEach((e=>{e instanceof r.Api.User&&Y(e,!0)}));const{users:t,userStatusesById:n}=Yt(e.users);return{users:t,userStatusesById:n,chats:e.users.map((e=>Mt(e))).filter(Boolean)}}async function aa({users:e}){const t=await zs(new r.Api.users.GetUsers({id:e.map((({id:e,accessHash:t})=>ae(e,t)))}));if(t&&t.length)return t.forEach((e=>{e instanceof r.Api.User&&Y(e,!0)})),Yt(t)}async function ra({phone:e,firstName:t,lastName:n}){const s=await zs(new r.Api.contacts.ImportContacts({contacts:[we({phone:e||"",firstName:t||"",lastName:n||""})]}));return s instanceof r.Api.contacts.ImportedContacts&&s.users.length&&Y(s.users[0]),s?.imported.length?L(s.imported[0].userId,"user"):void 0}function ca({id:e,accessHash:t,phoneNumber:n="",firstName:s="",lastName:i="",shouldSharePhoneNumber:o=!1}){return zs(new r.Api.contacts.AddContact({id:re(e,t),firstName:s,lastName:i,phone:n,...o&&{addPhonePrivacyException:o}}),!0)}async function da({id:e,accessHash:t}){const n=re(e,t);n instanceof r.Api.InputUser&&await zs(new r.Api.contacts.DeleteContacts({id:[n]}))&&Qo({"@type":"deleteContact",id:e})}async function ua(e,t){if(e){const{id:t,accessHash:n}=e,s=await zs(new r.Api.photos.GetUserPhotos({userId:re(t,n),limit:i.YUe,offset:0,maxId:q()("0")}));if(!s)return;return pa(s),{photos:s.photos.filter((e=>e instanceof r.Api.Photo)).map((e=>P(e))),users:s.users.map(Zt).filter(Boolean)}}const n=await Mo({chat:t,type:"profilePhoto",limit:i.YUe});if(!n)return;const{messages:s,users:o}=n;return{photos:s.map((e=>e.content.action.photo)).filter(Boolean),users:o}}function la(e){const{id:t,accessHash:n}=e;return zs(new r.Api.messages.ReportSpam({peer:ae(t,n)}),!0)}function fa(e,t){return zs(new r.Api.account.UpdateEmojiStatus({emojiStatus:De(e,t)}),!0)}function pa(e){"chats"in e&&X(e.chats),"photos"in e&&e.photos.forEach(Q),"users"in e&&X(e.users)}async function ha({hash:e="0"}){const t=await zs(new r.Api.messages.GetEmojiStickers({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.AllStickersNotModified))return t.sets.forEach((e=>{(e.thumbs?.length||e.thumbDocumentId)&&(a.ZP.stickerSets[String(e.id)]=e)})),{hash:String(t.hash),sets:t.sets.map(E)}}async function ga({hash:e="0"}){const t=await zs(new r.Api.messages.GetAllStickers({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.AllStickersNotModified))return t.sets.forEach((e=>{e.thumbs?.length&&(a.ZP.stickerSets[String(e.id)]=e)})),{hash:String(t.hash),sets:t.sets.map(E)}}async function ma({hash:e="0"}){const t=await zs(new r.Api.messages.GetRecentStickers({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.RecentStickersNotModified))return{hash:String(t.hash),stickers:x(t.stickers.slice(0,i.tK3))}}async function ya({hash:e="0"}){const t=await zs(new r.Api.messages.GetFavedStickers({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.FavedStickersNotModified))return{hash:String(t.hash),stickers:x(t.stickers)}}async function wa({hash:e="0"}){const t=await zs(new r.Api.messages.GetFeaturedStickers({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.FeaturedStickersNotModified))return{hash:String(t.hash),isPremium:Boolean(t.premium),sets:t.sets.map(U)}}async function ba(){const e=await zs(new r.Api.messages.GetFeaturedEmojiStickers({hash:q()(0)}));if(e&&!(e instanceof r.Api.messages.FeaturedStickersNotModified))return e.sets.forEach((({set:e})=>{e.thumbDocumentId&&(a.ZP.stickerSets[String(e.id)]=e)})),{isPremium:Boolean(e.premium),sets:e.sets.map(U)}}async function va({sticker:e,unfave:t}){const n=new r.Api.messages.FaveSticker({id:de(e),unfave:t});await zs(n)&&Yo({"@type":"updateFavoriteStickers"})}function Aa({sticker:e}){return zs(new r.Api.messages.SaveRecentSticker({id:de(e),unsave:!0}))}function Ia(){return zs(new r.Api.messages.ClearRecentStickers)}async function Sa({stickerSetInfo:e}){if("isMissing"in e)return;const t=await zs(new r.Api.messages.GetStickerSet({stickerset:"id"in e?ce(e.id,e.accessHash):(n=e.shortName,new r.Api.InputStickerSetShortName({shortName:n}))}),void 0,!0);var n;return t instanceof r.Api.messages.StickerSet?(a.ZP.stickerSets[String(t.set.id)]=t.set,{set:E(t.set),stickers:x(t.documents),packs:B(t.packs)}):void 0}async function Ca({documentId:e}){if(!e.length)return;const t=await zs(new r.Api.messages.GetCustomEmojiDocuments({documentId:e.map((e=>q()(e)))}));return t?x(t):void 0}async function Pa(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetAnimatedEmoji}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function _a(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetAnimatedEmojiAnimations}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function Ma(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetEmojiGenericAnimations}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function Ra(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetPremiumGifts}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function Da(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetEmojiDefaultTopicIcons}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function Ta(){const e=await zs(new r.Api.messages.GetStickerSet({stickerset:new r.Api.InputStickerSetEmojiDefaultStatuses}));if(e instanceof r.Api.messages.StickerSet)return{set:E(e.set),stickers:x(e.documents)}}async function ka({query:e,hash:t="0"}){const n=await zs(new r.Api.messages.SearchStickerSets({q:e,hash:q()(t)}));if(n&&!(n instanceof r.Api.messages.FoundStickerSetsNotModified))return{hash:String(n.hash),sets:n.sets.map(U)}}async function Ea({hash:e="0"}){const t=await zs(new r.Api.messages.GetSavedGifs({hash:q()(e)}));if(t&&!(t instanceof r.Api.messages.SavedGifsNotModified))return{hash:String(t.hash),gifs:ja(t.gifs)}}function Ua({gif:e,shouldUnsave:t}){return zs(new r.Api.messages.SaveGif({id:de(e),unsave:t}),!0)}async function Ba({stickerSetId:e,accessHash:t}){await zs(new r.Api.messages.InstallStickerSet({stickerset:ce(e,t)}))&&Yo({"@type":"updateStickerSet",id:e,stickerSet:{installedDate:Date.now()}})}async function xa({stickerSetId:e,accessHash:t}){await zs(new r.Api.messages.UninstallStickerSet({stickerset:ce(e,t)}))&&Yo({"@type":"updateStickerSet",id:e,stickerSet:{installedDate:void 0}})}async function Na({query:e,offset:t="",username:n=i.mVS}){if(!Xo){const e=await zs(new r.Api.contacts.ResolveUsername({username:n}));if(!(e&&e.users[0]instanceof r.Api.User))return;Xo=new r.Api.InputUser({userId:e.peer.userId,accessHash:e.users[0].accessHash})}const s=await zs(new r.Api.messages.GetInlineBotResults({bot:Xo,peer:new r.Api.InputPeerEmpty,query:e,offset:t}));if(!s)return;const o=s.results.map((e=>{if(e instanceof r.Api.BotInlineMediaResult)return e.document})).filter(Boolean);return{nextOffset:s.nextOffset,gifs:ja(o)}}async function Oa({emoji:e,hash:t="0"}){const n=await zs(new r.Api.messages.GetStickers({emoticon:e,hash:q()(t)}));if(n&&!(n instanceof r.Api.messages.StickersNotModified))return{stickers:x(n.stickers),hash:String(n.hash)}}async function qa({language:e,fromVersion:t}){const n=await zs(new r.Api.messages.GetEmojiKeywordsDifference({langCode:e,fromVersion:t}));if(n)return{language:n.langCode,version:n.version,keywords:n.keywords.reduce(((e,t)=>(e[t.keyword]=t.emoticons,e)),{})}}async function Ha(e="0"){const t=await zs(new r.Api.account.GetRecentEmojiStatuses({hash:q()(e)}));if(!t||t instanceof r.Api.account.EmojiStatusesNotModified)return;const n=t.statuses.slice(0,i.O58).map(Qt).filter(Boolean).map((({documentId:e})=>e)),s=await Ca({documentId:n});return{hash:String(t.hash),emojiStatuses:s}}function ja(e){return e.map((e=>{if(e instanceof r.Api.Document){const t=ut(e);if(t)return a.ZP.documents[String(e.id)]=e,t}})).filter(Boolean)}const Fa=new Set([i.WfZ,"USERNAME_INVALID"]);async function Ga({username:e}){try{return{result:await zs(new r.Api.channels.CheckUsername({channel:new r.Api.InputChannelEmpty,username:e}),void 0,!0),error:void 0}}catch(e){const t=e.message;if(Fa.has(t))return{result:!1,error:t};throw e}}async function La({chat:e,username:t}){const n=await zs(new r.Api.channels.UpdateUsername({channel:re(e.id,e.accessHash),username:t})),s=e.usernames?e.usernames.map((e=>e.isEditable?{...e,username:t}:e)):[{username:t,isEditable:!0,isActive:!0}];return n&&ea({"@type":"updateChat",id:e.id,chat:{usernames:s}}),n}async function $a({chat:e,usageLimit:t,expireDate:n}){const s=await zs(new r.Api.messages.ExportChatInvite({peer:ae(e.id,e.accessHash),usageLimit:t,expireDate:n}));if(s instanceof r.Api.ChatInviteExported)return ea({"@type":"updateChatFullInfo",id:e.id,fullInfo:{inviteLink:s.link}}),s.link}async function Ka({peer:e,admin:t,limit:n=0,isRevoked:s}){const i=await zs(new r.Api.messages.GetExportedChatInvites({peer:ae(e.id,e.accessHash),adminId:re(t.id,t.accessHash),limit:n,revoked:s||void 0}));if(i)return X(i.users),{invites:i.invites.filter((e=>e instanceof r.Api.ChatInviteExported)).map(qt),users:i.users.map(Zt).filter(Boolean)}}async function za({peer:e,isRevoked:t,link:n,expireDate:s,usageLimit:i,isRequestNeeded:o,title:a}){const c=await zs(new r.Api.messages.EditExportedChatInvite({link:n,peer:ae(e.id,e.accessHash),expireDate:s,usageLimit:o?void 0:i,requestNeeded:o,title:a,revoked:t||void 0}));if(c){if(X(c.users),c instanceof r.Api.messages.ExportedChatInvite&&c.invite instanceof r.Api.ChatInviteExported){const e=qt(c.invite);return{oldInvite:e,newInvite:e,users:c.users.map(Zt).filter(Boolean)}}if(c instanceof r.Api.messages.ExportedChatInviteReplaced&&c.invite instanceof r.Api.ChatInviteExported&&c.newInvite instanceof r.Api.ChatInviteExported)return{oldInvite:qt(c.invite),newInvite:qt(c.newInvite),users:c.users.map(Zt).filter(Boolean)}}}async function Wa({peer:e,expireDate:t,usageLimit:n,isRequestNeeded:s,title:i}){const o=await zs(new r.Api.messages.ExportChatInvite({peer:ae(e.id,e.accessHash),expireDate:t,usageLimit:s?void 0:n,requestNeeded:s||void 0,title:i}));if(o instanceof r.Api.ChatInviteExported)return qt(o)}async function Va({peer:e,link:t}){return await zs(new r.Api.messages.DeleteExportedChatInvite({peer:ae(e.id,e.accessHash),link:t}))}async function Za({peer:e,admin:t}){return await zs(new r.Api.messages.DeleteRevokedExportedChatInvites({peer:ae(e.id,e.accessHash),adminId:re(t.id,t.accessHash)}))}async function Ja({peer:e,link:t,offsetDate:n=0,offsetUser:s,limit:i=0,isRequested:o}){const a=await zs(new r.Api.messages.GetChatInviteImporters({peer:ae(e.id,e.accessHash),link:t,offsetDate:n,offsetUser:s?re(s.id,s.accessHash):new r.Api.InputUserEmpty,limit:i,requested:o||void 0}));if(!a)return;const d=a.users.map((e=>Zt(e))).filter(Boolean);return X(a.users),{importers:a.importers.map((e=>function(e){const{userId:t,date:n,about:s,requested:i}=e;return{userId:L(t,"user"),date:n,about:s,isRequested:i}}(e))),users:c(d,"id")}}function Qa({peer:e,user:t,isApproved:n}){return zs(new r.Api.messages.HideChatJoinRequest({peer:ae(e.id,e.accessHash),userId:re(t.id,t.accessHash),approved:n||void 0}),!0)}function Ya({peer:e,isApproved:t,link:n}){return zs(new r.Api.messages.HideAllChatJoinRequests({peer:ae(e.id,e.accessHash),approved:t||void 0,link:n}),!0)}function Xa(e){const{id:t,accessHash:n}=e;return zs(new r.Api.messages.HidePeerSettingsBar({peer:ae(t,n)}))}const er={EMAIL_UNCONFIRMED:"Email unconfirmed",EMAIL_HASH_EXPIRED:"Email hash expired",NEW_SALT_INVALID:"The new salt is invalid",NEW_SETTINGS_INVALID:"The new password settings are invalid",CODE_INVALID:"Invalid Code",PASSWORD_HASH_INVALID:"Invalid Password"},tr={};let nr,sr;async function ir(){const e=await zs(new r.Api.account.GetPassword);if(!e)return;const{hint:t,hasPassword:n}=e;return{hint:t,hasPassword:n}}function or(e){return nr({"@type":"updateTwoFaStateWaitCode",length:e}),new Promise(((e,t)=>{tr.resolve=e,tr.reject=t}))}async function ar(e){try{return await Zs({isCheckPassword:!0,currentPassword:e}),!0}catch(e){return lr(e),!1}}async function rr(e){try{return await Zs({currentPassword:e}),!0}catch(e){return lr(e),!1}}async function cr(e,t,n,s){try{return await Zs({currentPassword:e,newPassword:t,hint:n,email:s,emailCodeCallback:or,onEmailCodeError:lr}),!0}catch(e){return lr(e),!1}}async function dr(e,t){try{return await Zs({currentPassword:e,newPassword:e,email:t,emailCodeCallback:or,onEmailCodeError:lr}),!0}catch(e){return lr(e),!1}}function ur(e){tr.resolve(e)}function lr(e){let t;if(e instanceof r.errors.FloodWaitError){const n=Math.ceil(Number(e.seconds)/60/60);t="Too many attempts. Try again in "+(n>1?`${n} hours`:"an hour")}else t=er[e.message];t||(t="Unexpected Error",i.eMD&&console.error(e)),nr({"@type":"updateTwoFaError",message:t})}async function fr({chatId:e,accessHash:t,messageId:n,data:s,isGame:i}){const o=await(Mn.Z.getCurrentAccount()?.sendPduWithCallback(new xn({chatId:e,accessHash:t,messageId:n,data:s,isGame:i}).pack()));if(o)return Nn.parseMsg(o)}async function pr(){const e=await zs(new r.Api.contacts.GetTopPeers({botsInline:!0}));if(!(e instanceof r.Api.contacts.TopPeers))return;const t=e.users.map(Zt).filter(Boolean);return{ids:t.map((({id:e})=>e)),users:t}}async function hr({username:e}){const t=await zs(new r.Api.contacts.ResolveUsername({username:e}));if(t&&t.users[0]instanceof r.Api.User&&t.users[0].bot&&t.users[0].botInlinePlaceholder)return Y(t.users[0]),{user:Zt(t.users[0]),chat:Mt(t.users[0])}}async function gr({bot:e,chat:t,query:n,offset:s=""}){const i=await zs(new r.Api.messages.GetInlineBotResults({bot:ae(e.id,e.accessHash),peer:ae(t.id,t.accessHash),query:n,offset:s}));var o,c,u,l,f;if(i)return X(i.users),{isGallery:Boolean(i.gallery),help:e.botPlaceholder,nextOffset:(l=e.usernames[0].username,f=i.nextOffset,"gif"===l&&"0"===f?"":f),switchPm:(u=i.switchPm,u?d(u,["text","startParam"]):void 0),users:i.users.map(Zt).filter(Boolean),results:(o=String(i.queryId),c=i.results,c.map((e=>{return e instanceof r.Api.BotInlineMediaResult?(e.document instanceof r.Api.Document&&(t=e.document,a.ZP.documents[String(t.id)]=t),e.photo instanceof r.Api.Photo&&(n=e.photo,a.ZP.photos[String(n.id)]=n),function(e,t){const{id:n,type:s,title:i,description:o,photo:a,document:c}=e;return{id:n,queryId:t,type:s,title:i,description:o,..."sticker"===s&&c instanceof r.Api.Document&&{sticker:k(c)},...a instanceof r.Api.Photo&&{photo:P(a)},..."gif"===s&&c instanceof r.Api.Document&&{gif:ut(c)},..."video"===s&&c instanceof r.Api.Document&&{thumbnail:C(c.thumbs)}}}(e,o)):(e.thumb&&(s=e.thumb,a.ZP.webDocuments[s.url]=s),function(e,t){const{id:n,type:s,title:i,description:o,url:a,thumb:r}=e;return{id:n,queryId:t,type:s,title:i,description:o,url:a,webThumbnail:wt(r)}}(e,o));var t,n,s}))),cacheTime:i.cacheTime}}async function mr({chat:e,replyingToTopId:t,resultId:n,queryId:s,replyingTo:i,sendAs:o,isSilent:a,scheduleDate:c}){const d=fe();await zs(new r.Api.messages.SendInlineBotResult({clearDraft:!0,randomId:d,queryId:q()(s),peer:ae(e.id,e.accessHash),id:n,scheduleDate:c,...t&&{topMsgId:t},...a&&{silent:!0},...i&&{replyToMsgId:i},...o&&{sendAs:ae(o.id,o.accessHash)}}),!0)}async function yr({bot:e,startParam:t}){const n=fe();await zs(new r.Api.messages.StartBot({bot:ae(e.id,e.accessHash),peer:ae(e.id,e.accessHash),randomId:n,startParam:t}),!0)}async function wr({isSilent:e,peer:t,bot:n,url:s,startParam:i,replyToMessageId:o,threadId:a,theme:r,sendAs:c,isFromBotMenu:d}){return{url:'https://webappcontent.telegram.org/cafe/?mode=menu#tgWebAppData=query_id%3DAAHFY2V2AgAAAMVjZXb0KFJb%26user%3D%257B%2522id%2522%253A6281323461%252C%2522first_name%2522%253A%2522Wai%2522%252C%2522last_name%2522%253A%2522Chat%2522%252C%2522username%2522%253A%2522wai_chat%2522%252C%2522language_code%2522%253A%2522en%2522%257D%26auth_date%3D1680293757%26hash%3D513a7167671bc1e80c1d95c168231a1a4f32511942a2bfae25c2640e1c925a7f&tgWebAppVersion=6.4&tgWebAppPlatform=webz&tgWebAppThemeParams=%7B"bg_color"%3A"%23212121"%2C"text_color"%3A"%23ffffff"%2C"hint_color"%3A"%23aaaaaa"%2C"link_color"%3A"%238774e1"%2C"button_color"%3A"%238774e1"%2C"button_text_color"%3A"%23ffffff"%2C"secondary_bg_color"%3A"%230f0f0f"%7D',queryId:"sss"}}async function br({bot:e,url:t,theme:n}){const s=await zs(new r.Api.messages.RequestSimpleWebView({url:t,bot:ae(e.id,e.accessHash),themeParams:n?(i=n,new r.Api.DataJSON({data:JSON.stringify(i)})):void 0,platform:"webz"}));var i;return s?.url}function vr({isSilent:e,peer:t,bot:n,queryId:s,replyToMessageId:i,threadId:o,sendAs:a}){return zs(new r.Api.messages.ProlongWebView({silent:e||void 0,peer:ae(t.id,t.accessHash),bot:ae(n.id,n.accessHash),queryId:q()(s),replyToMsgId:i,...o&&{topMsgId:o},...a&&{sendAs:ae(a.id,a.accessHash)}}))}async function Ar({bot:e,buttonText:t,data:n}){const s=fe();await zs(new r.Api.messages.SendWebViewData({bot:ae(e.id,e.accessHash),buttonText:t,data:n,randomId:s}),!0)}async function Ir({hash:e}){const t=await zs(new r.Api.messages.GetAttachMenuBots({hash:e?q()(e):void 0}));if(t instanceof r.Api.AttachMenuBots)return X(t.users),{hash:t.hash.toString(),bots:c(t.bots.map(Lt),"id"),users:t.users.map(Zt).filter(Boolean)}}async function Sr({bot:e}){const t=await zs(new r.Api.messages.GetAttachMenuBot({bot:ae(e.id,e.accessHash)}));if(t instanceof r.Api.AttachMenuBotsBot)return X(t.users),{bot:Lt(t.bot),users:t.users.map(Zt).filter(Boolean)}}function Cr({bot:e,isWriteAllowed:t,isEnabled:n}){return zs(new r.Api.messages.ToggleBotInAttachMenu({bot:ae(e.id,e.accessHash),writeAllowed:t||void 0,enabled:n}))}async function Pr({chat:e,buttonId:t,messageId:n}){const s=await zs(new r.Api.messages.RequestUrlAuth({peer:ae(e.id,e.accessHash),buttonId:t,msgId:n}));if(!s)return;const i=cn(s);return"request"===i?.type&&sr({"@type":"updateUser",id:i.bot.id,user:i.bot}),i}async function _r({chat:e,messageId:t,buttonId:n,isWriteAllowed:s}){const i=await zs(new r.Api.messages.AcceptUrlAuth({peer:ae(e.id,e.accessHash),msgId:t,buttonId:n,writeAllowed:s||void 0}));if(!i)return;const o=cn(i);return"request"===o?.type&&sr({"@type":"updateUser",id:o.bot.id,user:o.bot}),o}async function Mr({url:e}){const t=await zs(new r.Api.messages.RequestUrlAuth({url:e}));if(!t)return;const n=cn(t);return"request"===n?.type&&sr({"@type":"updateUser",id:n.bot.id,user:n.bot}),n}async function Rr({url:e,isWriteAllowed:t}){const n=await zs(new r.Api.messages.AcceptUrlAuth({url:e,writeAllowed:t||void 0}));if(!n)return;const s=cn(n);return"request"===s?.type&&sr({"@type":"updateUser",id:s.bot.id,user:s.bot}),s}var Dr=n(48764).Buffer;let Tr,kr;async function Er({call:e}){const t=await zs(new r.Api.phone.GetGroupCall({call:Pe(e)}));if(!t)return;X(t.users),X(t.chats);const n=t.users.map(Zt).filter(Boolean),s=t.chats.map((e=>Mt(e))).filter(Boolean);return{groupCall:Ue(t.call),users:n,chats:s}}function Ur({call:e}){return zs(new r.Api.phone.DiscardGroupCall({call:Pe(e)}),!0)}function Br({call:e,participant:t,muted:n,presentationPaused:s,videoStopped:i,videoPaused:o,volume:a,raiseHand:c}){return zs(new r.Api.phone.EditGroupCallParticipant({call:Pe(e),participant:ae(t.id,t.accessHash),...void 0!==i&&{videoStopped:i},...void 0!==o&&{videoPaused:o},...void 0!==n&&{muted:n},...void 0!==s&&{presentationPaused:s},...void 0!==c&&{raiseHand:c},...void 0!==a&&{volume:a}}),!0)}function xr({groupCall:e,title:t}){return zs(new r.Api.phone.EditGroupCallTitle({title:t,call:Pe(e)}),!0)}async function Nr({call:e,canSelfUnmute:t}){const n=await zs(new r.Api.phone.ExportGroupCallInvite({canSelfUnmute:t||void 0,call:Pe(e)}));if(n)return n.link}async function Or({call:e,offset:t}){const n=await zs(new r.Api.phone.GetGroupParticipants({call:Pe(e),ids:[],sources:[],offset:t||"",limit:i.ASX}));if(!n)return;X(n.users),X(n.chats);const s=n.users.map(Zt).filter(Boolean),o=n.chats.map((e=>Mt(e))).filter(Boolean);return Tr({"@type":"updateGroupCallParticipants",groupCallId:e.id,participants:n.participants.map(Te),nextOffset:n.nextOffset}),{users:s,chats:o}}function qr({call:e}){return zs(new r.Api.phone.LeaveGroupCall({call:Pe(e)}),!0)}async function Hr({call:e,inviteHash:t,params:n}){const s=await zs(new r.Api.phone.JoinGroupCall({call:Pe(e),joinAs:new r.Api.InputPeerSelf,muted:!0,videoStopped:!0,params:new r.Api.DataJSON({data:JSON.stringify(n)}),inviteHash:t}));if(s&&s instanceof r.Api.Updates){const e=s.updates.find((e=>e instanceof r.Api.UpdateGroupCall));if(!(e instanceof r.Api.UpdateGroupCall))return;return Ue(e.call)}}async function jr({peer:e}){const t=pe(),n=await zs(new r.Api.phone.CreateGroupCall({peer:ae(e.id,e.accessHash),randomId:t}));if(n&&n instanceof r.Api.Updates){const e=n.updates[0];if(e instanceof r.Api.UpdateGroupCall)return Ue(e.call)}}function Fr({call:e,params:t}){return zs(new r.Api.phone.JoinGroupCallPresentation({call:Pe(e),params:new r.Api.DataJSON({data:JSON.stringify(t)})}),!0)}function Gr({call:e,subscribed:t}){return zs(new r.Api.phone.ToggleGroupCallStartSubscription({call:Pe(e),subscribed:t}),!0,void 0,void 0,void 0,!0)}function Lr({call:e}){return zs(new r.Api.phone.LeaveGroupCallPresentation({call:Pe(e)}),!0)}async function $r(){const e=await zs(new r.Api.messages.GetDhConfig({}));if(e&&!(e instanceof r.Api.messages.DhConfigNotModified))return{g:e.g,p:Array.from(e.p),random:Array.from(e.random)}}function Kr({call:e,isBusy:t}){return zs(new r.Api.phone.DiscardCall({peer:_e(e),reason:t?new r.Api.PhoneCallDiscardReasonBusy:new r.Api.PhoneCallDiscardReasonHangup}),!0)}async function zr({user:e,gAHash:t,isVideo:n}){const s=await zs(new r.Api.phone.RequestCall({randomId:pe(),userId:ae(e.id,e.accessHash),gAHash:Dr.from(t),...n&&{video:!0},protocol:qe()}));if(!s)return;const i=Be(s.phoneCall);return Tr({"@type":"updatePhoneCall",call:i}),X(s.users),{users:s.users.map(Zt).filter(Boolean)}}function Wr({call:e,rating:t,comment:n}){return zs(new r.Api.phone.SetCallRating({rating:t,peer:_e(e),comment:n}),!0)}function Vr({call:e}){return zs(new r.Api.phone.ReceivedCall({peer:_e(e)}))}async function Zr({call:e,gB:t}){const n=await zs(new r.Api.phone.AcceptCall({peer:_e(e),gB:Dr.from(t),protocol:qe()}));if(n)return e=Be(n.phoneCall),Tr({"@type":"updatePhoneCall",call:e}),X(n.users),{users:n.users.map(Zt).filter(Boolean)}}async function Jr({call:e,gA:t,keyFingerprint:n}){const s=await zs(new r.Api.phone.ConfirmCall({peer:_e(e),gA:Dr.from(t),keyFingerprint:q()(n),protocol:qe()}));if(s)return e=Be(s.phoneCall),Tr({"@type":"updatePhoneCall",call:e}),X(s.users),{users:s.users.map(Zt).filter(Boolean)}}function Qr({data:e,call:t}){return zs(new r.Api.phone.SendSignalingData({data:Dr.from(e),peer:_e(t)}))}function Yr(e){if(e)return Object.values(e).map((e=>({id:e.id,title:e.title,amount:e.prices.reduce(((e,t)=>e+t.amount.toJSNumber()),0),prices:e.prices.map((({label:e,amount:t})=>({label:e,amount:t.toJSNumber()})))})))}function Xr(e){const{invoice:t,info:n,shipping:s,currency:i,totalAmount:o,credentialsTitle:a,tipAmount:r}=e,{shippingAddress:c,phone:d,name:u}=n||{},{prices:l}=t,f=l.map((({label:e,amount:t})=>({label:e,amount:t.toJSNumber()})));let p,h;return s&&(p=s.prices.map((({label:e,amount:t})=>({label:e,amount:t.toJSNumber()}))),h=s.title),{currency:i,prices:f,info:{shippingAddress:c,phone:d,name:u},totalAmount:o.toJSNumber(),credentialsTitle:a,shippingPrices:p,shippingMethod:h,tipAmount:r?r.toJSNumber():0}}function ec(e){const{formId:t,canSaveCredentials:n,passwordMissing:s,providerId:i,nativeProvider:o,nativeParams:a,savedInfo:r,invoice:c,savedCredentials:d}=e,{test:u,nameRequested:l,phoneRequested:f,emailRequested:p,shippingAddressRequested:h,flexible:g,phoneToProvider:m,emailToProvider:y,currency:w,prices:v}=c,A=v.map((({label:e,amount:t})=>({label:e,amount:t.toJSNumber()}))),{shippingAddress:I}=r||{},S=r?(0,b.f)(r):void 0;S&&I&&(S.shippingAddress=(0,b.f)(I));const C=a?JSON.parse(a.data):{};return{canSaveCredentials:n,isPasswordMissing:s,formId:String(t),providerId:String(i),nativeProvider:o,savedInfo:S,invoiceContainer:{isTest:u,isNameRequested:l,isPhoneRequested:f,isEmailRequested:p,isShippingAddressRequested:h,isFlexible:g,shouldSendPhoneToProvider:m,shouldSendEmailToProvider:y,currency:w,prices:A},nativeParams:{needCardholderName:Boolean(C?.need_cardholder_name),needCountry:Boolean(C?.need_country),needZip:Boolean(C?.need_zip),publishableKey:C?.publishable_key,publicToken:C?.public_token},...d&&{savedCredentials:(P=d,P.map((({id:e,title:t})=>({id:e,title:t}))))}};var P}function tc(e){const{invoice:t,description:n,title:s,photo:i}=e,{test:o,currency:a,prices:r,recurring:c,recurringTermsUrl:d,maxTipAmount:u,suggestedTipAmounts:l}=t,f=r.reduce(((e,t)=>e+t.amount.toJSNumber()),0);return{text:n,title:s,photo:wt(i),amount:f,currency:a,isTest:o,isRecurring:c,recurringTermsUrl:d,maxTipAmount:u?.toJSNumber(),...l&&{suggestedTipAmounts:l.map((e=>e.toJSNumber()))}}}function nc(e){const{statusText:t,statusEntities:n,videos:s,videoSections:i,periodOptions:o}=e;return{statusText:t,statusEntities:n.map(vt),videoSections:i,videos:s.map(lt).filter(Boolean),options:o.map(sc)}}function sc(e){const{current:t,canPurchaseUpgrade:n,currency:s,amount:i,botUrl:o,months:a}=e;return{isCurrent:t,canPurchaseUpgrade:n,currency:s,amount:i.toString(),botUrl:o,months:a}}async function ic({inputInvoice:e,requestInfo:t,shouldSave:n}){const s=await zs(new r.Api.payments.ValidateRequestedInfo({invoice:Me(e),save:n||void 0,info:Ae(t)}));if(!s)return;const{id:i,shippingOptions:o}=s;return i?{id:i,shippingOptions:Yr(o)}:void 0}async function oc({inputInvoice:e,formId:t,requestedInfoId:n,shippingOptionId:s,credentials:i,savedCredentialId:o,temporaryPassword:a,tipAmount:c}){const d=a&&o?new r.Api.InputPaymentCredentialsSaved({id:o,tmpPassword:te(a)}):new r.Api.InputPaymentCredentials({save:i.save,data:new r.Api.DataJSON({data:JSON.stringify(i.data)})}),u=await zs(new r.Api.payments.SendPaymentForm({formId:q()(t),invoice:Me(e),requestedInfoId:n,shippingOptionId:s,credentials:d,...c&&{tipAmount:q()(c)}}));if(!(u instanceof r.Api.payments.PaymentVerificationNeeded))return Boolean(u);kr({"@type":"updatePaymentVerificationNeeded",url:u.url})}async function ac(e){const t=await zs(new r.Api.payments.GetPaymentForm({invoice:Me(e)}));if(t)return t.photo&&(a.ZP.webDocuments[t.photo.url]=t.photo),X(t.users),{form:ec(t),invoice:tc(t),users:t.users.map(Zt).filter(Boolean)}}async function rc(e,t){const n=await zs(new r.Api.payments.GetPaymentReceipt({peer:ae(e.id,e.accessHash),msgId:t}));if(n)return X(n.users),{receipt:Xr(n),users:n.users.map(Zt).filter(Boolean)}}async function cc(){const e=await zs(new r.Api.help.GetPremiumPromo);if(!e)return;X(e.users);const t=e.users.map(Zt).filter(Boolean);return e.videos.forEach((e=>{e instanceof r.Api.Document&&(a.ZP.documents[e.id.toString()]=e)})),{promo:nc(e),users:t}}async function dc(e){const t=await function(e,t){return function(e,t){return js.getTmpPassword(e,t)}(e,t)}(e);if(t)return"error"in t?t:{value:ee(t.tmpPassword),validUntil:t.validUntil}}async function uc({peer:e,reason:t,description:n}){return await zs(new r.Api.account.ReportPeer({peer:ae(e.id,e.accessHash),reason:Se(t),message:n}))}async function lc({peer:e,photo:t,reason:n,description:s}){const i=ye(t);if(i)return await zs(new r.Api.account.ReportProfilePhoto({peer:ae(e.id,e.accessHash),photoId:i,reason:Se(n),message:s}))}async function fc({hash:e,areCallsEnabled:t,areSecretChatsEnabled:n}){return await zs(new r.Api.account.ChangeAuthorizationSettings({hash:q()(e),...void 0!==t?{callRequestsDisabled:!t}:void 0,...void 0!==n?{encryptedRequestsDisabled:!n}:void 0}))}async function pc({days:e}){return await zs(new r.Api.account.SetAuthorizationTTL({authorizationTtlDays:e}))}var hc=n(48764).Buffer;function gc(e){const{emojies_sounds:t}=e;return t?Object.keys(t).reduce(((e,n)=>{const s=t[n];return a.ZP.documents[s.id]=new r.Api.Document({id:q()(s.id),accessHash:q()(s.access_hash),dcId:1,mimeType:"audio/ogg",fileReference:hc.from(atob(s.file_reference_base64.replace(/-/g,"+").replace(/_/g,"/"))),size:q()(0)}),e[n]=s.id,e}),{}):{}}function mc(e,t,n){return[e[`${t}_default`]||i.prK[n][0],e[`${t}_premium`]||i.prK[n][1]]}const yc=["ar","fa","id","ko","uz","en"];async function wc({firstName:e,lastName:t,about:n}){let s=await(Mn.Z.getCurrentAccount()?.sendPduWithCallback(new ss({firstName:e||"",lastName:t||"",about:n||""}).pack()));if(!s)return!1;const{err:i}=is.parseMsg(s);return i===Pn.wb.NO_ERROR}async function bc(e){try{return{result:await zs(new r.Api.account.CheckUsername({username:e}),void 0,!0),error:void 0}}catch(e){const t=e.message;if(Fa.has(t))return{result:!1,error:t};throw e}}async function vc(e){const t=await(Mn.Z.getCurrentAccount()?.sendPduWithCallback(new os({username:e}).pack()));if(!t)return!1;const{err:n}=as.parseMsg(t);return n===Pn.wb.NO_ERROR}async function Ac(e,t){const n=e?ye(e):new r.Api.InputPhotoEmpty,s=await zs(new r.Api.photos.UpdateProfilePhoto({id:n,...t?{fallback:!0}:void 0}));if(s)return X(s.users),s.photo instanceof r.Api.Photo?(Q(s.photo),{users:s.users.map(Zt).filter(Boolean),photo:P(s.photo)}):void 0}async function Ic(e,t,n=!1,s=0,o){const a=await(0,Xn.uploadFileV1)({file:e,workers:i.eLN}),r=a.id.toString();if(Mn.Z.getCurrentAccount()?.getSession())return{avatarHash:r,photos:[{id:r,thumbnail:{dataUri:o,width:640,height:640},sizes:[{width:160,height:160,type:"s"},{width:320,height:320,type:"m"},{width:640,height:640,type:"x"}]}]};let c=await(Mn.Z.getCurrentAccount()?.sendPduWithCallback(new rs({id:a.id.toString(),is_video:n,thumbnail:o}).pack()));if(!c)return!1;const{err:d,payload:u}=cs.parseMsg(c);return d==Pn.wb.NO_ERROR&&JSON.parse(u)}async function Sc({file:e,isSuggest:t,user:n,thumbnail:s}){const i=e?await(0,Xn.uploadFileV1)({file:e}):void 0;if(Mn.Z.getCurrentAccount()?.getSession()){const e=i?.id.toString();return{users:[{...n,avatarHash:e,photos:[{id:e,thumbnail:{dataUri:s,width:640,height:640},sizes:[{width:160,height:160,type:"s"},{width:320,height:320,type:"m"},{width:640,height:640,type:"x"}]}]}]}}const o=await zs(new r.Api.photos.UploadContactProfilePhoto({userId:re(n.id,n.accessHash),file:i,...t?{suggest:!0}:{save:!0}}));if(!o)return;X(o.users);const a=o.users.map(Zt).filter(Boolean);return o.photo instanceof r.Api.Photo?(Q(o.photo),{users:a,photo:P(o.photo)}):{users:a,photo:void 0}}async function Cc(e){const t=e.map(ye).filter(Boolean),n=await zs(new r.Api.photos.DeletePhotos({id:t}),!0);return n&&e.forEach((e=>{delete a.ZP.photos[e.id]})),n}async function Pc(){const e=await zs(new r.Api.account.GetWallPapers({hash:q()("0")}));if(!e||e instanceof r.Api.account.WallPapersNotModified)return;const t=e.wallpapers.filter((e=>e instanceof r.Api.WallPaper&&e.document instanceof r.Api.Document&&!e.pattern&&"application/x-tgwallpattern"!==e.document.mimeType));return t.forEach((e=>{a.ZP.documents[String(e.document.id)]=e.document})),{wallpapers:t.map(Xt).filter(Boolean)}}async function _c(e){const t=await Vs(e),n=await zs(new r.Api.account.UploadWallPaper({file:t,mimeType:e.type,settings:new r.Api.WallPaperSettings}));if(!(n&&n instanceof r.Api.WallPaper))return;const s=Xt(n);return s?(a.ZP.documents[String(n.document.id)]=n.document,{wallpaper:s}):void 0}async function Mc(){const e=await zs(new r.Api.contacts.GetBlocked({limit:i.LCd}));if(e)return Yc(e),{users:e.users.map(Zt).filter(Boolean),chats:e.chats.map((e=>Mt(e))).filter(Boolean),blockedIds:e.blocked.map((e=>$(e.peerId))),totalCount:e instanceof r.Api.contacts.BlockedSlice?e.count:e.blocked.length}}function Rc(e,t){return zs(new r.Api.contacts.Block({id:ae(e,t)}))}function Dc(e,t){return zs(new r.Api.contacts.Unblock({id:ae(e,t)}))}async function Tc(){const e=await zs(new r.Api.account.GetAuthorizations);if(e)return{authorizations:c(e.authorizations.map(en),"hash"),ttlDays:e.authorizationTtlDays}}function kc(e){return zs(new r.Api.account.ResetAuthorization({hash:q()(e)}))}function Ec(){return zs(new r.Api.auth.ResetAuthorizations)}async function Uc(){const e=await zs(new r.Api.account.GetWebAuthorizations);if(e)return X(e.users),{users:e.users.map(Zt).filter(Boolean),webAuthorizations:c(e.authorizations.map(tn),"hash")}}function Bc(e){return zs(new r.Api.account.ResetWebAuthorization({hash:q()(e)}))}function xc(){return zs(new r.Api.account.ResetWebAuthorizations)}async function Nc(){const e=await zs(new r.Api.account.GetNotifyExceptions({compareSound:!0}),void 0,void 0,!0);if(e instanceof r.Api.Updates||e instanceof r.Api.UpdatesCombined)return Yc(e),e.updates.reduce(((e,t)=>t instanceof r.Api.UpdateNotifySettings&&t.peer instanceof r.Api.NotifyPeer?(e.push(sn(t.notifySettings,t.peer.peer)),e):e),[])}async function Oc(){const[e,t,n,s]=await Promise.all([zs(new r.Api.account.GetContactSignUpNotification),zs(new r.Api.account.GetNotifySettings({peer:new r.Api.InputNotifyUsers})),zs(new r.Api.account.GetNotifySettings({peer:new r.Api.InputNotifyChats})),zs(new r.Api.account.GetNotifySettings({peer:new r.Api.InputNotifyBroadcasts}))]);if(!t||!n||!s)return!1;const{silent:i,muteUntil:o,showPreviews:a}=t,{silent:c,muteUntil:d,showPreviews:u}=n,{silent:l,muteUntil:f,showPreviews:h}=s;return{hasContactJoinedNotifications:!e,hasPrivateChatsNotifications:!(i||"number"==typeof o&&p()<o),hasPrivateChatsMessagePreview:a,hasGroupNotifications:!(c||"number"==typeof d&&p()<d),hasGroupMessagePreview:u,hasBroadcastNotifications:!(l||"number"==typeof f&&p()<f),hasBroadcastMessagePreview:h}}function qc(e){return zs(new r.Api.account.SetContactSignUpNotification({silent:e}))}function Hc(e,{isSilent:t,shouldShowPreviews:n}){let s;s="contact"===e?new r.Api.InputNotifyUsers:"group"===e?new r.Api.InputNotifyChats:new r.Api.InputNotifyBroadcasts;const o={showPreviews:n,silent:t,muteUntil:t?i.PT8:0};return zs(new r.Api.account.UpdateNotifySettings({peer:s,settings:new r.Api.InputPeerNotifySettings(o)}))}async function jc(){const e=await zs(new r.Api.langpack.GetLanguages({langPack:i.$OQ}));if(e)return e.map(b.f)}async function Fc({sourceLangPacks:e,langCode:t}){const n=(await Promise.all(e.map((e=>zs(new r.Api.langpack.GetLangPack({langPack:e,langCode:yc.includes(t)?`${t}-raw`:t})))))).filter(Boolean).map((e=>c(e.strings.map(b.f),"key")));if(n.length)return{langPack:Object.assign({},...n.reverse())}}async function Gc({langPack:e,langCode:t,keys:n}){const s=await zs(new r.Api.langpack.GetStrings({langPack:e,langCode:yc.includes(t)?`${t}-raw`:t,keys:n}));if(s)return s.map(b.f)}async function Lc(e){const t=Ie(e),n=await zs(new r.Api.account.GetPrivacy({key:t}));if(n)return Yc(n),{users:n.users.map(Zt).filter(Boolean),rules:nn(n.rules)}}function $c(e){const t=js.session.getAuthKey().getKey();return zs(new r.Api.account.RegisterDevice({tokenType:10,secret:t,appSandbox:!1,otherUids:[],token:e}))}function Kc(e){return zs(new r.Api.account.UnregisterDevice({tokenType:10,otherUids:[],token:e}))}async function zc(e,t){const n=Ie(e),s=[];switch(t.allowedUsers&&s.push(new r.Api.InputPrivacyValueAllowUsers({users:t.allowedUsers.map((({id:e,accessHash:t})=>re(e,t)))})),t.allowedChats&&s.push(new r.Api.InputPrivacyValueAllowChatParticipants({chats:t.allowedChats.map((({id:e})=>re(e)))})),t.blockedUsers&&s.push(new r.Api.InputPrivacyValueDisallowUsers({users:t.blockedUsers.map((({id:e,accessHash:t})=>re(e,t)))})),t.blockedChats&&s.push(new r.Api.InputPrivacyValueDisallowChatParticipants({chats:t.blockedChats.map((({id:e})=>re(e)))})),t.visibility){case"everybody":s.push(new r.Api.InputPrivacyValueAllowAll);break;case"contacts":s.push(new r.Api.InputPrivacyValueAllowContacts);break;case"nonContacts":s.push(new r.Api.InputPrivacyValueDisallowContacts);break;case"nobody":s.push(new r.Api.InputPrivacyValueDisallowAll)}const i=await zs(new r.Api.account.SetPrivacy({key:n,rules:s}));if(i)return Yc(i),{users:i.users.map(Zt).filter(Boolean),rules:nn(i.rules)}}async function Wc(e){await zs(new r.Api.account.UpdateStatus({offline:!e}))}async function Vc(){const e=await zs(new r.Api.account.GetContentSettings);if(e)return{isSensitiveEnabled:Boolean(e.sensitiveEnabled),canChangeSensitive:Boolean(e.sensitiveCanChange)}}function Zc(e){return zs(new r.Api.account.SetContentSettings({sensitiveEnabled:e||void 0}))}async function Jc(){const e=await zs(new r.Api.help.GetAppConfig);if(e)return function(e){const t=rn(e);return{emojiSounds:gc(t),seenByMaxChatMembers:t.chat_read_mark_size_threshold,seenByExpiresAt:t.chat_read_mark_expire_period,autologinDomains:t.autologin_domains||[],autologinToken:t.autologin_token||"",urlAuthDomains:t.url_auth_domains||[],maxUniqueReactions:t.reactions_uniq_max,premiumBotUsername:t.premium_bot_username,premiumInvoiceSlug:t.premium_invoice_slug,premiumPromoOrder:t.premium_promo_order,isPremiumPurchaseBlocked:t.premium_purchase_blocked,defaultEmojiStatusesStickerSetId:t.default_emoji_statuses_stickerset_id,topicsPinnedLimit:t.topics_pinned_limit,maxUserReactionsDefault:t.reactions_user_max_default,maxUserReactionsPremium:t.reactions_user_max_premium,hiddenMembersMinCount:t.hidden_members_group_size_min,canDisplayAutoarchiveSetting:t.autoarchive_setting_available,limits:{uploadMaxFileparts:mc(t,"upload_max_fileparts","uploadMaxFileparts"),stickersFaved:mc(t,"stickers_faved_limit","stickersFaved"),savedGifs:mc(t,"saved_gifs_limit","savedGifs"),dialogFiltersChats:mc(t,"dialog_filters_chats_limit","dialogFiltersChats"),dialogFilters:mc(t,"dialog_filters_limit","dialogFilters"),dialogFolderPinned:mc(t,"dialogs_pinned_limit","dialogFolderPinned"),captionLength:mc(t,"caption_length_limit","captionLength"),channels:mc(t,"channels_limit","channels"),channelsPublic:mc(t,"channels_public_limit","channelsPublic"),aboutLength:mc(t,"about_length_limit","aboutLength")}}}(e)}async function Qc(){const e=await zs(new r.Api.help.GetConfig);if(e)return function(e){const t=e.reactionsDefault&&it(e.reactionsDefault);return{expiresAt:e.expires,gifSearchUsername:e.gifSearchUsername,defaultReaction:t,maxGroupSize:e.chatSizeMax}}(e)}function Yc(e){X(e.users),X(e.chats)}async function Xc({langCode:e="en"}){const t=await zs(new r.Api.help.GetCountriesList({langCode:e}));if(t instanceof r.Api.help.CountriesList)return function(e){const t=e.filter((({hidden:e})=>!e));return{phoneCodes:t.map((e=>e.countryCodes.map((t=>an(e,t))))).flat().sort(((e,t)=>e.name?e.name.localeCompare(t.name):e.defaultName.localeCompare(t.defaultName))),general:t.map((e=>an(e,e.countryCodes[0]))).sort(((e,t)=>e.name?e.name.localeCompare(t.name):e.defaultName.localeCompare(t.defaultName)))}}(t.countries)}async function ed(){const e=await zs(new r.Api.account.GetGlobalPrivacySettings);if(e)return{shouldArchiveAndMuteNewNonContact:Boolean(e.archiveAndMuteNewNoncontactPeers)}}async function td({shouldArchiveAndMuteNewNonContact:e}){const t=await zs(new r.Api.account.SetGlobalPrivacySettings({settings:new r.Api.GlobalPrivacySettings({archiveAndMuteNewNoncontactPeers:e})}));if(t)return{shouldArchiveAndMuteNewNonContact:Boolean(t.archiveAndMuteNewNoncontactPeers)}}function nd({chatId:e,accessHash:t,username:n,isActive:s}){return zs(e?new r.Api.channels.ToggleUsername({channel:re(e,t),username:n,active:s}):new r.Api.account.ToggleUsername({username:n,active:s}))}function sd({chatId:e,accessHash:t,usernames:n}){return zs(e?new r.Api.channels.ReorderUsernames({channel:re(e,t),order:n}):new r.Api.account.ReorderUsernames({order:n}))}function id({chat:e,emoticon:t}){return zs(new r.Api.messages.SetTyping({peer:ae(e.id,e.accessHash),action:new r.Api.SendMessageEmojiInteractionSeen({emoticon:t})}))}function od({chat:e,emoticon:t,messageId:n,timestamps:s}){return zs(new r.Api.messages.SetTyping({peer:ae(e.id,e.accessHash),action:new r.Api.SendMessageEmojiInteraction({emoticon:t,msgId:n,interaction:new r.Api.DataJSON({data:JSON.stringify({v:1,a:s.map((e=>({t:e,i:1})))})})})}))}async function ad(){const e=await zs(new r.Api.messages.GetAvailableReactions({}));if(e&&!(e instanceof r.Api.messages.AvailableReactionsNotModified))return e.reactions.forEach((e=>{e.staticIcon instanceof r.Api.Document&&(a.ZP.documents[String(e.staticIcon.id)]=e.staticIcon),e.selectAnimation instanceof r.Api.Document&&(a.ZP.documents[String(e.selectAnimation.id)]=e.selectAnimation),e.aroundAnimation instanceof r.Api.Document&&(a.ZP.documents[String(e.aroundAnimation.id)]=e.aroundAnimation),e.centerIcon instanceof r.Api.Document&&(a.ZP.documents[String(e.centerIcon.id)]=e.centerIcon)})),e.reactions.map(ot)}function rd({chat:e,messageId:t,reactions:n}){return zs(new r.Api.messages.SendReaction({reaction:n?.map((e=>Re(e))),peer:ae(e.id,e.accessHash),msgId:t}),!0)}function cd({ids:e,chat:t}){return zs(new r.Api.messages.GetMessagesReactions({id:e,peer:ae(t.id,t.accessHash)}),!0)}async function dd({chat:e,messageId:t,reaction:n,offset:s}){const o=await zs(new r.Api.messages.GetMessageReactionsList({peer:ae(e.id,e.accessHash),id:t,...n&&{reaction:Re(n)},limit:i.Q8I,...s&&{offset:s}}));if(!o)return;X(o.users);const{nextOffset:a,reactions:c,count:d}=o;return{users:o.users.map(Zt).filter(Boolean),nextOffset:a,reactions:c.map(st).filter(Boolean),count:d}}function ud({reaction:e}){return zs(new r.Api.messages.SetDefaultReaction({reaction:Re(e)}))}function ld(e,t){if(e.error)return;const n=JSON.parse(e.json.data),[s,...i]=n.columns,o=n.y_scaled;return{type:t?"area":n.types.y0,zoomToken:e.zoomToken,labelFormatter:n.xTickFormatter,tooltipFormatter:n.xTooltipFormatter,labels:s.slice(1),hideCaption:!n.subchart.show,hasSecondYAxis:o,isStacked:n.stacked&&!o,isPercentage:t,datasets:i.map((e=>{const t=e[0];return{name:n.names[t],color:(s=n.colors[t],s.substring(s.indexOf("#"))),values:e.slice(1)};var s})),...fd(n.subchart.defaultZoom,s.slice(1))}}function fd(e,t){const[n,s]=e;let i=0,o=t.length-1;return t.forEach(((e,t)=>{!i&&e>=n&&(i=t),!o&&e>=s&&(o=t)})),{minimapRange:{begin:Math.max(0,i/(t.length-1)),end:Math.min(1,o/(t.length-1))},labelFromIndex:i,labelToIndex:o}}function pd({current:e,previous:t}){const n=e-t;return{current:e,change:n,...t&&{percentage:(n?Math.abs(n)/t*100:0).toFixed(2)}}}async function hd({chat:e}){const t=await zs(new r.Api.stats.GetBroadcastStats({channel:re(e.id,e.accessHash)}),void 0,void 0,void 0,e.fullInfo.statisticsDcId);var n,s;if(t)return{stats:(n=t,{growthGraph:ld(n.growthGraph),followersGraph:ld(n.followersGraph),muteGraph:ld(n.muteGraph),topHoursGraph:ld(n.topHoursGraph),languagesGraph:n.languagesGraph.token,viewsBySourceGraph:n.viewsBySourceGraph.token,newFollowersBySourceGraph:n.newFollowersBySourceGraph.token,interactionsGraph:n.interactionsGraph.token,followers:pd(n.followers),viewsPerPost:pd(n.viewsPerPost),sharesPerPost:pd(n.sharesPerPost),enabledNotifications:(s=n.enabledNotifications,{percentage:(s.part/s.total*100).toFixed(2)}),recentTopMessages:n.recentMessageInteractions}),users:[]}}async function gd({chat:e}){const t=await zs(new r.Api.stats.GetMegagroupStats({channel:re(e.id,e.accessHash)}),void 0,void 0,void 0,e.fullInfo.statisticsDcId);var n,s;if(t)return X(t.users),{users:t.users.map(Zt).filter(Boolean),stats:(n=t,{growthGraph:ld(n.growthGraph),membersGraph:ld(n.membersGraph),topHoursGraph:ld(n.topHoursGraph),languagesGraph:n.languagesGraph.token,messagesGraph:n.messagesGraph.token,actionsGraph:n.actionsGraph.token,period:(s=n.period,{maxDate:s.maxDate,minDate:s.minDate}),members:pd(n.members),viewers:pd(n.viewers),messages:pd(n.messages),posters:pd(n.posters)})}}async function md({chat:e,messageId:t}){const n=await zs(new r.Api.stats.GetMessageStats({channel:re(e.id,e.accessHash),msgId:t}),void 0,void 0,void 0,e.fullInfo.statisticsDcId);if(n)return{viewsGraph:ld(n.viewsGraph)}}async function yd({chat:e,messageId:t,dcId:n}){const s=await zs(new r.Api.stats.GetMessagePublicForwards({channel:re(e.id,e.accessHash),msgId:t,offsetPeer:new r.Api.InputPeerEmpty}),void 0,void 0,void 0,n);if(s)return"chats"in s&&X(s.chats),function(e){if(e&&"messages"in e)return e.messages.map((t=>{const n=L(t.peerId.channelId,"channel"),s=e.chats.find((e=>L(e.id,"channel")===n));return{messageId:t.id,views:t.views,title:s.title,chat:{id:n,type:"chatTypeChannel",title:s.title,username:s.username,avatarHash:kt(s.photo)}}}))}(s)}async function wd({token:e,x:t,isPercentage:n,dcId:s}){const i=await zs(new r.Api.stats.LoadAsyncGraph({token:e,...t&&{x:q()(t)}}),void 0,void 0,void 0,s);if(i)return ld(i,n)}var bd=n(59109),vd=n.n(bd),Ad=n(96748),Id=n.n(Ad),Sd=n(13302),Cd=n.n(Sd),Pd=n(48764).Buffer;function _d(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Md,Rd;class Dd{constructor(e){this.isOutgoing=e,_d(this,"state",void 0),_d(this,"seq",0),_d(this,"gA",void 0),_d(this,"gB",void 0),_d(this,"p",void 0),_d(this,"random",void 0),_d(this,"waitForState",void 0),_d(this,"resolveState",void 0),this.waitForState=new Promise((e=>{this.resolveState=e}))}async requestCall({p:e,g:t,random:n}){const s=j().readBigIntFromBuffer(Pd.from(e),!1),i=j().readBigIntFromBuffer(Pd.from(n),!1),o=j().modExp(q()(t),i,s);this.gA=o,this.p=s,this.random=i;const a=await j().sha256(j().getByteArray(o));return Array.from(a)}acceptCall({p:e,g:t,random:n}){const s=j().readBigIntFromBuffer(e,!1),i=j().readBigIntFromBuffer(n,!1),o=j().modExp(q()(t),i,s);return this.gB=o,this.p=s,this.random=i,Array.from(j().getByteArray(o))}async confirmCall(e,t,n){this.isOutgoing?this.gB=j().readBigIntFromBuffer(Pd.from(e),!1):this.gA=j().readBigIntFromBuffer(Pd.from(e),!1);const s=j().modExp(this.isOutgoing?this.gB:this.gA,this.random,this.p),i=await j().sha1(j().getByteArray(s)),o=j().readBigIntFromBuffer(i.slice(-8).reverse(),!1),a=await async function(e,t,n,s){const i=await j().sha256(Pd.concat([new Uint8Array(e),new Uint8Array(t)])),o=[],a=s.length-1;for(let e=0;e!==i.byteLength;e+=8){const t=(r=i.subarray(e,e+8),q()(r[0]).and(127).shiftLeft(56).or(q()(r[1]).shiftLeft(48)).or(q()(r[2]).shiftLeft(40)).or(q()(r[3]).shiftLeft(32)).or(q()(r[4]).shiftLeft(24)).or(q()(r[5]).shiftLeft(16)).or(q()(r[6]).shiftLeft(8)).or(q()(r[7]))).modPow(1,a).toJSNumber(),c=s[t],d=s[t+1]-c;o.push(String.fromCharCode(...n.subarray(c,c+d)))}var r;return o.join("")}(j().getByteArray(s),j().getByteArray(this.gA),t,n),r=new(Cd());return await r.setKey(j().getByteArray(s)),this.state=new(vd())(r,new(Id()),!0,this.isOutgoing),this.resolveState(),{gA:Array.from(j().getByteArray(this.gA)),keyFingerprint:o.toString(),emojis:a}}async encode(e){if(!this.state)return;const t=new Uint32Array(1);t[0]=this.seq++;const n=await this.state.encryptMessageData(Pd.concat([j().convertToLittle(t),Pd.from(e)]));return Array.from(n)}async decode(e){if(!this.state)return this.waitForState.then((()=>this.decode(e)));const t=await this.state.decryptMessageData(Pd.from(e));return JSON.parse(t.toString())}}function Td(e){Md=new Dd(...e)}function kd(){Md=void 0}function Ed(e){return Md.encode(...e)}function Ud(e){return Md.decode(...e)}function Bd(e){return Md.confirmCall(...e)}function xd(e){return Md.acceptCall(...e)}function Nd(e){return Md.requestCall(...e)}const Od=(0,o.$6)((function(e){if(!jd||e!==Hd)return;const t=jd;jd=void 0,t.forEach(Rd)}));let qd,Hd,jd;function Fd(e){jd?jd.push(e):jd=[e],qd&&!i.bGP.has(e["@type"])||(qd=(0,o.P2)(Od,i.M3V,!0),Hd=Math.random()),qd(Hd)}self.onerror=e=>{console.error(e),$d({type:"unhandledError",error:{message:e.error.message||"Uncaught exception in worker"}})},self.addEventListener("unhandledrejection",(e=>{console.error(e),$d({type:"unhandledError",error:{message:e.reason.message||"Uncaught rejection in worker"}})}));const Gd=new Map;function Ld(e){$d({type:"update",update:e}),i.eMD&&"updateUserStatus"!==e["@type"]&&"updateServerTimeOffset"!==e["@type"]&&ne("UPDATE",e["@type"],e)}function $d(e,t){t?postMessage(e,[t]):postMessage(e)}i.eMD&&console.log(">>> FINISH LOAD WORKER"),onmessage=async e=>{const{data:t}=e;switch(t.type){case"initApi":await async function(e,t,n){Rd=e,function(e){un=e}(Fd),function(e){gn=e}(Fd),function(e){Gs=e}(Fd),function(e){ao=e}(Fd),function(e){Qo=e}(Fd),function(e){Yo=e}(Fd),function(e){ea=e}(Fd),function(e){nr=e}(Fd),function(e){sr=e}(Fd),function(e){Tr=e}(Fd),function(e){kr=e}(Fd),n&&(0,a.Zf)(n),await async function(e,t){i.eMD&&console.log(">>> START INIT API"),Hs=e,bs.setApiUpdate(e,Ss.genMessageId);const{userAgent:n,platform:s,sessionData:o,isTest:a,isMovSupported:r,isWebmSupported:c,maxBufferSize:d,webAuthToken:u,dcId:l,mockScenario:f,accountId:p,entropy:h,session:g}=t;await Ts(p,h,g,{deviceModel:navigator.userAgent||n||Ns,systemVersion:s||Os,appVersion:`${i.JiC} ${qs}`});try{i.eMD&&(ne("CONNECTING"),self.invoke=zs),i.eMD&&(console.log(">>> FINISH INIT API"),ne("CONNECTED")),Hs({"@type":"updateApiReady"}),Hs({"@type":"updateAuthorizationState",authorizationState:"authorizationStateReady"}),Hs({"@type":"updateCurrentUser",currentUser:En}),Hs({"@type":"updateConnectionState",connectionState:"connectionStateReady"})}catch(e){throw i.eMD&&ne("CONNECTING ERROR",e),e}}(Fd,t)}(Ld,t.args[0],t.args[1]);break;case"callMethod":{const{messageId:e,name:n,args:o,withCallback:a}=t;try{if(e&&a){const t=(...t)=>{const n=t[t.length-1];$d({type:"methodCallback",messageId:e,callbackArgs:t},n instanceof ArrayBuffer?n:void 0)};Gd.set(e,t),o.push(t)}if(!Un.includes(n))return void(i.eMD&&console.log(`xxx callApi('${n}'`));const t=await function(e,...t){return s[e](...t)}(n,...o);i.eMD&&"object"==typeof t&&"CONSTRUCTOR_ID"in t&&ne("UNEXPECTED RESPONSE",`${n}: ${t.className}`);const{arrayBuffer:r}="object"==typeof t&&"arrayBuffer"in t&&t||{};e&&$d({type:"methodResponse",messageId:e,response:t},r)}catch(t){i.eMD&&console.error(t),e&&$d({type:"methodResponse",messageId:e,error:{message:t.message}})}e&&Gd.delete(e);break}case"cancelProgress":{const e=Gd.get(t.messageId);e&&(e.isCanceled=!0);break}case"ping":$d({type:"methodResponse",messageId:t.messageId})}}},83716:(e,t,n)=>{"use strict";let s;n.d(t,{$OQ:()=>z,ASX:()=>I,C1M:()=>_,CJw:()=>P,CyD:()=>l,F9T:()=>f,JiC:()=>c,KzG:()=>N,LCd:()=>b,M3V:()=>T,MPN:()=>R,MW8:()=>B,NfV:()=>$,Ngd:()=>x,O58:()=>U,OxA:()=>W,PT8:()=>D,Q8I:()=>S,SGw:()=>h,U$4:()=>o,WfZ:()=>F,YUe:()=>v,ZOc:()=>M,awM:()=>G,bGP:()=>k,d9v:()=>r,deL:()=>K,e74:()=>j,eLN:()=>m,eMD:()=>d,jr7:()=>u,lWA:()=>p,mVS:()=>L,mok:()=>y,oGt:()=>q,obR:()=>a,pCG:()=>C,prK:()=>V,qHj:()=>i,s11:()=>O,tK3:()=>E,tRq:()=>A,tiD:()=>w,tuy:()=>g,wGh:()=>H});try{s=localStorage.getItem("adr"),s||(s="0")}catch(e){s="0"}const i="https://wai-chat-bot.ptp-ai.workers.dev/api",o="https://wai-chat-bot.ptp-ai.workers.dev/api/chatgpt",a="wss://wai-chat-bot.ptp-ai.workers.dev",r="",c="1.60.107",d=!1,u=!1,l=!1,f="wai-media",p="tt-media",h="tt-media-avatars",g="tt-global",m=16,y=("undefined"!=typeof window&&window.innerHeight,200),w=50,b=100,v=40,A=100,I=100,S=100,C=100,P=100,_=20,M=3e5,R=5e9,D=2**31-1,T=Math.round(425),k=new Set(["newMessage","newScheduledMessage","deleteMessages","deleteScheduledMessages","deleteHistory"]),E=20,U=20,B="status-default-icon",x="video/quicktime",N="video/webm",O="image/gif",q=new Set(["image/png","image/jpeg",O]),H=new Set(["video/mp4"]),j=new Set(["audio/mp3","audio/ogg","audio/wav","audio/mpeg","audio/flac","audio/aac","audio/m4a","audio/mp4","audio/x-m4a"]),F=(new Set([...q,...H]),"USERNAME_PURCHASE_AVAILABLE"),G=(new Set(["t.me","web.t.me","k.t.me","z.t.me"]),new Set(["AU","BD","CA","CO","EG","HN","IE","IN","JO","MX","MY","NI","NZ","PH","PK","SA","SV","US"]),"777000"),L="gif",$=0,K="-777",z="android",W=1,V={uploadMaxFileparts:[4e3,8e3],stickersFaved:[5,10],savedGifs:[200,400],dialogFiltersChats:[100,200],dialogFilters:[10,20],dialogFolderPinned:[5,10],captionLength:[1024,2048],channels:[500,1e3],channelsPublic:[10,20],aboutLength:[70,140]}},89618:(e,t,n)=>{var s=n(48764).Buffer;const i=n(24736),o=n(66842);function a(e,t=!0,n=!1){let o=s.from(e);const a=o.length;t&&(o=o.reverse());let r=i(o.toString("hex"),16);return n&&Math.floor(r.toString("2").length/8)>=a&&(r=r.subtract(i(2).pow(i(8*a)))),r}function r(e,t=8){const n=i(e),o=[];for(let e=0;e<t;e++)o[e]=n.shiftRight(8*e).and(255);return s.from(o)}function c(e,t,n=!0,o=!1){const a=(e=i(e)).bitLength();if(t<Math.ceil(a/8))throw new Error("OverflowError: int too big to convert");if(!o&&e.lesser(i(0)))throw new Error("Cannot convert to unsigned");let r=!1;e.lesser(i(0))&&(r=!0,e=e.abs());const c=e.toString("16").padStart(2*t,"0");let d=s.from(c,"hex");if(n&&(d=d.reverse()),o&&r)if(n){let e=!1;0!==d[0]&&(d[0]-=1);for(let t=0;t<d.length;t++)0!==d[t]?(e&&(d[t]-=1,e=!1),d[t]=255-d[t]):e=!0}else{d[d.length-1]=256-d[d.length-1];for(let e=0;e<d.length-1;e++)d[e]=255-d[e]}return d}function d(e){return s.from(o.randomBytes(e))}function u(e){const t=o.createHash("sha1");return t.update(e),t.digest()}let l;e.exports={readBigIntFromBuffer:a,readBufferFromBigInt:c,generateRandomLong:function(e=!0){return a(d(8),!0,e)},mod:function(e,t){return(e%t+t)%t},crc32:function(e){l||(l=function(){let e;const t=[];for(let n=0;n<256;n++){e=n;for(let t=0;t<8;t++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),s.isBuffer(e)||(e=s.from(e));let t=-1;for(let n=0;n<e.length;n++){const s=e[n];t=l[255&(t^s)]^t>>>8}return(-1^t)>>>0},generateRandomBytes:d,generateKeyDataFromNonce:async function(e,t){e=r(e,16),t=r(t,32);const[n,i,o]=await Promise.all([u(s.concat([t,e])),u(s.concat([e,t])),u(s.concat([t,t]))]);return{key:s.concat([n,i.slice(0,12)]),iv:s.concat([i.slice(12,20),o,t.slice(0,4)])}},sha1:u,sha256:function(e){const t=o.createHash("sha256");return t.update(e),t.digest()},bigIntMod:function(e,t){return e.remainder(t).add(t).remainder(t)},modExp:function(e,t,n){e=e.remainder(n);let s=i.one,o=e;for(;t.greater(i.zero);){const e=t.remainder(i(2));t=t.divide(i(2)),e.eq(i.one)&&(s=s.multiply(o),s=s.remainder(n)),o=o.multiply(o),o=o.remainder(n)}return s},getRandomInt:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},sleep:e=>new Promise((t=>{setTimeout(t,e)})),getByteArray:function(e,t=!1){const n=e.toString(2).length,s=Math.floor((n+8-1)/8);return c(i(e),s,!1,t)},toSignedLittleBuffer:r,convertToLittle:function(e){const t=s.alloc(4*e.length);for(let n=0;n<e.length;n++)t.writeUInt32BE(e[n],4*n);return t},bufferXor:function(e,t){const n=[];for(let s=0;s<e.length;s++)n.push(e[s]^t[s]);return s.from(n)}}},59674:(e,t,n)=>{var s=n(48764).Buffer;const i=n(24736),{constructors:o}=n(57404),{readBigIntFromBuffer:a,readBufferFromBigInt:r,sha256:c,bigIntMod:d,modExp:u,generateRandomBytes:l}=n(89618),f=n(66842),p=256;function h(e,t){if(!s.from([199,28,174,185,198,177,201,4,142,108,82,47,112,241,63,115,152,13,64,35,142,62,33,193,73,52,208,55,86,61,147,15,72,25,138,10,167,193,64,88,34,148,147,210,37,48,244,219,250,51,111,110,10,201,37,19,149,67,174,212,76,206,124,55,32,253,81,246,148,88,112,90,198,140,212,254,107,107,19,171,220,151,70,81,41,105,50,132,84,241,143,175,140,89,95,100,36,119,254,150,187,42,148,29,91,205,29,74,200,204,73,136,7,8,250,155,55,142,60,79,58,144,96,190,230,124,249,164,164,166,149,129,16,81,144,126,22,39,83,181,107,15,107,65,13,186,116,216,168,75,42,20,179,20,78,14,241,40,71,84,253,23,237,149,13,89,101,180,185,221,70,88,45,177,23,141,22,156,107,196,101,176,214,255,156,163,146,143,239,91,154,228,228,24,252,21,232,62,190,160,248,127,169,255,94,237,112,5,13,237,40,73,244,123,249,89,217,86,133,12,233,41,133,31,13,129,21,246,53,177,5,238,46,78,21,208,75,36,84,191,111,79,173,240,52,177,4,3,17,156,216,227,185,47,204,91]).equals(e)||![3,4,5,7].includes(t))throw new Error("Changing passwords unsupported")}function g(e){return s.concat([s.alloc(p-e.length),e])}function m(e){return r(e,p,!1)}function y(e,t){const n=t.subtract(e);return!(n.lesser(i(0))||n.bitLength()<1984||e.bitLength()<1984||Math.floor((e.bitLength()+7)/8)>256)}function w(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++)e[s]^=t[s];return e}async function b(e,t){const n=await c(s.concat([e.salt1,s.from(t,"utf-8"),e.salt1])),i=await c(s.concat([e.salt2,n,e.salt2])),o=await function(e,t,n){return f.pbkdf2(e,t,1e5,64,"sha512")}(i,e.salt1);return c(s.concat([e.salt2,o,e.salt2]))}e.exports={computeCheck:async function(e,t){const n=e.currentAlgo;if(!(n instanceof o.PasswordKdfAlgoSHA256SHA256PBKDF2HMACSHA512iter100000SHA256ModPow))throw new Error(`Unsupported password algorithm ${n.className}`);const r=await b(n,t),f=a(n.p,!1),{g:p}=n,v=a(e.srp_B,!1);try{h(n.p,p)}catch(e){throw new Error("bad /g in password")}if(!function(e,t){return e.greater(i(0))&&t.subtract(e).greater(i(0))}(v,f))throw new Error("bad b in check");const A=a(r,!1),I=g(n.p),S=m(p),C=g(e.srp_B),P=u(i(p),A,f),_=a(await c(s.concat([I,S])),!1),M=d(_.multiply(P),f),[R,D,T]=await(async()=>{for(;;){const e=l(256),t=a(e,!1),n=u(i(p),t,f);if(y(n,f)){const e=m(n),o=a(await c(s.concat([e,C])),!1);if(o.greater(i(0)))return[t,e,o]}}})(),k=d(v.subtract(M),f);if(!y(k,f))throw new Error("bad gB");const E=T.multiply(A),U=R.add(E),B=u(k,U,f),[x,N,O,q,H]=await Promise.all([c(m(B)),c(I),c(S),c(n.salt1),c(n.salt2)]),j=await c(s.concat([w(N,O),q,H,D,C,x]));return new o.InputCheckPasswordSRP({srpId:e.srpId,A:s.from(D),M1:j})},computeDigest:async function(e,t){try{h(e.p,e.g)}catch(e){throw new Error("bad p/g in password")}return m(u(i(e.g),a(await b(e,t),!1),a(e.p,!1)))}}},61472:e=>{e.exports="0.0.2"},70243:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getTmpPassword:()=>l,updateTwoFaSettings:()=>u});var s=n(77150),i=n.n(s),o=n(89618),a=n(59674),r=n(87873),c=n.n(r),d=n(48764).Buffer;async function u(e,{isCheckPassword:t,currentPassword:n,newPassword:s,hint:r="",email:u,emailCodeCallback:l,onEmailCodeError:f}){if(!s&&!n)throw new Error("Neither `currentPassword` nor `newPassword` is present");if(u&&(!l||!f))throw new Error("`email` present without `emailCodeCallback` and `onEmailCodeError`");const p=await e.invoke(new(i().account.GetPassword));p.newAlgo instanceof i().PasswordKdfAlgoUnknown||(p.newAlgo.salt1=d.concat([p.newAlgo.salt1,(0,o.generateRandomBytes)(32)])),!p.hasPassword&&n&&(n=void 0);const h=n?await(0,a.computeCheck)(p,n):new(i().InputCheckPasswordEmpty);if(t)await e.invoke(new(i().auth.CheckPassword)({password:h}));else try{await e.invoke(new(i().account.UpdatePasswordSettings)({password:h,newSettings:new(i().account.PasswordInputSettings)({newAlgo:p.newAlgo,newPasswordHash:s?await(0,a.computeDigest)(p.newAlgo,s):d.alloc(0),hint:r,email:u,newSecureSettings:void 0})}))}catch(t){if(!(t instanceof c().EmailUnconfirmedError))throw t;for(;;)try{const n=await l(t.codeLength);if(!n)throw new Error("Code is empty");await e.invoke(new(i().account.ConfirmPasswordEmail)({code:n}));break}catch(e){f(e)}}}async function l(e,t,n=60){const s=await e.invoke(new(i().account.GetPassword));if(!s)return;const o=await(0,a.computeCheck)(s,t);try{return await e.invoke(new(i().account.GetTmpPassword)({password:o,period:n}))}catch(e){if("PASSWORD_HASH_INVALID"===e.message)return{error:e.message};throw e}}},78742:(e,t,n)=>{var s=n(48764).Buffer;const i=n(67435),o=n(96748),{sleep:a}=n(89618),r=n(87873),c=n(33995),d=n(89618),u=n(48960),l=n(59270),{LAYER:f}=n(70845),{constructors:p,requests:h}=n(57404),{ConnectionTCPObfuscated:g,MTProtoSender:m,UpdateConnectionState:y}=n(18415),{authFlow:w,checkAuthorization:b}=n(21545),{downloadFile:v}=n(52288),{uploadFile:A}=n(74766),{updateTwoFaSettings:I,getTmpPassword:S}=n(70243),C=131072,P=["u","v","w","y","d","x","c","m","b","a","s","f"];class _{constructor(e,t,n,s=_.DEFAULT_OPTIONS){if(!t||!n)throw Error('Your API ID or Hash are invalid. Please read "Requirements" on README.md');const a={..._.DEFAULT_OPTIONS,...s};if(this.apiId=t,this.apiHash=n,this.defaultDcId=a.dcId||2,this._useIPV6=a.useIPV6,"string"==typeof a.baseLogger?this._log=new o:this._log=a.baseLogger,"string"!=typeof e&&e){if(!(e instanceof l))throw new Error("The given session must be str or a session instance")}else try{throw new Error("not implemented")}catch(t){e=new c}this.floodSleepLimit=a.floodSleepLimit,this._eventBuilders=[],this._phoneCodeHash={},this.session=e,this.apiId=parseInt(t,10),this.apiHash=n,this._requestRetries=a.requestRetries,this._connectionRetries=a.connectionRetries,this._retryDelay=a.retryDelay||0,a.proxy&&this._log.warn("proxies are not supported"),this._proxy=a.proxy,this._timeout=a.timeout,this._autoReconnect=a.autoReconnect,this._connection=a.connection,this._floodWaitedRequests={},this._initWith=e=>new h.InvokeWithLayer({layer:f,query:new h.InitConnection({apiId:this.apiId,deviceModel:a.deviceModel||i.type().toString()||"Unknown",systemVersion:a.systemVersion||i.release().toString()||"1.0",appVersion:a.appVersion||"1.0",langCode:a.langCode,langPack:"",systemLangCode:a.systemLangCode,query:e,proxy:void 0})}),this._args=a,this._config=void 0,this.phoneCodeHashes=[],this._exportedSenderPromises={},this._waitingForAuthKey={},this._exportedSenderReleaseTimeouts={},this._additionalDcsDisabled=a.additionalDcsDisabled,this._loopStarted=!1,this._isSwitchingDc=!1,this._destroyed=!1}async connect(){await this._initSession(),void 0===this._sender&&(this._sender=new m(this.session.getAuthKey(),{logger:this._log,dcId:this.session.dcId,retries:this._connectionRetries,delay:this._retryDelay,autoReconnect:this._autoReconnect,connectTimeout:this._timeout,authKeyCallback:this._authKeyCallback.bind(this),updateCallback:this._handleUpdate.bind(this),isMainSender:!0})),this._sender.userDisconnected=!1,this._sender._user_connected=!1,this._sender.isReconnecting=!1,this._sender._disconnected=!0;const e=new this._connection(this.session.serverAddress,this.session.port,this.session.dcId,this._log,this._args.testServers);await this._sender.connect(e)?(this.session.setAuthKey(this._sender.authKey),await this._sender.send(this._initWith(new h.help.GetConfig({}))),this._loopStarted||(this._updateLoop(),this._loopStarted=!0),this._isSwitchingDc=!1):this._loopStarted||(this._updateLoop(),this._loopStarted=!0)}async _initSession(){if(await this.session.load(),!this.session.serverAddress||this.session.serverAddress.includes(":")!==this._useIPV6){const e=u.getDC(this.defaultDcId);this.session.setDC(this.defaultDcId,e.ipAddress,this._args.useWSS?443:80)}}async _updateLoop(){let e;for(;!this._destroyed;)if(await d.sleep(3e3),this._sender.isReconnecting||this._isSwitchingDc)e=void 0;else{try{const t=()=>this._sender.send(new h.PingDelayDisconnect({pingId:d.getRandomInt(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),disconnectDelay:6e4})),n=Date.now(),s=e?n-e:void 0;if(!s||s<5e3)await k((()=>T(t,5e3)),3,100);else{let e=setTimeout((()=>{this._handleUpdate(new y(y.disconnected)),e=void 0}),1e3);await T(t,3e3),e&&(clearTimeout(e),e=void 0),this._handleUpdate(new y(y.connected))}e=Date.now()}catch(t){if(console.warn(t),e=void 0,this._sender.isReconnecting||this._isSwitchingDc)continue;await this.disconnect(),await this.connect()}if((new Date).getTime()-this._lastRequest>18e5){try{await this.invoke(new h.updates.GetState)}catch(e){}e=void 0}}await this.disconnect()}async disconnect(){this._sender&&await this._sender.disconnect(),await Promise.all(Object.values(this._exportedSenderPromises).map((e=>Object.values(e).map((e=>e&&e.then((e=>{if(e)return e.disconnect()})))))).flat()),this._exportedSenderPromises={},this._waitingForAuthKey={}}async destroy(){this._destroyed=!0;try{await this.disconnect()}catch(e){}this.session.delete(),this._eventBuilders=[]}async _switchDC(e){this._log.info(`Reconnecting to new data center ${e}`);const t=u.getDC(e);return this.session.setDC(e,t.ipAddress,t.port),await this._sender.authKey.setKey(void 0),this.session.setAuthKey(void 0),this._isSwitchingDc=!0,await this.disconnect(),this.connect()}_authKeyCallback(e,t){this.session.setAuthKey(e,t)}async _cleanupExportedSender(e,t){this.session.dcId!==e&&this.session.setAuthKey(void 0,e);const n=await this._exportedSenderPromises[e][t];delete this._exportedSenderPromises[e][t],await n.disconnect()}async _cleanupExportedSenders(e){const t=Object.values(this._exportedSenderPromises[e]);t.length&&(this.session.dcId!==e&&this.session.setAuthKey(void 0,e),this._exportedSenderPromises[e]={},await Promise.all(t.map((async e=>{const t=await e;await t.disconnect()}))))}async _connectSender(e,t,n=!1){let s,i=Boolean(e.authKey.getKey());if(!i)if(this._waitingForAuthKey[t]){await this._waitingForAuthKey[t];const n=this.session.getAuthKey(t);await e.authKey.setKey(n.getKey()),i=Boolean(e.authKey.getKey())}else this._waitingForAuthKey[t]=new Promise((e=>{s=e}));const o=u.getDC(t,i);for(;;)try{if(await e.connect(new this._connection(o.ipAddress,o.port,t,this._log,this._args.testServers,!!i&&n)),this.session.dcId!==t&&!e._authenticated){this._log.info(`Exporting authorization for data center ${o.ipAddress}`);const n=await this.invoke(new h.auth.ExportAuthorization({dcId:t})),s=this._initWith(new h.auth.ImportAuthorization({id:n.id,bytes:n.bytes}));await e.send(s),e._authenticated=!0}return e.dcId=t,e.userDisconnected=!1,s&&(s(),delete this._waitingForAuthKey[t]),e}catch(t){console.error(t),await d.sleep(1e3),await e.disconnect()}}async _borrowExportedSender(e,t,n,s,i){if(this._additionalDcsDisabled)return;const o=s||0;let a;this._exportedSenderPromises[e]||(this._exportedSenderPromises[e]={}),this._exportedSenderPromises[e][o]&&!t||(this._exportedSenderPromises[e][o]=this._connectSender(n||this._createExportedSender(e,o),e,i));try{if(a=await this._exportedSenderPromises[e][o],!a.isConnected())return a.isConnecting?(await d.sleep(1e3),this._borrowExportedSender(e,!1,a,o,i)):this._borrowExportedSender(e,!0,a,o,i)}catch(t){return console.error(t),this._borrowExportedSender(e,!0,void 0,o,i)}return this._exportedSenderReleaseTimeouts[e]||(this._exportedSenderReleaseTimeouts[e]={}),this._exportedSenderReleaseTimeouts[e][o]&&(clearTimeout(this._exportedSenderReleaseTimeouts[e][o]),this._exportedSenderReleaseTimeouts[e][o]=void 0),this._exportedSenderReleaseTimeouts[e][o]=setTimeout((()=>{this._exportedSenderReleaseTimeouts[e][o]=void 0,a.disconnect()}),3e4),a}_createExportedSender(e,t){return new m(this.session.getAuthKey(e),{logger:this._log,dcId:e,retries:this._connectionRetries,delay:this._retryDelay,autoReconnect:this._autoReconnect,connectTimeout:this._timeout,authKeyCallback:this._authKeyCallback.bind(this),isMainSender:e===this.session.dcId,onConnectionBreak:()=>this._cleanupExportedSender(e,t)})}getSender(e,t,n){return e?this._borrowExportedSender(e,void 0,void 0,t,n):Promise.resolve(this._sender)}downloadFile(e,t={}){return v(this,e,t)}downloadMedia(e,t){let n;if(n=e instanceof p.Message?e.media:e instanceof p.MessageService?e.action.photo:e,"string"==typeof n)throw new Error("not implemented");return n instanceof p.MessageMediaWebPage&&n.webpage instanceof p.WebPage&&(n=n.webpage.document||n.webpage.photo),n instanceof p.MessageMediaPhoto||n instanceof p.Photo?this._downloadPhoto(n,t):n instanceof p.MessageMediaDocument||n instanceof p.Document?this._downloadDocument(n,t):n instanceof p.MessageMediaContact?this._downloadContact(n,t):n instanceof p.WebDocument||n instanceof p.WebDocumentNoProxy?this._downloadWebDocument(n,t):void 0}downloadProfilePhoto(e,t=!1){const n=t?"x":"m";let s,i,o;if([765557111,3316604308,524706233,3566872215].includes(e.SUBCLASS_OF_ID)){if(!e.photo){if(!e.chatPhoto)return;return this._downloadPhoto(e.chatPhoto,{sizeType:n})}s=e.photo}else s=e;if(s instanceof p.UserProfilePhoto||s instanceof p.ChatPhoto)return i=s.dcId,o=new p.InputPeerPhotoFileLocation({peer:u.getInputPeer(e),photoId:s.photoId,big:t}),this.downloadFile(o,{dcId:i})}downloadStickerSetThumb(e){if(!e.thumbs?.length&&!e.thumbDocumentId)return;const{thumbVersion:t}=e;return e.thumbDocumentId?this.invoke(new p.messages.GetCustomEmojiDocuments({documentId:[e.thumbDocumentId]})).then((e=>{const t=e[0];return this.downloadFile(new p.InputDocumentFileLocation({id:t.id,accessHash:t.accessHash,fileReference:t.fileReference,thumbSize:""}),{fileSize:t.size.toJSNumber(),dcId:t.dcId})})):this.downloadFile(new p.InputStickerSetThumb({stickerset:new p.InputStickerSetID({id:e.id,accessHash:e.accessHash}),thumbVersion:t}),{dcId:e.thumbDcId})}_pickFileSize(e,t){if(!t||!e||!e.length)return;let n;for(let s=P.indexOf(t);s<P.length;s++)if(n=e.find((e=>e.type===P[s])),n)return n}_downloadCachedPhotoSize(e){let t;return t=e instanceof p.PhotoStrippedSize?u.strippedPhotoToJpg(e.bytes):e.bytes,t}_downloadPhoto(e,t){if(e instanceof p.MessageMediaPhoto&&(e=e.photo),!(e instanceof p.Photo))return;const n="u"===t.sizeType||"v"===t.sizeType,s=this._pickFileSize(n?[...e.videoSizes,...e.sizes]:e.sizes,t.sizeType);return!s||s instanceof p.PhotoSizeEmpty?void 0:s instanceof p.PhotoCachedSize||s instanceof p.PhotoStrippedSize?this._downloadCachedPhotoSize(s):this.downloadFile(new p.InputPhotoFileLocation({id:e.id,accessHash:e.accessHash,fileReference:e.fileReference,thumbSize:s.type}),{dcId:e.dcId,fileSize:s.size||Math.max(...s.sizes||[]),progressCallback:t.progressCallback})}_downloadDocument(e,t){if(e instanceof p.MessageMediaDocument&&(e=e.document),!(e instanceof p.Document))return;let n;if(t.sizeType){if(n=e.thumbs?this._pickFileSize([...e.videoThumbs||[],...e.thumbs],t.sizeType):void 0,!n&&e.mimeType.startsWith("video/"))return;if(n&&(n instanceof p.PhotoCachedSize||n instanceof p.PhotoStrippedSize))return this._downloadCachedPhotoSize(n)}return this.downloadFile(new p.InputDocumentFileLocation({id:e.id,accessHash:e.accessHash,fileReference:e.fileReference,thumbSize:n?n.type:""}),{fileSize:n?n.size:e.size.toJSNumber(),progressCallback:t.progressCallback,start:t.start,end:t.end,dcId:e.dcId,workers:t.workers})}_downloadContact(e,t){throw new Error("not implemented")}async _downloadWebDocument(e){if(e.url&&!("accessHash"in e)){const t=await fetch(e.url).then((e=>e.arrayBuffer()));return s.from(t)}try{const t=[];let n=0;for(;;){const s=new h.upload.GetWebFile({location:new p.InputWebFileLocation({url:e.url,accessHash:e.accessHash}),offset:n,limit:C}),i=await this._borrowExportedSender(4),o=await i.send(s);if(n+=131072,!o.bytes.length)break;if(t.push(o.bytes),o.bytes.length<C)break}return s.concat(t)}catch(e){if("WEBFILE_NOT_AVAILABLE"===e.message)return s.alloc(0);throw e}}async downloadStaticMap(e,t,n,i,o,c,d,u){try{const l=[];let f=0;for(;;)try{const s=new h.upload.GetWebFile({location:new p.InputWebFileGeoPointLocation({geoPoint:new p.InputGeoPoint({lat:n,long:t,accuracyRadius:u}),accessHash:e,w:i,h:o,zoom:c,scale:d}),offset:f,limit:C}),a=await this._borrowExportedSender(4),r=await a.send(s);if(f+=131072,!r.bytes.length)break;if(l.push(r.bytes),r.bytes.length<C)break}catch(e){if(e instanceof r.FloodWaitError){console.warn(`getWebFile: sleeping for ${e.seconds}s on flood wait`),await a(1e3*e.seconds);continue}}return s.concat(l)}catch(e){if("WEBFILE_NOT_AVAILABLE"===e.message)return s.alloc(0);throw e}}async invoke(e,t){if("request"!==e.classType)throw new Error("You can only invoke MTProtoRequests");const n=void 0===t?this._sender:await this.getSender(t);this._lastRequest=(new Date).getTime();let s=0;for(s=0;s<this._requestRetries;s++){const t=n.sendWithInvokeSupport(e);try{return await t.promise}catch(e){if(e instanceof r.ServerError||"RPC_CALL_FAIL"===e.message||"RPC_MCGET_FAIL"===e.message)this._log.warn(`Telegram is having internal issues ${e.constructor.name}`),await a(2e3);else if(e instanceof r.FloodWaitError||e instanceof r.FloodTestPhoneWaitError){if(!(e.seconds<=this.floodSleepLimit))throw e;this._log.info(`Sleeping for ${e.seconds}s on flood wait`),await a(1e3*e.seconds)}else if(e instanceof r.PhoneMigrateError||e instanceof r.NetworkMigrateError||e instanceof r.UserMigrateError){if(this._log.info(`Phone migrated to ${e.newDc}`),(e instanceof r.PhoneMigrateError||e instanceof r.NetworkMigrateError)&&await b(this))throw e;await this._switchDC(e.newDc)}else{if(!(e instanceof r.MsgWaitError))throw e;await t.isReady()}}}throw new Error(`Request was unsuccessful ${s} time(s)`)}setIsPremium(e){this.isPremium=e}async getMe(){try{return(await this.invoke(new h.users.GetUsers({id:[new p.InputUserSelf]})))[0]}catch(e){this._log.warn("error while getting me"),this._log.warn(e)}}async start(e){if(this.isConnected()||await this.connect(),await b(this,e.shouldThrowIfUnauthorized))return;const t={apiId:this.apiId,apiHash:this.apiHash};await w(this,t,e)}uploadFile(e){return A(this,e)}updateTwoFaSettings(e){return I(this,e)}getTmpPassword(e,t){return S(this,e,t)}addEventHandler(e,t){this._eventBuilders.push([t,e])}_handleUpdate(e){if(e instanceof p.Updates||e instanceof p.UpdatesCombined){const t=[];for(const n of[...e.users,...e.chats])t.push(n);for(const n of e.updates)this._processUpdate(n,e.updates,t)}else e instanceof p.UpdateShort?this._processUpdate(e.update,void 0):this._processUpdate(e,void 0)}_processUpdate(e,t,n){e._entities=n||[];const s={update:e,others:t};this._dispatchUpdate(s)}async _dispatchUpdate(e={update:void 0,others:void 0,channelId:void 0,ptsDate:void 0}){for(const[t,n]of this._eventBuilders){const s=t.build(e.update);s&&await n(s)}}isConnected(){return!(!this._sender||!this._sender.isConnected())}}var M,R,D;function T(e,t){let n=!1;return Promise.race([e(),d.sleep(t).then((()=>n?void 0:Promise.reject(new Error("TIMEOUT"))))]).finally((()=>{n=!0}))}async function k(e,t,n){for(let s=0;s<t;s++)try{return await e()}catch(e){if(s===t-1)throw e;await d.sleep(n)}}M=_,D={connection:g,useIPV6:!1,proxy:void 0,timeout:10,requestRetries:5,connectionRetries:1/0,retryDelay:1e3,autoReconnect:!0,sequentialUpdates:!1,floodSleepLimit:60,deviceModel:void 0,systemVersion:void 0,appVersion:void 0,langCode:"en",systemLangCode:"en",baseLogger:"gramjs",useWSS:!1,additionalDcsDisabled:!1,testServers:!1,dcId:2},(R=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(R="DEFAULT_OPTIONS"))in M?Object.defineProperty(M,R,{value:D,enumerable:!0,configurable:!0,writable:!0}):M[R]=D,e.exports=_},21545:(e,t,n)=>{"use strict";n.r(t),n.d(t,{authFlow:()=>l,checkAuthorization:()=>p,signInUserWithPreferredMethod:()=>f});var s=n(77150),i=n.n(s),o=n(48960),a=n.n(o),r=n(89618),c=n(59674);const d="phoneNumber",u=3e4;async function l(e,t,n){let s;s="botAuthToken"in n?await async function(e,t,n){const{apiId:s,apiHash:o}=t,{botAuthToken:a}=n,{user:r}=await e.invoke(new(i().auth.ImportBotAuthorization)({apiId:s,apiHash:o,botAuthToken:a}));return r}(e,t,n):"webAuthToken"in n&&n.webAuthToken?await async function(e,t,n){try{const{apiId:s,apiHash:o}=t,a=await e.invoke(new(i().auth.ImportWebTokenAuthorization)({webAuthToken:n.webAuthToken,apiId:s,apiHash:o}));if(a instanceof i().auth.Authorization)return a.user;throw new Error("SIGN_UP_REQUIRED")}catch(s){return"SESSION_PASSWORD_NEEDED"===s.message?y(e,0,n,!0):(e._log.error(`Failed to login with web token: ${s}`),n.webAuthTokenFailed(),f(e,t,{...n,webAuthToken:void 0}))}}(e,t,n):await f(e,t,n),e._log.info("Signed in successfully as",a().getDisplayName(s))}async function f(e,t,n){const{initialMethod:s=d}=n;return"phoneNumber"===s?h(e,t,n):g(e,t,n)}async function p(e,t=!1){try{return await e.invoke(new(i().updates.GetState)),!0}catch(e){if("Disconnect"===e.message||t)throw e;return!1}}async function h(e,t,n){let s,o,a,r=!1;for(;;)try{if("function"==typeof n.phoneNumber)try{s=await n.phoneNumber()}catch(s){if("RESTART_AUTH_WITH_QR"===s.message)return g(e,t,n);throw s}else s=n.phoneNumber;const i=await m(e,t,s,n.forceSMS);if(o=i.phoneCodeHash,r=i.isCodeViaApp,"string"!=typeof o)throw new Error("Failed to retrieve phone code hash");break}catch(e){if("function"!=typeof n.phoneNumber)throw e;n.onError(e)}let c,d=!1;for(;;)try{try{a=await n.phoneCode(r)}catch(s){if("RESTART_AUTH"===s.message)return h(e,t,n)}if(!a)throw new Error("Code is empty");const u=await e.invoke(new(i().auth.SignIn)({phoneNumber:s,phoneCodeHash:o,phoneCode:a}));if(u instanceof i().auth.AuthorizationSignUpRequired){d=!0,c=u.termsOfService;break}return u.user}catch(t){if("SESSION_PASSWORD_NEEDED"===t.message)return y(e,0,n);n.onError(t)}if(d)for(;;)try{const[t,a]=await n.firstAndLastNames();if(!t)throw new Error("First name is required");const{user:r}=await e.invoke(new(i().auth.SignUp)({phoneNumber:s,phoneCodeHash:o,firstName:t,lastName:a}));return c&&await e.invoke(new(i().help.AcceptTermsOfService)({id:c.id})),r}catch(e){n.onError(e)}return n.onError(new Error("Auth failed")),h(e,t,n)}async function g(e,t,n){let s=!1;const o=(async()=>{for(;!s;){const t=await e.invoke(new(i().auth.ExportLoginToken)({apiId:Number(process.env.TELEGRAM_T_API_ID),apiHash:process.env.TELEGRAM_T_API_HASH,exceptIds:[]}));if(!(t instanceof i().auth.LoginToken))throw new Error("Unexpected");const{token:s,expires:o}=t;await Promise.race([n.qrCode({token:s,expires:o}),(0,r.sleep)(u)])}})(),a=new Promise((t=>{e.addEventHandler((e=>{e instanceof i().UpdateLoginToken&&t()}),{build:e=>e})}));try{await Promise.race([a,o])}catch(s){if("RESTART_AUTH"===s.message)return await h(e,t,n);throw s}finally{s=!0}try{const t=await e.invoke(new(i().auth.ExportLoginToken)({apiId:Number(process.env.TELEGRAM_T_API_ID),apiHash:process.env.TELEGRAM_T_API_HASH,exceptIds:[]}));if(t instanceof i().auth.LoginTokenSuccess&&t.authorization instanceof i().auth.Authorization)return t.authorization.user;if(t instanceof i().auth.LoginTokenMigrateTo){await e._switchDC(t.dcId);const n=await e.invoke(new(i().auth.ImportLoginToken)({token:t.token}));if(n instanceof i().auth.LoginTokenSuccess&&n.authorization instanceof i().auth.Authorization)return n.authorization.user}}catch(t){if("SESSION_PASSWORD_NEEDED"===t.message)return y(e,0,n);throw t}throw void 0}async function m(e,t,n,s=!1){try{const{apiId:o,apiHash:a}=t,r=await e.invoke(new(i().auth.SendCode)({phoneNumber:n,apiId:o,apiHash:a,settings:new(i().CodeSettings)}));if(!(r instanceof i().auth.SentCode))throw Error("Unexpected SentCodeSuccess");if(!s||r.type instanceof i().auth.SentCodeTypeSms)return{phoneCodeHash:r.phoneCodeHash,isCodeViaApp:r.type instanceof i().auth.SentCodeTypeApp};const c=await e.invoke(new(i().auth.ResendCode)({phoneNumber:n,phoneCodeHash:r.phoneCodeHash}));if(!(c instanceof i().auth.SentCode))throw Error("Unexpected SentCodeSuccess");return{phoneCodeHash:c.phoneCodeHash,isCodeViaApp:c.type instanceof i().auth.SentCodeTypeApp}}catch(i){if("AUTH_RESTART"===i.message)return m(e,t,n,s);throw i}}async function y(e,t,n,s=!1){for(;;)try{const t=await e.invoke(new(i().account.GetPassword)),o=await n.password(t.hint,s);if(!o)throw new Error("Password is empty");const a=await(0,c.computeCheck)(t,o),{user:r}=await e.invoke(new(i().auth.CheckPassword)({password:a}));return r}catch(e){n.onError(e)}}},52288:(e,t,n)=>{"use strict";n.r(t),n.d(t,{downloadFile:()=>I});var s=n(24736),i=n.n(s),o=n(77150),a=n.n(o),r=n(89618),c=n(48960),d=n(87873),u=n.n(d),l=n(46586),f=n(16039),p=n(48764).Buffer;function h(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g=4096,m=64,y=1048576,w=1e3,b=6e4,v=5;class A{constructor(e){h(this,"type",void 0),h(this,"size",void 0),h(this,"buffer",void 0),h(this,"largeFile",void 0),h(this,"largeFileAccessHandle",void 0),this.size=e,this.type=e&&e>self.maxBufferSize?"opfs":"memory"}async init(){if("opfs"===this.type){if(!FileSystemFileHandle?.prototype.createSyncAccessHandle)throw new Error("`createSyncAccessHandle` is not available. Cannot download files larger than 2GB.");const e=await navigator.storage.getDirectory(),t=await e.getDirectoryHandle("downloads",{create:!0});this.largeFile=await t.getFileHandle(Math.random().toString(),{create:!0}),this.largeFileAccessHandle=await this.largeFile.createSyncAccessHandle()}else this.buffer=this.size?p.alloc(this.size):p.alloc(0)}write(e,t){if("opfs"===this.type)this.largeFileAccessHandle.write(e,{at:t});else if(this.size)for(let n=0;n<e.length;n++){if(t+n>=this.buffer.length)return;this.buffer.writeUInt8(e[n],t+n)}else this.buffer=p.concat([this.buffer,e])}getData(){return"opfs"===this.type?this.largeFile.getFile():Promise.resolve(this.buffer)}}async function I(e,t,n){const{dcId:s}=n;for(let i=0;i<v;i++)try{return await M(e,t,n)}catch(t){if(!((t.message.startsWith("SESSION_REVOKED")||t.message.startsWith("CONNECTION_NOT_INITED"))&&i<v-1))throw t;await e._cleanupExportedSenders(s)}}const S=3,C=6,P=10485760,_=Array(C).fill(void 0).map((()=>new f.J(10)));async function M(e,t,n){let{partSizeKb:s,end:o}=n;const{fileSize:d}=n,f=Boolean(e.isPremium),{dcId:p,progressCallback:h,start:v=0}=n;o=o&&o<d?o:d-1,s||(s=d?(0,c.getDownloadPartSize)(d):m);const I=1024*s,M=o?Math.ceil((o-v)/I):1,R=!o,D=d&&d>=P&&!R;let T;if(I%g!=0)throw new Error(`The part size must be evenly divisible by ${g}`);e._log.info(`Downloading file in chunks of ${I} bytes`);const k=new A(o-v+1),E=[];let U=v;const B=_.map((({activeWorkers:e})=>e));let x=B.indexOf(Math.min(...B)),N=!1,O=0;for(h&&h(O),await k.init();;){let n=I,s=!1;Math.floor(U/y)!==Math.floor((U+n-1)/y)&&(n=y-U%y,s=!0);const c=D?x%(f?C:S):0;if(await _[c].requestWorker(),T&&await T.promise,R&&(T=new l.default),N){_[c].releaseWorker();break}if(E.push((async d=>{for(;;){let l;try{l=await e.getSender(p,c,f);const u=await Promise.race([l.send(new(a().upload.GetFile)({location:t,offset:i()(d),limit:n,precise:s||void 0})),(0,r.sleep)(b).then((()=>p===e.session.dcId?Promise.reject(new Error("USER_CANCELED")):Promise.reject(new Error("SESSION_REVOKED"))))]);if(h){if(h.isCanceled)throw new Error("USER_CANCELED");O+=1/M,h(O)}return!o&&u.bytes.length<n&&(N=!0),_[c].releaseWorker(),T&&T.resolve(),void k.write(u.bytes,d-v)}catch(e){if(l&&!l.isConnected()){await(0,r.sleep)(w);continue}if(e instanceof u().FloodWaitError){await(0,r.sleep)(1e3*e.seconds);continue}throw _[c].releaseWorker(),T&&T.resolve(),N=!0,e}}})(U)),U+=n,x++,o&&U>o)break}return await Promise.all(E),k.getData()}},74766:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getFileId:()=>C,uploadFile:()=>M,uploadFileCache:()=>_,uploadFileV1:()=>P});var s=n(77150),i=n.n(s),o=n(89618),a=n(48960),r=n(87873),c=n.n(r),d=n(16039),u=n(3783),l=n(83716),f=n(15023),p=n(83579),h=n(49524),g=n(2133),m=n(63024),y=n(48764).Buffer;const w=1024,b=10485760,v=1e3,A=3,I=6,S=Array(I).fill(void 0).map((()=>new d.J(10))),C=()=>(0,o.readBigIntFromBuffer)((0,o.generateRandomBytes)(8),!0,!0).toString().replace("-","").replace("n","");async function P(e){const{file:t,onProgress:n}=e,{name:s,size:o}=t;let r=C();const c=Number(r);r=String(c),f.ZP.cache[r]=t;const d=o>b,v=(0,a.getUploadPartSize)(o)*w,A=Math.floor((o+v-1)/v);n&&n(0);const I=await(0,g.z1)(t),S=p.Z.localEncrypt(y.from(I)),P=new u.dZ({file:{id:r,part:0,part_total:1,buf:S,size:o,type:t.type},err:m.wb.NO_ERROR}).pack().getPbData(),_=new Blob([y.from(P)]);return await h.save(l.F9T,r,_),d?new(i().InputFileBig)({id:c,parts:A,name:s}):new(i().InputFile)({id:c,parts:A,name:s,md5Checksum:""})}async function _(e){const{buf:t,id:n}=e,s=t.length,i=n,o=(0,a.getUploadPartSize)(s)*w,r=Math.floor((s+o-1)/o),c=S.map((({activeWorkers:e})=>e));let d=c.indexOf(Math.min(...c));const f=[];for(let n=0;n<r;n++){const s=d%I;await S[s].requestWorker();const a=t.subarray(n*o,(n+1)*o);f.push((async(t,n)=>{for(;;){try{if(l.qHj&&p.Z.getCurrentAccount()?.getSession()){l.eMD&&console.log("uploadProfilePhoto",i,t,r);const s={id:i,size:e.size,type:e.type,part:t+1,part_total:r,buf:n},o=new u.US({file:s}),a=y.from(o.pack().getPbData());await fetch(`${l.qHj}/proto`,{method:"POST",body:a,headers:{Authorization:`Bearer ${p.Z.getCurrentAccount()?.getSession()}`}})}}catch(e){throw S[s].releaseWorker(),e}S[s].releaseWorker();break}})(n,a)),d++}await Promise.all(f)}async function M(e,t){const{file:n,onProgress:s}=t,r=Boolean(e.isPremium),{name:d,size:u}=n,l=(0,o.readBigIntFromBuffer)((0,o.generateRandomBytes)(8),!0,!0),f=u>b,p=(0,a.getUploadPartSize)(u)*w,h=Math.floor((u+p-1)/p),g=S.map((({activeWorkers:e})=>e));let m=g.indexOf(Math.min(...g)),C=0;s&&s(C);const P=[];for(let t=0;t<h;t++){const a=m%(r?I:A);if(await S[a].requestWorker(),s?.isCanceled){S[a].releaseWorker();break}const d=n.slice(t*p,(t+1)*p);P.push((async(t,n)=>{for(;;){let d;try{d=await e.getSender(e.session.dcId,a,r);const s=await n.arrayBuffer();await d.send(f?new(i().upload.SaveBigFilePart)({fileId:l,filePart:t,fileTotalParts:h,bytes:y.from(s)}):new(i().upload.SaveFilePart)({fileId:l,filePart:t,bytes:y.from(s)}))}catch(e){if(d&&!d.isConnected()){await(0,o.sleep)(v);continue}if(e instanceof c().FloodWaitError){await(0,o.sleep)(1e3*e.seconds);continue}throw S[a].releaseWorker(),e}if(S[a].releaseWorker(),s){if(s.isCanceled)throw new Error("USER_CANCELED");C+=1/h,s(C)}break}})(t,d)),m++}return await Promise.all(P),f?new(i().InputFileBig)({id:l,parts:h,name:d}):new(i().InputFile)({id:l,parts:h,name:d,md5Checksum:""})}},13302:(e,t,n)=>{var s=n(48764).Buffer;const{sha1:i,toSignedLittleBuffer:o,readBufferFromBigInt:a,readBigIntFromBuffer:r}=n(89618),c=n(35544),{sleep:d}=n(89618);class u{constructor(e,t){if(!t||!e)return;this._key=e,this._hash=t;const n=new c(t);this.auxHash=n.readLong(!1),n.read(4),this.keyId=n.readLong(!1)}async setKey(e){if(!e)return this._key=void 0,this.auxHash=void 0,this.keyId=void 0,void(this._hash=void 0);if(e instanceof u)return this._key=e._key,this.auxHash=e.auxHash,this.keyId=e.keyId,void(this._hash=e._hash);this._key=e,this._hash=await i(this._key);const t=new c(this._hash);this.auxHash=t.readLong(!1),t.read(4),this.keyId=t.readLong(!1)}async waitForKey(){for(;!this.keyId;)await d(20)}getKey(){return this._key}async calcNewNonceHash(e,t){e=o(e,32);const n=s.alloc(1);n.writeUInt8(t,0);const c=s.concat([e,s.concat([n,a(this.auxHash,8,!0)])]),d=(await i(c)).slice(4,20);return r(d,!0,!0)}equals(e){return e instanceof this.constructor&&this._key&&e.getKey()&&e.getKey().equals(this._key)}}e.exports=u},55830:(e,t,n)=>{var s=n(48764).Buffer;const i=n(66842);e.exports=class{constructor(e,t){if(!s.isBuffer(e)||!s.isBuffer(t)||16!==t.length)throw new Error("Key and iv need to be a buffer");this.cipher=i.createCipheriv("AES-256-CTR",e,t)}encrypt(e){return s.from(this.cipher.update(e))}}},89636:(e,t,n)=>{const s=n(24736),{modExp:i}=n(89618);class o{static gcd(e,t){for(;t.neq(s.zero);){const n=t;t=e.remainder(t),e=n}return e}static factorize(e){if(e.remainder(2).equals(s.zero))return{p:s(2),q:e.divide(s(2))};let t=s.randBetween(s(1),e.minus(1));const n=s.randBetween(s(1),e.minus(1)),a=s.randBetween(s(1),e.minus(1));let r,c=s.one,d=s.one,u=s.one,l=s.zero,f=s.zero;for(;c.eq(s.one);){l=t;for(let o=0;s(o).lesser(d);o++)t=i(t,s(2),e).add(n).remainder(e);for(r=s.zero;r.lesser(d)&&c.eq(s.one);){f=t;const p=s.min(a,d.minus(r));for(let o=0;s(o).lesser(p);o++)t=i(t,s(2),e).add(n).remainder(e),u=u.multiply(l.minus(t).abs()).remainder(e);c=o.gcd(u,e),r=r.add(a)}d=d.multiply(2)}if(c.eq(e))for(;f=i(f,s(2),e).add(n).remainder(e),c=o.gcd(l.minus(f).abs(),e),!c.greater(1););const p=c;return u=e.divide(c),p<u?{p,q:u}:{p:u,q:p}}}e.exports=o},32608:(e,t,n)=>{var s=n(48764).Buffer;const{IGE:i}=n(28136),o=n(89618);e.exports=class{constructor(e,t){this.ige=new i(e,t)}decryptIge(e){return o.convertToLittle(this.ige.decrypt(e))}encryptIge(e){const t=e.length%16;return t&&(e=s.concat([e,o.generateRandomBytes(16-t)])),o.convertToLittle(this.ige.encrypt(e))}}},87873:(e,t,n)=>{const{RPCError:s}=n(86952),{rpcErrorRe:i}=n(65651),o=n(48187),a=n(86952),r=n(65651);e.exports={RPCMessageToError:function(e,t){for(const[n,s]of i){const i=e.errorMessage.match(n);if(i)return new s({request:t,capture:2===i.length?parseInt(i[1],10):void 0})}return new s(e.errorMessage,t)},...o,...a,...r}},26316:()=>{},43903:(e,t,n)=>{const{EventBuilder:s}=n(80663);e.exports=class extends s{constructor(e={types:void 0,func:void 0}){super(),e.types?this.types=e.types:this.types=!0}build(e){return e}}},80663:e=>{e.exports={EventBuilder:class{constructor(e={chats:void 0,blacklistChats:void 0,func:void 0}){this.chats=e.chats,this.blacklistChats=Boolean(e.blacklistChats),this.resolved=!1,this.func=e.func}build(e){}}}},33182:(e,t,n)=>{const s=n(26316),i=n(43903);class o extends Error{}e.exports={NewMessage:s,StopPropagation:o,Raw:i}},16151:e=>{e.exports=class{constructor(){this._queue=[],this.canGet=new Promise((e=>{this.resolveGet=e})),this.canPush=!0}async push(e){await this.canPush,this._queue.push(e),this.resolveGet(!0),this.canPush=new Promise((e=>{this.resolvePush=e}))}async pop(){await this.canGet;const e=this._queue.pop();return this.resolvePush(!0),this.canGet=new Promise((e=>{this.resolveGet=e})),e}}},35544:(e,t,n)=>{const{TypeNotFoundError:s}=n(48187),{coreObjects:i}=n(92058),{tlobjects:o}=n(70845),{readBigIntFromBuffer:a}=n(89618);e.exports=class{constructor(e){this.stream=e,this._last=void 0,this.offset=0}readByte(){return this.read(1)[0]}readInt(e=!0){let t;return t=e?this.stream.readInt32LE(this.offset):this.stream.readUInt32LE(this.offset),this.offset+=4,t}readLong(e=!0){return this.readLargeInt(64,e)}readFloat(){return this.read(4).readFloatLE(0)}readDouble(){return this.read(8).readDoubleLE(0)}readLargeInt(e,t=!0){const n=this.read(Math.floor(e/8));return a(n,!0,t)}read(e=-1){-1===e&&(e=this.stream.length-this.offset);const t=this.stream.slice(this.offset,this.offset+e);if(this.offset+=e,t.length!==e)throw Error(`No more data left to read (need ${e}, got ${t.length}: ${t}); last read ${this._last}`);return this._last=t,t}getBuffer(){return this.stream}tgReadBytes(){const e=this.readByte();let t,n;254===e?(n=this.readByte()|this.readByte()<<8|this.readByte()<<16,t=n%4):(n=e,t=(n+1)%4);const s=this.read(n);return t>0&&(t=4-t,this.read(t)),s}tgReadString(){return this.tgReadBytes().toString("utf-8")}tgReadBool(){const e=this.readInt(!1);if(2574415285===e)return!0;if(3162085175===e)return!1;throw new Error(`Invalid boolean code ${e.toString("16")}`)}tgReadDate(){const e=this.readInt();return new Date(1e3*e)}tgReadObject(){const e=this.readInt(!1);let t=o[e];if(void 0===t){if(2574415285===e)return!0;if(3162085175===e)return!1;if(481674261===e){const e=[],t=this.readInt();for(let n=0;n<t;n++)e.push(this.tgReadObject());return e}if(t=i[e],void 0===t){this.seek(-4);const t=this.tellPosition(),n=new s(e,this.read());throw this.setPosition(t),n}}return t.fromReader(this)}tgReadVector(){if(481674261!==this.readInt(!1))throw new Error("Invalid constructor code, vector was expected");const e=this.readInt(),t=[];for(let n=0;n<e;n++)t.push(this.tgReadObject());return t}close(){this.stream=void 0}tellPosition(){return this.offset}setPosition(e){this.offset=e}seek(e){this.offset+=e}}},96472:(e,t,n)=>{var s=n(48764).Buffer;e.exports=class{constructor(e){this._stream=e}write(e){this._stream=s.concat([this._stream,e])}getValue(){return this._stream}}},96748:e=>{let t;class n{constructor(e){t||(t=e||"debug"),this.isBrowser="undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs,this.isBrowser?this.colors={start:"%c",warn:"color : #ff00ff",info:"color : #ffff00",debug:"color : #00ffff",error:"color : #ff0000",end:""}:this.colors={start:"[2m",warn:"[35m",info:"[33m",debug:"[36m",error:"[31m",end:"[0m"},this.messageFormat="[%t] [%l] - [%m]"}static setLevel(e){t=e}canSend(e){return n.levels.indexOf(t)>=n.levels.indexOf(e)}warn(e){"debug"===t&&console.error((new Error).stack),this._log("warn",e,this.colors.warn)}info(e){this._log("info",e,this.colors.info)}debug(e){this._log("debug",e,this.colors.debug)}error(e){"debug"===t&&console.error((new Error).stack),this._log("error",e,this.colors.error)}format(e,t){return this.messageFormat.replace("%t",(new Date).toISOString()).replace("%l",t.toUpperCase()).replace("%m",e)}_log(e,n,s){t&&this.canSend(e)&&(this.isBrowser?console.log(this.colors.start+this.format(n,e),s):console.log(s+this.format(n,e)+this.colors.end))}}var s,i,o;s=n,o=["error","warn","info","debug"],(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(i="levels"))in s?Object.defineProperty(s,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[i]=o,e.exports=n},36411:(e,t,n)=>{var s=n(48764).Buffer;const i=n(63254),o=n(40355),a=n(96472),r=["messages.SendMessage","messages.SendMedia","messages.SendMultiMedia","messages.ForwardMessages","messages.SendInlineBotResult"];e.exports=class{constructor(e,t){this._state=e,this._queue=[],this._pendingStates=[],this._ready=new Promise((e=>{this.setReady=e})),this._log=t}values(){return this._queue}append(e){if(e&&r.includes(e.request.className))for(let t=this._queue.length-1;t>=0;t--)if(r.includes(this._queue[t].request.className)){e.after=this._queue[t];break}this._queue.push(e),this.setReady(!0),e&&1658238041!==e.request.CONSTRUCTOR_ID&&(this._pendingStates.push(e),e.promise.catch((()=>{})).finally((()=>{this._pendingStates=this._pendingStates.filter((t=>t!==e))})))}extend(e){for(const t of e)this._queue.push(t);this.setReady(!0)}async get(){if(this._queue.length||(this._ready=new Promise((e=>{this.setReady=e})),await this._ready),!this._queue[this._queue.length-1])return void(this._queue=[]);let e,t=new a(s.alloc(0));const n=[];let r=0;for(;this._queue.length&&n.length<=i.MAXIMUM_LENGTH;){const e=this._queue.shift();if(r+=e.data.length+o.SIZE_OVERHEAD,r<=i.MAXIMUM_SIZE){let s;e.after&&(s=e.after.msgId),e.msgId=await this._state.writeDataAsMessage(t,e.data,"request"===e.request.classType,s),this._log.debug(`Assigned msgId = ${e.msgId} to ${e.request.className||e.request.constructor.name}`),n.push(e)}else{if(n.length){this._queue.unshift(e);break}this._log.warn(`Message payload for ${e.request.className||e.request.constructor.name} is too long ${e.data.length} and cannot be sent`),e.reject("Request Payload is too big"),r=0}}if(n.length){if(n.length>1){const o=s.alloc(8);o.writeUInt32LE(i.CONSTRUCTOR_ID,0),o.writeInt32LE(n.length,4),e=s.concat([o,t.getValue()]),t=new a(s.alloc(0));const r=await this._state.writeDataAsMessage(t,e,!1);for(const e of n)e.containerId=r}return e=t.getValue(),{batch:n,data:e}}}rejectAll(){this._pendingStates.forEach((e=>{e.reject(new Error("Disconnect"))}))}}},7214:(e,t,n)=>{var s=n(48764).Buffer;const{Mutex:i}=n(48125),o=new i,a=new Error("WebSocket was closed");e.exports=class{constructor(e){this.client=void 0,this.closed=!0,this.disconnectedCallback=e}async readExactly(e){let t=s.alloc(0);for(;;){const n=await this.read(e);if(t=s.concat([t,n]),!(e-=n.length))return t}}async read(e){if(this.closed)throw a;if(await this.canRead,this.closed)throw a;const t=this.stream.slice(0,e);return this.stream=this.stream.slice(e),0===this.stream.length&&(this.canRead=new Promise((e=>{this.resolveRead=e}))),t}async readAll(){if(this.closed||!await this.canRead)throw a;const e=this.stream;return this.stream=s.alloc(0),this.canRead=new Promise((e=>{this.resolveRead=e})),e}getWebSocketLink(e,t,n,s){return 443===t?`wss://${e}:${t}/apiws${n?"_test":""}${s?"_premium":""}`:`ws://${e}:${t}/apiws${n?"_test":""}${s?"_premium":""}`}connect(e,t,n=!1,i=!1){return this.stream=s.alloc(0),this.canRead=new Promise((e=>{this.resolveRead=e})),this.closed=!1,this.website=this.getWebSocketLink(t,e,n,i),this.client=new WebSocket(this.website,"binary"),new Promise(((e,n)=>{this.client.onopen=()=>{this.receive(),e(this)},this.client.onerror=e=>{console.error("WebSocket error",e),n(e)},this.client.onclose=e=>{const{code:n,reason:s,wasClean:i}=e;1e3!==n&&console.error(`Socket ${t} closed. Code: ${n}, reason: ${s}, was clean: ${i}`),this.resolveRead(!1),this.closed=!0,this.disconnectedCallback&&this.disconnectedCallback()},self.addEventListener("offline",(async()=>{await this.close(),this.resolveRead(!1)}))}))}write(e){if(this.closed)throw a;this.client.send(e)}async close(){await this.client.close(),this.closed=!0}receive(){this.client.onmessage=async e=>{await o.runExclusive((async()=>{const t=e.data instanceof ArrayBuffer?s.from(e.data):s.from(await new Response(e.data).arrayBuffer());this.stream=s.concat([this.stream,t]),this.resolveRead(!0)}))}}}},89832:(e,t,n)=>{const s=n(96748),i=n(96472),o=n(35544),a=n(7214),r=n(36411),c=n(16151);e.exports={BinaryWriter:i,BinaryReader:o,MessagePacker:r,AsyncQueue:c,Logger:s,PromisedWebSockets:a}},13522:(e,t,n)=>{const s=n(77150),i=n(78742),o=n(18415),a=n(57404),r=n(61472),c=n(33182),d=n(48960),u=n(87873),l=n(15886),f=n(89832),p=n(89618);e.exports={Api:s,TelegramClient:i,sessions:l,connection:o,extensions:f,tl:a,version:r,events:c,utils:d,errors:u,helpers:p}},59870:(e,t,n)=>{"use strict";n.r(t),n.d(t,{doAuthentication:()=>y});var s=n(77150),i=n.n(s),o=n(87873),a=n(24736),r=n.n(a);n(89618),n(48764).Buffer;const c=[{fingerprint:r()("-3414540481677951611"),n:r()("29379598170669337022986177149456128565388431120058863768162556424047512191330847455146576344487764408661701890505066208632169112269581063774293102577308490531282748465986139880977280302242772832972539403531316010870401287642763009136156734339538042419388722777357134487746169093539093850251243897188928735903389451772730245253062963384108812842079887538976360465290946139638691491496062099570836476454855996319192747663615955633778034897140982517446405334423701359108810182097749467210509584293428076654573384828809574217079944388301239431309115013843331317877374435868468779972014486325557807783825502498215169806323"),e:65537},{fingerprint:r()("-5595554452916591101"),n:r()("25342889448840415564971689590713473206898847759084779052582026594546022463853940585885215951168491965708222649399180603818074200620463776135424884632162512403163793083921641631564740959529419359595852941166848940585952337613333022396096584117954892216031229237302943701877588456738335398602461675225081791820393153757504952636234951323237820036543581047826906120927972487366805292115792231423684261262330394324750785450942589751755390156647751460719351439969059949569615302809050721500330239005077889855323917509948255722081644689442127297605422579707142646660768825302832201908302295573257427896031830742328565032949"),e:65537}].reduce(((e,{fingerprint:t,...n})=>(e.set(t.toString(),n),e)),new Map);var d=n(48764).Buffer;const u=n(24736),l=n(32608),f=n(13302),p=n(89636),h=n(89618),g=n(35544),m=20;async function y(e,t){let n=h.generateRandomBytes(16);const s=h.readBigIntFromBuffer(n,!1,!0),a=await e.send(new(i().ReqPqMulti)({nonce:s}));if(t.debug("Starting authKey generation step 1"),!(a instanceof i().ResPQ))throw new o.SecurityError(`Step 1 answer was ${a}`);if(a.nonce.neq(s))throw new o.SecurityError("Step 1 invalid nonce from server");const r=h.readBigIntFromBuffer(a.pq,!1,!0);t.debug("Finished authKey generation step 1");const{p:y,q:w}=p.factorize(r),b=h.getByteArray(y),v=h.getByteArray(w);n=h.generateRandomBytes(32);const A=h.readBigIntFromBuffer(n,!0,!0),I=new(i().PQInnerData)({pq:h.getByteArray(r),p:b,q:v,nonce:a.nonce,serverNonce:a.serverNonce,newNonce:A}).getBytes();if(I.length>144)throw new o.SecurityError("Step 1 invalid nonce from server");let S,C;for(const e of a.serverPublicKeyFingerprints)if(C=c.get(e.toString()),void 0!==C){S=e;break}if(void 0===S||void 0===C)throw new o.SecurityError("Step 2 could not find a valid key for fingerprints");const P=h.generateRandomBytes(192-I.length),_=d.concat([I,P]),M=d.from(_).reverse();let R;for(let e=0;e<m;e++){const e=h.generateRandomBytes(32),n=await h.sha256(d.concat([e,_])),s=d.concat([M,n]),i=new l(e,d.alloc(32)).encryptIge(s),o=h.bufferXor(e,await h.sha256(i)),a=d.concat([o,i]),r=h.readBigIntFromBuffer(a,!1,!1);if(r.greaterOrEquals(C.n)){t.debug("Aes key greater than RSA. retrying");continue}const c=h.modExp(r,u(C.e),C.n);R=h.readBufferFromBigInt(c,256,!1,!1);break}if(void 0===R)throw new o.SecurityError("Step 2 could create a secure encrypted key");t.debug("Step 2 : Generated a secure aes encrypted data");const D=await e.send(new(i().ReqDHParams)({nonce:a.nonce,serverNonce:a.serverNonce,p:b,q:v,publicKeyFingerprint:S,encryptedData:R}));if(!(D instanceof i().ServerDHParamsOk||D instanceof i().ServerDHParamsFail))throw new Error(`Step 2.1 answer was ${D}`);if(D.nonce.neq(a.nonce))throw new o.SecurityError("Step 2 invalid nonce from server");if(D.serverNonce.neq(a.serverNonce))throw new o.SecurityError("Step 2 invalid server nonce from server");if(D instanceof i().ServerDHParamsFail){const e=await h.sha1(h.toSignedLittleBuffer(A,32).slice(4,20)),t=h.readBigIntFromBuffer(e,!0,!0);if(D.newNonceHash.neq(t))throw new o.SecurityError("Step 2 invalid DH fail nonce from server")}if(!(D instanceof i().ServerDHParamsOk))throw new Error(`Step 2.2 answer was ${D}`);t.debug("Finished authKey generation step 2"),t.debug("Starting authKey generation step 3");const{key:T,iv:k}=await h.generateKeyDataFromNonce(a.serverNonce,A);if(D.encryptedAnswer.length%16!=0)throw new o.SecurityError("Step 3 AES block size mismatch");const E=new l(T,k),U=E.decryptIge(D.encryptedAnswer),B=new g(U);B.read(20);const x=B.tgReadObject();if(!(x instanceof i().ServerDHInnerData))throw new Error(`Step 3 answer was ${x}`);if(x.nonce.neq(a.nonce))throw new o.SecurityError("Step 3 Invalid nonce in encrypted answer");if(x.serverNonce.neq(a.serverNonce))throw new o.SecurityError("Step 3 Invalid server nonce in encrypted answer");const N=h.readBigIntFromBuffer(x.dhPrime,!1,!1),O=h.readBigIntFromBuffer(x.gA,!1,!1),q=x.serverTime-Math.floor((new Date).getTime()/1e3),H=h.readBigIntFromBuffer(h.generateRandomBytes(256),!1,!1),j=h.modExp(u(x.g),H,N),F=h.modExp(O,H,N),G=new(i().ClientDHInnerData)({nonce:a.nonce,serverNonce:a.serverNonce,retryId:u.zero,gB:h.getByteArray(j,!1)}).getBytes(),L=d.concat([await h.sha1(G),G]),$=E.encryptIge(L),K=await e.send(new(i().SetClientDHParams)({nonce:a.nonce,serverNonce:a.serverNonce,encryptedData:$})),z=[i().DhGenOk,i().DhGenRetry,i().DhGenFail];if(!(K instanceof z[0]||K instanceof z[1]||K instanceof z[2]))throw new Error(`Step 3.1 answer was ${K}`);const{name:W}=K.constructor;if(K.nonce.neq(a.nonce))throw new o.SecurityError(`Step 3 invalid ${W} nonce from server`);if(K.serverNonce.neq(a.serverNonce))throw new o.SecurityError(`Step 3 invalid ${W} server nonce from server`);const V=new f;await V.setKey(h.getByteArray(F));const Z=1+["DhGenOk","DhGenRetry","DhGenFail"].indexOf(K.className),J=await V.calcNewNonceHash(A,Z);if(K[`newNonceHash${Z}`].neq(J))throw new o.SecurityError("Step 3 invalid new nonce hash");if(!(K instanceof i().DhGenOk))throw new Error(`Step 3.2 answer was ${K}`);return t.debug("Finished authKey generation step 3"),{authKey:V,timeOffset:q}}},45585:(e,t,n)=>{var s=n(48764).Buffer;const i=n(24736),o=n(59109),a=n(35544),{InvalidBufferError:r}=n(48187),{toSignedLittleBuffer:c}=n(89618);e.exports=class{constructor(e,t){this._state=new o(e,t),this._connection=e}async send(e){let t=e.getBytes(),n=this._state._getNewMsgId();const o=c(n,8),d=s.alloc(4);d.writeInt32LE(t.length,0);const u=s.concat([s.concat([s.alloc(8),o,d]),t]);if(await this._connection.send(u),t=await this._connection.recv(),t.length<8)throw new r(t);const l=new a(t);if(l.readLong().neq(i(0)))throw new Error("Bad authKeyId");if(n=l.readLong(),n.eq(i(0)))throw new Error("Bad msgId");if(l.readInt()<=0)throw new Error("Bad length");return l.tgReadObject()}}},74046:(e,t,n)=>{const{RPCError:s}=n(87873),i=n(45585),o=n(59109),a=n(89618),r=n(13302),{doAuthentication:c}=n(59870),d=n(52301),u=n(63254),l=n(68963),f=n(44287),{MsgsAck:p,upload:h,MsgsStateInfo:g,Pong:m}=n(57404).constructors,y=n(36411),w=n(35544),{UpdateConnectionState:b,UpdateServerTimeOffset:v}=n(68744),{BadMessageError:A}=n(48187),{BadServerSalt:I,BadMsgNotification:S,MsgDetailedInfo:C,MsgNewDetailedInfo:P,NewSessionCreated:_,FutureSalts:M,MsgsStateReq:R,MsgResendReq:D,MsgsAllInfo:T}=n(57404).constructors,{SecurityError:k}=n(48187),{InvalidBufferError:E}=n(48187),{LogOut:U}=n(57404).requests.auth,{RPCMessageToError:B}=n(87873),{TypeNotFoundError:x}=n(48187);class N{constructor(e,t){const n={...N.DEFAULT_OPTIONS,...t};this._connection=void 0,this._log=n.logger,this._dcId=n.dcId,this._retries=n.retries,this._delay=n.delay,this._autoReconnect=n.autoReconnect,this._connectTimeout=n.connectTimeout,this._authKeyCallback=n.authKeyCallback,this._updateCallback=n.updateCallback,this._autoReconnectCallback=n.autoReconnectCallback,this._isMainSender=n.isMainSender,this._onConnectionBreak=n.onConnectionBreak,this.userDisconnected=!1,this._user_connected=!1,this.isReconnecting=!1,this._disconnected=!0,this._send_loop_handle=void 0,this._recv_loop_handle=void 0,this.authKey=e||new r,this._state=new o(this.authKey,this._log),this._send_queue=new y(this._state,this._log),this._pending_state={},this._pending_ack=new Set,this._last_acks=[],this._handlers={[d.CONSTRUCTOR_ID]:this._handleRPCResult.bind(this),[u.CONSTRUCTOR_ID]:this._handleContainer.bind(this),[l.CONSTRUCTOR_ID]:this._handleGzipPacked.bind(this),[m.CONSTRUCTOR_ID]:this._handlePong.bind(this),[I.CONSTRUCTOR_ID]:this._handleBadServerSalt.bind(this),[S.CONSTRUCTOR_ID]:this._handleBadNotification.bind(this),[C.CONSTRUCTOR_ID]:this._handleDetailedInfo.bind(this),[P.CONSTRUCTOR_ID]:this._handleNewDetailedInfo.bind(this),[_.CONSTRUCTOR_ID]:this._handleNewSessionCreated.bind(this),[p.CONSTRUCTOR_ID]:this._handleAck.bind(this),[M.CONSTRUCTOR_ID]:this._handleFutureSalts.bind(this),[R.CONSTRUCTOR_ID]:this._handleStateForgotten.bind(this),[D.CONSTRUCTOR_ID]:this._handleStateForgotten.bind(this),[T.CONSTRUCTOR_ID]:this._handleMsgAll.bind(this)}}async connect(e,t){if(this.userDisconnected=!1,this._user_connected&&!t)return this._log.info("User is already connected!"),!1;this.isConnecting=!0,this._connection=e;for(let e=0;e<this._retries;e++)try{await this._connect(),this._updateCallback&&this._updateCallback(new b(b.connected));break}catch(t){this._updateCallback&&0===e&&this._updateCallback(new b(b.disconnected)),this._log.error(`WebSocket connection failed attempt: ${e+1}`),console.error(t),await a.sleep(this._delay)}return this.isConnecting=!1,!0}isConnected(){return this._user_connected}async disconnect(){this.userDisconnected=!0,await this._disconnect()}send(e){if(!this._user_connected)throw new Error("Cannot send requests while disconnected");const t=new f(e);return this._send_queue.append(t),t.promise}sendWithInvokeSupport(e){if(!this._user_connected)throw new Error("Cannot send requests while disconnected");const t=new f(e,void 0,this._pending_state);return this._send_queue.append(t),t}async _connect(){if(this._log.info("Connecting to {0}...".replace("{0}",this._connection)),await this._connection.connect(),this._log.debug("Connection success!"),this.authKey.getKey())this._authenticated=!0,this._log.debug("Already have an auth key ...");else{const e=new i(this._connection,this._log);this._log.debug("New auth_key attempt ...");const t=await c(e,this._log);this._log.debug("Generated new auth_key successfully"),await this.authKey.setKey(t.authKey),this._state.timeOffset=t.timeOffset,this._updateCallback&&this._updateCallback(new v(this._state.timeOffset)),this._authKeyCallback&&await this._authKeyCallback(this.authKey,this._dcId)}this._user_connected=!0,this.isReconnecting=!1,this._log.debug("Starting send loop"),this._send_loop_handle=this._sendLoop(),this._log.debug("Starting receive loop"),this._recv_loop_handle=this._recvLoop(),this._log.info("Connection to %s complete!".replace("%s",this._connection.toString()))}async _disconnect(){this._send_queue.rejectAll(),this._updateCallback&&this._updateCallback(new b(b.disconnected)),void 0!==this._connection?(this._log.info("Disconnecting from %s...".replace("%s",this._connection.toString())),this._user_connected=!1,this._log.debug("Closing current connection..."),await this._connection.disconnect()):this._log.info("Not disconnecting (already have no connection)")}async _sendLoop(){for(this._send_queue=new y(this._state,this._log);this._user_connected&&!this.isReconnecting;){if(this._pending_ack.size){const e=new f(new p({msgIds:Array(...this._pending_ack)}));this._send_queue.append(e),this._last_acks.push(e),this._last_acks.length>=10&&this._last_acks.shift(),this._pending_ack.clear()}this._log.debug(`Waiting for messages to send...${this.isReconnecting}`);const e=await this._send_queue.get();if(this.isReconnecting)return;if(!e)continue;let{data:t}=e;const{batch:n}=e;this._log.debug(`Encrypting ${n.length} message(s) in ${t.length} bytes for sending`),t=await this._state.encryptMessageData(t);try{await this._connection.send(t)}catch(e){return this._log.error(e),void this._log.info("Connection closed while sending data")}for(const e of n)if(Array.isArray(e))for(const t of e)"request"===t.request.classType&&(this._pending_state[t.msgId]=t);else"request"===e.request.classType&&(this._pending_state[e.msgId]=e);this._log.debug("Encrypted messages put in a queue to be sent")}}async _recvLoop(){let e,t;for(;this._user_connected&&!this.isReconnecting;){this._log.debug("Receiving items from the network...");try{e=await this._connection.recv()}catch(e){return void(this.userDisconnected||(this._log.error(e),this._log.warn("Connection closed while receiving data"),this.reconnect()))}try{t=await this._state.decryptMessageData(e)}catch(e){if(e instanceof x){this._log.info(`Type ${e.invalidConstructorId} not found, remaining data ${e.remaining}`);continue}if(e instanceof k){this._log.warn(`Security error while unpacking a received message: ${e}`);continue}return e instanceof E?void(404===e.code?this._handleBadAuthKey():(this._log.warn(`Invalid buffer ${e.code} for dc ${this._dcId}`),this.reconnect())):(this._log.error("Unhandled error while receiving data"),this._log.error(e),void this.reconnect())}try{await this._processMessage(t)}catch(e){e instanceof s?"AUTH_KEY_UNREGISTERED"===e.message&&this._handleBadAuthKey(!0):(this._log.error("Unhandled error while receiving data"),this._log.error(e))}}}_handleBadAuthKey(e){e&&this._isMainSender||(this._log.warn(`Broken authorization key for dc ${this._dcId}, resetting...`),this._isMainSender&&this._updateCallback?this._updateCallback(new b(b.broken)):!this._isMainSender&&this._onConnectionBreak&&this._onConnectionBreak(this._dcId))}async _processMessage(e){this._pending_ack.add(e.msgId),e.obj=await e.obj;let t=this._handlers[e.obj.CONSTRUCTOR_ID];t||(t=this._handleUpdate.bind(this)),await t(e)}_popStates(e){let t=this._pending_state[e];if(t)return this._pending_state[e].deferred.resolve(),delete this._pending_state[e],[t];const n=[];for(t of Object.values(this._pending_state))t.containerId&&t.containerId.equals(e)&&n.push(t.msgId);if(n.length){const e=[];for(const t of n)e.push(this._pending_state[t]),this._pending_state[t].deferred.resolve(),delete this._pending_state[t];return e}for(const t of this._last_acks)if(t.msgId===e)return[t];return[]}_handleRPCResult(e){const t=e.obj,n=this._pending_state[t.reqMsgId];if(n&&(n.deferred.resolve(),delete this._pending_state[t.reqMsgId]),this._log.debug(`Handling RPC result for message ${t.reqMsgId}`),!n)try{if(!(new w(t.body).tgReadObject()instanceof h.File))throw new x("Not an upload.File")}catch(e){if(this._log.error(e),e instanceof x)return void this._log.info(`Received response without parent request: ${t.body}`);throw e}if(t.error){const e=B(t.error,n.request);throw this._send_queue.append(new f(new p({msgIds:[n.msgId]}))),n.reject(e),e}try{const e=new w(t.body),s=n.request.readResult(e);n.resolve(s)}catch(e){throw n.reject(e),e}}async _handleContainer(e){this._log.debug("Handling container");for(const t of e.obj.messages)await this._processMessage(t)}async _handleGzipPacked(e){this._log.debug("Handling gzipped data");const t=new w(e.obj.data);e.obj=t.tgReadObject(),await this._processMessage(e)}_handleUpdate(e){2331323052===e.obj.SUBCLASS_OF_ID?(this._log.debug(`Handling update ${e.obj.className}`),this._updateCallback&&this._updateCallback(e.obj)):this._log.warn(`Note: ${e.obj.className} is not an update, not dispatching it`)}_handlePong(e){const t=e.obj,n=this._state.updateTimeOffset(e.msgId);this._updateCallback&&this._updateCallback(new v(n)),this._log.debug(`Handling pong for message ${t.msgId}`);const s=this._pending_state[t.msgId];this._pending_state[t.msgId].deferred.resolve(),delete this._pending_state[t.msgId],s&&s.resolve(t)}_handleBadServerSalt(e){const t=e.obj;this._log.debug(`Handling bad salt for message ${t.badMsgId}`),this._state.salt=t.newServerSalt;const n=this._popStates(t.badMsgId);this._send_queue.extend(n),this._log.debug(`${n.length} message(s) will be resent`)}_handleBadNotification(e){const t=e.obj,n=this._popStates(t.badMsgId);if(this._log.debug(`Handling bad msg ${JSON.stringify(t)}`),[16,17].includes(t.errorCode)){const t=this._state.updateTimeOffset(e.msgId);this._updateCallback&&this._updateCallback(new v(t)),this._log.info(`System clock is wrong, set time offset to ${t}s`)}else if(32===t.errorCode)this._state._sequence+=64;else{if(33!==t.errorCode){for(const e of n)e.reject(new A(e.request,t.errorCode));return}this._state._sequence-=16}this._send_queue.extend(n),this._log.debug(`${n.length} messages will be resent due to bad msg`)}_handleDetailedInfo(e){const t=e.obj.answerMsgId;this._log.debug(`Handling detailed info for message ${t}`),this._pending_ack.add(t)}_handleNewDetailedInfo(e){const t=e.obj.answerMsgId;this._log.debug(`Handling new detailed info for message ${t}`),this._pending_ack.add(t)}_handleNewSessionCreated(e){this._log.debug("Handling new session created"),this._state.salt=e.obj.serverSalt}_handleAck(e){const t=e.obj;this._log.debug(`Handling acknowledge for ${t.msgIds}`);for(const e of t.msgIds){const t=this._pending_state[e];t&&t.request instanceof U&&(this._pending_state[e].deferred.resolve(),delete this._pending_state[e],t.resolve(!0))}}_handleFutureSalts(e){this._log.debug(`Handling future salts for message ${e.msgId}`);const t=this._pending_state[e.msgId];t&&(this._pending_state[e].deferred.resolve(),delete this._pending_state[e],t.resolve(e.obj))}_handleStateForgotten(e){this._send_queue.append(new f(new g(e.msgId,String.fromCharCode(1).repeat(e.obj.msgIds))))}_handleMsgAll(e){}reconnect(){this._user_connected&&!this.isReconnecting&&(this.isReconnecting=!0,a.sleep(1e3).then((()=>{this._log.info("Started reconnecting"),this._reconnect()})))}async _reconnect(){this._log.debug("Closing current connection...");try{await this._disconnect()}catch(e){this._log.warn(e)}this._send_queue.append(void 0),this._state.reset();const e=new this._connection.constructor(this._connection._ip,this._connection._port,this._connection._dcId,this._connection._log,this._connection._testServers);await this.connect(e,!0),this.isReconnecting=!1;for(const e of Object.values(this._pending_state))e.deferred.resolve();this._pending_state={},this._autoReconnectCallback&&await this._autoReconnectCallback()}}var O,q,H;O=N,H={logger:void 0,retries:1/0,delay:2e3,autoReconnect:!0,connectTimeout:void 0,authKeyCallback:void 0,updateCallback:void 0,autoReconnectCallback:void 0,isMainSender:void 0,onConnectionBreak:void 0},(q=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(q="DEFAULT_OPTIONS"))in O?Object.defineProperty(O,q,{value:H,enumerable:!0,configurable:!0,writable:!0}):O[q]=H,e.exports=N},59109:(e,t,n)=>{var s=n(48764).Buffer;const i=n(24736),o=n(28136),a=n(89618),r=n(32608),c=n(35544),d=n(68963),{TLMessage:u}=n(92058),{SecurityError:l,InvalidBufferError:f}=n(48187),{InvokeAfterMsg:p}=n(57404).requests,{toSignedLittleBuffer:h}=n(89618);e.exports=class{constructor(e,t,n=!1,s=!1){this.authKey=e,this._log=t,this._isCall=n,this._isOutgoing=s,this.timeOffset=0,this.salt=0,this.id=void 0,this._sequence=void 0,this._lastMsgId=void 0,this.msgIds=[],this.reset()}reset(){this.id=a.generateRandomLong(!0),this._sequence=0,this._lastMsgId=i(0),this.msgIds=[]}updateMessageId(e){e.msgId=this._getNewMsgId()}async _calcKey(e,t,n){const i=this._isCall?128+(this._isOutgoing^n?8:0):!0===n?0:8,[o,r]=await Promise.all([a.sha256(s.concat([t,e.slice(i,i+36)])),a.sha256(s.concat([e.slice(i+40,i+76),t]))]),c=s.concat([o.slice(0,8),r.slice(8,24),o.slice(24,32)]);return this._isCall?{key:c,iv:s.concat([r.slice(0,4),o.slice(8,16),r.slice(24,28)])}:{key:c,iv:s.concat([r.slice(0,8),o.slice(8,24),r.slice(24,32)])}}async writeDataAsMessage(e,t,n,i){const o=this._getNewMsgId(),a=this._getSeqNo(n);let r;r=i?await d.gzipIfSmaller(n,new p(i,{getBytes:()=>t}).getBytes()):await d.gzipIfSmaller(n,t);const c=s.alloc(4);c.writeInt32LE(a,0);const u=s.alloc(4);u.writeInt32LE(r.length,0);const l=h(o,8);return e.write(s.concat([l,c,u])),e.write(r),o}async encryptMessageData(e){if(await this.authKey.waitForKey(),this._isCall){const t=128+(this._isOutgoing?0:8),n=e.length;e=s.from(e),n%4!=0&&(e=s.concat([e,s.from(new Array(4-n%4).fill(32))]));const i=(await a.sha256(s.concat([this.authKey.getKey().slice(88+t,88+t+32),s.from(e)]))).slice(8,24),{iv:r,key:c}=await this._calcKey(this.authKey.getKey(),i,!0);return e=a.convertToLittle(new o.CTR(c,r).encrypt(e)),s.concat([i,e])}{const t=h(this.salt,8),n=h(this.id,8);e=s.concat([s.concat([t,n]),e]);const i=a.generateRandomBytes(a.mod(-(e.length+12),16)+12),o=(await a.sha256(s.concat([this.authKey.getKey().slice(88,120),e,i]))).slice(8,24),{iv:c,key:d}=await this._calcKey(this.authKey.getKey(),o,!0),u=a.readBufferFromBigInt(this.authKey.keyId,8);return s.concat([u,o,new r(d,c).encryptIge(s.concat([e,i]))])}}async decryptMessageData(e){if(e.length<8)throw new f(e);if(e.length<0)throw new l("Server replied with negative length");if(e.length%4!=0&&!this._isCall)throw new l("Server replied with length not divisible by 4");if(!this._isCall&&a.readBigIntFromBuffer(e.slice(0,8)).neq(this.authKey.keyId))throw new l("Server replied with an invalid auth key");const t=this._isCall?e.slice(0,16):e.slice(8,24),n=this._isCall?128+(this.isOutgoing?8:0):void 0,{iv:i,key:d}=await this._calcKey(this.authKey.getKey(),t,!1);if(this._isCall){const t=(e=e.slice(16)).length;e=s.concat([e,s.from(new Array(4-t%4).fill(0))]),e=(e=a.convertToLittle(new o.CTR(d,i).decrypt(e))).slice(0,t)}else e=new r(d,i).decryptIge(this._isCall?e.slice(16):e.slice(24));const p=this._isCall?await a.sha256(s.concat([this.authKey.getKey().slice(88+n,88+n+32),e])):await a.sha256(s.concat([this.authKey.getKey().slice(96,128),e]));if(!this._isCall&&!t.equals(p.slice(8,24)))throw new l("Received msg_key doesn't match with expected one");const h=new c(e);if(this._isCall)return h.readInt(!1),h.read(e.length-4);{if(h.readLong(),!h.readLong().eq(this.id))throw new l("Server replied with a wrong session ID");const t=h.readLong();if(this.msgIds.includes(t.toString()))throw new l("Duplicate msgIds");this.msgIds.length>500&&this.msgIds.shift(),this.msgIds.push(t.toString());const n=h.readInt(),s=h.readInt(),i=e.length-s;if(i<12||i>1024)throw new l("Server replied with the wrong message padding");const o=h.tgReadObject();return new u(t,n,o)}}_getNewMsgId(){const e=(new Date).getTime()/1e3+this.timeOffset,t=Math.floor(1e9*(e-Math.floor(e)));let n=i(Math.floor(e)).shiftLeft(i(32)).or(i(t).shiftLeft(i(2)));return this._lastMsgId.greaterOrEquals(n)&&(n=this._lastMsgId.add(i(4))),this._lastMsgId=n,n}updateTimeOffset(e){const t=this._getNewMsgId(),n=this.timeOffset,s=Math.floor((new Date).getTime()/1e3),o=e.shiftRight(i(32));return this.timeOffset=o-s,this.timeOffset!==n&&(this._lastMsgId=i(0),this._log.debug(`Updated time offset (old offset ${n}, bad ${t}, good ${e}, new ${this.timeOffset})`)),this.timeOffset}_getSeqNo(e){if(e){const e=2*this._sequence+1;return this._sequence+=1,e}return 2*this._sequence}}},44287:(e,t,n)=>{const{default:s}=n(46586);e.exports=class{constructor(e,t=undefined,n={}){this.containerId=void 0,this.msgId=void 0,this.request=e,this.data=e.getBytes(),this.after=t,this.result=void 0,this.pending=n,this.deferred=new s,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}isReady(){const e=this.pending[this.after.id];return!e||e.deferred.promise}}},34353:(e,t,n)=>{function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const i=n(7214),o=n(16151);class a{constructor(e,t,n,a,r,c){s(this,"PacketCodecClass",void 0),this._ip=e,this._port=t,this._dcId=n,this._log=a,this._testServers=r,this._isPremium=c,this._connected=!1,this._sendTask=void 0,this._recvTask=void 0,this._codec=void 0,this._obfuscation=void 0,this._sendArray=new o,this._recvArray=new o,this.socket=new i(this.disconnectCallback.bind(this))}async disconnectCallback(){await this.disconnect(!0)}async _connect(){this._log.debug("Connecting"),this._codec=new this.PacketCodecClass(this),await this.socket.connect(this._port,this._ip,this._testServers,this._isPremium),this._log.debug("Finished connecting"),await this._initConn()}async connect(){await this._connect(),this._connected=!0,this._sendTask||(this._sendTask=this._sendLoop()),this._recvTask=this._recvLoop()}async disconnect(e=!1){this._connected&&(this._connected=!1,this._recvArray.push(void 0),e||await this.socket.close())}async send(e){if(!this._connected)throw new Error("Not connected");await this._sendArray.push(e)}async recv(){for(;this._connected;){const e=await this._recvArray.pop();if(e)return e}throw new Error("Not connected")}async _sendLoop(){try{for(;this._connected;){const e=await this._sendArray.pop();if(!e)return void(this._sendTask=void 0);await this._send(e)}}catch(e){this._log.info("The server closed the connection while sending")}}async _recvLoop(){let e;for(;this._connected;){try{if(e=await this._recv(),!e)throw new Error("no data received")}catch(e){return this._log.info("connection closed"),void this.disconnect()}await this._recvArray.push(e)}}async _initConn(){this._codec.tag&&await this.socket.write(this._codec.tag)}_send(e){const t=this._codec.encodePacket(e);this.socket.write(t)}_recv(){return this._codec.readPacket(this.socket)}toString(){return`${this._ip}:${this._port}/${this.constructor.name.replace("Connection","")}`}}e.exports={Connection:a,PacketCodec:class{constructor(e){this._conn=e}encodePacket(e){throw new Error("Not Implemented")}readPacket(e){throw new Error("Not Implemented")}},ObfuscatedConnection:class extends a{constructor(...e){super(...e),s(this,"ObfuscatedIO",void 0)}_initConn(){this._obfuscation=new this.ObfuscatedIO(this),this.socket.write(this._obfuscation.header)}_send(e){this._obfuscation.write(this._codec.encodePacket(e))}_recv(){return this._codec.readPacket(this._obfuscation)}}}},26302:(e,t,n)=>{var s=n(48764).Buffer;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=n(24736),{readBufferFromBigInt:a}=n(89618),{Connection:r,PacketCodec:c}=n(34353);class d extends c{constructor(e){super(e),this.tag=d.tag,this.obfuscateTag=d.obfuscateTag}encodePacket(e){let t=e.length>>2;if(t<127){const e=s.alloc(1);e.writeUInt8(t,0),t=e}else t=s.concat([s.from("7f","hex"),a(o(t),3)]);return s.concat([t,e])}async readPacket(e){let t=(await e.read(1))[0];return t>=127&&(t=s.concat([await e.read(3),s.alloc(1)]).readInt32LE(0)),e.read(t<<2)}}i(d,"tag",s.from("ef","hex")),i(d,"obfuscateTag",s.from("efefefef","hex")),e.exports={ConnectionTCPAbridged:class extends r{constructor(...e){super(...e),i(this,"PacketCodecClass",d)}},AbridgedPacketCodec:d}},5484:()=>{},72986:(e,t,n)=>{var s=n(48764).Buffer;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{generateRandomBytes:o}=n(89618),{ObfuscatedConnection:a}=n(34353),{AbridgedPacketCodec:r}=n(26302),c=n(55830);class d{constructor(e){i(this,"header",void 0),this.connection=e.socket;const t=this.initHeader(e.PacketCodecClass);this.header=t.random,this._encrypt=t.encryptor,this._decrypt=t.decryptor}initHeader(e){const t=[s.from("50567247","hex"),s.from("474554","hex"),s.from("504f5354","hex"),s.from("eeeeeeee","hex")];let n;for(;;)if(n=o(64),239!==n[0]&&!n.slice(4,8).equals(s.alloc(4))){let e=!0;for(const s of t)if(s.equals(n.slice(0,4))){e=!1;break}if(e)break}n=n.toJSON().data;const i=s.from(n.slice(8,56)).reverse(),a=s.from(n.slice(8,40)),r=s.from(n.slice(40,56)),d=s.from(i.slice(0,32)),u=s.from(i.slice(32,48)),l=new c(a,r),f=new c(d,u);return n=s.concat([s.from(n.slice(0,56)),e.obfuscateTag,s.from(n.slice(60))]),n=s.concat([s.from(n.slice(0,56)),s.from(l.encrypt(n).slice(56,64)),s.from(n.slice(64))]),{random:n,encryptor:l,decryptor:f}}async read(e){const t=await this.connection.readExactly(e);return this._decrypt.encrypt(t)}write(e){this.connection.write(this._encrypt.encrypt(e))}}e.exports={ConnectionTCPObfuscated:class extends a{constructor(...e){super(...e),i(this,"ObfuscatedIO",d),i(this,"PacketCodecClass",r)}}}},30417:(e,t,n)=>{const{Connection:s}=n(34353),{ConnectionTCPFull:i}=n(5484),{ConnectionTCPAbridged:o}=n(26302),{ConnectionTCPObfuscated:a}=n(72986);e.exports={Connection:s,ConnectionTCPFull:i,ConnectionTCPAbridged:o,ConnectionTCPObfuscated:a}},18415:(e,t,n)=>{const s=n(45585),i=n(74046),{Connection:o,ConnectionTCPFull:a,ConnectionTCPAbridged:r,ConnectionTCPObfuscated:c}=n(30417),{UpdateConnectionState:d,UpdateServerTimeOffset:u}=n(68744);e.exports={Connection:o,ConnectionTCPFull:a,ConnectionTCPAbridged:r,ConnectionTCPObfuscated:c,MTProtoPlainSender:s,MTProtoSender:i,UpdateConnectionState:d,UpdateServerTimeOffset:u}},68744:e=>{function t(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class n{constructor(e,t){this.state=e,this.origin=t}}t(n,"disconnected",-1),t(n,"connected",1),t(n,"broken",0),e.exports={UpdateConnectionState:n,UpdateServerTimeOffset:class{constructor(e){this.timeOffset=e}}}},59270:e=>{e.exports=class{get dcId(){throw new Error("Not Implemented")}get serverAddress(){throw new Error("Not Implemented")}get port(){throw new Error("Not Implemented")}get authKey(){throw new Error("Not Implemented")}set authKey(e){throw new Error("Not Implemented")}setDC(e,t,n){throw new Error("Not implemented")}save(){throw new Error("Not Implemented")}delete(){throw new Error("Not Implemented")}}},926:(e,t,n)=>{const s=n(28753),i="GramJs";e.exports=class extends s{async _delete(){const e=new Request(this._storageKey);return(await self.caches.open(i)).delete(e)}async _fetchFromCache(){const e=new Request(this._storageKey),t=await self.caches.open(i),n=await t.match(e);return n?n.text():void 0}async _saveToCache(e){const t=new Request(this._storageKey),n=new Response(e);return(await self.caches.open(i)).put(t,n)}}},80007:(e,t,n)=>{var s=n(48764).Buffer;const i=n(33995),o=n(13302),a=n(48960);e.exports=class extends i{constructor(e,t){super(),this._sessionData=e,this._callback=t,this._authKeys={}}get authKey(){throw new Error("Not supported")}set authKey(e){throw new Error("Not supported")}async load(){if(!this._sessionData)return;const{mainDcId:e,keys:t,hashes:n}=this._sessionData,{ipAddress:i,port:r}=a.getDC(e);this.setDC(e,i,r,!0),await Promise.all(Object.keys(t).map((async e=>{const i="string"==typeof t[e]?s.from(t[e],"hex"):s.from(t[e]);if(n[e]){const t="string"==typeof n[e]?s.from(n[e],"hex"):s.from(n[e]);this._authKeys[e]=new o(i,t)}else this._authKeys[e]=new o,await this._authKeys[e].setKey(i,!0)})))}setDC(e,t,n,s=!1){this._dcId=e,this._serverAddress=t,this._port=n,delete this._authKeys[e],s||this._onUpdate()}getAuthKey(e=this._dcId){return this._authKeys[e]}setAuthKey(e,t=this._dcId){this._authKeys[t]=e,this._onUpdate()}getSessionData(){const e={mainDcId:this._dcId,keys:{},hashes:{}};return Object.keys(this._authKeys).forEach((t=>{const n=this._authKeys[t];n&&n._key&&(e.keys[t]=n._key.toString("hex"),e.hashes[t]=n._hash.toString("hex"))})),e}_onUpdate(){this._callback(this.getSessionData())}delete(){this._callback(void 0)}}},45945:(e,t,n)=>{const s=n(24678),i=n(28753),o="GramJs";e.exports=class extends i{_delete(){return s.del(`${o}:${this._storageKey}`)}_fetchFromCache(){return s.get(`${o}:${this._storageKey}`)}_saveToCache(e){return s.set(`${o}:${this._storageKey}`,e)}}},31753:(e,t,n)=>{const s=n(28753);e.exports=class extends s{_delete(){return localStorage.removeItem(this._storageKey)}_fetchFromCache(){return localStorage.getItem(this._storageKey)}_saveToCache(e){return localStorage.setItem(this._storageKey,e)}}},33995:(e,t,n)=>{const s=n(59270);e.exports=class extends s{constructor(){super(),this._serverAddress=void 0,this._dcId=0,this._port=void 0,this._takeoutId=void 0,this._entities=new Set,this._updateStates={}}get dcId(){return this._dcId}get serverAddress(){return this._serverAddress}get port(){return this._port}get authKey(){return this._authKey}set authKey(e){this._authKey=e}setDC(e,t,n){this._dcId=0|e,this._serverAddress=t,this._port=n}}},28753:(e,t,n)=>{var s=n(48764).Buffer;const i=n(33995),o=n(13302),a=n(48960);e.exports=class extends i{constructor(e){super(),this._authKeys={},e&&e.startsWith("session:")?this._sessionString=e:e&&(this._storageKey=e)}get authKey(){throw new Error("Not supported")}set authKey(e){throw new Error("Not supported")}async load(){if(this._sessionString)await this._loadFromSessionString();else if(this._storageKey)try{const e=await this._fetchFromCache(),{mainDcId:t,keys:n,hashes:i}=JSON.parse(e),{ipAddress:r,port:c}=a.getDC(t);this.setDC(t,r,c,!0),Object.keys(n).forEach((e=>{n[e]&&i[e]&&(this._authKeys[e]=new o(s.from(n[e].data),s.from(i[e].data)))}))}catch(e){console.warn("Failed to retrieve or parse session from storage"),console.warn(e)}}setDC(e,t,n,s=!1){this._dcId=e,this._serverAddress=t,this._port=n,delete this._authKeys[e],s||this._updateStorage()}async save(){return this._storageKey||(this._storageKey=`GramJs-session-${Date.now()}`),await this._updateStorage(),this._storageKey}getAuthKey(e=this._dcId){return this._authKeys[e]}setAuthKey(e,t=this._dcId){this._authKeys[t]=e,this._updateStorage()}getSessionData(e){const t={mainDcId:this._dcId,keys:{},hashes:{}};return Object.keys(this._authKeys).forEach((n=>{const s=this._authKeys[n];s._key&&(t.keys[n]=e?s._key.toString("hex"):s._key,t.hashes[n]=e?s._hash.toString("hex"):s._hash)})),t}async _loadFromSessionString(){const[,e,t]=this._sessionString.split(":"),n=Number(e),{ipAddress:i,port:r}=a.getDC(n);this.setDC(n,i,r);const c=new o;await c.setKey(s.from(t,"hex"),!0),this.setAuthKey(c,n)}async _updateStorage(){if(this._storageKey)try{await this._saveToCache(JSON.stringify(this.getSessionData()))}catch(e){console.warn("Failed to update session in storage"),console.warn(e)}}async delete(){try{return await this._delete()}catch(e){console.warn("Failed to delete session from storage"),console.warn(e)}}_delete(){throw new Error("Not Implemented")}_fetchFromCache(){throw new Error("Not Implemented")}_saveToCache(e){throw new Error("Not Implemented")}}},12433:(e,t,n)=>{var s=n(48764).Buffer;const i=n(33995),o=n(13302),a=n(35544);class r extends i{constructor(e=undefined){if(super(),e){if("1"!==e[0])throw new Error("Not a valid string");e=e.slice(1);const t=r.decode(e),n=new a(t);this._dcId=n.read(1).readUInt8(0);const s=n.read(2).readInt16BE(0);this._serverAddress=String(n.read(s)),this._port=n.read(2).readInt16BE(0),this._key=n.read(-1)}}static encode(e){return e.toString("base64")}static decode(e){return s.from(e,"base64")}async load(){this._key&&(this._authKey=new o,await this._authKey.setKey(this._key))}save(){if(!this.authKey)return"";const e=s.from([this.dcId]),t=s.from(this.serverAddress),n=s.alloc(2);n.writeInt16BE(t.length,0);const i=s.alloc(2);return i.writeInt16BE(this.port,0),"1"+r.encode(s.concat([e,n,t,i,this.authKey.getKey()]))}getAuthKey(e){if(!e||e===this.dcId)return this.authKey}setAuthKey(e,t){t&&t!==this.dcId||(this.authKey=e)}}e.exports=r},15886:(e,t,n)=>{const s=n(33995),i=n(12433),o=n(926),a=n(31753),r=n(45945),c=n(80007);e.exports={Memory:s,StringSession:i,CacheApiSession:o,LocalStorageSession:a,IdbSession:r,CallbackSession:c}},70845:(e,t,n)=>{const s=n(77150),i={};for(const e of Object.values(s))if(e.CONSTRUCTOR_ID)i[e.CONSTRUCTOR_ID]=e;else for(const t of Object.values(e))i[t.CONSTRUCTOR_ID]=t;e.exports={LAYER:152,tlobjects:i}},77150:(e,t,n)=>{var s=n(48764).Buffer;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{parseTl:o,serializeBytes:a,serializeDate:r}=n(51436),{toSignedLittleBuffer:c}=n(89618),d=n(84779),u=n(48106),l="undefined"!=typeof self&&void 0!==self.localStorage,f="GramJs:apiCache";function p(e){const t=o(e),n=[],s=[];for(const e of t)e.isFunction?s.push(e):n.push(e);return[n,s]}function h(e,t){switch(t){case"int":{const t=s.alloc(4);return t.writeInt32LE(e,0),t}case"long":return c(e,8);case"int128":return c(e,16);case"int256":return c(e,32);case"double":{const t=s.alloc(8);return t.writeDoubleLE(e,0),t}case"string":case"bytes":return a(e);case"Bool":return e?s.from("b5757299","hex"):s.from("379779bc","hex");case"true":return s.alloc(0);case"date":return r(e);default:return e.getBytes()}}function g(e,t){if(t.isVector){t.useVectorId&&e.readInt();const n=[],s=e.readInt();t.isVector=!1;for(let i=0;i<s;i++)n.push(g(e,t));return t.isVector=!0,n}if(t.flagIndicator)return e.readInt();switch(t.type){case"int":return e.readInt();case"long":return e.readLong();case"int128":return e.readLargeInt(128);case"int256":return e.readLargeInt(256);case"double":return e.readDouble();case"string":return e.tgReadString();case"Bool":return e.tgReadBool();case"true":return!0;case"bytes":return e.tgReadBytes();case"date":return e.tgReadDate();default:if(t.skipConstructorId)throw new Error(`Unknown type ${t}`);return e.tgReadObject()}}function m(e,t){const n={};for(const o of t){const{name:t,constructorId:a,subclassOfId:r,argsConfig:c,namespace:d,result:u}=o,l=[d,t].join(".").replace(/^\./,"");class f{constructor(t){i(this,"CONSTRUCTOR_ID",a),i(this,"SUBCLASS_OF_ID",r),i(this,"className",l),i(this,"classType",e),t=t||{},Object.keys(t).forEach((e=>{this[e]=t[e]}))}static fromReader(e){const t={};for(const n in c)if(c.hasOwnProperty(n)){const s=c[n];if(s.isFlag){const i=t[`flags${s.flagGroup>1?s.flagGroup:""}`]&1<<s.flagIndex;if("true"===s.type){t[n]=Boolean(i);continue}t[n]=i?g(e,s):void 0}else t[n]=g(e,s)}return new f(t)}getBytes(){const e=this.CONSTRUCTOR_ID,t=s.alloc(4);t.writeUInt32LE(e,0);const n=[t];for(const e in c)if(c.hasOwnProperty(e)){if(c[e].isFlag&&(!1===this[e]&&"true"===c[e].type||void 0===this[e]))continue;if(c[e].isVector){c[e].useVectorId&&n.push(s.from("15c4b51c","hex"));const t=s.alloc(4);t.writeInt32LE(this[e].length,0),n.push(t,s.concat(this[e].map((t=>h(t,c[e].type)))))}else if(c[e].flagIndicator)if(Object.values(c).some((e=>e.isFlag))){let e=0;for(const t in c)c[t].isFlag&&(!1===this[t]&&"true"===c[t].type||void 0===this[t]?e|=0:e|=1<<c[t].flagIndex);const t=s.alloc(4);t.writeUInt32LE(e,0),n.push(t)}else n.push(s.alloc(4));else if(n.push(h(this[e],c[e].type)),this[e]&&"function"==typeof this[e].getBytes){let t=c[e].type.charAt(c[e].type.indexOf(".")+1);t=t===t.toUpperCase(),t||n.shift()}}return s.concat(n)}readResult(t){if("request"!==e)throw new Error("`readResult()` called for non-request instance");const n=u.match(/Vector<(int|long)>/);if(n){t.readInt();const e=[],s=t.readInt();if("int"===n[1])for(let n=0;n<s;n++)e.push(t.readInt());else for(let n=0;n<s;n++)e.push(t.readLong());return e}return t.tgReadObject()}}i(f,"CONSTRUCTOR_ID",a),i(f,"SUBCLASS_OF_ID",r),i(f,"className",l),i(f,"classType",e),d?(n[d]||(n[d]={}),n[d][t]=f):n[t]=f}return n}e.exports=function(){let e;const t=l&&function(){const e=localStorage.getItem(f);return e&&JSON.parse(e)}();return t?e=t:(e=function(){const[e,t]=p(d),[n,s]=p(u);return{constructors:[].concat(e,n),requests:[].concat(t,s)}}(),l&&localStorage.setItem(f,JSON.stringify(e))),function(e,t){const n={...e};return Object.keys(t).forEach((e=>{"function"!=typeof t[e]&&n[e]?Object.assign(n[e],t[e]):n[e]=t[e]})),n}(m("constructor",e.constructors),m("request",e.requests))}()},68963:(e,t,n)=>{var s=n(48764).Buffer;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{serializeBytes:o}=n(57404);class a{constructor(e){this.data=e,this.CONSTRUCTOR_ID=812830625,this.classType="constructor"}static async gzipIfSmaller(e,t){if(e&&t.length>512){const e=await new a(t).toBytes();if(e.length<t.length)return e}return t}static gzip(e){return s.from(e)}static ungzip(e){return s.from("")}static read(e){if(e.readInt(!1)!==a.CONSTRUCTOR_ID)throw new Error("not equal");return a.gzip(e.tgReadBytes())}static async fromReader(e){return new a(await a.ungzip(e.tgReadBytes()))}async toBytes(){const e=s.alloc(4);return e.writeUInt32LE(a.CONSTRUCTOR_ID,0),s.concat([e,o(await a.gzip(this.data))])}}i(a,"CONSTRUCTOR_ID",812830625),i(a,"classType","constructor"),e.exports=a},63254:(e,t,n)=>{function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const i=n(40355);class o{constructor(e){this.CONSTRUCTOR_ID=1945237724,this.messages=e,this.classType="constructor"}static fromReader(e){const t=[],n=e.readInt();for(let s=0;s<n;s++){const n=e.readLong(),s=e.readInt(),o=e.readInt(),a=e.tellPosition(),r=e.tgReadObject();e.setPosition(a+o);const c=new i(n,s,r);t.push(c)}return new o(t)}}s(o,"CONSTRUCTOR_ID",1945237724),s(o,"classType","constructor"),s(o,"MAXIMUM_SIZE",1044448),s(o,"MAXIMUM_LENGTH",100),e.exports=o},52301:(e,t,n)=>{function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{RpcError:i}=n(57404).constructors,o=n(68963);class a{constructor(e,t,n){this.CONSTRUCTOR_ID=4082920705,this.reqMsgId=e,this.body=t,this.error=n,this.classType="constructor"}static async fromReader(e){const t=e.readLong(),n=e.readInt(!1);return n===i.CONSTRUCTOR_ID?new a(t,void 0,i.fromReader(e)):n===o.CONSTRUCTOR_ID?new a(t,(await o.fromReader(e)).data):(e.seek(-4),new a(t,e.read(),void 0))}}s(a,"CONSTRUCTOR_ID",4082920705),s(a,"classType","constructor"),e.exports=a},40355:e=>{function t(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class n{constructor(e,t,n){this.msgId=e,this.seqNo=t,this.obj=n,this.classType="constructor"}}t(n,"SIZE_OVERHEAD",12),t(n,"classType","constructor"),e.exports=n},92058:(e,t,n)=>{const s=n(40355),i=n(52301),o=n(63254),a=n(68963),r={[i.CONSTRUCTOR_ID]:i,[a.CONSTRUCTOR_ID]:a,[o.CONSTRUCTOR_ID]:o};e.exports={TLMessage:s,RPCResult:i,MessageContainer:o,GZIPPacked:a,coreObjects:r}},44107:(e,t,n)=>{"use strict";n.d(t,{Qx:()=>s,ZS:()=>o});let s=function(e){return e[e.CID_AuthLoginReq=1001]="CID_AuthLoginReq",e[e.CID_AuthLoginRes=1002]="CID_AuthLoginRes",e[e.CID_AuthNativeReq=1003]="CID_AuthNativeReq",e[e.CID_AuthNativeRes=1004]="CID_AuthNativeRes",e[e.CID_AuthPreLoginReq=1005]="CID_AuthPreLoginReq",e[e.CID_AuthPreLoginRes=1006]="CID_AuthPreLoginRes",e[e.CID_AuthStep1Req=1007]="CID_AuthStep1Req",e[e.CID_AuthStep1Res=1008]="CID_AuthStep1Res",e[e.CID_AuthStep2Req=1009]="CID_AuthStep2Req",e[e.CID_AuthStep2Res=1010]="CID_AuthStep2Res",e[e.CID_InitAppRes=1011]="CID_InitAppRes",e[e.CID_UpdateProfileReq=1012]="CID_UpdateProfileReq",e[e.CID_UpdateProfileRes=1013]="CID_UpdateProfileRes",e[e.CID_UpdateUsernameReq=1014]="CID_UpdateUsernameReq",e[e.CID_UpdateUsernameRes=1015]="CID_UpdateUsernameRes",e[e.CID_UploadProfilePhotoReq=1016]="CID_UploadProfilePhotoReq",e[e.CID_UploadProfilePhotoRes=1017]="CID_UploadProfilePhotoRes",e[e.CID_LoadChatsReq=2001]="CID_LoadChatsReq",e[e.CID_LoadChatsRes=2002]="CID_LoadChatsRes",e[e.CID_DownloadReq=3001]="CID_DownloadReq",e[e.CID_DownloadRes=3002]="CID_DownloadRes",e[e.CID_UploadReq=3003]="CID_UploadReq",e[e.CID_UploadRes=3004]="CID_UploadRes",e[e.CID_AnswerCallbackButtonReq=4001]="CID_AnswerCallbackButtonReq",e[e.CID_AnswerCallbackButtonRes=4002]="CID_AnswerCallbackButtonRes",e[e.CID_DownloadMsgReq=4003]="CID_DownloadMsgReq",e[e.CID_DownloadMsgRes=4004]="CID_DownloadMsgRes",e[e.CID_GenMsgIdReq=4005]="CID_GenMsgIdReq",e[e.CID_GenMsgIdRes=4006]="CID_GenMsgIdRes",e[e.CID_MsgDeleteReq=4007]="CID_MsgDeleteReq",e[e.CID_MsgDeleteRes=4008]="CID_MsgDeleteRes",e[e.CID_MsgListReq=4009]="CID_MsgListReq",e[e.CID_MsgListRes=4010]="CID_MsgListRes",e[e.CID_MsgUpdateReq=4011]="CID_MsgUpdateReq",e[e.CID_MsgUpdateRes=4012]="CID_MsgUpdateRes",e[e.CID_RemoveMessagesReq=4013]="CID_RemoveMessagesReq",e[e.CID_RemoveMessagesRes=4014]="CID_RemoveMessagesRes",e[e.CID_SendBotMsgReq=4015]="CID_SendBotMsgReq",e[e.CID_SendBotMsgRes=4016]="CID_SendBotMsgRes",e[e.CID_SendReq=4017]="CID_SendReq",e[e.CID_SendRes=4018]="CID_SendRes",e[e.CID_UpdateCmdReq=4019]="CID_UpdateCmdReq",e[e.CID_UpdateCmdRes=4020]="CID_UpdateCmdRes",e[e.CID_UploadMsgReq=4021]="CID_UploadMsgReq",e[e.CID_UploadMsgRes=4022]="CID_UploadMsgRes",e[e.CID_OtherNotify=5001]="CID_OtherNotify",e[e.CID_StopChatStreamReq=5002]="CID_StopChatStreamReq",e[e.CID_SyncReq=6001]="CID_SyncReq",e[e.CID_SyncRes=6002]="CID_SyncRes",e[e.CID_DownloadUserReq=7001]="CID_DownloadUserReq",e[e.CID_DownloadUserRes=7002]="CID_DownloadUserRes",e[e.CID_GenUserIdReq=7003]="CID_GenUserIdReq",e[e.CID_GenUserIdRes=7004]="CID_GenUserIdRes",e[e.CID_UploadUserReq=7005]="CID_UploadUserReq",e[e.CID_UploadUserRes=7006]="CID_UploadUserRes",e}({});const i={1001:"CID_AuthLoginReq",1002:"CID_AuthLoginRes",1003:"CID_AuthNativeReq",1004:"CID_AuthNativeRes",1005:"CID_AuthPreLoginReq",1006:"CID_AuthPreLoginRes",1007:"CID_AuthStep1Req",1008:"CID_AuthStep1Res",1009:"CID_AuthStep2Req",1010:"CID_AuthStep2Res",1011:"CID_InitAppRes",1012:"CID_UpdateProfileReq",1013:"CID_UpdateProfileRes",1014:"CID_UpdateUsernameReq",1015:"CID_UpdateUsernameRes",1016:"CID_UploadProfilePhotoReq",1017:"CID_UploadProfilePhotoRes",2001:"CID_LoadChatsReq",2002:"CID_LoadChatsRes",3001:"CID_DownloadReq",3002:"CID_DownloadRes",3003:"CID_UploadReq",3004:"CID_UploadRes",4001:"CID_AnswerCallbackButtonReq",4002:"CID_AnswerCallbackButtonRes",4003:"CID_DownloadMsgReq",4004:"CID_DownloadMsgRes",4005:"CID_GenMsgIdReq",4006:"CID_GenMsgIdRes",4007:"CID_MsgDeleteReq",4008:"CID_MsgDeleteRes",4009:"CID_MsgListReq",4010:"CID_MsgListRes",4011:"CID_MsgUpdateReq",4012:"CID_MsgUpdateRes",4013:"CID_RemoveMessagesReq",4014:"CID_RemoveMessagesRes",4015:"CID_SendBotMsgReq",4016:"CID_SendBotMsgRes",4017:"CID_SendReq",4018:"CID_SendRes",4019:"CID_UpdateCmdReq",4020:"CID_UpdateCmdRes",4021:"CID_UploadMsgReq",4022:"CID_UploadMsgRes",5001:"CID_OtherNotify",5002:"CID_StopChatStreamReq",6001:"CID_SyncReq",6002:"CID_SyncRes",7001:"CID_DownloadUserReq",7002:"CID_DownloadUserRes",7003:"CID_GenUserIdReq",7004:"CID_GenUserIdRes",7005:"CID_UploadUserReq",7006:"CID_UploadUserRes"},o=e=>i[e]||e.toString()},82752:(e,t,n)=>{"use strict";n.d(t,{K2:()=>f,Mt:()=>p,On:()=>h,ZP:()=>v,_b:()=>r,_f:()=>c,e2:()=>l,es:()=>w,mS:()=>m,rI:()=>y,sB:()=>g});var s=n(48764).Buffer;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=n(73679);let a=[];function r(){const e=a.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function c(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}function d(e,t){let n=e.bytes,s=e.offset,i=e.limit,o=s+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),s}function u(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function l(e){let t=u(e,4),n=e.bytes;return n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}function f(e,t){let n=d(e,4),s=e.bytes;s[n+3]=t,s[n+2]=t>>8,s[n+1]=t>>16,s[n]=t>>24}function p(e){let t=u(e,2),n=e.bytes;return n[t]<<8|n[t+1]}function h(e,t){let n=d(e,2),s=e.bytes;s[n+1]=t,s[n]=t>>8}function g(e,t){let n=u(e,t);return e.bytes.subarray(n,n+t)}function m(e,t){let n=d(e,t.length);e.bytes.set(t,n)}function y(e){return{bytes:e,offset:0,limit:e.length}}class w{constructor(e){i(this,"_pbData",void 0),i(this,"_pbHeader",void 0),i(this,"_pbBody",void 0),i(this,"_bb",void 0),this._pbData=new Uint8Array,this._pbBody=new Uint8Array,this._bb=r(),this._pbHeader={length:0,version:0,flag:0,command_id:0,seq_num:0,reversed:0},e&&(this.setPbData(e),this.readPbData())}getPbData(){return this._pbData}setPbData(e){this._pbData=e}getPbDataLength(){return this._pbData.length}getPbBody(){return this._pbBody}body(){return this._pbBody}getPbBodyLength(){return this._pbBody.length}setPbBody(e){this._pbBody=e}writeData(e,t,n=0,i=0){this.setPbBody(e),this._pbHeader={length:e.length+16,version:0,flag:0,command_id:t,seq_num:n,reversed:i},f(this._bb,this._pbHeader.length),h(this._bb,this._pbHeader.version),h(this._bb,this._pbHeader.flag),h(this._bb,this._pbHeader.command_id),h(this._bb,this._pbHeader.seq_num),f(this._bb,this._pbHeader.reversed),m(this._bb,s.from(e)),this.setPbData(c(this._bb))}updateSeqNo(e){this._bb.offset=10,h(this._bb,e),this._pbHeader.seq_num=e}readPbData(){const e=y(this._pbData.slice(0,16));this._pbHeader.length=l(e),this._pbHeader.version=p(e),this._pbHeader.flag=p(e),this._pbHeader.command_id=p(e),this._pbHeader.seq_num=p(e),this._pbHeader.reversed=l(e),this.setPbBody(this._pbData.slice(16,this._pbHeader.length))}getCommandId(){return this._pbHeader.command_id}getReversed(){return this._pbHeader.reversed}getSeqNum(){return this._pbHeader.seq_num}}let b=0;class v{constructor(e,t){i(this,"__cid",void 0),i(this,"msg",void 0),i(this,"__pb",void 0);const n=e.split(".");let s=o.default;do{s=s[n.shift()]}while(n.length>0);this.__pb=s,this.setMsg(t)}setCommandId(e){this.__cid=e}setMsg(e){this.msg=e}getMsg(){return this.msg}encode(){return this.__E()}decode(e){return this.__D(e)}pack(){return this.__pack()}toHex(){return s.from(this.__E()).toString("hex")}fromHex(e){return 0===e.indexOf("0x")&&(e=e.substring(2)),this.__D(s.from(e,"hex"))}__E(){const e=this.__pb.create(this.getMsg());return this.__pb.encode(e).finish()}__D(e){const t=this.__pb.decode(e);return this.__pb.toObject(t)}__pack(){const e=new w;return b>1e4&&(b=0),e.writeData(this.__E(),this.__cid,++b),e}}},63024:(e,t,n)=>{"use strict";n.d(t,{PS:()=>s,wb:()=>i});let s=function(e){return e[e.EncryptType_Wallet=0]="EncryptType_Wallet",e[e.EncryptType_Group=1]="EncryptType_Group",e[e.EncryptType_Message=2]="EncryptType_Message",e[e.EncryptType_Media=3]="EncryptType_Media",e}({}),i=function(e){return e[e.NO_ERROR=0]="NO_ERROR",e[e.ERR_SYSTEM=1]="ERR_SYSTEM",e[e.ERR_AUTH_LOGIN=2]="ERR_AUTH_LOGIN",e[e.ERR_AUTH_NEED=3]="ERR_AUTH_NEED",e}({})},44205:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var s=n(82752),i=n(44107);class o extends s.ZP{constructor(e){var t,n,s;super("PTP.File.DownloadReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(i.Qx.CID_DownloadReq),this.msg=e}static parseMsg(e){return(new o).decode(e.body())}}},14229:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var s=n(82752),i=n(44107);class o extends s.ZP{constructor(e){var t,n,s;super("PTP.File.UploadReq",e),t=this,s=void 0,(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="msg"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.setCommandId(i.Qx.CID_UploadReq),this.msg=e}static parseMsg(e){return(new o).decode(e.body())}}},3783:(e,t,n)=>{"use strict";n.d(t,{US:()=>o.Z,dZ:()=>i.Z,ju:()=>s.Z});var s=n(44205),i=n(86038),o=n(14229);n(45340)},73679:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});const s=n(62100);s.util.Long=n(41583);var i=s.roots,o=s.types?s.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},a=s.types?s.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},r=Object.keys(o);function c({name:e,repeated:t,map:n,keyType:s},i){return e+": "+i+(t&&"array"!==i?"[]":n&&"object"!==i?"{k:"+s+"}":"")+" expected"}for(var d={int32:"key32Re",uint32:"key32Re",sint32:"key32Re",fixed32:"key32Re",sfixed32:"key32Re",int64:"key64Re",uint64:"key64Re",sint64:"key64Re",fixed64:"key64Re",sfixed64:"key64Re",bool:"key2Re"},u={int32:1,uint32:1,sint32:1,fixed32:1,sfixed32:1},l={int64:1,uint64:1,sint64:1,fixed64:1,sfixed64:1},f={float:1,double:1},p=s.util,h=function(e,t,n,a){if("$1"===a)return n.map=!0,function(e,t,n){return d[e]?s.util[d[e]].test(t)?null:(n.keyType=e,c(n,"key")):null}(e,t,n);if(void 0!==o[e]){if(u[e]){if("number"!=typeof t)return c(n,"number")}else if(l[e]){if(!(p.isInteger(t)||t&&p.isInteger(t.low)&&p.isInteger(t.high)))return c(n,"integer|Long")}else if(f[e]){if("number"!=typeof t)return c(n,"float|double")}else if("bool"===e){if("boolean"!=typeof t)return c(n,"boolean")}else if("string"===e){if(!p.isString(t))return c(n,"string")}else if("bytes"===e&&!(t&&"number"==typeof t.length||p.isString(t)))return c(n,"invalid bytes");return null}return i[e].resolvedType?i[e].resolvedType[t]?null:c(n,"enum value"):i[e].verify(t)},g={$:function(e){return g[e]?g[e].call(this):i[e].decode(this,this.uint32())}},m={$:function(e,t,n){var s=o[e];return void 0===s?(this.uint32((n<<3|2)>>0).fork(),i[e].encode(t,this).ldelim()):m[e].call(this.uint32(n<<3|s),t)}},y=0;y<r.length;y++)g[r[y]]=s.Reader.prototype[r[y]],m[r[y]]=s.Writer.prototype[r[y]];function w(e){for(var t={},n=0;n<e.length;n++)for(var s=e[n],i=0;i<s.types.length;i++)t[s.types[i]]=s.convf;return t}var b=w([{types:["bool"],convf:Boolean},{types:["string"],convf:String},{types:["float","double"],convf:Number},{types:["uint32","fixed32"],convf:function(e){return e>>>0}},{types:["int32","sint32","sfixed32"],convf:function(e){return 0|e}},{types:["int64","sint64","fixed64","sfixed64","uint64"],convf:function(e,t){var n=void 0;return s.util.Long?(n=s.util.Long.fromValue(e)).unsigned="u"===t.charAt(0):"object"==typeof e?n=new s.util.LongBits(e.low>>>0,e.high>>>0).toNumber("u"===t.charAt(0)):"string"==typeof e?n=parseInt(e,10):"number"==typeof e&&(n=e),n}},{types:["bytes"],convf:function(e,t){var n=void 0;return"string"==typeof e?(n=s.util.newBuffer(s.util.base64.length(e)),s.util.base64.decode(e,n,0)):e.length&&(n=e),n}},{types:["$"],convf:function(e,t){if(b[t])return b[t].call(null,e,t);if(!i[t].fromObject){var n=i[t][e];return"string"==typeof n?i[t][n]:n}return i[t].fromObject(e)}}]),v=w([{types:["float","double"],convf:function(e,t,n){return n.json&&!isFinite(e)?String(e):e}},{types:["int64","sint64","fixed64","sfixed64","uint64"],convf:function(e,t,n){return"number"==typeof e?n.longs===String?String(e):e:n.longs===String?s.util.Long.prototype.toString.call(e):n.longs===Number?new s.util.LongBits(e.low>>>0,e.high>>>0).toNumber("u"===t.charAt(0)):e}},{types:["bytes"],convf:function(e,t,n){return n.bytes===String?s.util.base64.encode(e,0,e.length):n.bytes===Array?Array.prototype.slice.call(e):Array.isArray(e)?s.util.newBuffer(e):e}},{types:["$"],convf:function(e,t,n){return v[t]?v[t].call(null,e,t,n):void 0===o[t]?i[t].toObject?i[t].toObject(e,n):n.enums===String?i[t][e]:e:e}}]);!function e(t,n,o,r){for(var d=0,u=Object.keys(t);d<u.length;d++){var l=u[d];if(t[l].$&&Object.keys(t[l].$).every((function(e){return Number(e)}))){if(o[l])throw Error("field "+n+"."+l+" has already existed");o[l]=function(t,i){function r(e){for(var n in t){var s=t[n];"{"===s[1].charAt(0)?this[s[0]]={}:"["!==s[1].charAt(0)&&"<"!==s[1].charAt(0)||(this[s[0]]=[])}if(e)for(var i=Object.keys(e),o=0;o<i.length;++o)null!=e[i[o]]&&(this[i[o]]=e[i[o]])}var d={};for(var u in t){var l=t[u],f=l[1];"{"===f.charAt(0)?(r.prototype[l[0]]=s.util.emptyObject,d[f]={$:f.substring(1).split(",").map((function(e,t){return["$"+(t+1),e,null]})).reduce((function(e,t,n){return e[n+1]=t,e}),{})}):"["===f.charAt(0)||"<"===f.charAt(0)?r.prototype[l[0]]=s.util.emptyArray:"bytes"===f?r.prototype[l[0]]=s.util.newBuffer([]):l[2]&&l[2].hasOwnProperty("low")&&l[2].hasOwnProperty("high")?r.prototype[l[0]]=s.util.Long.fromBits(l[2].low,l[2].high,l[2].unsigned):r.prototype[l[0]]=l[2]}return r.create=function(e){return new o[i](e)},r.decode=function(e,n){e instanceof s.Reader||(e=s.Reader.create(e));for(var r=void 0===n?e.len:e.pos+n,c=new o[i];e.pos<r;){var d=e.uint32(),u=d>>>3;if(u>0&&t[u]){var l=t[u][0],f=t[u][1];if("{"===f.charAt(0)){c[l]===s.util.emptyObject&&(c[l]={});var p=o[i].$namespace[f].decode(e,e.uint32());c[l][p.$1]=p.$2}else if("["===f.charAt(0)||"<"===f.charAt(0))if(f=f.substring(1),c[l]&&c[l].length||(c[l]=[]),void 0!==a[f]&&2==(7&d))for(var h=e.uint32()+e.pos;e.pos<h;)c[l].push(g.$.call(e,f));else c[l].push(g.$.call(e,f));else c[l]=g.$.call(e,f)}else e.skipType(7&d)}return c},r.decodeDelimited=function(e){return e instanceof s.Reader||(e=s.Reader.create(e)),this.decode(e,e.uint32())},r.encode=function(e,n){for(var r in n||(n=s.Writer.create()),t){var c=t[r][0],d=t[r][1];if("{"===d.charAt(0)){if(null!=e[c]&&e.hasOwnProperty(c))for(var u=0,l=Object.keys(e[c]);u<l.length;++u)n.uint32((r<<3|2)>>0).fork(),o[i].$namespace[d].encode({$1:l[u],$2:e[c][l[u]]},n).ldelim()}else if("["===d.charAt(0)||"<"===d.charAt(0)){var f="<"===d.charAt(0);d=d.substring(1);var p=e[c];if(null!=p&&p.length)if(f&&void 0!==a[d]){for(n.uint32((r<<3|2)>>0).fork(),u=0;u<p.length;u++)m[d].call(n,p[u]);n.ldelim()}else for(u=0;u<p.length;u++)m.$.call(n,d,p[u],r)}else null!=e[c]&&e.hasOwnProperty(c)&&m.$.call(n,d,e[c],r)}return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.fromObject=function(e){if(e instanceof o[i])return e;var s=new o[i];for(var a in t){var r=t[a][0],c=t[a][1],d=e[r];if("{"===c.charAt(0)){if(!d)continue;if("object"!=typeof d)throw TypeError(n+"."+i+"."+r+": object expected");for(var u={},l=c.substring(1).split(",")[1],f=0,p=Object.keys(d);f<p.length;++f)u[p[f]]=b.$.call(null,d[p[f]],l);s[r]=u}else if("["===c.charAt(0)||"<"===c.charAt(0)){if(!d)continue;if(!Array.isArray(d))throw TypeError(n+"."+i+"."+c+": arary excepted");var h=[];for(c=c.substring(1),f=0;f<d.length;f++)h[f]=b.$.call(null,d[f],c);s[r]=h}else null!=d&&(s[r]=b.$.call(null,d,c))}return s},r.toObject=function(e,n){n=n||{};var s={};for(var i in t){var o=t[i][0],a=t[i][1],r=e[o];if("{"===a.charAt(0)){(n.objects||n.defaults)&&(s[o]={});var c=r?Object.keys(r):[];if(c.length){for(var d={},u=a.substring(1).split(",")[1],l=0;l<c.length;l++)d[c[l]]=v.$.call(null,r[c[l]],u,n);s[o]=d}}else if("["===a.charAt(0)||"<"===a.charAt(0)){if((n.arrays||n.defaults)&&(s[o]=[]),r&&r.length){var f=[];for(a=a.substring(1),l=0;l<r.length;l++)f[l]=v.$.call(null,r[l],a,n);s[o]=f}}else n.defaults&&(s[o]=v.$.call(null,t[i][2],a,n)),null!=r&&e.hasOwnProperty(o)&&(s[o]=v.$.call(null,r,a,n))}return s},r.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";for(var a in t){var r=t[a][0],d=t[a][1],u=n+"."+i+"."+r;if("{"===d.charAt(0)){if(null!=e[r]&&e.hasOwnProperty(r)){if(!s.util.isObject(e[r]))return c({name:u,map:!0},"object");for(var l=Object.keys(e[r]),f=0;f<l.length;++f)if(o[i].$namespace[d].$fieldName=u,g=o[i].$namespace[d].verify({$1:l[f],$2:e[r][l[f]]}))return g}}else if("["===d.charAt(0)||"<"===d.charAt(0)){d=d.substring(1);var p=e[r];if(!Array.isArray(p))return c({name:u,repeated:!0},"array");for(f=0;f<p.length;f++)if(g=h(d,p[f],{name:u+"["+f+"]",repeated:!0}))return g}else{var g;if("$1"!==r&&"$2"!==r||(u=this.$fieldName),null!=e[r]&&e.hasOwnProperty(r)&&(g=h(d,e[r],{name:u},r)))return g}}return null},Object.keys(d).length&&(r.$namespace=e(d,n+"."+i,r.$namespace||{},!0)),r}(t[l].$,l),!r&&(i[n+"."+l]=o[l])}else t[l]["@"]&&Object.values(t[l]["@"]).every((function(e){return Number(e)===e}))&&(o[l]=function(e,t){for(var n=Object.keys(e),s={},i=0;i<n.length;i++)s[s[n[i]]=e[n[i]]]=n[i];var o={};return n.forEach((function(e){o[s[e]]=1})),s.resolvedType=o,s}(t[l]["@"]),!r&&(i[n+"."+l]=o[l]));delete t[l].$,delete t[l]["@"],o[l]=e(t[l],n?n+"."+l:l,o[l]||{})}return o}({default:{PTP:{Auth:{AuthLoginReq:{$:{1:["sign","string",""],2:["clientInfo","default.PTP.Common.ClientInfo",null]}},AuthLoginRes:{$:{100:["err","uint32",0]}},AuthNativeReq:{$:{1:["accountId","uint64",{low:0,high:0,unsigned:!0}],2:["entropy","string",""],3:["session","string",""]}},AuthNativeRes:{$:{}},AuthPreLoginReq:{$:{1:["sign1","bytes",[]],2:["address1","string",""],3:["sign2","bytes",[]],4:["address2","string",""],5:["ts","uint64",{low:0,high:0,unsigned:!0}]}},AuthPreLoginRes:{$:{1:["uid","string",""],2:["ts","uint64",{low:0,high:0,unsigned:!0}],100:["err","uint32",0]}},AuthStep1Req:{$:{1:["p","bytes",[]]}},AuthStep1Res:{$:{1:["q","bytes",[]],2:["address","string",""],3:["sign","bytes",[]],6:["ts","uint64",{low:0,high:0,unsigned:!0}],100:["err","uint32",0]}},AuthStep2Req:{$:{1:["ts","uint64",{low:0,high:0,unsigned:!0}],2:["address","string",""],3:["sign","bytes",[]]}},AuthStep2Res:{$:{100:["err","uint32",0]}},InitAppRes:{$:{1:["chats","string",""],2:["messages","string",""],3:["chatFolders","string",""],100:["err","uint32",0]}},UpdateProfileReq:{$:{1:["firstName","string",""],2:["lastName","string",""],3:["about","string",""]}},UpdateProfileRes:{$:{100:["err","uint32",0]}},UpdateUsernameReq:{$:{1:["username","string",""]}},UpdateUsernameRes:{$:{100:["err","uint32",0]}},UploadProfilePhotoReq:{$:{1:["id","string",""],2:["is_video","bool",!1],3:["thumbnail","string",""]}},UploadProfilePhotoRes:{$:{1:["payload","string",""],100:["err","uint32",0]}}},Chats:{LoadChatsReq:{$:{1:["limit","uint32",0],2:["offsetDate","uint32",0],3:["archived","bool",!1],4:["withPinned","bool",!1],5:["lastLocalServiceMessage","string",""]}},LoadChatsRes:{$:{1:["payload","string",""],100:["err","uint32",0]}}},Common:{AUTH_TYPE:{"@":{AUTH_TYPE_USERNAME:0,AUTH_TYPE_EMAIL:1,AUTH_TYPE_MOBILE:2}},ClientInfo:{$:{1:["deviceModel","string",""],2:["systemVersion","string",""],3:["appVersion","string",""]}},EncryptType:{"@":{EncryptType_Wallet:0,EncryptType_Group:1,EncryptType_Message:2,EncryptType_Media:3}},ERR:{"@":{NO_ERROR:0,ERR_SYSTEM:1,ERR_AUTH_LOGIN:2,ERR_AUTH_NEED:3}},FileInfo:{$:{1:["id","string",""],2:["size","uint64",{low:0,high:0,unsigned:!0}],3:["part","uint32",0],4:["part_total","uint32",0],5:["buf","bytes",[]],6:["type","string",""]}},MessageStoreRow:{$:{1:["message","default.PTP.Common.PbMsg",null],3:["messageId","uint32",0],4:["time","uint32",0],5:["buf","bytes",[]]}},PbAction:{$:{1:["text","string",""],2:["type","string",""]}},PbAiBot:{$:{1:["chatGptConfig","default.PTP.Common.PbChatGpBotConfig",null],3:["enableAi","bool",!1],4:["botApi","string",""],5:["disableClearHistory","bool",!1],6:["commandsFromApi","<default.PTP.Common.PbCommands",null]}},PbAudio:{$:{1:["id","string",""],2:["size","[uint32",null],3:["duration","[uint32",null],5:["mimeType","string",""],6:["fileName","string",""],7:["performer","string",""],8:["title","string",""],9:["thumbnailSizes","<default.PTP.Common.PbSizes",null]}},PbBotInfo:{$:{1:["botId","string",""],2:["description","string",""],4:["menuButton","default.PTP.Common.PbMenuButton",null],5:["commands","<default.PTP.Common.PbCommands",null],6:["photo","default.PTP.Common.PbPhoto",null],7:["aiBot","default.PTP.Common.PbAiBot",null]}},PbChat:{$:{1:["type","string",""],2:["id","string",""],3:["title","string",""],4:["usernames","<default.PTP.Common.PbUsernames",null],5:["isMuted","bool",!1],6:["isMin","bool",!1],7:["hasPrivateLink","bool",!1],8:["isSignaturesShown","bool",!1],9:["accessHash","string",""],10:["isVerified","bool",!1],11:["isJoinToSend","bool",!1],12:["isJoinRequest","bool",!1],13:["isForum","bool",!1],14:["isListed","bool",!1],15:["settings","default.PTP.Common.PbSettings",null],16:["lastMessage","default.PTP.Common.PbMsg",null]}},PbChatFolder:{$:{1:["id","uint32",0],2:["title","string",""],3:["channels","bool",!1],4:["pinnedChatIds","<string",null],5:["includedChatIds","<string",null],6:["excludedChatIds","<string",null]}},PbChatGpBotConfig:{$:{1:["init_system_content","string",""],2:["api_key","string",""],3:["max_history_length","uint32",0],4:["modelConfig","default.PTP.Common.PbChatGptModelConfig",null]}},PbChatGptModelConfig:{$:{1:["model","string",""],2:["temperature","uint32",0],3:["max_tokens","uint32",0],4:["presence_penalty","uint32",0]}},PbCommands:{$:{1:["botId","string",""],2:["command","string",""],3:["description","string",""]}},PbContent:{$:{1:["text","default.PTP.Common.PbText",null],2:["photo","default.PTP.Common.PbPhoto",null],3:["voice","default.PTP.Common.PbVoice",null],4:["action","default.PTP.Common.PbAction",null],5:["document","default.PTP.Common.PbDocument",null],6:["audio","default.PTP.Common.PbAudio",null]}},PbDimensions:{$:{1:["width","uint32",0],2:["height","uint32",0]}},PbDocument:{$:{1:["id","string",""],2:["fileName","string",""],3:["size","[uint32",null],4:["timestamp","uint32",0],5:["duration","[uint32",null],6:["mimeType","string",""],7:["performer","string",""],8:["previewBlobUrl","string",""],9:["mediaType","string",""],10:["mediaSize","default.PTP.Common.PbSizes",null],11:["thumbnail","default.PTP.Common.PbThumbnail",null]}},PbFullInfo:{$:{1:["bio","string",""],2:["commonChatsCount","uint32",0],3:["isBlocked","bool",!1],4:["noVoiceMessages","bool",!1],5:["botInfo","default.PTP.Common.PbBotInfo",null],6:["pinnedMessageId","uint32",0]}},PbMenuButton:{$:{1:["type","string",""],2:["text","string",""],3:["url","string",""]}},PbMessageEntity:{$:{1:["type","string",""],2:["offset","uint32",0],3:["length","uint32",0],4:["documentId","string",""],5:["userId","string",""],6:["url","string",""],7:["language","string",""],8:["cipher","string",""],9:["hint","string",""]}},PbMsg:{$:{1:["id","uint32",0],2:["chatId","string",""],3:["content","default.PTP.Common.PbContent",null],4:["date","uint32",0],5:["isOutgoing","bool",!1],6:["senderId","string",""],7:["isForwardingAllowed","bool",!1],8:["previousLocalId","double",0],9:["views","uint32",0],10:["repliesThreadInfo","default.PTP.Common.PbRepliesThreadInfo",null],11:["reactions","default.PTP.Common.PbReactions",null]}},PbPhoto:{$:{1:["id","string",""],2:["thumbnail","default.PTP.Common.PbThumbnail",null],3:["sizes","<default.PTP.Common.PbSizes",null],4:["isSpoiler","bool",!1]}},PbQrCode:{$:{1:["type","uint32",1],2:["data","bytes",[]]}},PbReaction:{$:{2:["emoticon","string",""]}},PbReactionCount:{$:{1:["chosenOrder","uint32",0],2:["count","uint32",0],3:["reaction","default.PTP.Common.PbReaction",null]}},PbReactions:{$:{1:["canSeeList","bool",!1],2:["results","<default.PTP.Common.PbReactionCount",null]}},PbRepliesThreadInfo:{$:{1:["isComments","bool",!1],3:["threadId","uint32",0],4:["chatId","string",""],5:["originChannelId","string",""],6:["messagesCount","uint32",0],7:["lastMessageId","uint32",0],8:["recentReplierIds","<string",null]}},PbSettings:{$:{1:["isAutoArchived","bool",!1],2:["canReportSpam","bool",!1],3:["canAddContact","bool",!1],4:["canBlockContact","bool",!1]}},PbSizes:{$:{1:["width","uint32",0],2:["height","uint32",0],3:["type","string",""]}},PbText:{$:{1:["text","string",""],2:["entities","<default.PTP.Common.PbMessageEntity",null]}},PbThumbnail:{$:{1:["width","uint32",0],2:["height","uint32",0],3:["dataUri","string",""]}},PbUser:{$:{1:["id","string",""],2:["firstName","string",""],3:["usernames","<default.PTP.Common.PbUsernames",null],4:["isMin","bool",!1],5:["isPremium","bool",!1],6:["type","string",""],7:["hasVideoAvatar","bool",!1],8:["canBeInvitedToGroup","bool",!1],9:["phoneNumber","string",""],10:["noStatus","bool",!1],11:["accessHash","string",""],12:["fullInfo","default.PTP.Common.PbFullInfo",null],13:["lastName","string",""],14:["isSelf","bool",!1],15:["avatarHash","string",""],16:["photos","<default.PTP.Common.PbPhoto",null]}},PbUsernames:{$:{1:["username","string",""],2:["isActive","bool",!1],3:["isEditable","bool",!1]}},PbUserSetting:{$:{1:["chatFolders","<default.PTP.Common.PbChatFolder",null],2:["chatFolderOrderedIds","[uint32",null],3:["myBotIds","<string",null],4:["myGroups","<string",null]}},PbVoice:{$:{1:["id","string",""],2:["waveform","[uint32",null],3:["duration","uint32",0]}},QrCodeType:{"@":{QrCodeType_MNEMONIC:1}},UserMessageStoreData:{$:{1:["chatId","string",""],2:["messageIds","[uint64",null],3:["messageIdsDeleted","[uint64",null],4:["time","uint64",{low:0,high:0,unsigned:!0}]}},UserStoreData:{$:{1:["chatIds","<string",null],2:["chatIdsDeleted","<string",null],3:["chatFolders","string",""],7:["time","uint64",{low:0,high:0,unsigned:!0}]}},UserStoreRow:{$:{1:["buf","bytes",[]],2:["userId","string",""],3:["time","uint32",0],4:["user","default.PTP.Common.PbUser",null]}}},File:{DownloadReq:{$:{1:["id","string",""],2:["part","uint32",0]}},DownloadRes:{$:{1:["file","default.PTP.Common.FileInfo",null],100:["err","uint32",0]}},UploadReq:{$:{1:["file","default.PTP.Common.FileInfo",null]}},UploadRes:{$:{100:["err","uint32",0]}}},Msg:{AnswerCallbackButtonReq:{$:{1:["chatId","string",""],2:["messageId","uint32",0],3:["data","string",""],4:["accessHash","string",""],5:["isGame","bool",!1]}},AnswerCallbackButtonRes:{$:{1:["message","string",""],2:["url","string",""],3:["alert","string",""],100:["err","uint32",0]}},DownloadMsgReq:{$:{1:["chatId","string",""]}},DownloadMsgRes:{$:{1:["messages","<default.PTP.Common.MessageStoreRow",null],100:["err","uint32",0]}},GenMsgIdReq:{$:{1:["isLocal","bool",!1]}},GenMsgIdRes:{$:{1:["messageId","uint64",{low:0,high:0,unsigned:!0}],100:["err","uint32",0]}},MsgDeleteReq:{$:{1:["user_id","string",""],2:["chat_id","string",""],3:["msg_ids","[uint32",null],4:["revoke","bool",!1]}},MsgDeleteRes:{$:{100:["err","uint32",0]}},MsgListReq:{$:{1:["chatId","string",""],2:["lastMessageId","uint32",0],3:["limit","uint32",0],4:["isUp","bool",!1]}},MsgListRes:{$:{1:["payload","string",""],100:["err","uint32",0]}},MsgUpdateReq:{$:{1:["user_id","string",""],2:["chat_id","string",""],3:["msg_id","uint32",0],4:["text","string",""]}},MsgUpdateRes:{$:{100:["err","uint32",0]}},RemoveMessagesReq:{$:{1:["messageIds","[uint32",null]}},RemoveMessagesRes:{$:{100:["err","uint32",0]}},SendBotMsgReq:{$:{1:["chatId","string",""],2:["botApi","string",""],3:["text","string",""],4:["chatGpt","string",""],5:["msgId","uint32",0]}},SendBotMsgRes:{$:{1:["reply","string",""],2:["chatId","string",""],3:["msgId","uint32",0],4:["streamEnd","bool",!1],5:["message","default.PTP.Common.PbMsg",null]}},SendReq:{$:{1:["chatId","string",""],2:["text","string",""],3:["msg","default.PTP.Common.PbMsg",null]}},SendRes:{$:{1:["chatId","string",""],2:["action","string",""],3:["msg","default.PTP.Common.PbMsg",null],4:["text","string",""],5:["localId","uint32",0],100:["err","uint32",0]}},UpdateCmdReq:{$:{1:["botApi","string",""],2:["chatId","string",""]}},UpdateCmdRes:{$:{1:["commands","<default.PTP.Common.PbCommands",null],2:["chatId","string",""]}},UploadMsgReq:{$:{1:["messages","<default.PTP.Common.MessageStoreRow",null],2:["chatId","string",""],3:["time","uint32",0]}},UploadMsgRes:{$:{100:["err","uint32",0]}}},Other:{OtherNotify:{$:{100:["err","uint32",0]}},StopChatStreamReq:{$:{1:["chatId","uint32",0],2:["msgId","uint32",0]}}},Sync:{SyncReq:{$:{1:["userStoreData","default.PTP.Common.UserStoreData",null]}},SyncRes:{$:{1:["userStoreData","default.PTP.Common.UserStoreData",null],100:["err","uint32",0]}}},User:{DownloadUserReq:{$:{1:["userIds","<string",null]}},DownloadUserRes:{$:{1:["users","<default.PTP.Common.UserStoreRow",null],100:["err","uint32",0]}},GenUserIdReq:{$:{}},GenUserIdRes:{$:{1:["userId","uint32",0],100:["err","uint32",0]}},UploadUserReq:{$:{1:["users","<default.PTP.Common.UserStoreRow",null],3:["time","uint32",0]}},UploadUserRes:{$:{100:["err","uint32",0]}}}}}},"",i,!1),s.util.global.default=i.default;const A=s.util.global.default},93968:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var s=n(2153);function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o{constructor(e,t){i(this,"lang",void 0),i(this,"words",void 0),t||(t="english"),Object.defineProperty(this,"lang",{value:t,writable:!1}),(0,s.XE)(this.lang),e||(e=(0,s.OF)()),Object.defineProperty(this,"words",{value:e,writable:!1})}getLang(){return this.lang}getWords(){return this.words}checkMnemonic(){return(0,s._I)(this.words)}toSeedBuffer(e){return e||(e=""),(0,s.Z1)(this.getWords(),e)}toSeedHex(e){return this.toSeedBuffer(e).toString("hex")}toEntropy(){return(0,s.oy)(this.getWords())}static fromEntropy(e,t){const n=(0,s.JJ)(e);return new o(n,t)}}},46586:(e,t,n)=>{"use strict";function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,{default:()=>i});class i{constructor(){s(this,"promise",void 0),s(this,"reject",void 0),s(this,"resolve",void 0),this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}},49524:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Type:()=>i,clear:()=>c,fetch:()=>o,remove:()=>r,save:()=>a});const s=self.caches;let i=function(e){return e[e.Text=0]="Text",e[e.Blob=1]="Blob",e[e.Json=2]="Json",e[e.ArrayBuffer=3]="ArrayBuffer",e}({});async function o(e,t,n,o=!1){if(s)try{const a=new Request(t.replace(/:/g,"_")),r=await s.open(e),c=await r.match(a);if(!c)return;const d=c.headers.get("Content-Type");switch(n){case i.Text:return await c.text();case i.Blob:{if(t.startsWith("avatar")&&d&&d.startsWith("text"))return;const e=await c.blob(),n=!e.type||!o&&e.type.includes("html");let s=e.type||d;return n&&s?(o||(s=s.replace(/html/gi,"")),new Blob([e],{type:s})):e}case i.Json:return await c.json();case i.ArrayBuffer:return await c.arrayBuffer();default:return}}catch(e){return void console.warn(e)}}async function a(e,t,n){if(s)try{const i="string"==typeof n||n instanceof Blob||n instanceof ArrayBuffer?n:JSON.stringify(n),o=new Request(t.replace(/:/g,"_")),a=new Response(i),r=await s.open(e);return await r.put(o,a)}catch(e){return void console.warn(e)}}async function r(e,t){try{if(!s)return;const n=await s.open(e);return await n.delete(t)}catch(e){return void console.warn(e)}}async function c(e){try{if(!s)return;return await s.delete(e)}catch(e){return void console.warn(e)}}},69118:(e,t,n)=>{"use strict";function s(e,t,n=!0){let s,i,o;return(...a)=>{i=!0,o=a,s||(n&&(i=!1,e(...o)),s=self.setInterval((()=>{if(!i)return self.clearInterval(s),void(s=void 0);i=!1,e(...o)}),t))}}function i(e){return function(e,t){let n,s=!1;return(...i)=>{n=i,s||(s=!0,e((()=>{s=!1,t(...n)})))}}(r,e)}let o,a;function r(e,t=!1){o?t?a.push(e):o.push(e):(o=t?[]:[e],a=t?[e]:[],Promise.resolve().then((()=>{const e=o,t=a;o=void 0,a=void 0,t.forEach((e=>e())),e.forEach((e=>e()))})))}n.d(t,{$6:()=>i,P2:()=>s})},83579:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ce});var s=n(95053),i=n(86266);const o=n(55835),{Buffer:a}=n(48764),r=new i.ec("secp256k1");var c=n(93968),d=n(1372),u=n(63024);const l="m/44'/60'/1'";class f{constructor(e,t){var n,s,i;n=this,i=void 0,(s=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(s="__masterKey"))in n?Object.defineProperty(n,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[s]=i;const o=e.toSeedBuffer(t);this.__masterKey=d.hdkey.fromMasterSeed(o),Object.defineProperty(this,"__masterKey",{value:d.hdkey.fromMasterSeed(o),writable:!1})}getMashKey(){return this.__masterKey}static fromEntropy(e,t,n){const s=c.Z.fromEntropy(e,n);return new f(s,t)}getChild(e,t=0,n=0,s=!1){const i=`${e}/${n}/${t}`,o=this.getMashKey().derivePath(i),a=o.getWallet().getAddressString(),r=o._hdkey.privateKey,c=o._hdkey.publicKey,d=o.getWallet().getPublicKey();return s?{path:i,address:a,prvKey:f.bufferToHex(r),pubKey:f.bufferToHex(c),pubKey_:f.bufferToHex(d)}:{path:i,address:a,prvKey:r,pubKey:c,pubKey_:d}}static bufferToHex(e){return"0x"+e.toString("hex")}getEthWallet(e,t){return this.getChild("m/44'/60'/0'",e,0,!!t)}getPTPWallet(e,t){return this.getChild(l,e,u.PS.EncryptType_Wallet,!!t)}getPTPEncryptWallet(e,t){return this.getChild(l,e,t,!1)}getGroupWallet(e,t){return this.getChild("m/44'/60'/1'",e,u.PS.EncryptType_Group,!!t)}}var p=n(69282),h=n.n(p),g=n(13550),m=n.n(g);function y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Buffer:w}=n(48764),{keccak224:b,keccak384:v,keccak256:A,keccak512:I}=n(82192),{ecdsaRecover:S,publicKeyConvert:C,ecdsaSign:P}=n(95053);let _=function(e){return e[e.SignMsgType_eth=1e3]="SignMsgType_eth",e[e.SignMsgType_ptp=1001]="SignMsgType_ptp",e[e.SignMsgType_ptp_group=1002]="SignMsgType_ptp_group",e}({});const M=function(e){if(!w.isBuffer(e))throw new Error(`This method only supports Buffer but input was: ${e}`)},R=function(e){return"0x"+e.toString("hex")},D=function(e,t=256){switch(M(e),t){case 224:return b(e);case 256:return A(e);case 384:return v(e);case 512:return I(e);default:throw new Error(`Invald algorithm: keccak${t}`)}},T=function(e){return new(m())(e).toNumber()};function k(e){let t=e;if("string"!=typeof t)throw new Error("[padToEven] value must be type 'string', received "+typeof t);return t.length%2&&(t=`0${t}`),t}const E=function(e,t){return M(e),U(e,t,!1)},U=function(e,t,n){const s=(i=t,w.allocUnsafe(i).fill(0));var i;return n?e.length<t?(e.copy(s),s):e.slice(0,t):e.length<t?(e.copy(s,t-e.length),s):e.slice(-t)};let B=function(e){return e[e.Number=0]="Number",e[e.BN=1]="BN",e[e.Buffer=2]="Buffer",e[e.PrefixedHexString=3]="PrefixedHexString",e}({});function x(e){const t=new(m())(e);return t.eqn(0)||t.eqn(1)}const N=function(e){const t=function(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`}(e);return w.from(k(t.slice(2)),"hex")},O=function(e){if(null==e)return w.allocUnsafe(0);if(w.isBuffer(e))return w.from(e);if(Array.isArray(e)||e instanceof Uint8Array)return w.from(e);if("string"==typeof e){if(!q(e))throw new Error(`Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: ${e}`);return w.from(k((e=>{if("string"!=typeof e)throw new Error("[stripHexPrefix] input must be type 'string', received "+typeof e);return function(e){if("string"!=typeof e)throw new Error("[isHexPrefixed] input must be type 'string', received type "+typeof e);return"0"===e[0]&&"x"===e[1]}(e)?e.slice(2):e})(e)),"hex")}if("number"==typeof e)return N(e);if(m().isBN(e)){if(e.isNeg())throw new Error(`Cannot convert negative BN to buffer. Given: ${e}`);return e.toArrayLike(w)}if(e.toArray)return w.from(e.toArray());if(e.toBuffer)return w.from(e.toBuffer());throw new Error("invalid type")};function q(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/)||t&&e.length!==2+2*t)}function H(e,t){if(null===e)return null;if(void 0===e)return;if("string"==typeof e&&!q(e))throw new Error(`A string must be provided with a 0x-prefix, given: ${e}`);if("number"==typeof e&&!Number.isSafeInteger(e))throw new Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative input type)");const n=O(e);if(t===B.Buffer)return n;if(t===B.BN)return new(m())(n);if(t===B.Number){const e=new(m())(n),t=new(m())(Number.MAX_SAFE_INTEGER.toString());if(e.gt(t))throw new Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative output type)");return e.toNumber()}return`0x${n.toString("hex")}`}function j(e,t){const n=H(e,B.BN);if(n.eqn(0)||n.eqn(1))return H(e,B.BN);if(!t)return n.subn(27);const s=H(t,B.BN);return n.sub(s.muln(2).addn(35))}const F=function(e){let t,n,s;if(e.length>=65)t=e.slice(0,32),n=e.slice(32,64),s=T(e.slice(64));else{if(64!==e.length)throw new Error("Invalid signature length");t=e.slice(0,32),n=e.slice(32,64),s=T(e.slice(32,33))>>7,n[0]&=127}return s<27&&(s+=27),{v:s,r:t,s:n}},G=function(e,t=!1){return M(e),t&&64!==e.length&&(e=w.from(C(e,!1).slice(1))),h()(64===e.length),D(e).slice(-20)};class L{constructor({pubKey:e,prvKey:t}){y(this,"pubKey",void 0),y(this,"prvKey",void 0),Object.defineProperty(this,"pubKey",{value:e,writable:!1}),Object.defineProperty(this,"prvKey",{value:t,writable:!1})}static getSignMsgData(e,t=_.SignMsgType_ptp){const n=w.from(e,"utf-8");let s;return s=t==_.SignMsgType_eth?w.from(`Ethereum Signed Message:\n${n.length}`,"utf-8"):t==_.SignMsgType_ptp_group?w.from(`PTP GROUP Signed Message:\n${n.length}`,"utf-8"):w.from(`PTP Signed Message:\n${n.length}`,"utf-8"),w.concat([s,n])}sign(e){const t=function(e,t,n){const{signature:s,recid:i}=P(e,t,{recovered:!0});return{r:w.from(s.slice(0,32)),s:w.from(s.slice(32,64)),v:i+27}}(D(L.getSignMsgData(e)),this.prvKey);return w.concat([t.r,t.s,N(t.v)])}static recoverAddress({sig:e,message:t}){const n=function(e,t){const n=D(e),s=F(t);return function(e,t,n,s,i){const o=w.concat([E(n,32),E(s,32)],64),a=j(t,i);if(!x(a))throw new Error("Invalid signature v value");const r=S(o,a.toNumber(),e);return w.from(C(r,!1).slice(1))}(n,s.v,s.r,s.s)}(L.getSignMsgData(t),e),s=G(n);return R(s)}static recoverAddressAndPubKey({sig:e,message:t}){const n=function(e,t){const n=D(e),s=F(t);return function(e,t,n,s,i){const o=w.concat([E(n,32),E(s,32)],64),a=j(t,i);if(!x(a))throw new Error("Invalid signature v value");const r=S(o,a.toNumber(),e);return C(r,!1)}(n,s.v,s.r,s.s)}(L.getSignMsgData(t),e),s=G(w.from(n.slice(1)));return{address:R(s),pubKey:w.from(n)}}}const{Buffer:$}=n(48764),K=n(55835),z="aes-256-gcm";class W{static encrypt(e,t,n,s){const i=K.createCipheriv(z,t,n);s&&i.setAAD(s);let o=i.update(e,"utf8","binary");o+=i.final("binary");const a=i.getAuthTag();return $.concat([$.from(a),$.from(o,"binary")])}static decrypt(e,t,n,s){const i=$.from(e.subarray(0,16)),o=K.createDecipheriv(z,t,n);let a;s&&o.setAAD(s),a=$.from(e.subarray(16,e.length)),o.setAuthTag(i);let r=o.update(a.toString("hex"),"hex","hex");return r+=o.final("hex"),$.from(r,"hex")}}var V=n(44567),Z=n(29423),J=n(48764).Buffer;function Q(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Y="a-ks",X="a-ss",ee="86680581fcdc7b5aba47f2218884d50706b108532a624f0cbe939d9dea1bf997",te="815b4192992cf4a36796ead23b8b5fd4",ne="60efbef0ab699df0011825d013d92148";let se,ie,oe,ae=[],re={};class ce{constructor(e){Q(this,"accountId",void 0),Q(this,"uid",void 0),Q(this,"userInfo",void 0),Q(this,"shareKey",void 0),Q(this,"iv",void 0),Q(this,"aad",void 0),Q(this,"entropy",void 0),Q(this,"session",void 0),Q(this,"clientInfo",void 0),this.accountId=e,this.uid=""}static getServerKv(){return ie}static getClientKv(){return oe}static setServerKv(e){ie=e}static setClientKv(e){oe=e}static formatSession({sign:e,ts:t,address:n,accountId:s}){return`${e.toString("hex")}_${t}_${n}_${s}`}static parseSession(e){if(e){const t=e.split("_");return{sign:t[0],time:parseInt(t[1]),address:t[2],accountId:t.length>3?parseInt(t[3]):0}}}saveSession(e){const t=ce.parseSession(e);t&&(ce.getClientKv().put("adr",t.address),ce.saveSessionByAddr(t.address,e))}getSessionAddress(){const e=this.getSession();if(e){const{address:t}=ce.parseSession(e);return t}}getSession(){if(this.session)return this.session;{const e=ce.getClientKv().get("adr");return e?(this.session=ce.getSessionByAddr(e),this.session):void 0}}delSession(){this.session=void 0,ce.getClientKv().delete("adr")}static saveSessionByAddr(e,t){const n=ce.getSessions();n[e]=t,ce.getClientKv().put(`${X}`,JSON.stringify(n))}static getSessionByAddr(e){const t=ce.getSessions();return t[e]?t[e]:void 0}static getSessions(){const e=ce.getClientKv().get(`${X}`);return e?JSON.parse(e):{}}async saveUidFromCacheByAddress(e,t){await ce.getServerKv().put(`ADR_UID_${e}`,t)}async getUidFromCacheByAddress(e){return await ce.getServerKv().get(`ADR_UID_${e}`)||void 0}getShareKey(){return this.shareKey}getIv(){return this.iv}getAad(){return this.aad}getAccountId(){return this.accountId}setUid(e){this.uid=e}setUserInfo(e){this.userInfo=e}getUserInfo(){return this.userInfo}getUid(){return this.uid}async verifyPwd(e,t){const n=(0,V.n)(e),s=await this.getEntropy();return t===ce.getAddressFromEntropy(s,n)}static getAddressFromEntropy(e,t){return new f(c.Z.fromEntropy(e),t).getPTPWallet(0).address}genEntropy(){let e=new c.Z;this.entropy=e.toEntropy()}async encryptData(e,t){const n=await this.getEntropy();t&&(t=(0,V.n)(t));let s=new f(c.Z.fromEntropy(n)),{prvKey:i,pubKey:o}=s.getPTPWallet(u.PS.EncryptType_Message);o=o.slice(1);const a=J.from(t,"hex");return W.encrypt(e,a,i,o)}async decryptData(e,t){const n=await this.getEntropy();t=(0,V.n)(t);let s=new f(c.Z.fromEntropy(n)),{prvKey:i,pubKey:o}=s.getPTPWallet(u.PS.EncryptType_Message);o=o.slice(1);const a=J.from(t,"hex");return W.decrypt(e,a,i,o)}async encryptByPubKey(e,t){const n=await this.getEntropy();let s=new f(c.Z.fromEntropy(n),t),{pubKey_:i}=s.getPTPWallet(0);return((e,t,n={})=>{if(64!==e.length)throw new Error("pubKeyTo len must 64");const s=n.ephemPrivKey||o.randomBytes(32),i=r.keyFromPrivate(s),c=i.getPublic(),d=a.from(c.encode("array",!1)),u=a.concat([a.from([4]),e]),l=r.keyFromPublic(u),f=i.derive(l.getPublic()),p=o.createHash("sha512").update(f.toArrayLike(a)).digest(),h=n.iv||o.randomBytes(16),g=p.slice(0,32),m=p.slice(32),y=((e,t,n)=>{const s=o.createCipheriv("aes-256-cbc",t,e),i=s.update(n),r=s.final();return a.concat([i,r])})(h,g,t),w=a.concat([h,d,y]),b=o.createHmac("sha256",m).update(w).digest();return a.concat([h,d,b,y])})(i,e)}async decryptByPrvKey(e,t){const n=await this.getEntropy();let s=new f(c.Z.fromEntropy(n),t),{prvKey:i}=s.getPTPWallet(0);return((e,t,n={})=>{let s,i,c=0;(n=n||{}).ephemPrivKey?(c=65,i=r.keyFromPrivate(n.ephemPrivKey).getPublic(),s=a.from(i.encode("array",!1))):(s=t.slice(16,81),i=r.keyFromPublic(s).getPublic());const d=t.slice(0,16),u=t.slice(81-c,113-c),l=t.slice(113-c),f=r.keyFromPrivate(e).derive(i),p=o.createHash("sha512").update(f.toArrayLike(a)).digest(),h=p.slice(0,32),g=p.slice(32),m=a.concat([d,s,l]);if(!((e,t)=>{if(e.length!==t.length)return!1;let n=0;for(let s=0;s<e.length;s++)n|=e[s]^t[s];return 0===n})(o.createHmac("sha256",g).update(m).digest(),u))throw new Error("MAC mismatch");return((e,t,n)=>{const s=o.createDecipheriv("aes-256-cbc",t,e),i=s.update(n),r=s.final();return a.concat([i,r])})(d,h,l)})(i,e)}static getAccountIdByEntropy(e){const t=ce.getKeys();for(let n=0;n<Object.keys(t).length;n++){const s=Object.keys(t)[n];if(e===t[s])return parseInt(s)}return null}static localEncrypt(e){return W.encrypt(J.from(e),J.from(ee,"hex"),J.from(te,"hex"),J.from(ne,"hex"))}static localDecrypt(e){return W.decrypt(e,J.from(ee,"hex"),J.from(te,"hex"),J.from(ne,"hex"))}static saveKey(e,t){const n=ce.getKeys();n[e]=t;const s=ce.localEncrypt(J.from(JSON.stringify(n)));ce.getClientKv().put(`${Y}`,s.toString("hex"))}static getKey(e){const t=ce.getKeys();return t[e]?t[e]:void 0}static getKeys(){let e=ce.getClientKv().get(`${Y}`);return e?(-1===e.indexOf("{")&&(e=ce.localDecrypt(J.from(e,"hex")),e=e.toString()),JSON.parse(e)):{}}async setEntropy(e,t){this.entropy=e,t||await ce.saveKey(this.getAccountId(),e)}async getEntropy(){if(this.entropy)return this.entropy;let e=await ce.getKey(this.getAccountId());return e||(e=(new c.Z).toEntropy(),await ce.saveKey(this.getAccountId(),e)),this.entropy=e,e}async initEcdh(e,t,n){const i=await this.getEntropy(),o=new f(c.Z.fromEntropy(i)).getPTPWallet(0);this.shareKey=J.from((0,s.ecdh)(e,o.prvKey)),this.aad=n,this.iv=t}aesEncrypt(e){return W.encrypt(e,this.getShareKey(),this.getIv(),this.getAad())}aesDecrypt(e){return W.decrypt(e,this.getShareKey(),this.getIv(),this.getAad())}async signMessage(e,t){const n=await this.getEntropy(),s=new f(c.Z.fromEntropy(n),t).getPTPWallet(0),i=new L({pubKey:s.pubKey,prvKey:s.prvKey});return{address:s.address,sign:i.sign(e)}}verifyRecoverAddress(e,t){return L.recoverAddress({message:t,sig:e})}async verifySession(e,t){const{address:n}=this.recoverAddressAndPubKey(J.from(e.split("_")[0],"hex"),e.split("_")[1]);return await this.verifyPwd(t,n)?n:""}recoverAddressAndPubKey(e,t){return L.recoverAddressAndPubKey({message:t,sig:e})}static setCurrentAccount(e){se=e.getAccountId()}static getCurrentAccount(){return se?ce.getInstance(se):null}static genAccountId(){return+new Date}static getCurrentAccountId(){if(se)return se;{let e=ce.getClientKv().get("a-c-id");return e?("string"==typeof e&&(e=parseInt(e)),ce.getClientKv().put("a-c-id",String(e))):e=ce.genAccountId(),ce.setCurrentAccountId(e),e}}static setCurrentAccountId(e){se=e;const t=ce.getClientKv().get("a-as");ae=t?JSON.parse(t):[],ae.includes(e)||(ae.push(e),ce.getClientKv().put("a-as",JSON.stringify(ae))),ce.getClientKv().put("a-c-id",String(e))}static getInstance(e){return re[e]||(re[e]=new ce(e)),re[e]}static randomBuff(e){return J.from((0,Z.Nu)(e))}setClientInfo(e){this.clientInfo=e}getClientInfo(){return this.clientInfo}}},44567:(e,t,n)=>{"use strict";n.d(t,{n:()=>a}),n(54155);var s=n(74237),i=n(48764).Buffer;const o="wai ai blockchain auto bot";function a(e){return(0,s.sha256)(i.from(`${e}${o}`)).toString("hex")}},2133:(e,t,n)=>{"use strict";n.d(t,{nM:()=>a,q9:()=>i,z1:()=>o});var s=n(48764).Buffer;function i(){return Math.ceil(+new Date/1e3)}async function o(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>{const e=s.from(i.result);t(e)},i.onerror=n,i.readAsArrayBuffer(e)}))}async function a(e){const t=await function(e){return new Promise(((t,n)=>{const s=new FileReader;s.readAsArrayBuffer(e),s.onload=()=>t(s.result),s.onerror=n}))}(e);return s.from(t)}},46601:()=>{},89214:()=>{},71922:()=>{},2363:()=>{},27790:()=>{},81922:()=>{},52361:()=>{},94616:()=>{},6567:()=>{}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=n,i.x=()=>{var e=i.O(void 0,[5016,8893],(()=>i(10792)));return i.O(e)},e=[],i.O=(t,n,s,o)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,s,o]=e[u],r=!0,c=0;c<n.length;c++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(r=!1,o<a&&(a=o));if(r){e.splice(u--,1);var d=s();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,s,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+"."+{5016:"455c82d3276fe3a7bfaa",8893:"a4f28d7160f2217560d9"}[e]+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={3598:1};i.f.i=(t,n)=>{e[t]||importScripts(i.p+i.u(t))};var t=self.webpackChunkwai=self.webpackChunkwai||[],n=t.push.bind(t);t.push=t=>{var[s,o,a]=t;for(var r in o)i.o(o,r)&&(i.m[r]=o[r]);for(a&&a(i);s.length;)e[s.pop()]=1;n(t)}})(),t=i.x,i.x=()=>Promise.all([i.e(5016),i.e(8893)]).then(t),i.x()})();
//# sourceMappingURL=3598.9ad0540da16200b335d1.js.map