(self.webpackChunkwai=self.webpackChunkwai||[]).push([[6059],{78874:(t,e,a)=>{"use strict";a.d(e,{X9:()=>K,Co:()=>J,ft:()=>W});var o=a(33555),s=a(6137),n=a(91713),i=a(83716),r=a(71226),d=a(25260),c=a(11192),l=a(60782),h=a(69118),u=a(56112),f=a(53551),I=a(78958),p=a(42431),g=a(16974),m=a(50711),V=a(9211),b=a(44271),w=a(65054),C=a(60054),y=a(49524),R=a(71394);a(82752),a(44107);var v=a(86038);a(45340);var A=a(63024),M=(a(77150),a(89618)),B=(a(48960),a(87873),a(16039)),P=a(24736),S=a.n(P),_=a(57404),F=a(48764).Buffer;const T="BroadcastChannel"in self,E=T?new BroadcastChannel(i.tuy):void 0;let H=[];const U=(0,h.P2)((()=>{E.postMessage({type:"localDbUpdate",batchedUpdates:H}),H=[]}),100);function N(t){if(t instanceof Uint8Array)return F.from(t);if("object"==typeof t&&1===Object.keys(t).length&&"value"===Object.keys(t)[0])return S()(t.value);if(Array.isArray(t))return t.map(N);if("object"!=typeof t||!("CONSTRUCTOR_ID"in t))return t;const e=t.className.split(".").reduce(((t,e)=>t[e]),_.constructors),a=function(t){const{flags:e,CONSTRUCTOR_ID:a,SUBCLASS_OF_ID:o,className:s,classType:n,getBytes:i,...r}=t;return r}(t);return new e(Object.keys(a).reduce(((t,e)=>(t[e]=N(a[e]),t)),{}))}var O;["localMessages","chats","users","messages","documents","stickerSets","photos","webDocuments","cache","botWaitReply"].reduce(((t,e)=>{var a;const o=null!==(a=O?.[e])&&void 0!==a?a:{},s=Object.keys(o).reduce(((t,e)=>(t[e]=N(o[e]),t)),{});var n;return t[e]=T?(n=e,new Proxy(s,{get:(t,e,a)=>Reflect.get(t,e,a),set:(t,e,a)=>(H.push({name:n,prop:e,value:a}),U(),Reflect.set(t,e,a))})):s,t}),{}),a(83579),a(2133),a(48764).Buffer;const j=(Array(6).fill(void 0).map((()=>new B.J(10))),()=>(0,M.readBigIntFromBuffer)((0,M.generateRandomBytes)(8),!0,!0).toString().replace("-","").replace("n",""));var k=a(10413),Z=a(93447),L=a(48764).Buffer;i.awM;const D=(0,h.P2)((t=>t()),3e3,!0),G=(0,h.Ds)((t=>t()),500,!1,!0);(0,o.iw)("preloadTopChatMessages",(async(t,e)=>{const a=new Set;for(let n=0;n<i.ulj;n++){await(0,h.wO)(100),t=(0,o.Rd)();const n=Object.values(t.byTabId).map((({id:e})=>(0,c.Bt)(t,e)?.chatId)).filter(Boolean),r=(0,g.gO)(i.NfV),d=r?.find((t=>!n.includes(t)&&!a.has(t)));if(!d)return;a.add(d),e.loadViewportMessages({chatId:d,threadId:s._f,tabId:(0,w._w)()})}})),(0,o.iw)("openChat",((t,e,a)=>{const{id:o,threadId:n=s._f}=a;if(!o)return;const{currentUserId:i}=t,d=(0,c.Z1)(t,o);if(d?.hasUnreadMark&&e.toggleChatUnread({id:o}),d)(0,u.Hp)(d)&&d.isMin;else if(o===i)(0,r.t9)("fetchChat",{type:"self"});else{const e=(0,c.dy)(t,o);e&&(0,r.t9)("fetchChat",{type:"user",user:e})}n!==s._f&&e.requestThreadInfoUpdate({chatId:o,threadId:n})})),(0,o.iw)("openComments",(async(t,e,a)=>{const{id:n,threadId:h,originChannelId:u,tabId:f=(0,w._w)()}=a;if(h!==s._f){const a=(0,c.qS)(t,n,h);if(a)e.openChat({id:n,threadId:a,tabId:f});else{const a=(0,c.Cm)(t,n,h);if(!a)return;e.openChat({id:i.mzl,tabId:f});const s=await(0,r.t9)("requestThreadInfoUpdate",{chat:a,threadId:h,originChannelId:u});if(!s)return void e.openPreviousChat({tabId:f});t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(s.users,"id")),(0,o.R3)(t),e.openChat({id:n,threadId:s.topMessageId,tabId:f})}}})),(0,o.iw)("openLinkedChat",(async(t,e,a)=>{const{id:o,tabId:s=(0,w._w)()}=a,n=(0,c.Z1)(t,o);if(!n)return;const i=await(0,r.t9)("fetchFullChat",n);i?.fullInfo?.linkedChatId&&e.openChat({id:i.fullInfo.linkedChatId,tabId:s})})),(0,o.iw)("focusMessageInComments",(async(t,e,a)=>{const{chatId:s,threadId:n,messageId:i,tabId:h=(0,w._w)()}=a,u=(0,c.Z1)(t,s);if(!u)return;const f=await(0,r.t9)("requestThreadInfoUpdate",{chat:u,threadId:n});f&&(t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(f.users,"id")),(0,o.R3)(t),e.focusMessage({chatId:s,threadId:n,messageId:i,tabId:h}))})),(0,o.iw)("openSupportChat",(async(t,e,a)=>{const{tabId:o=(0,w._w)()}=a||{},s=(0,c.P_)(t);if(s)return void e.openChat({id:s.id,shouldReplaceHistory:!0,tabId:o});e.openChat({id:i.mzl,shouldReplaceHistory:!0,tabId:o});const n=await(0,r.t9)("fetchChat",{type:"support"});n&&e.openChat({id:n.chatId,shouldReplaceHistory:!0,tabId:o})})),(0,o.iw)("loadAllChats",(async(t,e,a)=>{const s=a.listType;if("archived"===s)return;const{onReplace:n}=a;let{shouldReplace:r}=a,d=0;const l=t=>t.lastMessage?.date||t.joinDate;for(;r||!t.chats.isFullyLoaded[s];){if(d++>=100)return void(i.eMD&&console.error("`actions/loadAllChats`: Infinite loop detected"));t=(0,o.Rd)();const e=!r&&t.chats.listIds[s],a=e?e.map((e=>t.chats.byId[e])).filter((e=>Boolean(e&&l(e))&&e.id!==i.awM&&!(0,c.ep)(t,e.id))).sort(((t,e)=>l(t)-l(e)))[0]:void 0;await z(t,s,a?.id,a&&l(a),r,!0),r&&(n?.(),r=!1),t=(0,o.Rd)()}})),(0,o.iw)("loadFullChat",((t,e,a)=>{const{chatId:o,force:s,tabId:n=(0,w._w)()}=a,i=(0,c.Z1)(t,o);i&&(s?W(t,e,i,n):G((()=>W(t,e,i,n))))})),(0,o.iw)("loadTopChats",(t=>{D((()=>z(t,"active")))})),(0,o.iw)("requestChatUpdate",((t,e,a)=>{const{chatId:o}=a,s=(0,c.Z1)(t,o);s&&(0,r.t9)("requestChatUpdate",{chat:s,...o===i.awM&&{lastLocalMessage:(0,c.VF)(t)?.message}})})),(0,o.iw)("updateChatMutedState",((t,e,a)=>{const{chatId:s,isMuted:n}=a,i=(0,c.Z1)(t,s);i&&(t=(0,d.a4)(t,s,{isMuted:n}),(0,o.R3)(t),(0,r.t9)("updateChatMutedState",{chat:i,isMuted:n}))})),(0,o.iw)("updateTopicMutedState",((t,e,a)=>{const{chatId:s,isMuted:n,topicId:i}=a,l=(0,c.Z1)(t,s);l&&(t=(0,d.Cn)(t,s,i,{isMuted:n}),(0,o.R3)(t),(0,r.t9)("updateTopicMutedState",{chat:l,topicId:i,isMuted:n}))})),(0,o.iw)("createChannel",(async(t,e,a)=>{const{title:s,about:i,photo:l,memberIds:h,tabId:u=(0,w._w)()}=a,f=h.map((e=>(0,c.dy)(t,e))).filter(Boolean);let I;t=(0,b.i)(t,{chatCreation:{progress:n.Nh.InProgress}},u),(0,o.R3)(t);try{I=await(0,r.t9)("createChannel",{title:s,about:i,users:f})}catch(a){t=(0,o.Rd)(),t=(0,b.i)(t,{chatCreation:{progress:n.Nh.Error}},u),(0,o.R3)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:u}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:u})}if(!I)return;const{id:p,accessHash:g}=I;t=(0,o.Rd)(),t=(0,d.a4)(t,p,I),t=(0,b.i)(t,{chatCreation:{...(0,c.jU)(t,u).chatCreation,progress:I?n.Nh.Complete:n.Nh.Error}},u),(0,o.R3)(t),e.openChat({id:p,shouldReplaceHistory:!0,tabId:u}),p&&g&&l&&await(0,r.t9)("editChatPhoto",{chatId:p,accessHash:g,photo:l})})),(0,o.iw)("joinChannel",(async(t,e,a)=>{const{chatId:o,tabId:s=(0,w._w)()}=a,n=(0,c.Z1)(t,o);if(!n)return;const{id:i,accessHash:d}=n;if(i&&d)try{await(0,r.t9)("joinChannel",{channelId:i,accessHash:d})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:s}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:s})}})),(0,o.iw)("deleteChatUser",((t,e,a)=>{const{chatId:s,userId:n,tabId:i=(0,w._w)()}=a,l=(0,c.Z1)(t,s),h=(0,c.dy)(t,n);l&&h&&(t=(0,d.Dd)(t,s),(0,o.R3)(t),(0,c.Bt)(t,i)?.chatId===s&&e.openChat({id:void 0,tabId:i}),(0,r.t9)("deleteChatUser",{chat:l,user:h}))})),(0,o.iw)("deleteChat",((t,e,a)=>{const{chatId:s,tabId:n=(0,w._w)()}=a,i=(0,c.Z1)(t,s);i&&(t=(0,d.Dd)(t,s),(0,o.R3)(t),(0,c.Bt)(t,n)?.chatId===s&&e.openChat({id:void 0,tabId:n}),(0,r.t9)("deleteChat",{chatId:i.id}))})),(0,o.iw)("leaveChannel",((t,e,a)=>{const{chatId:s,tabId:n=(0,w._w)()}=a,i=(0,c.Z1)(t,s);if(!i)return;t=(0,d.Dd)(t,s),(0,o.R3)(t),(0,c.Bt)(t,n)?.chatId===s&&e.openChat({id:void 0,tabId:n});const{id:l,accessHash:h}=i;l&&h&&(0,r.t9)("leaveChannel",{channelId:l,accessHash:h})})),(0,o.iw)("deleteChannel",((t,e,a)=>{const{chatId:s,tabId:n=(0,w._w)()}=a,i=(0,c.Z1)(t,s);if(!i)return;t=(0,d.Dd)(t,s),(0,o.R3)(t),(0,c.Bt)(t,n)?.chatId===s&&e.openChat({id:void 0,tabId:n});const{id:l,accessHash:h}=i;l&&h&&(0,r.t9)("deleteChannel",{channelId:l,accessHash:h})}));const q=async(t,e)=>{const a=await fetch(e),o=await a.arrayBuffer(),s="image/"+e.split(".")[e.split(".").length-1],n=new v.Z({file:{id:t,part:0,part_total:1,buf:L.from(o),size:L.from(o).length,type:s},err:A.wb.NO_ERROR}).pack().getPbData(),r=new Blob([L.from(n)],{type:s}),d=new Blob([L.from(o)],{type:s}),c=await(0,Z.tg)(d,40,40,"image/jpeg",.1),l=await(0,R.gm)(c),h=await(0,R.YJ)(l);return await y.save(i.F9T,t,r),{id:t,thumbnail:{dataUri:h,width:640,height:640},sizes:[{width:160,height:160,type:"s"},{width:320,height:320,type:"m"},{width:640,height:640,type:"x"}]}};(0,o.iw)("createChat",(async(t,e,a)=>{const{title:s,id:i,promptInit:r,about:h,tabId:u=(0,w._w)()}=a;let f=Object.keys(t.users.byId);t=(0,b.i)(t,{chatCreation:{progress:n.Nh.InProgress}},u),(0,o.R3)(t);try{let a,I=parseInt(C.gg);i?a=i:(f.length>0&&(f=[...f,...t.chatIdsDeleted],f.sort(((t,e)=>parseInt(e)-parseInt(t))),I=parseInt(f[0])+1),I<1e5&&(I=1e5),a=I.toString()),localStorage.getItem("cg-key")&&localStorage.getItem("cg-key");const p=r||C.iu;let g="",m=[];if(C.pK[a]){g=j();const t=C.pK[a],e=await q(g,t);m.push(e)}const V={canBeInvitedToGroup:!1,hasVideoAvatar:!1,type:"userTypeBot",id:a,phoneNumber:"",isMin:!1,noStatus:!0,isSelf:!1,avatarHash:g,accessHash:"",isPremium:!1,firstName:s,photos:m,usernames:[{username:"Bot_"+a,isActive:!0,isEditable:!0}],fullInfo:{isBlocked:!1,noVoiceMessages:!1,bio:h||C.GX,botInfo:{aiBot:{enableAi:!0,chatGptConfig:{init_system_content:p,api_key:"",max_history_length:10,modelConfig:{...C.ep,...a===C.fJ?{model:"gpt-4"}:{}}}},botId:a,description:h||C.GX,menuButton:{type:"commands"},commands:[...C.Jw,...C.C6].map((t=>(t.botId=a,t)))}}};t=(0,o.Rd)();const{chatFolders:w}=t,y=[V],R=[k.Z.buildDefaultChat(V)];let v,A=window.sessionStorage.getItem("activeChatFolder");const M={};A&&Object.values(w.byId).forEach((t=>{if(w.orderedIds[parseInt(A)]){const e=w.orderedIds[parseInt(A)];t.id===e&&(t.includedChatIds||(t.includedChatIds=[]),t.includedChatIds.push(a),M[t.id]=t,v=t)}}));const B={[V.id]:{type:"userStatusEmpty"}};t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(y,"id")),t=(0,d.fZ)(t,(0,l.ee)(R,"id")),t=(0,d.B1)(t,"active",R.map((t=>t.id))),t=(0,d.zn)(t,B),t=(0,b.i)(t,{chatCreation:{...(0,c.jU)(t,u).chatCreation,progress:n.Nh.Complete}},u),(0,o.R3)({...t,chatFolders:{...t.chatFolders,byId:{...t.chatFolders.byId,...M}}}),v&&e.editChatFolder({id:v.id,folderUpdate:v}),(r||i===C.Wv||i===C.fJ)&&e.sendBotCommand({chatId:a,command:"/initPrompt",tabId:u}),e.openChat({id:a,shouldReplaceHistory:!0})}catch(e){console.error(e),t=(0,o.Rd)(),t=(0,b.i)(t,{chatCreation:{...(0,c.jU)(t,u).chatCreation,progress:n.Nh.Error,error:"创建失败"}},u),(0,o.R3)(t)}})),(0,o.iw)("createGroupChat",(async(t,e,a)=>{const{title:s,memberIds:i,photo:l,tabId:h=(0,w._w)()}=a,u=i.map((e=>(0,c.dy)(t,e))).filter(Boolean);t=(0,b.i)(t,{chatCreation:{progress:n.Nh.InProgress}},h),(0,o.R3)(t);try{const a=await(0,r.t9)("createGroupChat",{title:s,users:u});if(!a)return;const{id:i}=a;t=(0,o.Rd)(),t=(0,d.a4)(t,i,a),t=(0,b.i)(t,{chatCreation:{...(0,c.jU)(t,h).chatCreation,progress:a?n.Nh.Complete:n.Nh.Error}},h),(0,o.R3)(t),e.openChat({id:i,shouldReplaceHistory:!0,tabId:h}),i&&l&&await(0,r.t9)("editChatPhoto",{chatId:i,photo:l})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,o.Rd)(),t=(0,b.i)(t,{chatCreation:{...(0,c.jU)(t,h).chatCreation,progress:n.Nh.Error,error:"CreateGroupError"}},h),(0,o.R3)(t))}})),(0,o.iw)("toggleChatPinned",((t,e,a)=>{const{id:o,folderId:s,tabId:n=(0,w._w)()}=a,d=(0,c.Z1)(t,o);if(!d)return;const l=(0,V.M)(t,"dialogFolderPinned");if(s){const e=(0,c.Mw)(t,s);if(e){const a=!(0,c.ep)(t,o,s),{pinnedChatIds:n,includedChatIds:i}=e,d=a?[o,...n||[]]:(n||[]).filter((t=>t!==o)),l=[o,...i];(0,r.t9)("editChatFolder",{id:s,folderUpdate:{...e,pinnedChatIds:d,includedChatIds:l}})}}else{const a=(0,c.Ek)(t,o),s=(0,c.ep)(t,o,"archived"===a?i.WSp:void 0),h=t.chats.orderedPinnedIds["archived"===a?"archived":"active"];if((h?.length||0)>=l&&!s)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:n});(0,r.t9)("toggleChatPinned",{chat:d,shouldBePinned:!s})}})),(0,o.iw)("toggleChatArchived",((t,e,a)=>{const{id:o}=a,s=(0,c.Z1)(t,o);s&&(0,r.t9)("toggleChatArchived",{chat:s,folderId:(0,u.pE)(s)?0:i.WSp})})),(0,o.iw)("loadChatFolders",(async t=>{const e=await(0,r.t9)("fetchChatFolders");e&&(t=(0,o.Rd)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,o.R3)(t))})),(0,o.iw)("loadRecommendedChatFolders",(async t=>{const e=await(0,r.t9)("fetchRecommendedChatFolders");e&&(t=(0,o.Rd)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,o.R3)(t))})),(0,o.iw)("editChatFolders",((t,e,a)=>{const{chatId:o,idsToRemove:s,idsToAdd:n,tabId:i=(0,w._w)()}=a,d=(0,V.M)(t,"dialogFiltersChats");n.some((e=>(0,c.Mw)(t,e).includedChatIds.length>=d))?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:i}):(s.forEach((async e=>{const a=(0,c.Mw)(t,e);a&&await(0,r.t9)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter((t=>t!==o)),includedChatIds:a.includedChatIds.filter((t=>t!==o))}})})),n.forEach((async e=>{const a=(0,c.Mw)(t,e);a&&await(0,r.t9)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(o)}})})))})),(0,o.iw)("editChatFolder",((t,e,a)=>{const{id:o,folderUpdate:s}=a,n=(0,c.Mw)(t,o);n&&(0,r.t9)("editChatFolder",{id:o,folderUpdate:{id:o,emoticon:n.emoticon,pinnedChatIds:n.pinnedChatIds,...s}})})),(0,o.iw)("addChatFolder",(async(t,e,a)=>{const{folder:s,tabId:n=(0,w._w)()}=a,{orderedIds:d,byId:c}=t.chatFolders,l=(0,V.M)(t,"dialogFilters");if(Object.keys(c).length>=l)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:n});const h=Math.max(...d||[],i.WSp),{id:u,description:f,...I}=s;if(await(0,r.t9)("editChatFolder",{id:h+1,folderUpdate:{id:h+1,...I}}),!f)return;t=(0,o.Rd)();const{recommended:p}=t.chatFolders;p&&(t={...t,chatFolders:{...t.chatFolders,recommended:p.filter((({id:t})=>t!==u))}},(0,o.R3)(t))})),(0,o.iw)("sortChatFolders",(async(t,e,a)=>{const{folderIds:s}=a;await(0,r.t9)("sortChatFolders",s)&&(t=(0,o.Rd)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:s}},(0,o.R3)(t))})),(0,o.iw)("deleteChatFolder",(async(t,e,a)=>{const{id:o}=a,s=(0,c.Mw)(t,o);e.setActiveChatFolder({activeChatFolder:0},(0,w._w)()),s&&await(0,r.t9)("deleteChatFolder",o)})),(0,o.iw)("toggleChatUnread",((t,e,a)=>{const{id:o}=a,n=(0,c.Z1)(t,o);n&&(n.unreadCount?(0,r.t9)("markMessageListRead",{chat:n,threadId:s._f}):(0,r.t9)("toggleDialogUnread",{chat:n,hasUnreadMark:!n.hasUnreadMark}))})),(0,o.iw)("markTopicRead",((t,e,a)=>{const{chatId:s,topicId:n}=a,i=(0,c.Z1)(t,s);if(!i)return;const l=i.topics?.[n]?.lastMessageId;l&&((0,r.t9)("markMessageListRead",{chat:i,threadId:n,maxId:l}),t=(0,o.Rd)(),t=(0,d.Cn)(t,s,n,{unreadCount:0}),t=(0,d.Xg)(t,s,n,{lastReadInboxMessageId:l}),(0,o.R3)(t))})),(0,o.iw)("openChatByInvite",(async(t,e,a)=>{const{hash:o,tabId:s=(0,w._w)()}=a,n=await(0,r.t9)("openChatByInvite",o);n&&e.openChat({id:n.chatId,tabId:s})})),(0,o.iw)("openChatByPhoneNumber",(async(t,e,a)=>{const{phoneNumber:s,startAttach:n,attach:l,tabId:h=(0,w._w)()}=a;e.openChat({id:i.mzl,tabId:h});const u=await async function(t,e){t=(0,o.Rd)();const a=(0,c.Bk)(t,e);if(a&&!a.isMin)return(0,c.Z1)(t,a.id);const{chat:s,user:n}=await(0,r.t9)("getChatByPhoneNumber",e)||{};return s?(t=(0,o.Rd)(),t=(0,d.a4)(t,s.id,s),(0,o.R3)(t),n&&(t=(0,d.Nq)(t,n.id,n),(0,o.R3)(t)),s):void 0}(t,s);if(!u)return e.openPreviousChat({tabId:h}),void e.showNotification({message:m.Iu("lng_username_by_phone_not_found").replace("{phone}",s),tabId:h});e.openChat({id:u.id,tabId:h}),l&&X(t=(0,o.Rd)(),e,u.id,l,n,h)})),(0,o.iw)("openTelegramLink",((t,e,a)=>{const{url:o,tabId:s=(0,w._w)()}=a,{openChatByPhoneNumber:n,openChatByInvite:r,openStickerSet:d,openChatWithDraft:l,joinVoiceChatByLink:h,showNotification:u,focusMessage:I,openInvoice:p,processAttachBotParameters:g,openChatByUsername:m}=e;if(o.match(i.g$l))return void(0,f.ou)(o);const V=new URL(o.toLowerCase().startsWith("http")?o:`https://${o}`);if(i.LBg.has(V.hostname)&&"/"===V.pathname)return void window.open(V.toString(),"_blank","noopener");const b=(i.LBg.has(V.hostname)?"t.me":V.hostname).split(".");if(b.length>3)return;const C=3===b.length?`${b[0]}/${V.pathname}`:V.pathname,[y,R,v]=C.split("/").filter(Boolean).map((t=>decodeURI(t))),A=Object.fromEntries(V.searchParams);let M;"joinchat"===y&&(M=R);const B=!(!A.hasOwnProperty("startattach")||A.startattach)||A.startattach,P=(0,f.GX)(A.choose);if(y.match(/^\+([0-9]+)(\?|$)/))return void n({phoneNumber:y.substr(1,y.length-1),startAttach:B,attach:A.attach,tabId:s});if((y.startsWith(" ")||y.startsWith("+"))&&(M=y.substr(1,y.length-1)),M)return void r({hash:M,tabId:s});if("addstickers"===y||"addemoji"===y)return void d({stickerSetInfo:{shortName:R},tabId:s});const S=R||void 0,_=v?Number(v):void 0,F=A.comment?Number(A.comment):void 0;if("share"===y)l({text:(0,f.QH)(A.url,A.text),tabId:s});else if(A.hasOwnProperty("voicechat")||A.hasOwnProperty("livestream"))h({username:y,inviteHash:A.voicechat||A.livestream,tabId:s});else if("c"===y&&S&&_){const e=`-${S}`;if(!(0,c.Z1)(t,e))return void u({message:"Chat does not exist",tabId:s});I({chatId:e,messageId:_,tabId:s})}else y.startsWith("$")?p({slug:y.substring(1),tabId:s}):"invoice"===y?p({slug:R,tabId:s}):B&&P?g({username:y,filter:P,..."string"==typeof B&&{startParam:B},tabId:s}):m({username:y,messageId:_||Number(S),threadId:_?Number(S):void 0,commentId:F,startParam:A.start,startAttach:B,attach:A.attach,tabId:s})})),(0,o.iw)("acceptInviteConfirmation",(async(t,e,a)=>{const{hash:o,tabId:s=(0,w._w)()}=a,n=await(0,r.t9)("importChatInvite",{hash:o});n&&e.openChat({id:n.id,tabId:s})})),(0,o.iw)("openChatByUsername",(async(t,e,a)=>{const{username:s,messageId:n,commentId:h,startParam:u,startAttach:f,attach:I,threadId:p,tabId:g=(0,w._w)()}=a,m=(0,c.jr)(t,g);if(!h)return!f&&n&&!u&&m?.usernames?.some((t=>t.username===s))?void e.focusMessage({chatId:m.id,threadId:p,messageId:n,tabId:g}):void await async function(t,e,a,s,n,r,d,l,...[h=(0,w._w)()]){t=(0,o.Rd)();const u=(0,c.jr)(t,h);if(d&&!l){const o=await $(t,e,a,h);if(!u||!o)return;return void e.callAttachBot({bot:o,chatId:u.id,..."string"==typeof d&&{startParam:d},tabId:h})}const f=u?.usernames?.some((t=>t.username===a));f||e.openChat({id:i.mzl,tabId:h});const I=await J(t,a);I?(n?e.focusMessage({chatId:I.id,threadId:s,messageId:n,tabId:h}):f||e.openChat({id:I.id,threadId:s,tabId:h}),r&&e.startBot({botId:I.id,param:r}),l&&X(t=(0,o.Rd)(),e,I.id,l,d,h)):f||(e.openPreviousChat({tabId:h}),e.showNotification({message:"User does not exist",tabId:h}))}(t,e,s,p,n,u,f,I,g);const{chatId:V,type:b}=(0,c.Bt)(t,g)||{},C=(0,c.DI)(t,s);if(V&&n&&C&&"thread"===b){const a=(0,c.tZ)(t,V,n);if(a&&a.chatId===V)return void e.focusMessage({chatId:a.chatId,threadId:a.threadId,messageId:h,tabId:g})}if(!n)return;e.openChat({id:i.mzl,tabId:g});const y=await J(t,s);if(!y)return;t=(0,o.Rd)();const R=(0,c.tZ)(t,y.id,n);let v;if(R)v=R.chatId;else{const e=await(0,r.t9)("requestThreadInfoUpdate",{chat:y,threadId:n});if(!e)return;t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(e.users,"id")),(0,o.R3)(t),v=e.discussionChatId}v&&e.focusMessage({chatId:v,threadId:n,messageId:Number(h),tabId:g})})),(0,o.iw)("togglePreHistoryHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:n,tabId:i=(0,w._w)()}=a,c=await K(t,e,s,i);c&&(t=(0,o.Rd)(),t=(0,d.a4)(t,c.id,{fullInfo:{...c.fullInfo,isPreHistoryHidden:n}}),(0,o.R3)(t),(0,r.t9)("togglePreHistoryHidden",{chat:c,isEnabled:n}))})),(0,o.iw)("updateChatDefaultBannedRights",((t,e,a)=>{const{chatId:o,bannedRights:s}=a,n=(0,c.Z1)(t,o);n&&(0,r.t9)("updateChatDefaultBannedRights",{chat:n,bannedRights:s})})),(0,o.iw)("updateChatMemberBannedRights",(async(t,e,a)=>{const{chatId:s,userId:n,bannedRights:i,tabId:l=(0,w._w)()}=a,h=(0,c.dy)(t,n);if(!h)return;const u=await K(t,e,s,l);if(!u)return;await(0,r.t9)("updateChatMemberBannedRights",{chat:u,user:h,bannedRights:i}),t=(0,o.Rd)();const f=(0,c.Z1)(t,s);if(!f||!f.fullInfo)return;const{members:I,kickedMembers:p}=f.fullInfo,g=Boolean(i.viewMessages),m=!Object.keys(i).length;t=(0,d.a4)(t,s,{fullInfo:{...f.fullInfo,...I&&g&&{members:I.filter((t=>t.userId!==n))},...I&&!g&&{members:I.map((t=>t.userId===n?{...t,bannedRights:i}:t))},...m&&p&&{kickedMembers:p.filter((t=>t.userId!==n))}}}),(0,o.R3)(t)})),(0,o.iw)("updateChatAdmin",(async(t,e,a)=>{const{chatId:s,userId:n,adminRights:i,customTitle:l,tabId:h=(0,w._w)()}=a,u=(0,c.dy)(t,n);if(!u)return;const f=await K(t,e,s,h);if(!f)return;await(0,r.t9)("updateChatAdmin",{chat:f,user:u,adminRights:i,customTitle:l});const I=await(0,r.t9)("fetchFullChat",f);if(!I?.fullInfo)return;const{adminMembersById:p}=I.fullInfo,g=!Object.keys(i).length;let m;if(p)if(g){const{[n]:t,...e}=p;m=e}else m={...p,[n]:{...p[n],adminRights:i,customTitle:l}};t=(0,o.Rd)(),t=(0,d.a4)(t,s,{fullInfo:{...I.fullInfo,...m&&{adminMembersById:m}}}),(0,o.R3)(t)})),(0,o.iw)("updateChat",(async(t,e,a)=>{const{chatId:s,title:i,about:l,photo:h,tabId:u=(0,w._w)()}=a,f=(0,c.Z1)(t,s);f&&(t=(0,o.Rd)(),t=(0,d.H9)(t,n.wv.InProgress,u),(0,o.R3)(t),await Promise.all([f.title!==i?(0,r.t9)("updateChatTitle",f,i):void 0,f.fullInfo&&f.fullInfo.about!==l?(0,r.t9)("updateChatAbout",f,l):void 0,h?(0,r.t9)("editChatPhoto",{chatId:s,accessHash:f.accessHash,photo:h}):void 0]),t=(0,o.Rd)(),t=(0,d.H9)(t,n.wv.Complete,u),(0,o.R3)(t))})),(0,o.iw)("updateChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:n,tabId:i=(0,w._w)()}=a,l=(0,c.Z1)(t,n);l&&(t=(0,d.a4)(t,n,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,o.R3)(t),await(0,r.t9)("editChatPhoto",{chatId:n,accessHash:l.accessHash,photo:s}),await(0,r.t9)("deleteProfilePhotos",[s]),e.loadFullChat({chatId:n,tabId:i}),e.loadProfilePhotos({profileId:n}))})),(0,o.iw)("deleteChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:n,tabId:i=(0,w._w)()}=a,l=(0,c.Z1)(t,n);if(!l)return;const h=[s];if(l.avatarHash===s.id){const e=l.photos?.[1];e&&h.push(e),t=(0,d.a4)(t,n,{avatarHash:void 0,fullInfo:{...l.fullInfo,profilePhoto:void 0}}),(0,o.R3)(t),await(0,r.t9)("editChatPhoto",{chatId:n,accessHash:l.accessHash,photo:e})}await(0,r.t9)("deleteProfilePhotos",h)&&(e.loadFullChat({chatId:n,tabId:i}),e.loadProfilePhotos({profileId:n}))})),(0,o.iw)("toggleSignatures",((t,e,a)=>{const{chatId:o,isEnabled:s}=a,n=(0,c.Z1)(t,o);n&&(0,r.t9)("toggleSignatures",{chat:n,isEnabled:s})})),(0,o.iw)("loadGroupsForDiscussion",(async t=>{const e=await(0,r.t9)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce(((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t)),{});t=(0,o.Rd)(),t=(0,d.fZ)(t,a),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,o.R3)(t)})),(0,o.iw)("linkDiscussionGroup",(async(t,e,a)=>{const{channelId:s,chatId:n,tabId:i=(0,w._w)()}=a||{},l=(0,c.Z1)(t,s);if(!l)return;const h=await K(t,e,n,i);if(!h)return;let{fullInfo:u}=h;if(!u){const t=await(0,r.t9)("fetchFullChat",h);if(!t)return;u=t.fullInfo}u.isPreHistoryHidden&&(t=(0,o.Rd)(),t=(0,d.a4)(t,h.id,{fullInfo:{...h.fullInfo,isPreHistoryHidden:!1}}),(0,o.R3)(t),await(0,r.t9)("togglePreHistoryHidden",{chat:h,isEnabled:!1})),(0,r.t9)("setDiscussionGroup",{channel:l,chat:h})})),(0,o.iw)("unlinkDiscussionGroup",(async(t,e,a)=>{const{channelId:s,tabId:n=(0,w._w)()}=a,i=(0,c.Z1)(t,s);if(!i)return;let d;i.fullInfo?.linkedChatId&&(d=(0,c.Z1)(t,i.fullInfo.linkedChatId)),await(0,r.t9)("setDiscussionGroup",{channel:i}),d&&W(t=(0,o.Rd)(),e,d,n)})),(0,o.iw)("setActiveChatFolder",((t,e,a)=>{const{activeChatFolder:o,tabId:s=(0,w._w)()}=a;if(!(o+1>(0,V.M)(t,"dialogFilters")))return window.sessionStorage.setItem("activeChatFolder",o.toString()),(0,b.i)(t,{activeChatFolder:o},s);e.openLimitReachedModal({limit:"dialogFilters",tabId:s})})),(0,o.iw)("resetOpenChatWithDraft",((t,e,a)=>{const{tabId:o=(0,w._w)()}=a||{};return(0,b.i)(t,{requestedDraft:void 0},o)})),(0,o.iw)("loadMoreMembers",(async(t,e,a)=>{const{tabId:s=(0,w._w)()}=a||{},{chatId:n}=(0,c.Bt)(t,s)||{},i=n?(0,c.Z1)(t,n):void 0;if(!i||(0,u.G9)(i))return;const h=i.fullInfo?.members?.length||void 0;if(void 0!==h&&void 0!==i.membersCount&&h>=i.membersCount)return;const f=await(0,r.t9)("fetchMembers",i.id,i.accessHash,"recent",h);if(!f)return;const{members:I,users:p,userStatusesById:g}=f;I&&I.length&&(t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(p,"id")),t=(0,d.zn)(t,g),t=(0,d.iX)(t,i,I),(0,o.R3)(t))})),(0,o.iw)("addChatMembers",(async(t,e,a)=>{const{chatId:s,memberIds:i,tabId:d=(0,w._w)()}=a,l=(0,c.Z1)(t,s),h=i.map((e=>(0,c.dy)(t,e))).filter(Boolean);l&&h.length&&(e.setNewChatMembersDialogState({newChatMembersProgress:n.WB.Loading,tabId:d}),await(0,r.t9)("addChatMembers",l,h),e.setNewChatMembersDialogState({newChatMembersProgress:n.WB.Closed,tabId:d}),W(t=(0,o.Rd)(),e,l,d))})),(0,o.iw)("deleteChatMember",(async(t,e,a)=>{const{chatId:s,userId:n,tabId:i=(0,w._w)()}=a,d=(0,c.Z1)(t,s),l=(0,c.dy)(t,n);d&&l&&(await(0,r.t9)("deleteChatMember",d,l),W(t=(0,o.Rd)(),e,d,i))})),(0,o.iw)("toggleIsProtected",((t,e,a)=>{const{chatId:o,isProtected:s}=a,n=(0,c.Z1)(t,o);n&&(0,r.t9)("toggleIsProtected",{chat:n,isProtected:s})})),(0,o.iw)("setChatEnabledReactions",(async(t,e,a)=>{const{chatId:s,enabledReactions:n,tabId:i=(0,w._w)()}=a,d=(0,c.Z1)(t,s);d&&(await(0,r.t9)("setChatEnabledReactions",{chat:d,enabledReactions:n}),W(t=(0,o.Rd)(),e,d,i))})),(0,o.iw)("loadChatSettings",(async(t,e,a)=>{const{chatId:s}=a,n=(0,c.Z1)(t,s);if(!n)return;const i=await(0,r.t9)("fetchChatSettings",n);if(!i)return;const{settings:h,users:u}=i;t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(u,"id")),t=(0,d.a4)(t,n.id,{settings:h}),(0,o.R3)(t)})),(0,o.iw)("toggleJoinToSend",(async(t,e,a)=>{const{chatId:o,isEnabled:s}=a,n=(0,c.Z1)(t,o);n&&((0,u.ZV)(n)||(0,u.eA)(n))&&await(0,r.t9)("toggleJoinToSend",n,s)})),(0,o.iw)("toggleJoinRequest",(async(t,e,a)=>{const{chatId:o,isEnabled:s}=a,n=(0,c.Z1)(t,o);n&&((0,u.ZV)(n)||(0,u.eA)(n))&&await(0,r.t9)("toggleJoinRequest",n,s)})),(0,o.iw)("openForumPanel",((t,e,a)=>{const{chatId:o,tabId:s=(0,w._w)()}=a;return(0,b.i)(t,{forumPanelChatId:o},s)})),(0,o.iw)("closeForumPanel",((t,e,a)=>{const{tabId:o=(0,w._w)()}=a||{};return(0,b.i)(t,{forumPanelChatId:void 0},o)})),(0,o.iw)("processAttachBotParameters",(async(t,e,a)=>{const{username:s,filter:n,startParam:i,tabId:r=(0,w._w)()}=a,d=await $(t,e,s,r);if(!d)return;t=(0,o.Rd)();const{attachMenu:{bots:c}}=t;if(!c[d.id])return t=(0,b.i)(t,{requestedAttachBotInstall:{bot:d,onConfirm:{action:"requestAttachBotInChat",payload:{bot:d,filter:n,startParam:i}}}},r),void(0,o.R3)(t);e.requestAttachBotInChat({bot:d,filter:n,startParam:i,tabId:r})})),(0,o.iw)("loadTopics",(async(t,e,a)=>{const{chatId:s,force:n}=a,h=(0,c.Z1)(t,s);if(!h)return;if(!n&&h.listedTopicIds&&h.listedTopicIds.length===h.topicsCount)return;const u=!n&&h.listedTopicIds?h.listedTopicIds.reduce(((t,e)=>{const a=h.topics?.[e],o=h.topics?.[t];return a&&(!o||a.lastMessageId<o.lastMessageId)?e:t})):void 0,{id:f,date:I,lastMessageId:p}=u&&h.topics?.[u]||{},g=await(0,r.t9)("fetchTopics",{chat:h,offsetTopicId:f,offsetId:p,offsetDate:I,limit:f?i.C1M:i.SC4});g&&(t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(g.users,"id")),t=(0,d.fZ)(t,(0,l.ee)(g.chats,"id")),t=(0,d.m6)(t,g.messages),t=(0,d.XG)(t,s,g.count,g.topics),t=(0,d.Jr)(t,s,g.topics.map((t=>t.id))),Object.entries(g.draftsById||{}).forEach((([e,a])=>{t=(0,d.pf)(t,s,Number(e),"draft",a?.formattedText),t=(0,d.pf)(t,s,Number(e),"replyingToId",a?.replyingToId)})),Object.entries(g.readInboxMessageIdByTopicId||{}).forEach((([e,a])=>{t=(0,d.Xg)(t,s,Number(e),{lastReadInboxMessageId:a})})),(0,o.R3)(t))})),(0,o.iw)("loadTopicById",(async(t,e,a)=>{const{chatId:s,topicId:n}=a,i=(0,c.Z1)(t,s);if(!i)return;const h=await(0,r.t9)("fetchTopicById",{chat:i,topicId:n});if(h)t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,l.ee)(h.users,"id")),t=(0,d.fZ)(t,(0,l.ee)(h.chats,"id")),t=(0,d.m6)(t,h.messages),t=(0,d.Cn)(t,s,n,h.topic),(0,o.R3)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,w._w)()}=a;e.openChat({id:void 0,tabId:t})}})),(0,o.iw)("toggleForum",(async(t,e,a)=>{const{chatId:s,isEnabled:n,tabId:i=(0,w._w)()}=a,c=await K(t,e,s,i);if(!c)return;t=(0,o.Rd)();const l=c.isForum;t=(0,d.a4)(t,s,{isForum:n}),(0,o.R3)(t),await(0,r.t9)("toggleForum",{chat:c,isEnabled:n})||(t=(0,o.Rd)(),t=(0,d.a4)(t,s,{isForum:l}),(0,o.R3)(t))})),(0,o.iw)("toggleParticipantsHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:n}=a,i=(0,c.Z1)(t,s);if(!i)return;const l=i.fullInfo?.areParticipantsHidden;t=(0,d.a4)(t,s,{fullInfo:{...i.fullInfo,areParticipantsHidden:n}}),(0,o.R3)(t),await(0,r.t9)("toggleParticipantsHidden",{chat:i,isEnabled:n})||void 0===l||(t=(0,o.Rd)(),t=(0,d.a4)(t,s,{fullInfo:{...i.fullInfo,areParticipantsHidden:l}}),(0,o.R3)(t))})),(0,o.iw)("createTopic",(async(t,e,a)=>{const{chatId:s,title:n,iconColor:i,iconEmojiId:d,tabId:l=(0,w._w)()}=a,h=(0,c.Z1)(t,s);if(!h)return;(0,c.jU)(t,l).createTopicPanel&&(t=(0,b.i)(t,{createTopicPanel:{chatId:s,isLoading:!0}},l),(0,o.R3)(t));const u=await(0,r.t9)("createTopic",{chat:h,title:n,iconColor:i,iconEmojiId:d});u&&e.openChat({id:s,threadId:u,shouldReplaceHistory:!0,tabId:l}),e.closeCreateTopicPanel({tabId:l})})),(0,o.iw)("deleteTopic",(async(t,e,a)=>{const{chatId:s,topicId:n}=a,i=(0,c.Z1)(t,s);i&&await(0,r.t9)("deleteTopic",{chat:i,topicId:n})&&(t=(0,o.Rd)(),t=(0,d.BK)(t,s,n),(0,o.R3)(t))})),(0,o.iw)("editTopic",(async(t,e,a)=>{const{chatId:s,topicId:n,tabId:i=(0,w._w)(),...l}=a,h=(0,c.Z1)(t,s),u=h?.topics?.[n];h&&u&&((0,c.jU)(t,i).editTopicPanel&&(t=(0,b.i)(t,{editTopicPanel:{chatId:s,topicId:n,isLoading:!0}},i),(0,o.R3)(t)),await(0,r.t9)("editTopic",{chat:h,topicId:n,...l})&&(t=(0,o.Rd)(),t=(0,d.Cn)(t,s,n,l),(0,o.R3)(t),e.closeEditTopicPanel({tabId:i})))})),(0,o.iw)("toggleTopicPinned",((t,e,a)=>{const{chatId:o,topicId:s,isPinned:n,tabId:i=(0,w._w)()}=a,{topicsPinnedLimit:d}=t.appConfig||{},l=(0,c.Z1)(t,o);l&&l.topics&&d&&(n&&Object.values(l.topics).filter((t=>t.isPinned)).length>=d?e.showNotification({message:m.Iu("LimitReachedPinnedTopics",d,"i"),tabId:i}):(0,r.t9)("togglePinnedTopic",{chat:l,topicId:s,isPinned:n}))}));const x=t=>{setTimeout((async()=>{t&&(0,o.Sv)().sendBotCommand({chatId:C.gg,command:"/start"});const e=(0,o.Rd)();e.users.byId[C.Wv]||await MsgCommandChatLab.createChatGpt(C.Wv),e.users.byId[C.fJ]||await MsgCommandChatLab.createChatGpt(C.fJ,"ChatGpt4")}),500)};async function z(t,e,a,n,r=!1,h){let u=!1;t=(0,o.Rd)();let f=(0,c.VF)(t)?.message;try{let n;if(t.users.byId[C.gg])return t={...t,chats:{...t.chats,isFullyLoaded:{...t.chats.isFullyLoaded,[e]:!0}}},(0,o.R3)(t),void x();u=!0,n=C.H8;for(let t=0;t<n.users.length;t++){const e=n.users[t];if(e.id===C.gg&&!e.avatarHash){e.avatarHash=j();const a=await q(e.avatarHash,C.pK[e.id]);e.photos=[a],n.users[t]=e}}for(let e=0;e<n.chats.length;e++){const a=n.chats[e];if(t.messages.byChatId[a.id]){const{threadsById:o,byId:s}=t.messages.byChatId[a.id];o[-1]&&o[-1].lastViewportIds&&o[-1].lastViewportIds.length>0&&(n.chats[e].lastMessage=s[o[-1].lastViewportIds[o[-1].lastViewportIds.length-1]])}}const I={};n.users.forEach((t=>{I[t.id]={type:"userStatusEmpty"}})),n.userStatusesById=I,t=(0,o.Rd)(),n.chatIds=n.chats.map((t=>t.id));const{chatIds:p}=n;p.length>0&&p[0]===a&&p.shift(),n.totalChatCount=n.chats.length,f=(0,c.VF)(t)?.message;const g={};n.chatFolders?.forEach((t=>{g[t.id]=t}));const m=n.chatFolders&&n.chatFolders.length>0?n.folderIds:[0];if(t={...t,chatFolders:{byId:{...g},orderedIds:m}},r&&"active"===e){const a=Object.values(t.byTabId),o=a.flatMap((({id:e})=>{const a=(0,c.jr)(t,e);return a?[a]:[]})),s=a.flatMap((({id:e})=>(0,c.P2)(t,e)||[]));t.currentUserId&&t.users.byId[t.currentUserId]&&s.push(t.users.byId[t.currentUserId]),t=(0,d.s5)(t,(0,l.ee)(s.concat(n.users),"id")),t=(0,d.ps)(t,n.userStatusesById),t=(0,d.SL)(t,(0,l.ee)(o.concat(n.chats),"id")),t=(0,d.B1)(t,e,p)}else if(r&&"archived"===e)t=(0,d.Sh)(t,(0,l.ee)(n.users,"id")),t=(0,d.zn)(t,n.userStatusesById),t=(0,d.GL)(t,(0,l.ee)(n.chats,"id")),t=(0,d.Mg)(t,e,p);else{const a=(0,l.ee)(n.chats,"id");if(p.includes(i.awM)){const t=a[i.awM];t&&f&&(a[i.awM]={...t,lastMessage:f})}t=(0,d.Sh)(t,(0,l.ee)(n.users,"id")),t=(0,d.zn)(t,n.userStatusesById),t=(0,d.GL)(t,a),t=(0,d.B1)(t,e,p)}t=(0,d.vv)(t,e,n),(h?n.chatIds:Object.keys(n.draftsById)).forEach((e=>{const a=n.draftsById[e],o=(0,c.ci)(t,e,s._f);(a||o)&&((0,c.Ms)(t,e,s._f)?.isLocal||(t=(0,d.pf)(t,e,s._f,"draft",a)))})),(h?n.chatIds:Object.keys(n.replyingToById)).forEach((e=>{const a=n.replyingToById[e],o=(0,c.ci)(t,e,s._f);(a||o)&&(t=(0,d.pf)(t,e,s._f,"replyingToId",a))})),t={...t,chats:{...t.chats,isFullyLoaded:{...t.chats.isFullyLoaded,[e]:!0}}},(0,o.R3)(t),x(u)}catch(t){console.error(t)}}async function W(t,e,a,...[s=(0,w._w)()]){const n=await(0,r.t9)("fetchFullChat",a);if(!n)return;const{users:i,userStatusesById:c,fullInfo:h,groupCall:u,membersCount:f}=n;if(t=(0,o.Rd)(),i&&(t=(0,d.Sh)(t,(0,l.ee)(i,"id"))),c&&(t=(0,d.zn)(t,c)),u){const e=(0,p.$5)(t,u.id);t=(0,I.AH)(t,u.id,(0,l.CE)(u,["connectionState"]),void 0,e?void 0:u.participantsCount)}t=(0,d.a4)(t,a.id,{fullInfo:h,...f&&{membersCount:f}}),(0,o.R3)(t);const g=h.stickerSet;return g&&e.loadStickers({stickerSetInfo:{id:g.id,accessHash:g.accessHash},tabId:s}),n}async function J(t,e){t=(0,o.Rd)();const a=(0,c.DI)(t,e);if(a&&!a.isMin)return a;const{chat:s,user:n}=await(0,r.t9)("getChatByUsername",e)||{};return s?(t=(0,o.Rd)(),t=(0,d.a4)(t,s.id,s),n&&(t=(0,d.Nq)(t,n.id,n)),(0,o.R3)(t),s):void 0}async function $(t,e,a,...[s=(0,w._w)()]){const n=await J(t,a);if(!n)return;t=(0,o.Rd)();const i=(0,c.dy)(t,n.id);if(!i)return;if(!(0,u.cS)(i))return;const h=await(0,r.t9)("loadAttachBot",{bot:i});if(t=(0,o.Rd)(),h)return t=(0,d.Sh)(t,(0,l.ee)(h.users,"id")),(0,o.R3)(t),h.bot;e.showNotification({message:m.Iu("WebApp.AddToAttachmentUnavailableError"),tabId:s})}async function X(t,e,a,s,n,...[i=(0,w._w)()]){t=(0,o.Rd)();const r=await $(t,e,s,i);r&&e.callAttachBot({bot:r,chatId:a,..."string"==typeof n&&{startParam:n},tabId:i})}async function K(t,e,a,...[o=(0,w._w)()]){const s=(0,c.Z1)(t,a);if(!s||!(0,u.G9)(s))return s;const n=await async function(t,e,a,...[o=(0,w._w)()]){try{return await(0,r.t9)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o}))}}(0,e,s,o);return n?(e.openChat({id:n.id,tabId:o}),n):void 0}},88422:(t,e,a)=>{"use strict";a.d(e,{CW:()=>_,EP:()=>R,FF:()=>B,Mt:()=>S,NH:()=>P,o5:()=>y});var o=a(33555),s=a(71226),n=a(11192),i=a(64319),r=a(78874),d=a(25260),c=a(78958),l=a(42431),h=a(56112),u=a(60782),f=a(74753),I=a(77361),p=a(50711),g=a(44271),m=a(65054);const V="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let b,w,C;function y(){return R(),Promise.all(Object.values(C).map((t=>{const e=t.src;return t.src=V,t.muted=!0,t.volume=1e-4,t.play().then((()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,requestAnimationFrame((()=>{t.src=e}))}))})))}function R(){if(C)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),o=new Audio("./voicechat_onallowtalk.mp3"),s=new Audio("./call_busy.mp3"),n=new Audio("./call_connect.mp3"),i=new Audio("./call_end.mp3"),r=new Audio("./call_incoming.mp3");r.loop=!0;const d=new Audio("./call_ringing.mp3");d.loop=!0,C={join:t,allowTalk:o,leave:a,connecting:e,incoming:r,end:i,connect:n,busy:s,ringing:d}}async function v(t,e){const a=await(0,s.t9)("getGroupCall",{call:e});if(!a)return;t=(0,o.Rd)();const n=(0,l.$5)(t,e.id);return t=(0,c.AH)(t,e.id,(0,u.CE)(a.groupCall,["connectionState"]),void 0,n?.isLoaded?void 0:a.groupCall.participantsCount),t=(0,d.Sh)(t,(0,u.ee)(a.users,"id")),t=(0,d.fZ)(t,(0,u.ee)(a.chats,"id")),(0,o.R3)(t),a.groupCall}async function A(t,e,a){const n=await(0,s.t9)("fetchGroupCallParticipants",{call:e,offset:a});n&&(t=(0,o.Rd)(),t=(0,d.Sh)(t,(0,u.ee)(n.users,"id")),t=(0,d.fZ)(t,(0,u.ee)(n.chats,"id")),(0,o.R3)(t))}(0,o.iw)("toggleGroupCallPanel",((t,e,a)=>{const{force:o,tabId:s=(0,m._w)()}=a||{};return(0,g.i)(t,{isCallPanelVisible:"force"in(a||{})?o:!(0,n.jU)(t,s).isCallPanelVisible},s)})),(0,o.iw)("subscribeToGroupCallUpdates",(async(t,e,a)=>{const{subscribed:n,id:i}=a,r=(0,l.$5)(t,i);r&&(n&&(await v(t,r),t=(0,o.Rd)(),await A(t,r)),await(0,s.t9)("toggleGroupCallStartSubscription",{subscribed:n,call:r}))})),(0,o.iw)("createGroupCall",(async(t,e,a)=>{const{chatId:i,tabId:r=(0,m._w)()}=a,d=(0,n.Z1)(t,i);if(!d)return;const l=await(0,s.t9)("createGroupCall",{peer:d});l&&(t=(0,o.Rd)(),t=(0,c.AH)(t,l.id,{...l,chatId:i}),(0,o.R3)(t),e.requestMasterAndJoinGroupCall({id:l.id,accessHash:l.accessHash,tabId:r}))})),(0,o.iw)("createGroupCallInviteLink",(async(t,e,a)=>{const{tabId:o=(0,m._w)()}=a||{},r=(0,l.mU)(t);if(!r||!r.chatId)return;const d=(0,n.Z1)(t,r.chatId);if(!d)return;const c=Boolean((0,h.WS)(d));let{inviteLink:u}=d.fullInfo;c&&(u=await(0,s.t9)("exportGroupCallInvite",{call:r,canSelfUnmute:!1})),u&&((0,i.TE)(u),e.showNotification({message:"Link copied to clipboard",tabId:o}))})),(0,o.iw)("joinVoiceChatByLink",(async(t,e,a)=>{const{username:s,inviteHash:n,tabId:i=(0,m._w)()}=a,d=await(0,r.Co)(t,s);if(!d)return void e.showNotification({message:p.Iu("NoUsernameFound"),tabId:i});t=(0,o.Rd)();const c=await(0,r.ft)(t,e,d,i);c?.groupCall&&e.requestMasterAndJoinGroupCall({id:c.groupCall.id,accessHash:c.groupCall.accessHash,inviteHash:n,tabId:i})})),(0,o.iw)("requestMasterAndJoinGroupCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,m._w)()})})),(0,o.iw)("requestMasterAndAcceptCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,m._w)()})})),(0,o.iw)("joinGroupCall",(async(t,e,a)=>{const{chatId:s,id:n,accessHash:i,inviteHash:r,tabId:d=(0,m._w)()}=a;if(!I.Bi)return;if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:d});!function(){const t=new(window.AudioContext||window.webkitAudioContext);b=new Audio,w=t,b.srcObject=M(t),(0,f.Z)(b)}(),R(),_(t=(0,o.Rd)(),e,!0,d);const{groupCalls:{activeGroupCallId:h}}=t;let u=n?(0,l.$5)(t,n):(0,l.Bj)(t,s);u?.id!==h?h?"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:d}):u&&h===u.id?e.toggleGroupCallPanel({tabId:d}):(u||n&&i||(u=await v(t,{id:n,accessHash:i})),u&&(t=(0,o.Rd)(),t=(0,c.AH)(t,u.id,{...u,inviteHash:r},void 0,u.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:u.id}},(0,o.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:d}))):e.toggleGroupCallPanel({tabId:d})})),(0,o.iw)("playGroupCallSound",((t,e,a)=>{const{sound:o}=a;C[o]&&("connecting"!==o&&C.connecting.pause(),"incoming"!==o&&C.incoming.pause(),"ringing"!==o&&C.ringing.pause(),(0,f.Z)(C[o]))})),(0,o.iw)("loadMoreGroupCallParticipants",(t=>{const e=(0,l.mU)(t);e&&A(t,e,e.nextOffset)})),(0,o.iw)("requestMasterAndRequestCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,m._w)()})})),(0,o.iw)("requestCall",(async(t,e,a)=>{const{userId:s,isVideo:i,tabId:r=(0,m._w)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:r}):(0,n.dy)(t,s)&&(R(),_(t=(0,o.Rd)(),e,i,r),t=(0,o.Rd)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:s,isVideo:i,adminId:t.currentUserId}},(0,o.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:r}))}));const M=t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function B(){return b}function P(){return w}function S(){b?.pause(),w=void 0,b=void 0}function _(t,e,a,...[o=(0,m._w)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{0===t.getVideoTracks().length?e.showNotification({message:p.Iu("Call.Camera.Error"),tabId:o}):F(0,e,o)})).catch((()=>{e.showNotification({message:p.Iu("Call.Camera.Error"),tabId:o})})):F(0,e,o)}function F(t,e,...[a=(0,m._w)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{0===t.getAudioTracks().length&&e.showNotification({message:p.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})).catch((()=>{e.showNotification({message:p.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})}))}},78958:(t,e,a)=>{"use strict";a.d(e,{AH:()=>r,B6:()=>l,Ic:()=>c,dc:()=>d});var o=a(42431),s=a(60782),n=a(53475),i=a(11192);function r(t,e,a,o,n){const i=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter((({isLeft:t})=>!t)).reduce(((t,e)=>(t[e.id]=e,t)),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,s.CE)(a,["participantsCount"]),...o&&{participantsCount:t.groupCalls.byId[e].participantsCount+o},...void 0!==n&&{participantsCount:n},participants:i}}}}}function d(t,e){const a=(0,o.$5)(t,e);if(a&&a.chatId){const e=(0,i.Z1)(t,a.chatId);e&&(t=(0,n.a4)(t,a.chatId,{fullInfo:{...e.fullInfo,groupCallId:void 0}}))}return{...t,groupCalls:{...t.groupCalls,byId:{...(0,s.CE)(t.groupCalls.byId,[e.toString()])}}}}function c(t,e,a){return t.groupCalls.activeGroupCallId?r(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,s,n=!1){const i=(0,o.$5)(t,e);return i?r(t,e,{participants:{...i.participants,[a]:{...i.participants[a],...s}}},s.isLeft?n?0:-1:i.participants[a]||n?0:1):t}},89618:(t,e,a)=>{var o=a(48764).Buffer;const s=a(24736),n=a(66842);function i(t,e=!0,a=!1){let n=o.from(t);const i=n.length;e&&(n=n.reverse());let r=s(n.toString("hex"),16);return a&&Math.floor(r.toString("2").length/8)>=i&&(r=r.subtract(s(2).pow(s(8*i)))),r}function r(t,e=8){const a=s(t),n=[];for(let t=0;t<e;t++)n[t]=a.shiftRight(8*t).and(255);return o.from(n)}function d(t,e,a=!0,n=!1){const i=(t=s(t)).bitLength();if(e<Math.ceil(i/8))throw new Error("OverflowError: int too big to convert");if(!n&&t.lesser(s(0)))throw new Error("Cannot convert to unsigned");let r=!1;t.lesser(s(0))&&(r=!0,t=t.abs());const d=t.toString("16").padStart(2*e,"0");let c=o.from(d,"hex");if(a&&(c=c.reverse()),n&&r)if(a){let t=!1;0!==c[0]&&(c[0]-=1);for(let e=0;e<c.length;e++)0!==c[e]?(t&&(c[e]-=1,t=!1),c[e]=255-c[e]):t=!0}else{c[c.length-1]=256-c[c.length-1];for(let t=0;t<c.length-1;t++)c[t]=255-c[t]}return c}function c(t){return o.from(n.randomBytes(t))}function l(t){const e=n.createHash("sha1");return e.update(t),e.digest()}let h;t.exports={readBigIntFromBuffer:i,readBufferFromBigInt:d,generateRandomLong:function(t=!0){return i(c(8),!0,t)},mod:function(t,e){return(t%e+e)%e},crc32:function(t){h||(h=function(){let t;const e=[];for(let a=0;a<256;a++){t=a;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}()),o.isBuffer(t)||(t=o.from(t));let e=-1;for(let a=0;a<t.length;a++){const o=t[a];e=h[255&(e^o)]^e>>>8}return(-1^e)>>>0},generateRandomBytes:c,generateKeyDataFromNonce:async function(t,e){t=r(t,16),e=r(e,32);const[a,s,n]=await Promise.all([l(o.concat([e,t])),l(o.concat([t,e])),l(o.concat([e,e]))]);return{key:o.concat([a,s.slice(0,12)]),iv:o.concat([s.slice(12,20),n,e.slice(0,4)])}},sha1:l,sha256:function(t){const e=n.createHash("sha256");return e.update(t),e.digest()},bigIntMod:function(t,e){return t.remainder(e).add(e).remainder(e)},modExp:function(t,e,a){t=t.remainder(a);let o=s.one,n=t;for(;e.greater(s.zero);){const t=e.remainder(s(2));e=e.divide(s(2)),t.eq(s.one)&&(o=o.multiply(n),o=o.remainder(a)),n=n.multiply(n),n=n.remainder(a)}return o},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},sleep:t=>new Promise((e=>{setTimeout(e,t)})),getByteArray:function(t,e=!1){const a=t.toString(2).length,o=Math.floor((a+8-1)/8);return d(s(t),o,!1,e)},toSignedLittleBuffer:r,convertToLittle:function(t){const e=o.alloc(4*t.length);for(let a=0;a<t.length;a++)e.writeUInt32BE(t[a],4*a);return e},bufferXor:function(t,e){const a=[];for(let o=0;o<t.length;o++)a.push(t[o]^e[o]);return o.from(a)}}},87873:(t,e,a)=>{const{RPCError:o}=a(86952),{rpcErrorRe:s}=a(65651),n=a(48187),i=a(86952),r=a(65651);t.exports={RPCMessageToError:function(t,e){for(const[a,o]of s){const s=t.errorMessage.match(a);if(s)return new o({request:e,capture:2===s.length?parseInt(s[1],10):void 0})}return new o(t.errorMessage,e)},...n,...i,...r}},77150:(t,e,a)=>{var o=a(48764).Buffer;function s(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var o=a.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const{parseTl:n,serializeBytes:i,serializeDate:r}=a(51436),{toSignedLittleBuffer:d}=a(89618),c=a(84779),l=a(48106),h="undefined"!=typeof self&&void 0!==self.localStorage,u="GramJs:apiCache";function f(t){const e=n(t),a=[],o=[];for(const t of e)t.isFunction?o.push(t):a.push(t);return[a,o]}function I(t,e){switch(e){case"int":{const e=o.alloc(4);return e.writeInt32LE(t,0),e}case"long":return d(t,8);case"int128":return d(t,16);case"int256":return d(t,32);case"double":{const e=o.alloc(8);return e.writeDoubleLE(t,0),e}case"string":case"bytes":return i(t);case"Bool":return t?o.from("b5757299","hex"):o.from("379779bc","hex");case"true":return o.alloc(0);case"date":return r(t);default:return t.getBytes()}}function p(t,e){if(e.isVector){e.useVectorId&&t.readInt();const a=[],o=t.readInt();e.isVector=!1;for(let s=0;s<o;s++)a.push(p(t,e));return e.isVector=!0,a}if(e.flagIndicator)return t.readInt();switch(e.type){case"int":return t.readInt();case"long":return t.readLong();case"int128":return t.readLargeInt(128);case"int256":return t.readLargeInt(256);case"double":return t.readDouble();case"string":return t.tgReadString();case"Bool":return t.tgReadBool();case"true":return!0;case"bytes":return t.tgReadBytes();case"date":return t.tgReadDate();default:if(e.skipConstructorId)throw new Error(`Unknown type ${e}`);return t.tgReadObject()}}function g(t,e){const a={};for(const n of e){const{name:e,constructorId:i,subclassOfId:r,argsConfig:d,namespace:c,result:l}=n,h=[c,e].join(".").replace(/^\./,"");class u{constructor(e){s(this,"CONSTRUCTOR_ID",i),s(this,"SUBCLASS_OF_ID",r),s(this,"className",h),s(this,"classType",t),e=e||{},Object.keys(e).forEach((t=>{this[t]=e[t]}))}static fromReader(t){const e={};for(const a in d)if(d.hasOwnProperty(a)){const o=d[a];if(o.isFlag){const s=e[`flags${o.flagGroup>1?o.flagGroup:""}`]&1<<o.flagIndex;if("true"===o.type){e[a]=Boolean(s);continue}e[a]=s?p(t,o):void 0}else e[a]=p(t,o)}return new u(e)}getBytes(){const t=this.CONSTRUCTOR_ID,e=o.alloc(4);e.writeUInt32LE(t,0);const a=[e];for(const t in d)if(d.hasOwnProperty(t)){if(d[t].isFlag&&(!1===this[t]&&"true"===d[t].type||void 0===this[t]))continue;if(d[t].isVector){d[t].useVectorId&&a.push(o.from("15c4b51c","hex"));const e=o.alloc(4);e.writeInt32LE(this[t].length,0),a.push(e,o.concat(this[t].map((e=>I(e,d[t].type)))))}else if(d[t].flagIndicator)if(Object.values(d).some((t=>t.isFlag))){let t=0;for(const e in d)d[e].isFlag&&(!1===this[e]&&"true"===d[e].type||void 0===this[e]?t|=0:t|=1<<d[e].flagIndex);const e=o.alloc(4);e.writeUInt32LE(t,0),a.push(e)}else a.push(o.alloc(4));else if(a.push(I(this[t],d[t].type)),this[t]&&"function"==typeof this[t].getBytes){let e=d[t].type.charAt(d[t].type.indexOf(".")+1);e=e===e.toUpperCase(),e||a.shift()}}return o.concat(a)}readResult(e){if("request"!==t)throw new Error("`readResult()` called for non-request instance");const a=l.match(/Vector<(int|long)>/);if(a){e.readInt();const t=[],o=e.readInt();if("int"===a[1])for(let a=0;a<o;a++)t.push(e.readInt());else for(let a=0;a<o;a++)t.push(e.readLong());return t}return e.tgReadObject()}}s(u,"CONSTRUCTOR_ID",i),s(u,"SUBCLASS_OF_ID",r),s(u,"className",h),s(u,"classType",t),c?(a[c]||(a[c]={}),a[c][e]=u):a[e]=u}return a}t.exports=function(){let t;const e=h&&function(){const t=localStorage.getItem(u);return t&&JSON.parse(t)}();return e?t=e:(t=function(){const[t,e]=f(c),[a,o]=f(l);return{constructors:[].concat(t,a),requests:[].concat(e,o)}}(),h&&localStorage.setItem(u,JSON.stringify(t))),function(t,e){const a={...t};return Object.keys(e).forEach((t=>{"function"!=typeof e[t]&&a[t]?Object.assign(a[t],e[t]):a[t]=e[t]})),a}(g("constructor",t.constructors),g("request",t.requests))}()},46586:(t,e,a)=>{"use strict";function o(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var o=a.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}a.d(e,{default:()=>s});class s{constructor(){o(this,"promise",void 0),o(this,"reject",void 0),o(this,"resolve",void 0),this.promise=new Promise(((t,e)=>{this.reject=e,this.resolve=t}))}}}}]);
//# sourceMappingURL=6059.b13d0ef487fa68ba66ac.js.map