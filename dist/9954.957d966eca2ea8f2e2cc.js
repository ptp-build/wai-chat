"use strict";(self.webpackChunkwai=self.webpackChunkwai||[]).push([[9954],{78130:(e,t,a)=>{a.r(t),a.d(t,{ActiveCallHeader:()=>De,GroupCall:()=>Ge,PhoneCall:()=>xe,RatePhoneCallModal:()=>Be});var n=a(77361),i=a(88422);function o(e){return e<<0}function s(e){return e>>>0}function r(e,t=3){if(!e)return 0;const{length:a}=e;let n=0;for(let t=0;t<a;t++)n+=e[t]*e[t];const i=Math.sqrt(n/a)/255;return Math.min(1,i*t)}function c(e){return{id:e.id,name:e.name,"rtcp-fbs":e.feedbackTypes,clockrate:e.clockrate,parameters:e.parameters,channels:e.channels}}const l=.1,d="getDisplayMedia"in(navigator?.mediaDevices||{}),u=navigator?.mediaDevices?.getSupportedConstraints().echoCancellation,p=navigator?.mediaDevices?.getSupportedConstraints().noiseSuppression,m=(e,t=!1)=>{if(!e||!e.sdp)throw Error("Failed parsing SDP: session description is null");const a=e.sdp.split("\r\nm=").map(((e,t)=>0===t?e:`m=${e}`)).reduce(((e,t)=>{const a=t.match(/^m=(.+?)\s/)?.[1]||"header";return e[e.hasOwnProperty(a)&&"video"===a?"screencast":a]=t.split("\r\n").filter(Boolean),e}),{}),n=(e,t)=>t?a[t]?.find((t=>t.startsWith(e)))?.substr(e.length):Object.values(a).map((t=>t.find((t=>t.startsWith(e)))?.substr(e.length))).filter(Boolean)[0],i=e=>a[e].filter((e=>e.startsWith("a=extmap"))).map((e=>{const[,t,a]=e.match(/extmap:(\d+)(?:\/.+)?\s(.+)/);return{id:Number(t),uri:a}})),s=e=>{const t=a[e].filter((e=>e.startsWith("a=rtpmap"))).map((e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],[n,i,o]=a.split("/");return{id:Number(t),name:n,clockrate:Number(i),...o&&{channels:Number(o)}}})),n=a[e].filter((e=>e.startsWith("a=rtcp-fb"))).map((e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],[n,i]=a.split(" ");return{id:Number(t),type:n,subtype:i||""}})),i=a[e].filter((e=>e.startsWith("a=fmtp"))).map((e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],n=a.split(";").reduce(((e,t)=>{const[a,n]=t.split("=");return e[a]=n,e}),{});if(!Object.values(n).some((e=>!e)))return{id:Number(t),data:n}})).filter(Boolean);return t.map((e=>{const t=i.filter((t=>t.id===e.id)).map((e=>e.data)).reduce(((e,t)=>Object.assign(e,t)),{}),a=n.filter((t=>t.id===e.id)).map((e=>({type:e.type,subtype:e.subtype})));return{...e,...Object.keys(t).length>0&&{parameters:t},...a.length>0&&{feedbackTypes:a}}}))},r=n("a=ssrc:","audio"),c=r&&Number(r.split(" ")[0]),l=n("a=ssrc-group:","video")?.split(" ")||void 0,d=n("a=ssrc-group:","screencast")?.split(" ")||void 0;if(!l)throw Error("Failed parsing SDP: no video ssrc");const[u,p]=n("a=fingerprint:")?.split(" ")||[],m=n("a=setup:");if(!u||!p)throw Error("Failed parsing SDP: no fingerprint");console.log(a);const V=n("a=ice-ufrag:"),g=n("a=ice-pwd:");if(!V||!g)throw Error("Failed parsing SDP: no ICE ufrag or pwd");return{fingerprints:[{fingerprint:p,hash:u,setup:t?m:"active"}],pwd:g,ufrag:V,...c&&{ssrc:o(c)},...l&&{"ssrc-groups":[{semantics:l[0],sources:l.slice(1,l.length).map(Number).map(o)},t&&d&&{semantics:d[0],sources:d.slice(1,d.length).map(Number).map(o)}].filter(Boolean)},...t&&{audioExtmap:i("audio"),videoExtmap:i("video"),screencastExtmap:i("screencast"),audioPayloadTypes:s("audio"),videoPayloadTypes:s("video"),screencastPayloadTypes:s("screencast")}}},V=(e,t=!1,a=!1,n=!1)=>{const i=[],o=e=>{i.push(e)},{sessionId:r,ssrcs:c,audioExtensions:l,videoExtensions:d,audioPayloadTypes:u,videoPayloadTypes:p,transport:{ufrag:m,pwd:V,fingerprints:g,candidates:v}}=e;o("v=0"),o(`o=- ${r} 2 IN IP4 0.0.0.0`),o("s=-"),o("t=0 0"),o("a=ice-options:trickle"),o("a=msid-semantic:WMS *"),o(`a=group:BUNDLE ${c.map((e=>e.endpoint)).join(" ")}${a?"":" "+(n?"3":"2")}`),n||o("a=ice-lite");const f=e=>{if(e.sdpString)o(`a=${e.sdpString}`);else{let t="";t+="a=candidate:",t+=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`,"rel-addr"in e&&(t+=` raddr ${e["rel-addr"]} rport ${e["rel-port"]}`),t+=` generation ${e.generation}`,o(t)}},C=()=>{o(`a=ice-ufrag:${m}`),o(`a=ice-pwd:${V}`),g.forEach((e=>{o(`a=fingerprint:${e.hash} ${e.fingerprint}`),o(`a=setup:${n?e.setup:"passive"}`)})),v.forEach(f)},h=e=>{const{channels:t,id:a,name:n,clockrate:i,parameters:s}=e;if(o(`a=rtpmap:${a} ${n}/${i}${t?`/${t}`:""}`),s){const e=Object.keys(s).map((e=>`${e}=${s[e]};`)).join(" ");o(`a=fmtp:${a} ${e}`)}e["rtcp-fbs"]?.forEach((e=>{o(`a=rtcp-fb:${a} ${e.type}${e.subtype?` ${e.subtype}`:""}`)}))},b=e=>{const a=e.isVideo?p:u,i=e.isVideo?"video":"audio";if(o(`m=${i} ${e.isMain?1:0} RTP/SAVPF ${a.map((e=>e.id)).join(" ")}`),o("c=IN IP4 0.0.0.0"),o("b=AS:1300"),o(`a=mid:${e.endpoint}`),o("a=rtcp-mux"),a.forEach(h),o("a=rtcp:1 IN IP4 0.0.0.0"),e.isVideo&&o("a=rtcp-rsize"),(e.isVideo?d:l).forEach((({id:e,uri:t})=>{o(`a=extmap:${e} ${t}`)})),e.isRemoved)o("a=inactive");else{if(C(),n)o("a=sendrecv"),o("a=bundle-only");else{if(t)return void o("a=recvonly");e.isMain?o("a=sendrecv"):(o("a=sendonly"),o("a=bundle-only"))}e.sourceGroups.forEach((t=>{o(`a=ssrc-group:${t.semantics} ${t.sources.map(s).join(" ")}`),t.sources.forEach((t=>{const a=s(t);o(`a=ssrc:${a} cname:${e.endpoint}`),o(`a=ssrc:${a} msid:${e.endpoint} ${e.endpoint}`),o(`a=ssrc:${a} mslabel:${e.endpoint}`),o(`a=ssrc:${a} label:${e.endpoint}`)}))}))}};return n?c.filter(b):c.filter((e=>"0"===e.endpoint||"1"===e.endpoint)).map(b),a||(o("m=application 1 UDP/DTLS/SCTP webrtc-datachannel"),o("c=IN IP4 0.0.0.0"),C(),o("a=ice-options:trickle"),o("a=mid:"+(n?"3":a?"1":"2")),o("a=sctp-port:5000"),o("a=max-message-size:262144")),n||c.filter((e=>"0"!==e.endpoint&&"1"!==e.endpoint)).map(b),`${i.join("\n")}\n`},g=e=>{const t=e.createOscillator(),a=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])},v=({width:e=640,height:t=480}={})=>{const a=Object.assign(document.createElement("canvas"),{width:e,height:t}),n=a.getContext("2d");if(!n)throw Error("Cannot create canvas ctx");n.fillRect(0,0,e,t);const i=a.captureStream();return new MediaStream([Object.assign(i.getVideoTracks()[0],{enabled:!1})])};let f,C;function h(e){f&&(f.screenshareDataChannel?.close(),f.screenshareConnection?.close(),e||f.onUpdate?.({"@type":"updateGroupCallLeavePresentation"}))}function b(e){return f?.streams?.[e]}function P(e,t){const a=f?.participantFunctions?.[e];a&&a.setVolume?.(t)}function w(e,t){const a=t||f?.myId,n=a&&b(a)?.[e];return!!n&&n.getTracks()[0]?.enabled}function y(e){f?.onUpdate?.({"@type":"updateGroupCallStreams",userId:e,hasAudioStream:w("audio",e),hasVideoStream:w("video",e),hasPresentationStream:w("presentation",e),amplitude:f.speaking?.[e]})}function Z(e,t="user"){return"presentation"===e?navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}):navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...u&&{echoCancellation:!0},...p&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}})}async function I(){if(!(f?.myId&&f.connection&&f.streams&&f.facingMode))return;const e=b(f.myId)?.video;if(!e)return;const t=e.getTracks()[0];if(!t)return;const a=f.connection.getSenders().find((e=>t.id===e.track?.id));if(a){f.facingMode="environment"===f.facingMode?"user":"environment";try{const e=await Z("video",f.facingMode);await a.replaceTrack(e.getTracks()[0]),f.streams[f.myId].video=e}catch(e){}}}async function E(e,t=undefined){if(!(f&&f.myId&&f.connection&&f.streams))return;const a=b(f.myId)?.[e];if(!a)return;const n=a.getTracks()[0];if(!n)return;const i=[...f.connection.getSenders(),...f.screenshareConnection?.getSenders()||[]].find((e=>n.id===e.track?.id));if(i){t=void 0===t?!n.enabled:t;try{if(t&&!n.enabled){const t=await Z(e);if(await i.replaceTrack(t.getTracks()[0]),f.streams[f.myId][e]=t,"video"===e)f.facingMode="user";else if("audio"===e){const{audioContext:e}=f;if(!e)return;const a=e.createMediaStreamSource(t),n=e.createAnalyser();n.minDecibels=-100,n.maxDecibels=-30,n.smoothingTimeConstant=.05,n.fftSize=1024,a.connect(n),f={...f,participantFunctions:{...f.participantFunctions,[f.myId]:{...f.participantFunctions?.[f.myId],getCurrentAmplitude:()=>{const e=new Uint8Array(n.frequencyBinCount);return n.getByteFrequencyData(e),r(e,1.5)}}}}}}else if(!t&&n.enabled){n.stop();const t="audio"===e?f.silence:f.black;if(!t)return;await i.replaceTrack(t.getTracks()[0]),f.streams[f.myId][e]=t,"video"===e&&(f.facingMode=void 0)}y(f.myId),"presentation"!==e||t||h(!0)}catch(e){}}}function k(e){f?.onUpdate?.({"@type":"updateGroupCallConnectionState",connectionState:e})}function A(){f&&(f.myId&&f.streams?.[f.myId]&&Object.values(f.streams[f.myId]||{}).forEach((e=>{e?.getTracks().forEach((e=>{e.stop()}))})),h(!0),f.dataChannel?.close(),f.connection?.close(),k("disconnected"),f.analyserInterval&&clearInterval(f.analyserInterval),f=void 0)}function S(){f&&f.participantFunctions&&Object.keys(f.participantFunctions).forEach((e=>{const{getCurrentAmplitude:t}=f.participantFunctions[Number(e)];if(t){const a=t(),n=f.speaking[e]||0;f.speaking[e]=a,(a>l&&n<=l||a<=l&&n>l)&&y(e)}}))}async function N(e){if(!f)return;const{participants:t,conference:a,connection:n,myId:i}=f;if(!(t&&a&&n&&a.ssrcs&&a.transport&&i))return;if(e.find((e=>e.isSelf&&e.source!==f?.conference?.ssrcs?.find((e=>e.isMain&&!e.isVideo))?.sourceGroups[0].sources[0])))return void A();const o=[];if(e.forEach((e=>{if(console.log("handleUpdateGroupCallParticipants",e),e.isSelf)return void(e.isMuted&&!e.canSelfUnmute&&(E("audio",!1),E("video",!1),E("presentation",!1)));const{isLeft:t}=e,n=e.isMuted||e.isMutedByMe,i=!e.isVideoJoined||!e.video||t,s=!e.presentation||t;let r=!1,c=!1,l=!1;a.ssrcs.filter((t=>t.userId===e.id)).forEach((t=>{t.isVideo||(t.sourceGroups[0].sources[0]===e.source&&(c=!0),t.isRemoved=n),t.isVideo&&(t.isPresentation||(e.video&&t.endpoint===e.video.endpoint&&(r=!0),t.isRemoved=i),t.isPresentation&&(e.presentation&&t.endpoint===e.presentation.endpoint&&(l=!0),t.isRemoved=s))})),n||c||a.ssrcs.push({userId:e.id,isMain:!1,endpoint:`audio${e.source}`,isVideo:!1,sourceGroups:[{semantics:"FID",sources:[e.source]}]}),i||r||!e.video||(o.push(e.video.endpoint),a.ssrcs.push({userId:e.id,isMain:!1,endpoint:e.video.endpoint,isVideo:!0,sourceGroups:e.video.sourceGroups})),s||l||!e.presentation||a.ssrcs.push({isPresentation:!0,userId:e.id,isMain:!1,endpoint:e.presentation.endpoint,isVideo:!0,sourceGroups:e.presentation.sourceGroups})})),f.updatingParticipantsQueue)return void f.updatingParticipantsQueue.push(a);f.updatingParticipantsQueue=[];const s=V(a);console.log("build sdp!",s),await n.setRemoteDescription({type:"offer",sdp:s});try{const e=await n.createAnswer();if(await n.setLocalDescription(e),y(i),f.updatingParticipantsQueue.length>0)for(const e of f.updatingParticipantsQueue){await n.setRemoteDescription({type:"offer",sdp:V(e)});const t=await n.createAnswer();await n.setLocalDescription(t),y(i)}f.updatingParticipantsQueue=void 0}catch(e){console.error(e)}}function T(e){if(!(f&&f.audioElement&&f.audioContext&&f.mediaStream))return;const t=f.conference?.ssrcs?.find((t=>t.endpoint===e.track.id));if(!t||!t.userId)return;const{userId:a,isPresentation:n}=t,i=f.participants?.find((e=>e.id===a)),o="video"===e.track.kind?n?"presentation":"video":"audio";e.track.onended=()=>{delete f?.streams?.[a][o],y(a)};const s=e.streams[0];if("audio"===e.track.kind){const{mediaStream:e}=f,t=new window.AudioContext,n=t.createMediaStreamSource(s),o=t.createGain();o.gain.value=(i?.volume||1e4)/1e4;const c=t.createGain();o.gain.value=1;const l=t.createAnalyser();l.minDecibels=-100,l.maxDecibels=-30,l.smoothingTimeConstant=.05,l.fftSize=1024,n.connect(l).connect(c).connect(o).connect(t.destination),e.addTrack(n.mediaStream.getAudioTracks()[0]);const d=new Audio;d.srcObject=s,d.muted=!0,d.remove(),f={...f,participantFunctions:{...f.participantFunctions,[a]:{...f.participantFunctions?.[a],setVolume:e=>{o.gain.value=e>1?2*e:e},toggleMute:e=>{c.gain.value=e?0:1},getCurrentAmplitude:()=>{const e=new Uint8Array(l.frequencyBinCount);return l.getByteFrequencyData(e),r(e,1.5)}}}}}f={...f,streams:{...f.streams,[a]:{...f.streams?.[a],[o]:s}}},y(a)}function M(e,t,a=!1){const n=new RTCPeerConnection,i=a?void 0:function(e){const t=e.createDataChannel("data",{id:0});return t.onopen=()=>{},t.onmessage=e=>{JSON.parse(e.data).colibriClass},t.onerror=e=>{console.log("%conerror","background: green; font-size: 5em"),console.error(e)},t}(n);return e.forEach((e=>e.getTracks().forEach((t=>{n.addTrack(t,e)})))),a||(n.oniceconnectionstatechange=()=>{const e=n.iceConnectionState;console.log("ice",e),"connected"===e||"completed"===e?k("connected"):"checking"===e||"new"===e?k("connecting"):"disconnected"===n.iceConnectionState&&k("reconnecting")}),n.ontrack=T,n.onnegotiationneeded=async()=>{if(!f)return;const{myId:i}=f;if(!i)return;const o=await n.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!a});if(console.log("created offer!",o),await n.setLocalDescription(o),!o.sdp)return;const s=m(o);console.log("parsed sdp",s);const r=a?void 0:{userId:"",sourceGroups:[{semantics:"FID",sources:[s.ssrc||0]}],isRemoved:a,isMain:!0,isVideo:!1,isPresentation:a,endpoint:a?"1":"0"},c=s["ssrc-groups"]&&{isPresentation:a,userId:"",sourceGroups:s["ssrc-groups"],isMain:!0,isVideo:!0,endpoint:a?"0":"1"},l=a?f.screenshareConference:f.conference,d=[];a?(c&&d.push(c),r&&d.push(r)):(r&&d.push(r),c&&d.push(c));const u=e.find((e=>"audio"===e.getTracks()[0].kind)),p=e.find((e=>"video"===e.getTracks()[0].kind));f={...f,...a?{screenshareConference:{...l,ssrcs:d}}:{conference:{...l,ssrcs:d}},streams:{...f.streams,[i]:{...f.streams?.[i],...u&&{audio:u},...!a&&p?{video:p}:{presentation:p}}}},y(i),t(s)},{connection:n,dataChannel:i}}function G(){C?.onUpdate({...C.mediaState,"@type":"updatePhoneCallMediaState"})}function D(e,t="user"){return"presentation"===e?navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}):navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...u&&{echoCancellation:!0},...p&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}})}async function U(e,t=undefined){if(!C)return;const a="audio"===e?C.streams.ownAudio:"video"===e?C.streams.ownVideo:C.streams.ownPresentation;if(!a)return;const n=a.getTracks()[0];if(!n)return;const i=C.connection.getSenders().find((e=>n.id===e.track?.id));if(i){t=void 0===t?!n.enabled:t;try{if(t&&!n.enabled){const t=await D(e);t.getTracks()[0].onended=()=>{U(e,!1)},await i.replaceTrack(t.getTracks()[0]),"audio"===e?C.streams.ownAudio=t:"video"===e?(C.streams.ownVideo=t,C.facingMode="user"):C.streams.ownPresentation=t,"video"!==e&&"presentation"!==e||U("video"===e?"presentation":"video",!1)}else if(!t&&n.enabled){n.stop();const t="audio"===e?C.silence:"video"===e?C.blackVideo:C.blackPresentation;if(!t)return;await i.replaceTrack(t.getTracks()[0]),"audio"===e?C.streams.ownAudio=t:"video"===e?C.streams.ownVideo=t:C.streams.ownPresentation=t}G(),_()}catch(e){}}}function R(){C&&(C.streams.ownVideo?.getTracks().forEach((e=>e.stop())),C.streams.ownPresentation?.getTracks().forEach((e=>e.stop())),C.streams.ownAudio?.getTracks().forEach((e=>e.stop())),C.dataChannel.close(),C.connection.close(),C=void 0)}function _(){if(!C)return;const{emitSignalingData:e,streams:t}=C;e({"@type":"MediaState",videoRotation:0,isMuted:!t.ownAudio?.getTracks()[0].enabled,isBatteryLow:!0,videoState:t.ownVideo?.getTracks()[0].enabled?"active":"inactive",screencastState:t.ownPresentation?.getTracks()[0].enabled?"active":"inactive"})}function $(e){if(!C||C.isOutgoing)return e;const{payloadTypes:t}=e,a=t.findIndex((e=>"VP8"===e.name)),n=t[a],i=t.findIndex((e=>Number(e.parameters?.apt)===n.id));return e.payloadTypes=[t[a],t[i]],e}function j(e){if(!C)return;const{emitSignalingData:t}=C;e.ssrc&&e["ssrc-groups"]&&e["ssrc-groups"][0]&&e["ssrc-groups"][1]&&t({"@type":"InitialSetup",fingerprints:e.fingerprints,ufrag:e.ufrag,pwd:e.pwd,audio:{ssrc:s(e.ssrc).toString(),ssrcGroups:[],payloadTypes:e.audioPayloadTypes,rtpExtensions:e.audioExtmap},video:$({ssrc:s(e["ssrc-groups"][0].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][0].semantics,ssrcs:e["ssrc-groups"][0].sources.map(s)}],payloadTypes:e.videoPayloadTypes,rtpExtensions:e.videoExtmap}),screencast:$({ssrc:s(e["ssrc-groups"][1].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][1].semantics,ssrcs:e["ssrc-groups"][1].sources.map(s)}],payloadTypes:e.screencastPayloadTypes,rtpExtensions:e.screencastExtmap})})}async function O(e){if(C&&C.connection)switch(console.log(e),e["@type"]){case"MediaState":C.mediaState=e,G(),_();break;case"Candidates":{const{candidates:t,gotInitialSetup:a}=C;if(!t)return;e.candidates.forEach((e=>{C.candidates.push(e.sdpString)})),a&&await Promise.all(C.candidates.map((e=>C.connection.addIceCandidate({candidate:e,sdpMLineIndex:0}))));break}case"InitialSetup":{const{connection:t,isOutgoing:a}=C;if(!t)return;const n={transport:{candidates:[],ufrag:e.ufrag,pwd:e.pwd,fingerprints:e.fingerprints,"rtcp-mux":!1,xmlns:""},sessionId:Date.now(),ssrcs:[e.audio&&{isVideo:!1,isMain:!1,userId:"123",endpoint:"0",sourceGroups:[{semantics:"FID",sources:[e.audio.ssrc]}]},e.video&&{isVideo:!0,isPresentation:!1,isMain:!1,userId:"123",endpoint:"1",sourceGroups:e.video.ssrcGroups.map((e=>({semantics:e.semantics,sources:e.ssrcs})))},e.screencast&&{isVideo:!0,isPresentation:!0,isMain:!1,userId:"123",endpoint:"2",sourceGroups:e.screencast.ssrcGroups.map((e=>({semantics:e.semantics,sources:e.ssrcs})))}],audioPayloadTypes:e.audio.payloadTypes?.map(c)||[],audioExtensions:e.audio.rtpExtensions,videoPayloadTypes:$(e.video).payloadTypes?.map(c)||[],videoExtensions:e.video.rtpExtensions};if(await t.setRemoteDescription({sdp:V(n,a,void 0,!0),type:a?"answer":"offer"}),C.conference=n,!a){const e=await t.createAnswer();if(!e)return;await t.setLocalDescription(e),j(m(e,!0))}C.gotInitialSetup=!0,await Promise.all(C.candidates.map((e=>t.addIceCandidate({candidate:e,sdpMLineIndex:0}))));break}}}var x=a(60748),F=a(33555),B=a(83716),L=a(71226),q=a(11192),H=a(42431),z=a(78958),J=a(25184),X=a(25260),Y=a(60782),Q=a(44271),K=a(65054);(0,F.iw)("leaveGroupCall",(async(e,t,a)=>{const{isFromLibrary:n,shouldDiscard:o,shouldRemove:s,rejoin:r,tabId:c=(0,K._w)()}=a||{},l=(0,H.mU)(e);l&&(e=(0,z.Ic)(e,{connectionState:"disconnected"},l.participantsCount-1),(0,F.R3)(e),await(0,L.t9)("leaveGroupCall",{call:l}),o&&await(0,L.t9)("discardGroupCall",{call:l}),e=(0,F.Rd)(),s&&(e=(0,z.dc)(e,l.id)),(0,i.Mt)(),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:void 0}},(0,F.R3)(e),t.toggleGroupCallPanel({force:void 0,tabId:c}),n||A(),t.afterHangUp(),r&&t.requestMasterAndJoinGroupCall({...r,tabId:c}))})),(0,F.iw)("toggleGroupCallVideo",(async e=>{const t=(0,H.mU)(e),a=(0,q.dy)(e,e.currentUserId);a&&t&&(await E("video"),await(0,L.t9)("editGroupCallParticipant",{call:t,videoStopped:!w("video"),participant:a}))})),(0,F.iw)("requestToSpeak",((e,t,a)=>{const{value:n}=a||{value:!0},i=(0,H.mU)(e),o=(0,q.dy)(e,e.currentUserId);o&&i&&(0,L.t9)("editGroupCallParticipant",{call:i,raiseHand:n,participant:o})})),(0,F.iw)("setGroupCallParticipantVolume",((e,t,a)=>{const{participantId:n,volume:i}=a,o=(0,H.mU)(e),s=(0,q.dy)(e,n);s&&o&&(P(n,Math.floor(i/B.Ro)/100),(0,L.t9)("editGroupCallParticipant",{call:o,volume:Number(i),participant:s}))})),(0,F.iw)("toggleGroupCallMute",(async(e,t,a)=>{const{participantId:n,value:i}=a||{},o=(0,H.mU)(e),s=(0,q.dy)(e,n||e.currentUserId);if(!s||!o)return;const r=void 0===i?w("audio",s.id):i;n?P(n,r?0:1):await E("audio"),await(0,L.t9)("editGroupCallParticipant",{call:o,muted:r,participant:s})})),(0,F.iw)("toggleGroupCallPresentation",(async(e,t,a)=>{const n=(0,H.mU)(e),i=(0,q.dy)(e,e.currentUserId);if(i&&n){if(void 0!==a?.value?a?.value:!w("presentation")){const e=await async function(){if(f)try{const e=await Z("presentation");if(!e)return;return e.getTracks()[0].onended=()=>{f&&f.myId&&(delete f.streams?.[f.myId].presentation,y(f.myId),h())},await new Promise((t=>{const{connection:a,dataChannel:n}=M([e],t,!0);f={...f,screenshareConnection:a,screenshareDataChannel:n}}))}catch(e){return}}();if(!e)return;await(0,L.t9)("joinGroupCallPresentation",{call:n,params:e})}else await E("presentation",!1),await(0,L.t9)("leaveGroupCallPresentation",{call:n});await(0,L.t9)("editGroupCallParticipant",{call:n,presentationPaused:!w("presentation"),participant:i})}})),(0,F.iw)("connectToActiveGroupCall",(async(e,t,a)=>{const{tabId:n=(0,K._w)()}=a||{},o=(0,H.mU)(e);if(!o)return;if("discarded"===o.connectionState)return void t.showNotification({message:"This voice chat is not active",tabId:n});const s=(0,i.FF)(),r=(0,i.NH)();if(!s||!r)return;const{currentUserId:c}=e;if(!c)return;const l=await function(e,t,a,n){if(f)throw Error("Already in call");k("connecting");const i=new MediaStream;return a.srcObject=i,a.play().catch((e=>console.warn(e))),f={onUpdate:n,participants:[],myId:e,speaking:{},silence:g(t),black:v({width:640,height:480}),analyserInterval:setInterval(S,1e3),audioElement:a,audioContext:t,mediaStream:i},new Promise((e=>{f={...f,...M([f.silence,f.black],e)}}))}(c,r,s,t.apiUpdate),d=await(0,L.t9)("joinGroupCall",{call:o,params:l,inviteHash:o.inviteHash});if(e=(0,F.Rd)(),d&&(t.loadMoreGroupCallParticipants(),o.chatId)){e=(0,F.Rd)();const a=(0,q.Z1)(e,o.chatId);if(!a)return;await(0,J.ft)(e,t,a,n)}})),(0,F.iw)("connectToActivePhoneCall",(async(e,t)=>{const{phoneCall:a}=e;if(!a)return;const n=(0,H.fu)(e);if(!n)return;const i=await(0,L.t9)("getDhConfig");if(!i)return;await(0,L.t9)("createPhoneCallState",[!0]);const o=await(0,L.t9)("requestPhoneCall",[i]),s=await(0,L.t9)("requestCall",{user:n,gAHash:o,isVideo:a.isVideo});s?(e=(0,F.Rd)(),e=(0,X.Sh)(e,(0,Y.ee)(s.users,"id")),(0,F.R3)(e)):"hangUp"in t&&t.hangUp({tabId:(0,K._w)()})})),(0,F.iw)("acceptCall",(async e=>{const{phoneCall:t}=e;if(!t)return;const a=await(0,L.t9)("getDhConfig");if(!a)return;await(0,L.t9)("createPhoneCallState",[!1]);const n=await(0,L.t9)("acceptPhoneCall",[a]),i=await(0,L.t9)("acceptCall",{call:t,gB:n});i&&(e=(0,F.Rd)(),e=(0,X.Sh)(e,(0,Y.ee)(i.users,"id")),(0,F.R3)(e))})),(0,F.iw)("sendSignalingData",((e,t,a)=>{const{phoneCall:n}=e;if(!n)return;const i=JSON.stringify(a);(async()=>{const e=await(0,L.t9)("encodePhoneCallData",[i]);e&&(0,L.t9)("sendSignalingData",{data:e,call:n})})()})),(0,F.iw)("closeCallRatingModal",((e,t,a)=>{const{tabId:n=(0,K._w)()}=a||{};return(0,Q.i)(e,{ratingPhoneCall:void 0},n)})),(0,F.iw)("setCallRating",((e,t,a)=>{const{rating:n,comment:i,tabId:o=(0,K._w)()}=a,{ratingPhoneCall:s}=(0,q.jU)(e,o);if(s)return(0,L.t9)("setCallRating",{call:s,rating:n,comment:i}),(0,Q.i)(e,{ratingPhoneCall:void 0},o)})),(0,F.iw)("hangUp",((e,t,a)=>{const{tabId:n=(0,K._w)()}=a||{},{phoneCall:i}=e;if(i){if("discarded"===i.state)return(0,L.t9)("destroyPhoneCallState"),R(),e={...e,phoneCall:void 0},(0,F.R3)(e),t.toggleGroupCallPanel({force:void 0,tabId:n}),void t.afterHangUp();if((0,L.t9)("destroyPhoneCallState"),R(),(0,L.t9)("discardCall",{call:i}),"requesting"===i.state)return e={...e,phoneCall:void 0},(0,F.R3)(e),t.toggleGroupCallPanel({force:void 0,tabId:n}),void t.afterHangUp();setTimeout((()=>{e=(0,F.Rd)(),e={...e,phoneCall:void 0},(0,F.R3)(e),t.toggleGroupCallPanel({force:void 0,tabId:n}),t.afterHangUp()}),500)}}));var W=a(50711);const ee=new Uint16Array([55357,56841,55357,56845,55357,56859,55357,56877,55357,56881,55357,56865,55357,56846,55357,56884,55357,56885,55357,56840,55357,56876,55357,56839,55357,56847,55357,56430,55357,56439,55357,56450,55357,56438,55357,56424,55357,56425,55357,56436,55357,56437,55357,56891,55357,56893,55357,56896,55357,56442,55357,56904,55357,56905,55357,56906,55357,56448,55357,56445,55357,56489,55357,56613,55357,56485,55357,56484,55357,56386,55357,56384,55357,56387,55357,56389,55357,56388,55357,56397,55357,56398,55357,56396,55357,56394,9996,9995,55357,56400,55357,56390,55357,56391,55357,56393,55357,56392,55357,56911,55357,56399,55357,56490,55357,57014,55356,57283,55357,56451,55357,56427,55357,56426,55357,56428,55357,56429,55357,56453,55356,57257,55357,56401,55357,56402,55357,56415,55357,56414,55357,56416,55357,56405,55357,56407,55357,56406,55357,56409,55357,56412,55357,56403,55356,57216,55357,56452,55357,56475,55357,56473,55357,56476,55357,56474,55357,56461,55357,56462,55357,56374,55357,56378,55357,56369,55357,56365,55357,56377,55357,56368,55357,56376,55357,56367,55357,56360,55357,56379,55357,56375,55357,56366,55357,56343,55357,56372,55357,56337,55357,56344,55357,56380,55357,56359,55357,56357,55357,56340,55357,56333,55357,56354,55357,56347,55357,56349,55357,56348,55357,56350,55357,56332,55357,56345,55357,56346,55357,56351,55357,56364,55357,56331,55357,56336,55357,56330,55357,56363,55356,57152,55356,57145,55356,57147,55356,57153,55356,57150,55356,57156,55356,57141,55356,57140,55356,57139,55356,57118,55356,57114,55356,57113,55356,57102,55356,57099,9889,9748,10052,9924,55356,57088,55356,57096,55356,57098,55356,57235,55356,57222,55356,57219,55357,56443,55356,57221,55356,57220,55356,57217,55356,57224,55357,56622,55356,57253,55357,56567,55357,56511,55357,56507,9742,55357,56545,55357,56570,55357,56571,55357,56585,55357,56596,9203,9200,8986,55357,56594,55357,56593,55357,56590,55357,56481,55357,56614,55357,56588,55357,56587,55357,57023,55357,57021,55357,56615,55357,56616,55357,57002,55357,57004,55357,56483,55357,56619,55357,56618,55357,56458,55357,56457,55357,56496,55357,56501,55357,56499,9993,55357,56555,55357,56550,55357,56517,55357,56513,9986,55357,56524,55357,56526,10002,9999,55357,56528,55357,56538,55357,56620,55357,56621,55356,57256,55356,57260,55356,57252,55356,57255,55356,57269,55356,57273,55356,57275,55356,57274,55356,57272,55357,56446,55356,57262,55356,56527,55356,57266,55356,57263,55356,57288,55356,57280,9917,9918,55356,57278,55356,57265,55356,57289,55356,57267,55356,57281,55356,57287,55356,57286,55356,57290,55356,57284,9749,55356,57212,55356,57210,55356,57207,55356,57204,55356,57173,55356,57172,55356,57183,55356,57175,55356,57201,55356,57178,55356,57180,55356,57185,55356,57203,55356,57182,55356,57193,55356,57190,55356,57218,55356,57200,55356,57194,55356,57195,55356,57197,55356,57199,55356,57166,55356,57167,55356,57162,55356,57163,55356,57170,55356,57159,55356,57161,55356,57171,55356,57169,55356,57164,55356,57168,55356,57165,55356,57158,55356,57157,55356,57149,55356,57313,55356,57317,55356,57318,9962,55356,57328,9978,55356,57325,55357,56827,55357,56829,55356,57248,55356,57249,9970,55356,57250,55357,56994,55357,56996,9875,55357,56960,9992,55357,56961,55357,56962,55357,56971,55357,56974,55357,56972,55357,56985,55357,56983,55357,56981,55357,56987,55357,57e3,55357,56980,55357,56978,55357,56977,55357,57010,55357,56992,55357,56988,55357,56998,9888,55357,56999,9981,55356,57264,55357,56831,55356,57258,55356,57261,55356,56815,55356,56821,55356,56816,55356,56823,55356,56809,55356,56810,55356,56808,55356,56819,55356,56826,55356,56824,55356,56811,55356,56823,55356,56810,55356,56824,55356,56814,55356,56825,55356,56823,55356,56826,55356,56812,55356,56807,49,8419,50,8419,51,8419,52,8419,53,8419,54,8419,55,8419,56,8419,57,8419,48,8419,55357,56607,10071,10067,9829,9830,55357,56495,55357,56599,55357,56625,55357,56628,55357,56629,55357,56630,55357,56631]),te=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,87,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,256,258,259,260,261,262,264,266,268,270,272,274,276,278,280,282,284,286,288,290,292,294,295,297,299,301,303,305,306,307,308,310,312,314,316,318,320,322,324,326,328,330,332,334,336,338,340,342,344,346,348,350,351,353,355,357,359,360,362,364,365,366,368,370,372,374,376,378,380,382,384,386,388,390,392,394,396,398,400,402,404,406,407,408,410,412,414,416,418,420,422,424,426,427,429,431,433,435,437,439,441,443,445,447,449,451,453,455,457,459,461,463,465,467,469,471,473,475,477,479,481,483,485,487,489,491,493,495,497,499,501,503,505,507,508,510,511,513,515,517,519,521,522,524,526,528,529,531,532,534,536,538,540,542,544,546,548,550,552,554,556,558,560,562,564,566,567,569,570,572,574,576,578,582,586,590,594,598,602,606,610,614,618,620,622,624,626,628,630,632,634,636,638,640,641,642,643,644,646,648,650,652,654,656,658];(0,F.iw)("apiUpdate",((e,t,a)=>{const{activeGroupCallId:i}=e.groupCalls;switch(a["@type"]){case"updateGroupCallLeavePresentation":t.toggleGroupCallPresentation({value:!1});break;case"updateGroupCallStreams":if(!a.userId||!i)break;if(!(0,H.GU)(e,i,a.userId))break;return(0,z.B6)(e,i,a.userId,(0,Y.CE)(a,["@type","userId"]));case"updateGroupCallConnectionState":if(!i)break;if("disconnected"===a.connectionState){"leaveGroupCall"in t&&t.leaveGroupCall({isFromLibrary:!0,tabId:(0,K._w)()});break}return(0,z.AH)(e,i,{connectionState:a.connectionState,isSpeakerDisabled:a.isSpeakerDisabled});case"updateGroupCallParticipants":{const{groupCallId:e,participants:t}=a;i===e&&N(t);break}case"updateGroupCallConnection":{if(a.data.stream){t.showNotification({message:"Big live streams are not yet supported",tabId:(0,K._w)()}),"leaveGroupCall"in t&&t.leaveGroupCall({tabId:(0,K._w)()});break}!async function(e,t){if(!f)return;const a=t?f.screenshareConference:f.conference,n=t?f.screenshareConnection:f.connection;if(!a||!n||!a.ssrcs)return;const i=Date.now(),o={...a,transport:e.transport,sessionId:i,audioExtensions:e.audio?.["rtp-hdrexts"],audioPayloadTypes:e.audio?.["payload-types"],videoExtensions:e.video?.["rtp-hdrexts"],videoPayloadTypes:e.video?.["payload-types"]};f={...f,...t?{screenshareConference:o}:{conference:o}},console.warn("update remote description",o,V(o,!0,t));try{await n.setRemoteDescription({type:"answer",sdp:V(o,!0,t)})}catch(e){console.error(e)}}(a.data,a.presentation);const n=(0,H.mU)(e);n?.participants&&Object.keys(n.participants).length>0&&N(Object.values(n.participants));break}case"updatePhoneCallMediaState":return{...e,phoneCall:{...e.phoneCall,...(0,Y.CE)(a,["@type"])}};case"updatePhoneCall":{if(!n.Bi)return;const{phoneCall:i,currentUserId:s}=e,r={...i,...a.call},c=i?.adminId===s;if(e={...e,phoneCall:r},i&&i.id&&r.id!==i.id)return void("discarded"!==r.state&&(0,L.t9)("discardCall",{call:r,isBusy:!0}));const{accessHash:l,state:d,connections:u,gB:p}=r;if(("active"===d||"accepted"===d)&&(o=r.protocol,!o?.libraryVersions.some((e=>"4.0.0"===e||"4.0.1"===e)))){const a=(0,H.fu)(e);return"hangUp"in t&&t.hangUp({tabId:(0,K._w)()}),void t.showNotification({message:W.Iu("VoipPeerIncompatible",a?.firstName),tabId:(0,K._w)()})}if("discarded"===d){if(!i)return;return(0,Q.i)(e,{...r.needRating&&{ratingPhoneCall:r},isCallPanelVisible:void 0},(0,K._w)())}return"accepted"===d&&l&&p?(async()=>{const{gA:t,keyFingerprint:a,emojis:n}=await(0,L.t9)("confirmPhoneCall",[p,ee,te]),i={...(e=(0,F.Rd)()).phoneCall,emojis:n};e={...e,phoneCall:i},(0,F.R3)(e);const o=await(0,L.t9)("confirmCall",{call:r,gA:t,keyFingerprint:a});o&&(e=(0,F.Rd)(),e=(0,X.Sh)(e,(0,Y.ee)(o.users,"id")),(0,F.R3)(e))})():"active"===d&&u&&"active"!==i?.state&&(c||((0,L.t9)("receivedCall",{call:r}),(async()=>{const{emojis:t}=await(0,L.t9)("confirmPhoneCall",[r.gAOrB,ee,te]),a={...(e=(0,F.Rd)()).phoneCall,emojis:t};e={...e,phoneCall:a},(0,F.R3)(e)})()),async function(e,t,a,n,i){const o=new RTCPeerConnection({iceServers:e.map((e=>({urls:[e.isTurn&&`turn:${e.ip}:${e.port}`,e.isStun&&`stun:${e.ip}:${e.port}`].filter(Boolean),username:e.username,credentialType:"password",credential:e.password}))),iceCandidatePoolSize:2}),s=g(new AudioContext),r=v({width:640,height:480}),c=v({width:640,height:480});o.addTrack(s.getTracks()[0],s),o.addTrack(r.getTracks()[0],r),o.addTrack(c.getTracks()[0],c),o.onicecandidate=e=>{e.candidate&&t({"@type":"Candidates",candidates:[{sdpString:e.candidate.candidate}]})},o.onconnectionstatechange=()=>{i({"@type":"updatePhoneCallConnectionState",connectionState:o.connectionState})},o.ontrack=e=>{if(!C)return;const t=e.streams[0];"audio"===e.track.kind?(C.audio.srcObject=t,C.audio.play().catch(),C.streams.audio=t):"1"===e.transceiver.mid?C.streams.video=t:C.streams.presentation=t,G()};const l=o.createDataChannel("data",{id:0,negotiated:!0});l.onmessage=e=>{O(JSON.parse(e.data))};const d=new Audio;C={audio:d,connection:o,emitSignalingData:t,isOutgoing:a,candidates:[],onUpdate:i,streams:{ownVideo:r,ownAudio:s,ownPresentation:c},mediaState:{isBatteryLow:!1,screencastState:"inactive",videoState:"inactive",videoRotation:0,isMuted:!0},blackVideo:r,blackPresentation:c,silence:s,dataChannel:l};try{n&&U("video",!0),U("audio",!0)}catch(e){}if(a){const e=await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});await o.setLocalDescription(e),j(m(e,!0))}}(u,t.sendSignalingData,c,Boolean(r?.isVideo),t.apiUpdate)),e}case"updatePhoneCallConnectionState":{const{connectionState:n}=a;return e.phoneCall?"closed"===n||"disconnected"===n||"failed"===n?void("hangUp"in t&&t.hangUp({tabId:(0,K._w)()})):{...e,phoneCall:{...e.phoneCall,isConnected:"connected"===n}}:e}case"updatePhoneCallSignalingData":{const{phoneCall:t}=e;if(!t)break;(0,L.t9)("decodePhoneCallData",[a.data])?.then(O);break}}var o}));var ae=a(62821),ne=a(46752),ie=a(60706),oe=a(59107),se=a(42797),re=a(34288),ce=a(231),le=a(53106),de=a(58964),ue=a(13103);const pe=()=>{navigator.vibrate?.(50)};var me=a(87204),Ve=a(58912);const ge=(0,x.X$)((0,F.c$)((e=>{const t=(0,H.mU)(e),{connectionState:a}=t||{},n=t&&(0,H.GU)(e,t.id,e.currentUserId),{raiseHandRating:i,hasAudioStream:o,canSelfUnmute:s,isMuted:r}=n||{};return{connectionState:a||"discarded",hasRequestedToSpeak:Boolean(i),noAudioStream:!o,canSelfUnmute:s,isMuted:r}}))((({noAudioStream:e,canSelfUnmute:t,isMuted:a,hasRequestedToSpeak:n,connectionState:i})=>{const{toggleGroupCallMute:o,requestToSpeak:s,playGroupCallSound:r}=(0,F.Sv)(),c=(0,oe.Z)(),l=(0,x.sO)("up"),[d,u]=(0,x.eJ)(!1),p="connected"!==i,m=!t&&a,V=(0,me.Z)(m);(0,x.d4)((()=>{V&&!m&&r({sound:"allowTalk"})}),[r,V,m]);const g=(0,x.Ye)((()=>{if(d){const e=Math.floor(100*Math.random());return e<32?[0,120]:e<64?[120,240]:e<97?[240,420]:[420,540]}return!V&&m?e?[99,135]:[136,172]:V&&!m?[0,36]:m?[0,0]:e?[69,99]:[36,69]}),[V,d,e,m]),v=d?"HandFilled":"VoiceMini",f=()=>{pe(),o()},C=c(n?"VoipMutedTapedForSpeak":m?"VoipMutedByAdmin":e?"VoipUnmute":"VoipTapToMute");return x.ZP.createElement("div",{className:"button-wrapper microphone-wrapper"},x.ZP.createElement("button",{className:(0,ne.Z)("MicrophoneButton",e&&"crossed",t&&"can-self-unmute",p&&"is-connecting",m&&"muted-by-admin"),onMouseDown:()=>{if(m){if(d)return;return pe(),s(),u(!0),void setTimeout((()=>{u(!1)}),3e3)}l.current="down",e&&setTimeout((()=>{"down"===l.current&&(l.current="hold",f())}),200)},onMouseUp:()=>{m||(f(),l.current="up")}},x.ZP.createElement(Ve.Z,{tgsUrl:ae.l[v],size:48,playSegment:g})),x.ZP.createElement("div",{className:"button-text"},C))})));var ve=a(14605),fe=a(80036),Ce=a(3927),he=a(52328),be=a(22275);const Pe=[0,17],we=[17,34],ye=(0,x.X$)((0,F.c$)((e=>({isAdmin:(0,H.Ht)(e)})))((({participant:e,closeDropdown:t,isDropdownOpen:a,anchor:n,isAdmin:i})=>{const{toggleGroupCallMute:o,setGroupCallParticipantVolume:s,toggleGroupCallPanel:r,openChat:c,requestToSpeak:l}=(0,F.Sv)(),d=(0,oe.Z)(),[u,p,m]=(0,ie.Z)(),V=e?.id,{isMutedByMe:g,isMuted:v,isSelf:f,canSelfUnmute:C}=e||{},h=Boolean(e?.raiseHandRating),b=!C&&v,[P,w]=(0,x.eJ)(g?0:(e?.volume||B.aCB)/B.Ro);(0,x.d4)((()=>{w(g?0:(e?.volume||B.aCB)/B.Ro)}),[V]);const y=function(e,t,a=[]){return(0,Ce.Z)((e=>{e()}),a,e,t)}(500),Z=(0,x.I4)((e=>{e.stopPropagation(),p(),t()}),[p,t]),I=(0,x.I4)((e=>{e.stopPropagation(),l({value:!1}),t()}),[l,t]),E=(0,x.I4)((e=>{e.stopPropagation(),t(),i||w(g?B.aCB/B.Ro:0),o({participantId:V,value:i?!b:!g})}),[t,o,V,i,b,g]),k=(0,x.I4)((e=>{e.stopPropagation(),r(),c({id:V}),t()}),[r,t,c,V]),A=0===P?Pe:we;return x.ZP.createElement("div",null,x.ZP.createElement(he.Z,{isOpen:a,positionX:"right",autoClose:!0,style:(0,fe.Z)(n&&`right: 1rem; top: ${n.y}px`),onClose:t,className:"participant-menu"},!f&&!b&&x.ZP.createElement("div",{className:"group"},x.ZP.createElement("div",{className:(0,ne.Z)("volume-control",P<50&&"low",P>=50&&P<100&&"medium",P>=100&&P<150&&"normal",P>=150&&"high")},x.ZP.createElement("input",{type:"range",min:"0",max:"200",value:P,onChange:e=>{const t=Number(e.target.value);w(t),y((()=>{0===t?o({participantId:V,value:!0}):s({participantId:V,volume:Math.floor(t*B.Ro)})}))}}),x.ZP.createElement("div",{className:"info"},x.ZP.createElement(Ve.Z,{tgsUrl:ae.l.Speaker,playSegment:A,size:24}),x.ZP.createElement("span",null,P,"%")))),x.ZP.createElement("div",{className:"group"},h&&f&&x.ZP.createElement(de.Z,{icon:"stop-raising-hand",onClick:I},d("VoipGroupCancelRaiseHand")),!f&&x.ZP.createElement(de.Z,{icon:"user",onClick:k},d("VoipGroupOpenProfile")),!f&&x.ZP.createElement(de.Z,{icon:v&&i?"allow-speak":"microphone-alt",onClick:E},d(i?b?"VoipGroupAllowToSpeak":"VoipMute":g?"VoipGroupUnmuteForMe":"VoipGroupMuteForMe")),!f&&i&&x.ZP.createElement(de.Z,{icon:"delete-user",destructive:!0,onClick:Z},d("VoipGroupUserRemove")))),!f&&i&&x.ZP.createElement(be.Z,{isOpen:u,userId:V,onClose:m}))})));var Ze=a(27407),Ie=a(70172);const Ee=(0,x.X$)((({participant:e,noColor:t})=>{const{isMuted:a,isMutedByMe:n}=e,i=(e.amplitude||0)>l,o=Boolean(e.raiseHandRating),s=(0,me.Z)(o),r=!Boolean(e?.canSelfUnmute)&&a,c=(0,me.Z)(a),d=(0,x.Ye)((()=>a&&!c?[43,64]:!a&&c?[22,42]:o&&!s?[65,84]:!r&&s?[0,21]:a?[22,23]:[43,44]),[a,r,o]),u=(0,x.Ye)((()=>t?[255,255,255]:o?[77,166,224]:r||n?[255,112,111]:i?[87,188,108]:[132,141,148]),[t,o,r,n,i]);return x.ZP.createElement(Ve.Z,{tgsUrl:ae.l.VoiceOutlined,playSegment:d,size:28,color:u})})),ke=(0,x.X$)((0,F.c$)(((e,{participant:t})=>({user:t.isUser?(0,q.dy)(e,t.id):void 0,chat:t.isUser?void 0:(0,q.Z1)(e,t.id)})))((({openParticipantMenu:e,participant:t,user:a,chat:n})=>{const i=(0,x.sO)(null),o=(0,oe.Z)(),{isSelf:s,isMutedByMe:r,isMuted:c}=t,d=(t.amplitude||0)>l,u=Boolean(t.raiseHandRating),[p,m]=(0,x.Ye)((()=>s?[o("ThisIsYou"),"blue"]:r?[o("VoipGroupMutedForMe"),"red"]:u?[o("WantsToSpeak"),"blue"]:!c&&d?[t.volume&&t.volume!==B.aCB?o("SpeakingWithVolume",(t.volume/B.Ro).toString()).replace("%%","%"):o("Speaking"),"green"]:t.about?[t.about,""]:[o("Listening"),"blue"]),[d,t.volume,o,s,r,u,c,t.about]);if(!a&&!n)return;const V=a?`${a.firstName||""} ${a.lastName||""}`:n?.title;return x.ZP.createElement("div",{className:(0,ne.Z)("GroupCallParticipant",t.canSelfUnmute&&"can-self-unmute"),onClick:()=>{s||e(i.current,t)},ref:i},x.ZP.createElement(Ie.Z,{user:a,chat:n,size:"medium"}),x.ZP.createElement("div",{className:"info"},x.ZP.createElement("span",{className:"name"},V),x.ZP.createElement("span",{className:(0,ne.Z)("about",m)},p)),x.ZP.createElement("div",{className:"microphone"},x.ZP.createElement(Ee,{participant:t})))})));var Ae=a(21273);const Se=(0,x.X$)((0,F.c$)((e=>{const{participantsCount:t,participants:a}=(0,H.mU)(e)||{};return{participants:a,participantsCount:t||0}}))((({participants:e,participantsCount:t,openParticipantMenu:a})=>{const{createGroupCallInviteLink:n,loadMoreGroupCallParticipants:i}=(0,F.Sv)(),o=(0,oe.Z)(),s=(0,x.Ye)((()=>Object.keys(e||{})),[e]),r=(0,x.I4)((()=>{i()}),[i]),[c,l]=(0,Ze.Z)(r,s,s.length>=t);return x.ZP.createElement("div",{className:"participants"},x.ZP.createElement("div",{className:"invite-btn",onClick:function(){n()}},x.ZP.createElement("div",{className:"icon"},x.ZP.createElement("i",{className:"icon-add-user"})),x.ZP.createElement("div",{className:"text"},o("VoipGroupInviteMember"))),x.ZP.createElement(Ae.Z,{items:c,onLoadMore:l},c?.map((t=>e[t]&&x.ZP.createElement(ke,{key:t,openParticipantMenu:a,participant:e[t]})))))}))),Ne=(0,x.X$)((0,F.c$)(((e,{participant:t})=>({currentUserId:e.currentUserId,user:t.isUser?(0,q.dy)(e,t.id):void 0,chat:t.isUser?void 0:(0,q.Z1)(e,t.id),isActive:(t.amplitude||0)>l})))((({type:e,onClick:t,user:a,chat:n,isActive:i,isFullscreen:o})=>{const s=(0,oe.Z)(),r=(0,x.I4)((()=>{t&&t(a?.id||n.id,e)}),[n,t,e,a?.id]);if(!a&&!n)return;const c=b(a?.id||n.id);return x.ZP.createElement("div",{className:(0,ne.Z)("GroupCallParticipantVideo",i&&"active"),onClick:r},o&&x.ZP.createElement("button",{className:"back-button"},x.ZP.createElement("i",{className:"icon-arrow-left"}),s("Back")),x.ZP.createElement(Ie.Z,{user:a,chat:n,className:"thumbnail-avatar"}),!B.gdz&&x.ZP.createElement("div",{className:"thumbnail-wrapper"},x.ZP.createElement("video",{className:"thumbnail",muted:!0,autoPlay:!0,playsInline:!0,srcObject:c?.[e]})),x.ZP.createElement("video",{className:"video",muted:!0,autoPlay:!0,playsInline:!0,srcObject:c?.[e]}),x.ZP.createElement("div",{className:"info"},x.ZP.createElement("i",{className:"icon-microphone-alt"}),x.ZP.createElement("span",{className:"name"},a?.firstName||n?.title),"presentation"===e&&x.ZP.createElement("i",{className:"last-icon icon-active-sessions"})))}))),Te=(0,x.X$)((0,F.c$)((e=>{const{participants:t}=(0,H.mU)(e)||{};return{participants:t}}))((({participants:e,onDoubleClick:t})=>{const[a,n]=(0,x.eJ)(void 0),i=(0,x.Ye)((()=>Object.values(e||{}).filter((e=>e.hasPresentationStream))),[e]),o=(0,x.Ye)((()=>Object.values(e||{}).filter((e=>e.hasVideoStream))),[e]),s=o.length+i.length,r=s<=2?1:s<=6?2:s<=9?3:4,c=3===s||2===r&&s%2!=0,l=(0,x.I4)(((e,t)=>{a&&e===a.id&&t===a.type?n(void 0):n({id:e,type:t})}),[a]);return x.ZP.createElement("div",{className:"streams",onDoubleClick:t},x.ZP.createElement("div",{className:(0,ne.Z)("videos",c&&"span-last-video"),style:`--column-count: ${a?1:r}`},a&&x.ZP.createElement(Ne,{key:a.id,isFullscreen:!0,onClick:l,participant:e[a.id],type:a.type}),a?void 0:i.map((e=>x.ZP.createElement(Ne,{key:e.id,onClick:l,participant:e,type:"presentation"}))),a?void 0:o.map((e=>x.ZP.createElement(Ne,{key:e.id,onClick:l,participant:e,type:"video"})))))}))),Me=[0,10],Ge=(0,x.X$)((0,F.c$)(((e,{groupCallId:t})=>{const{connectionState:a,title:n,isSpeakerDisabled:i,participants:o,participantsCount:s}=(0,H.$5)(e,t)||{};return{connectionState:a,title:n,isSpeakerEnabled:!i,participantsCount:s,meParticipant:(0,H.GU)(e,t,e.currentUserId),isCallPanelVisible:Boolean((0,q.jU)(e).isCallPanelVisible),isAdmin:(0,H.Ht)(e),participants:o}}))((({groupCallId:e,isCallPanelVisible:t,connectionState:a,isSpeakerEnabled:i,title:o,meParticipant:s,isAdmin:r,participants:c})=>{const{toggleGroupCallVideo:l,toggleGroupCallPresentation:u,leaveGroupCall:p,toggleGroupCallPanel:m,connectToActiveGroupCall:V,playGroupCallSound:g}=(0,F.Sv)(),v=(0,oe.Z)(),C=(0,x.sO)(null),{isMobile:h,isLandscape:b}=(0,se.ZP)(),[P,w]=(0,x.eJ)(!1),[y,Z,E]=(0,ie.Z)(),[k,A,S]=(0,ie.Z)(!0),N=Object.values(c).some((({video:e,presentation:t})=>e||t)),T=y&&(!h||b)&&N,[M,G]=(0,x.eJ)(),[D,U,R]=(0,ie.Z)(),[_,$,j]=(0,ie.Z)(),[O,B]=(0,x.eJ)(!1),[L,q]=(0,x.eJ)(!1),H=s?.hasVideoStream,z=s?.hasPresentationStream,J="connected"!==a,X=s?.canSelfUnmute,Y=!X&&s?.isMuted,Q=(0,x.I4)(((e,t)=>{const a=e.getBoundingClientRect(),n=C.current;G({anchor:{x:a.left,y:a.top-n.offsetTop+60},participant:t}),U()}),[U]);(0,x.d4)((()=>{"connected"===a?g({sound:"join"}):"reconnecting"===a&&g({sound:"connecting"})}),[a,g]);const K=(0,x.I4)((()=>{j(),B(!1)}),[j]),W=(0,x.Ye)((()=>({onTrigger:e,isOpen:t})=>x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",className:t?"active":void 0,onClick:e,ariaLabel:v("AccDescrMoreOptions")},x.ZP.createElement("i",{className:"icon-more"}))),[v]),ee=(0,x.I4)((()=>{C.current&&(y?document.exitFullscreen().then(E):C.current.requestFullscreen().then(Z))}),[E,y,Z]),te=(0,x.I4)((()=>{k?S():A()}),[S,k,A]),pe=(0,x.I4)((()=>{n.t0&&(y||S(),ee())}),[S,ee,y]),me=(0,x.I4)((()=>{y?E():Z()}),[E,y,Z]),fe=(0,x.I4)((()=>{m(),y&&E()}),[E,y,m]);(0,x.d4)((()=>{if(!n.t0)return;const e=C.current;return e?(e.addEventListener("fullscreenchange",me),()=>{e.removeEventListener("fullscreenchange",me)}):void 0}),[me]),(0,x.d4)((()=>{V()}),[V,e]);const Ce=(0,x.I4)((()=>{B(!0),q(!0),$(),y&&ee()}),[ee,y,$]),he=(0,x.I4)((()=>{if(r&&!_)return $(),void(y&&ee());g({sound:"leave"}),w(!0),j()}),[j,ee,r,_,y,$,g]),be=(0,x.I4)((()=>{P&&p({shouldDiscard:L})}),[P,p,L]),Pe=(0,x.I4)((()=>{u()}),[u]);return x.ZP.createElement(ue.Z,{isOpen:!t&&!P,onClose:m,className:(0,ne.Z)("GroupCall",h&&!b&&"single-column",T&&"landscape",!k&&"no-sidebar"),dialogRef:C,onCloseAnimationEnd:be},x.ZP.createElement("div",{className:"header"},x.ZP.createElement("h3",null,o||v("VoipGroupVoiceChat")),n.t0&&x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",onClick:ee,ariaLabel:v(y?"AccExitFullscreen":"AccSwitchToFullscreen")},x.ZP.createElement("i",{className:y?"icon-smallscreen":"icon-fullscreen"})),T&&x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",onClick:te},x.ZP.createElement("i",{className:"icon-sidebar"})),(d&&!Y||r)&&x.ZP.createElement(le.Z,{positionX:"right",trigger:W},d&&!Y&&x.ZP.createElement(de.Z,{icon:"share-screen-outlined",onClick:Pe},v(z?"VoipChatStopScreenCapture":"VoipChatStartScreenCapture")),r&&x.ZP.createElement(de.Z,{icon:"phone-discard-outline",onClick:Ce,destructive:!0},v("VoipGroupLeaveAlertEndChat"))),x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",onClick:fe},x.ZP.createElement("i",{className:"icon-close"}))),x.ZP.createElement("div",{className:"scrollable custom-scroll"},x.ZP.createElement(Te,{onDoubleClick:pe}),(!T||k)&&x.ZP.createElement(Se,{openParticipantMenu:Q})),x.ZP.createElement(ye,{participant:M?.participant,anchor:M?.anchor,isDropdownOpen:D,closeDropdown:R}),x.ZP.createElement("div",{className:"buttons"},J&&x.ZP.createElement(re.Z,null),x.ZP.createElement("div",{className:"button-wrapper"},x.ZP.createElement("div",{className:"video-buttons"},H&&(n.wZ||n.cj)&&x.ZP.createElement("button",{className:"smaller-button",onClick:I},x.ZP.createElement(Ve.Z,{tgsUrl:ae.l.CameraFlip,playSegment:Me,size:24})),x.ZP.createElement("button",{className:(0,ne.Z)("small-button",Y?"speaker":"camera",(H||Y&&i)&&"active"),onClick:()=>{Y?f&&(f.isSpeakerDisabled=!f.isSpeakerDisabled,f?.onUpdate?.({"@type":"updateGroupCallConnectionState",connectionState:"connected",isSpeakerDisabled:f.isSpeakerDisabled}),f.participantFunctions&&Object.values(f.participantFunctions).forEach((e=>{e.toggleMute?.(!!f?.isSpeakerDisabled)}))):l()}},x.ZP.createElement("i",{className:Y?"icon-speaker":H?"icon-video-stop":"icon-video"}))),x.ZP.createElement("div",{className:"button-text"},v(Y?"VoipSpeaker":"VoipCamera"))),x.ZP.createElement(ge,null),x.ZP.createElement("div",{className:"button-wrapper"},x.ZP.createElement("button",{className:"small-button leave",onClick:he},x.ZP.createElement("i",{className:"icon-phone-discard"})),x.ZP.createElement("div",{className:"button-text"},v("VoipGroupLeave")))),x.ZP.createElement(ue.Z,{isOpen:_,onClose:K,className:"error",title:v(O?"VoipGroupEndAlertTitle":"VoipGroupLeaveAlertTitle")},x.ZP.createElement("p",null,v(O?"VoipGroupEndAlertText":"VoipGroupLeaveAlertText")),!O&&x.ZP.createElement(ve.Z,{label:v("VoipGroupEndChat"),checked:L,onCheck:q}),x.ZP.createElement("div",{className:"dialog-buttons"},x.ZP.createElement(ce.Z,{isText:!0,className:"confirm-dialog-button",onClick:he},v(O?"VoipGroupEnd":"VoipGroupLeave")),x.ZP.createElement(ce.Z,{isText:!0,className:"confirm-dialog-button",onClick:K},v("Cancel")))))}))),De=(0,x.X$)((0,F.c$)((e=>{const t=(0,q.jU)(e);return{groupCall:t.isMasterTab?(0,H.mU)(e):void 0,isCallPanelVisible:t.isCallPanelVisible,phoneCallUser:t.isMasterTab?(0,H.fu)(e):void 0}}))((({groupCall:e,phoneCallUser:t,isCallPanelVisible:a})=>{const{toggleGroupCallPanel:n}=(0,F.Sv)(),i=(0,oe.Z)();if((0,x.d4)((()=>(document.body.classList.toggle("has-call-header",Boolean(a)),()=>{document.body.classList.toggle("has-call-header",!1)})),[a]),e||t)return x.ZP.createElement("div",{className:(0,ne.Z)("ActiveCallHeader",a&&"open"),onClick:function(){n()}},x.ZP.createElement("span",{className:"title"},t?.firstName||e?.title||i("VoipGroupVoiceChat")))})));var Ue=a(32340),Re=a(790),_e=a(62357),$e=a(65326);const je=(0,x.X$)((({onClick:e,label:t,customIcon:a,icon:n,iconClassName:i,className:o,isDisabled:s,isActive:r})=>x.ZP.createElement("div",{className:"eWbOLx__FZXR1sqKEJek"},x.ZP.createElement(ce.Z,{round:!0,className:(0,ne.Z)(o,"XKOJvKiD4DsRfJLLhnw2",r&&"qvAVe7qcyaEvRQQ1StFI"),onClick:e,disabled:s},a||x.ZP.createElement("i",{className:(0,ne.Z)(i,`icon-${n}`)})),x.ZP.createElement("div",{className:"wnAniFJmQ7ocVtjRHNey"},t)))),Oe={root:"AddQYAOZJv2f7U7qIfC3",blurred:"anFtHj7Wvsv4M_2I2EFF","single-column":"Oi7aFYBAbl4bYichdt52",singleColumn:"Oi7aFYBAbl4bYichdt52",header:"_iK8HccGNSmmo2wL7tMs","close-button":"U66J7V5JKTCiktgwYpcC",closeButton:"U66J7V5JKTCiktgwYpcC","emojis-backdrop":"IekzemHkkO4bfrWHmxlv",emojisBackdrop:"IekzemHkkO4bfrWHmxlv",open:"hiNHKiq2owo1FvdT9a5g",emojis:"BjOb1fDymE5GCiJ4g6YN","emoji-tooltip":"Ci9ie86NFinrXvowDx23",emojiTooltip:"Ci9ie86NFinrXvowDx23","user-info":"eiM2IbZjKKAwrfNtXtAy",userInfo:"eiM2IbZjKKAwrfNtXtAy",buttons:"AtK8DjRToL8Uk7ZAY25p",leave:"uI2mkCTKDcqYPu64xKOk",accept:"PC2FeM0OEDDW0TVFGMkk","accept-icon":"hBxp1Loj3vj4DtnculDA",acceptIcon:"hBxp1Loj3vj4DtnculDA","main-video":"lXMZESnc4CBKQbvV7qkL",mainVideo:"lXMZESnc4CBKQbvV7qkL","second-video":"cnQvI_xwAbO0EEwRcLsg",secondVideo:"cnQvI_xwAbO0EEwRcLsg",visible:"XaD79h6hSiEi0ypkn5OK",fullscreen:"NlF9_Kb2le_3B712PZnO"},xe=(0,x.X$)((0,F.c$)((e=>{const{phoneCall:t,currentUserId:a}=e,{isCallPanelVisible:n,isMasterTab:i}=(0,q.jU)(e);return{isCallPanelVisible:Boolean(n),user:(0,H.fu)(e),isOutgoing:t?.adminId===a,phoneCall:i?t:void 0,animationLevel:e.settings.byKey.animationLevel}}))((({user:e,isOutgoing:t,phoneCall:a,isCallPanelVisible:i,animationLevel:o})=>{const s=(0,oe.Z)(),{hangUp:r,requestMasterAndAcceptCall:c,playGroupCallSound:l,toggleGroupCallPanel:u,connectToActivePhoneCall:p}=(0,F.Sv)(),m=(0,x.sO)(null),[V,g,v]=(0,ie.Z)(),{isMobile:f}=(0,se.ZP)(),h=(0,x.I4)((()=>{V?v():g()}),[v,V,g]),b=(0,x.I4)((()=>{m.current&&(V?document.exitFullscreen().then(v):m.current.requestFullscreen().then(g))}),[v,V,g]);(0,x.d4)((()=>{if(!n.t0)return;const e=m.current;return e?(e.addEventListener("fullscreenchange",h),()=>{e.removeEventListener("fullscreenchange",h)}):void 0}),[h]);const P=(0,x.I4)((()=>{u(),V&&v()}),[v,V,u]),w="discarded"===a?.state,y="busy"===a?.reason,Z="requested"===a?.state&&!t,I=("requested"===a?.state||"waiting"===a?.state)&&t,E="active"===a?.state,k=a?.isConnected,[A,S,N]=(0,ie.Z)(),T=(0,x.I4)((()=>{S(),r()}),[r,S]);(0,x.d4)((()=>{A?l({sound:"end"}):Z?l({sound:"incoming"}):y?l({sound:"busy"}):w?l({sound:"end"}):I?l({sound:"ringing"}):k&&l({sound:"connect"})}),[y,w,Z,I,k,l,A]),(0,x.d4)((()=>{a?.id?N():p()}),[p,a?.id,N]);const M=(0,$e.Z)();(0,_e.Z)((()=>{M()}),k?1e3:void 0);const R=(0,x.Ye)((()=>{const e=a?.state;return A?s("lng_call_status_hanging"):y?"busy":"requesting"===e?s("lng_call_status_requesting"):"requested"===e?s(t?"lng_call_status_ringing":"lng_call_status_incoming"):"waiting"===e?s("lng_call_status_waiting"):"active"===e&&k?void 0:s("lng_call_status_exchanging")}),[y,k,A,t,s,a?.state]),_="active"===a?.videoState,$="active"===a?.screencastState,j=C?.streams,O=j?.ownAudio?.getTracks()[0].enabled,B=j?.ownPresentation?.getTracks()[0].enabled,L=j?.ownVideo?.getTracks()[0].enabled,[q,H,z]=(0,ie.Z)(),[J,X,Y]=(0,ie.Z)(),Q=(0,x.I4)((()=>{B&&H(),L&&X(),setTimeout((async()=>{await U("presentation"),z(),Y()}),250)}),[B,L,H,X,z,Y]),K=(0,x.I4)((()=>{L&&X(),B&&H(),setTimeout((async()=>{await U("video"),z(),Y()}),250)}),[B,L,H,X,z,Y]),W=(0,x.I4)((()=>{U("audio")}),[]),[ee,te,re]=(0,ie.Z)(),[le,de,pe]=(0,ie.Z)(),me=(0,x.I4)((()=>{de(),async function(){if(!C||!C.facingMode)return;const e=C.streams.ownVideo;if(!e)return;const t=e.getTracks()[0];if(!t)return;const a=C.connection.getSenders().find((e=>t.id===e.track?.id));if(a){C.facingMode="environment"===C.facingMode?"user":"environment";try{const e=await D("video",C.facingMode);await a.replaceTrack(e.getTracks()[0]),C.streams.ownVideo=e,G()}catch(e){}}}(),setTimeout(pe,250)}),[de,pe]),ge=a?.startDate&&Number(new Date)/1e3-a.startDate;return(0,x.d4)((()=>{"discarded"===a?.state&&setTimeout(r,250)}),[r,a?.reason,a?.state]),x.ZP.createElement(ue.Z,{isOpen:a&&"discarded"!==a?.state&&!i,onClose:P,className:(0,ne.Z)(Oe.root,f&&Oe.singleColumn),dialogRef:m},x.ZP.createElement(Ie.Z,{user:e,size:"jumbo",className:_||$?Oe.blurred:"",withVideo:!0,noLoop:"requesting"!==a?.state,animationLevel:o}),"active"===a?.screencastState&&j?.presentation&&x.ZP.createElement("video",{className:Oe.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:j.presentation}),"active"===a?.videoState&&j?.video&&x.ZP.createElement("video",{className:Oe.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:j.video}),x.ZP.createElement("video",{className:(0,ne.Z)(Oe.secondVideo,!q&&B&&Oe.visible,V&&Oe.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:j?.ownPresentation}),x.ZP.createElement("video",{className:(0,ne.Z)(Oe.secondVideo,!J&&L&&Oe.visible,V&&Oe.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:j?.ownVideo}),x.ZP.createElement("div",{className:Oe.header},n.t0&&x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",onClick:b,ariaLabel:s(V?"AccExitFullscreen":"AccSwitchToFullscreen")},x.ZP.createElement("i",{className:V?"icon-smallscreen":"icon-fullscreen"})),x.ZP.createElement(ce.Z,{round:!0,size:"smaller",color:"translucent",onClick:P,className:Oe.closeButton},x.ZP.createElement("i",{className:"icon-close"}))),x.ZP.createElement("div",{className:(0,ne.Z)(Oe.emojisBackdrop,ee&&Oe.open),onClick:ee?re:te},x.ZP.createElement("div",{className:(0,ne.Z)(Oe.emojis,ee&&Oe.open)},a?.isConnected&&a?.emojis&&(0,Ue.Z)(a.emojis,["emoji"])),x.ZP.createElement("div",{className:(0,ne.Z)(Oe.emojiTooltip,ee&&Oe.open)},s("CallEmojiKeyTooltip",e?.firstName).replace("%%","%"))),x.ZP.createElement("div",{className:Oe.userInfo},x.ZP.createElement("h1",null,e?.firstName),x.ZP.createElement("span",{className:Oe.status},R||(0,Re.k9)(ge||0))),x.ZP.createElement("div",{className:Oe.buttons},x.ZP.createElement(je,{onClick:W,icon:"microphone",isDisabled:!E,isActive:O,label:s(O?"lng_call_mute_audio":"lng_call_unmute_audio")}),x.ZP.createElement(je,{onClick:K,icon:"video",isDisabled:!E,isActive:L,label:s(L?"lng_call_stop_video":"lng_call_start_video")}),L&&(n.wZ||n.cj)&&x.ZP.createElement(je,{onClick:me,customIcon:x.ZP.createElement(Ve.Z,{tgsUrl:ae.l.CameraFlip,playSegment:le?[0,10]:[0,1],size:32}),isDisabled:!E,label:s("VoipFlip")}),d&&x.ZP.createElement(je,{onClick:Q,icon:"share-screen",isDisabled:!E,isActive:B,label:s("lng_call_screencast")}),Z&&x.ZP.createElement(je,{onClick:c,icon:"phone-discard",isDisabled:w,label:s("lng_call_accept"),className:Oe.accept,iconClassName:Oe.acceptIcon}),x.ZP.createElement(je,{onClick:T,icon:"phone-discard",isDisabled:w,label:s(Z?"lng_call_decline":"lng_call_end_call"),className:Oe.leave})))})));var Fe=a(97687);const Be=(0,x.X$)((({isOpen:e})=>{const{closeCallRatingModal:t,setCallRating:a}=(0,F.Sv)(),n=(0,x.sO)(null),i=(0,oe.Z)(),[o,s]=(0,x.eJ)(),r=(0,x.I4)((()=>{o?a({rating:o+1,comment:n.current?.value||""}):t()}),[t,o,a]),c=(0,x.I4)((()=>{t()}),[t]);return x.ZP.createElement(ue.Z,{title:i("lng_call_rate_label"),className:"narrow",onClose:t,isOpen:e},x.ZP.createElement("div",{className:"wLqZtZzJMOmPkr1Z7kT5"},new Array(5).fill(void 0).map(((e,t)=>{const a=void 0!==o&&o>=t;return x.ZP.createElement("i",{className:(0,ne.Z)(a?"icon-favorite-filled":"icon-favorite",a&&"o_nOyYqj5URif5S86StK","OLQPS_OeztNYIaL15tdz"),onClick:(n=t,()=>s(o===n?void 0:n))});var n}))),x.ZP.createElement(Fe.Z,{ref:n,placeholder:i("lng_call_rate_comment"),className:(0,ne.Z)("ZToDNX6q1Yhf4aDPyuJF",4!==o&&void 0!==o&&"HdCq8jVctaJoit7bdgZd")}),x.ZP.createElement("div",{className:"dialog-buttons mt-2"},x.ZP.createElement(ce.Z,{className:"confirm-dialog-button",isText:!0,onClick:r},i("Send")),x.ZP.createElement(ce.Z,{className:"confirm-dialog-button",isText:!0,onClick:c},i("Cancel"))))}));(n.s$||n.cj)&&document.addEventListener("click",i.o5,{once:!0})},88422:(e,t,a)=>{a.d(t,{CW:()=>N,EP:()=>y,FF:()=>k,Mt:()=>S,NH:()=>A,o5:()=>w});var n=a(33555),i=a(71226),o=a(11192),s=a(64319),r=a(25184),c=a(25260),l=a(78958),d=a(42431),u=a(56112),p=a(60782),m=a(74753),V=a(77361),g=a(50711),v=a(44271),f=a(65054);const C="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let h,b,P;function w(){return y(),Promise.all(Object.values(P).map((e=>{const t=e.src;return e.src=C,e.muted=!0,e.volume=1e-4,e.play().then((()=>{e.pause(),e.volume=1,e.currentTime=0,e.muted=!1,requestAnimationFrame((()=>{e.src=t}))}))})))}function y(){if(P)return;const e=new Audio("./voicechat_join.mp3"),t=new Audio("./voicechat_connecting.mp3");t.loop=!0;const a=new Audio("./voicechat_leave.mp3"),n=new Audio("./voicechat_onallowtalk.mp3"),i=new Audio("./call_busy.mp3"),o=new Audio("./call_connect.mp3"),s=new Audio("./call_end.mp3"),r=new Audio("./call_incoming.mp3");r.loop=!0;const c=new Audio("./call_ringing.mp3");c.loop=!0,P={join:e,allowTalk:n,leave:a,connecting:t,incoming:r,end:s,connect:o,busy:i,ringing:c}}async function Z(e,t){const a=await(0,i.t9)("getGroupCall",{call:t});if(!a)return;e=(0,n.Rd)();const o=(0,d.$5)(e,t.id);return e=(0,l.AH)(e,t.id,(0,p.CE)(a.groupCall,["connectionState"]),void 0,o?.isLoaded?void 0:a.groupCall.participantsCount),e=(0,c.Sh)(e,(0,p.ee)(a.users,"id")),e=(0,c.fZ)(e,(0,p.ee)(a.chats,"id")),(0,n.R3)(e),a.groupCall}async function I(e,t,a){const o=await(0,i.t9)("fetchGroupCallParticipants",{call:t,offset:a});o&&(e=(0,n.Rd)(),e=(0,c.Sh)(e,(0,p.ee)(o.users,"id")),e=(0,c.fZ)(e,(0,p.ee)(o.chats,"id")),(0,n.R3)(e))}(0,n.iw)("toggleGroupCallPanel",((e,t,a)=>{const{force:n,tabId:i=(0,f._w)()}=a||{};return(0,v.i)(e,{isCallPanelVisible:"force"in(a||{})?n:!(0,o.jU)(e,i).isCallPanelVisible},i)})),(0,n.iw)("subscribeToGroupCallUpdates",(async(e,t,a)=>{const{subscribed:o,id:s}=a,r=(0,d.$5)(e,s);r&&(o&&(await Z(e,r),e=(0,n.Rd)(),await I(e,r)),await(0,i.t9)("toggleGroupCallStartSubscription",{subscribed:o,call:r}))})),(0,n.iw)("createGroupCall",(async(e,t,a)=>{const{chatId:s,tabId:r=(0,f._w)()}=a,c=(0,o.Z1)(e,s);if(!c)return;const d=await(0,i.t9)("createGroupCall",{peer:c});d&&(e=(0,n.Rd)(),e=(0,l.AH)(e,d.id,{...d,chatId:s}),(0,n.R3)(e),t.requestMasterAndJoinGroupCall({id:d.id,accessHash:d.accessHash,tabId:r}))})),(0,n.iw)("createGroupCallInviteLink",(async(e,t,a)=>{const{tabId:n=(0,f._w)()}=a||{},r=(0,d.mU)(e);if(!r||!r.chatId)return;const c=(0,o.Z1)(e,r.chatId);if(!c)return;const l=Boolean((0,u.WS)(c));let{inviteLink:p}=c.fullInfo;l&&(p=await(0,i.t9)("exportGroupCallInvite",{call:r,canSelfUnmute:!1})),p&&((0,s.TE)(p),t.showNotification({message:"Link copied to clipboard",tabId:n}))})),(0,n.iw)("joinVoiceChatByLink",(async(e,t,a)=>{const{username:i,inviteHash:o,tabId:s=(0,f._w)()}=a,c=await(0,r.Co)(e,i);if(!c)return void t.showNotification({message:g.Iu("NoUsernameFound"),tabId:s});e=(0,n.Rd)();const l=await(0,r.ft)(e,t,c,s);l?.groupCall&&t.requestMasterAndJoinGroupCall({id:l.groupCall.id,accessHash:l.groupCall.accessHash,inviteHash:o,tabId:s})})),(0,n.iw)("requestMasterAndJoinGroupCall",((e,t,a)=>{t.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,f._w)()})})),(0,n.iw)("requestMasterAndAcceptCall",((e,t,a)=>{t.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,f._w)()})})),(0,n.iw)("joinGroupCall",(async(e,t,a)=>{const{chatId:i,id:o,accessHash:s,inviteHash:r,tabId:c=(0,f._w)()}=a;if(!V.Bi)return;if(e.phoneCall)return void t.toggleGroupCallPanel({tabId:c});!function(){const e=new(window.AudioContext||window.webkitAudioContext);h=new Audio,b=e,h.srcObject=E(e),(0,m.Z)(h)}(),y(),N(e=(0,n.Rd)(),t,!0,c);const{groupCalls:{activeGroupCallId:u}}=e;let p=o?(0,d.$5)(e,o):(0,d.Bj)(e,i);p?.id!==u?u?"leaveGroupCall"in t&&t.leaveGroupCall({rejoin:a,tabId:c}):p&&u===p.id?t.toggleGroupCallPanel({tabId:c}):(p||o&&s||(p=await Z(e,{id:o,accessHash:s})),p&&(e=(0,n.Rd)(),e=(0,l.AH)(e,p.id,{...p,inviteHash:r},void 0,p.participantsCount+1),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:p.id}},(0,n.R3)(e),t.toggleGroupCallPanel({force:!1,tabId:c}))):t.toggleGroupCallPanel({tabId:c})})),(0,n.iw)("playGroupCallSound",((e,t,a)=>{const{sound:n}=a;P[n]&&("connecting"!==n&&P.connecting.pause(),"incoming"!==n&&P.incoming.pause(),"ringing"!==n&&P.ringing.pause(),(0,m.Z)(P[n]))})),(0,n.iw)("loadMoreGroupCallParticipants",(e=>{const t=(0,d.mU)(e);t&&I(e,t,t.nextOffset)})),(0,n.iw)("requestMasterAndRequestCall",((e,t,a)=>{t.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,f._w)()})})),(0,n.iw)("requestCall",(async(e,t,a)=>{const{userId:i,isVideo:s,tabId:r=(0,f._w)()}=a;e.phoneCall?t.toggleGroupCallPanel({tabId:r}):(0,o.dy)(e,i)&&(y(),N(e=(0,n.Rd)(),t,s,r),e=(0,n.Rd)(),e={...e,phoneCall:{id:"",state:"requesting",participantId:i,isVideo:s,adminId:e.currentUserId}},(0,n.R3)(e),t.toggleGroupCallPanel({force:!1,tabId:r}))}));const E=e=>{const t=e.createOscillator(),a=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function k(){return h}function A(){return b}function S(){h?.pause(),b=void 0,h=void 0}function N(e,t,a,...[n=(0,f._w)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{0===e.getVideoTracks().length?t.showNotification({message:g.Iu("Call.Camera.Error"),tabId:n}):T(0,t,n)})).catch((()=>{t.showNotification({message:g.Iu("Call.Camera.Error"),tabId:n})})):T(0,t,n)}function T(e,t,...[a=(0,f._w)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{0===e.getAudioTracks().length&&t.showNotification({message:g.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})).catch((()=>{t.showNotification({message:g.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})}))}}}]);
//# sourceMappingURL=9954.957d966eca2ea8f2e2cc.js.map